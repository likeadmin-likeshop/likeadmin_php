import{a8 as ze,al as sr,d as ve,P as Ye,o as H,c as q,f as ce,w as $,W as Mt,h as B,p as Fe,i as Q,T as J,U as he,X as it,$ as St,a9 as ue,k as le,ct as or,cu as Nt,ay as lr,cv as Bt,cw as Ut,ab as ur,D as At,e as j,q as Te,t as ie,ac as bt,au as dr,am as vt,aA as Ee,cx as cr,r as se,bR as Pe,v as Ue,a as K,cy as fr,az as Re,cz as hr,cA as gr,V as Ae,cb as pr,H as vr,y as Gt,aq as tt,cB as mr,cC as yr,L as Ge,M as Er,O as Tr,ap as Sr,ad as br,Y as Lr,av as kr,bp as _t,ax as ct,_ as lt,s as ut,cD as Ar,cE as _r,aO as mt,g as ee,E as jt,cF as Dr,cG as Rr,cH as Cr,cI as Ir,l as rt,cJ as wr,cK as Or,cL as Fr,cM as Pr,Q as me,aw as Se,m as Lt,b as Vt,ak as yt,an as xr,bO as je,bN as Ve,cl as kt,K as ft,N as Mr,cN as Nr,S as Br,Z as Ur,cO as Gr,cP as jr,cQ as Vr,cR as Kr,cS as Hr,cT as Wr,cU as $r}from"./index.f6e05cbe.js";import{v as qr}from"./el-loading.8596fac6.js";import{P as Kt}from"./index.efc5949b.js";import{E as Yr,a as zr}from"./el-table-column.2d4289c5.js";import{E as Xr}from"./el-checkbox.63373ee7.js";import"./el-tag.0d2c783e.js";import{E as Ht}from"./el-input.55902c84.js";import{E as Qr,a as Zr}from"./el-select.4dd1729b.js";import{P as Wt}from"./index.04796e48.js";import{E as $t}from"./el-overlay.b28b5fac.js";import{E as Jr}from"./el-tree.9509dcae.js";import{E as ei}from"./el-popover.1d532e47.js";import{u as ti}from"./pages.9343f4a5.js";import{E as ri,a as ii}from"./el-image-viewer.7be667db.js";const qt=Symbol("uploadContextKey"),ni=ze({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},href:{type:String,default:""},icon:{type:sr,default:""}}),ai={click:F=>F instanceof MouseEvent},si=["href"],oi={name:"ElLink"},li=ve({...oi,props:ni,emits:ai,setup(F,{emit:C}){const f=F,_=Ye("link");function T(S){f.disabled||C("click",S)}return(S,D)=>(H(),q("a",{class:J([B(_).b(),B(_).m(S.type),B(_).is("disabled",S.disabled),B(_).is("underline",S.underline&&!S.disabled)]),href:S.disabled||!S.href?void 0:S.href,onClick:T},[S.icon?(H(),ce(B(Fe),{key:0},{default:$(()=>[(H(),ce(Mt(S.icon)))]),_:1})):Q("v-if",!0),S.$slots.default?(H(),q("span",{key:1,class:J(B(_).e("inner"))},[he(S.$slots,"default")],2)):Q("v-if",!0),S.$slots.icon?he(S.$slots,"icon",{key:2}):Q("v-if",!0)],10,si))}});var ui=it(li,[["__file","/home/runner/work/element-plus/element-plus/packages/components/link/src/link.vue"]]);const di=St(ui),ci=ze({type:{type:String,default:"line",values:["line","circle","dashboard"]},percentage:{type:Number,default:0,validator:F=>F>=0&&F<=100},status:{type:String,default:"",values:["","success","exception","warning"]},indeterminate:{type:Boolean,default:!1},duration:{type:Number,default:3},strokeWidth:{type:Number,default:6},strokeLinecap:{type:ue(String),default:"round"},textInside:{type:Boolean,default:!1},width:{type:Number,default:126},showText:{type:Boolean,default:!0},color:{type:ue([String,Array,Function]),default:""},format:{type:ue(Function),default:F=>`${F}%`}}),fi=["aria-valuenow"],hi={viewBox:"0 0 100 100"},gi=["d","stroke","stroke-width"],pi=["d","stroke","opacity","stroke-linecap","stroke-width"],vi={key:0},mi={name:"ElProgress"},yi=ve({...mi,props:ci,setup(F){const C=F,f={success:"#13ce66",exception:"#ff4949",warning:"#e6a23c",default:"#20a0ff"},_=Ye("progress"),T=le(()=>({width:`${C.percentage}%`,animationDuration:`${C.duration}s`,backgroundColor:t(C.percentage)})),S=le(()=>(C.strokeWidth/C.width*100).toFixed(1)),D=le(()=>["circle","dashboard"].includes(C.type)?Number.parseInt(`${50-Number.parseFloat(S.value)/2}`,10):0),I=le(()=>{const n=D.value,u=C.type==="dashboard";return`
          M 50 50
          m 0 ${u?"":"-"}${n}
          a ${n} ${n} 0 1 1 0 ${u?"-":""}${n*2}
          a ${n} ${n} 0 1 1 0 ${u?"":"-"}${n*2}
          `}),R=le(()=>2*Math.PI*D.value),o=le(()=>C.type==="dashboard"?.75:1),b=le(()=>`${-1*R.value*(1-o.value)/2}px`),y=le(()=>({strokeDasharray:`${R.value*o.value}px, ${R.value}px`,strokeDashoffset:b.value})),d=le(()=>({strokeDasharray:`${R.value*o.value*(C.percentage/100)}px, ${R.value}px`,strokeDashoffset:b.value,transition:"stroke-dasharray 0.6s ease 0s, stroke 0.6s ease, opacity ease 0.6s"})),p=le(()=>{let n;return C.color?n=t(C.percentage):n=f[C.status]||f.default,n}),m=le(()=>C.status==="warning"?or:C.type==="line"?C.status==="success"?Nt:lr:C.status==="success"?Bt:Ut),l=le(()=>C.type==="line"?12+C.strokeWidth*.4:C.width*.111111+2),e=le(()=>C.format(C.percentage));function i(n){const u=100/n.length;return n.map((c,E)=>At(c)?{color:c,percentage:(E+1)*u}:c).sort((c,E)=>c.percentage-E.percentage)}const t=n=>{var u;const{color:a}=C;if(ur(a))return a(n);if(At(a))return a;{const c=i(a);for(const E of c)if(E.percentage>n)return E.color;return(u=c[c.length-1])==null?void 0:u.color}};return(n,u)=>(H(),q("div",{class:J([B(_).b(),B(_).m(n.type),B(_).is(n.status),{[B(_).m("without-text")]:!n.showText,[B(_).m("text-inside")]:n.textInside}]),role:"progressbar","aria-valuenow":n.percentage,"aria-valuemin":"0","aria-valuemax":"100"},[n.type==="line"?(H(),q("div",{key:0,class:J(B(_).b("bar"))},[j("div",{class:J(B(_).be("bar","outer")),style:Te({height:`${n.strokeWidth}px`})},[j("div",{class:J([B(_).be("bar","inner"),{[B(_).bem("bar","inner","indeterminate")]:n.indeterminate}]),style:Te(B(T))},[(n.showText||n.$slots.default)&&n.textInside?(H(),q("div",{key:0,class:J(B(_).be("bar","innerText"))},[he(n.$slots,"default",{percentage:n.percentage},()=>[j("span",null,ie(B(e)),1)])],2)):Q("v-if",!0)],6)],6)],2)):(H(),q("div",{key:1,class:J(B(_).b("circle")),style:Te({height:`${n.width}px`,width:`${n.width}px`})},[(H(),q("svg",hi,[j("path",{class:J(B(_).be("circle","track")),d:B(I),stroke:`var(${B(_).cssVarName("fill-color-light")}, #e5e9f2)`,"stroke-width":B(S),fill:"none",style:Te(B(y))},null,14,gi),j("path",{class:J(B(_).be("circle","path")),d:B(I),stroke:B(p),fill:"none",opacity:n.percentage?1:0,"stroke-linecap":n.strokeLinecap,"stroke-width":B(S),style:Te(B(d))},null,14,pi)]))],6)),(n.showText||n.$slots.default)&&!n.textInside?(H(),q("div",{key:2,class:J(B(_).e("text")),style:Te({fontSize:`${B(l)}px`})},[he(n.$slots,"default",{percentage:n.percentage},()=>[n.status?(H(),ce(B(Fe),{key:1},{default:$(()=>[(H(),ce(Mt(B(m))))]),_:1})):(H(),q("span",vi,ie(B(e)),1))])],6)):Q("v-if",!0)],10,fi))}});var Ei=it(yi,[["__file","/home/runner/work/element-plus/element-plus/packages/components/progress/src/progress.vue"]]);const Yt=St(Ei),Ti="ElUpload";class Si extends Error{constructor(C,f,_,T){super(C),this.name="UploadAjaxError",this.status=f,this.method=_,this.url=T}}function Dt(F,C,f){let _;return f.response?_=`${f.response.error||f.response}`:f.responseText?_=`${f.responseText}`:_=`fail to ${C.method} ${F} ${f.status}`,new Si(_,f.status,C.method,F)}function bi(F){const C=F.responseText||F.response;if(!C)return C;try{return JSON.parse(C)}catch{return C}}const Li=F=>{typeof XMLHttpRequest=="undefined"&&bt(Ti,"XMLHttpRequest is undefined");const C=new XMLHttpRequest,f=F.action;C.upload&&C.upload.addEventListener("progress",S=>{const D=S;D.percent=S.total>0?S.loaded/S.total*100:0,F.onProgress(D)});const _=new FormData;if(F.data)for(const[S,D]of Object.entries(F.data))Array.isArray(D)?_.append(S,...D):_.append(S,D);_.append(F.filename,F.file,F.file.name),C.addEventListener("error",()=>{F.onError(Dt(f,F,C))}),C.addEventListener("load",()=>{if(C.status<200||C.status>=300)return F.onError(Dt(f,F,C));F.onSuccess(bi(C))}),C.open(F.method,f,!0),F.withCredentials&&"withCredentials"in C&&(C.withCredentials=!0);const T=F.headers||{};if(T instanceof Headers)T.forEach((S,D)=>C.setRequestHeader(D,S));else for(const[S,D]of Object.entries(T))dr(D)||C.setRequestHeader(S,String(D));return C.send(_),C},zt=["text","picture","picture-card"];let ki=1;const Xt=()=>Date.now()+ki++,Qt=ze({action:{type:String,default:"#"},headers:{type:ue(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>vt({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:ue(Array),default:()=>vt([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:zt,default:"text"},httpRequest:{type:ue(Function),default:Li},disabled:Boolean,limit:Number}),Ai=ze({...Qt,beforeUpload:{type:ue(Function),default:Ee},beforeRemove:{type:ue(Function)},onRemove:{type:ue(Function),default:Ee},onChange:{type:ue(Function),default:Ee},onPreview:{type:ue(Function),default:Ee},onSuccess:{type:ue(Function),default:Ee},onProgress:{type:ue(Function),default:Ee},onError:{type:ue(Function),default:Ee},onExceed:{type:ue(Function),default:Ee}}),_i=ze({files:{type:ue(Array),default:()=>vt([])},disabled:{type:Boolean,default:!1},handlePreview:{type:ue(Function),default:Ee},listType:{type:String,values:zt,default:"text"}}),Di={remove:F=>!!F},Ri=["onKeydown"],Ci=["src"],Ii=["onClick"],wi=["onClick"],Oi=["onClick"],Fi={name:"ElUploadList"},Pi=ve({...Fi,props:_i,emits:Di,setup(F,{emit:C}){const f=F,{t:_}=cr(),T=Ye("upload"),S=Ye("icon"),D=Ye("list"),I=se(!1),R=b=>{f.handlePreview(b)},o=b=>{C("remove",b)};return(b,y)=>(H(),ce(pr,{tag:"ul",class:J([B(T).b("list"),B(T).bm("list",b.listType),B(T).is("disabled",b.disabled)]),name:B(D).b()},{default:$(()=>[(H(!0),q(Ae,null,Pe(b.files,d=>(H(),q("li",{key:d.uid||d.name,class:J([B(T).be("list","item"),B(T).is(d.status),{focusing:I.value}]),tabindex:"0",onKeydown:Ue(p=>!b.disabled&&o(d),["delete"]),onFocus:y[0]||(y[0]=p=>I.value=!0),onBlur:y[1]||(y[1]=p=>I.value=!1),onClick:y[2]||(y[2]=p=>I.value=!1)},[he(b.$slots,"default",{file:d},()=>[b.listType==="picture"||d.status!=="uploading"&&b.listType==="picture-card"?(H(),q("img",{key:0,class:J(B(T).be("list","item-thumbnail")),src:d.url,alt:""},null,10,Ci)):Q("v-if",!0),b.listType!=="picture"&&(d.status==="uploading"||b.listType!=="picture-card")?(H(),q("div",{key:1,class:J(B(T).be("list","item-info"))},[j("a",{class:J(B(T).be("list","item-name")),onClick:Re(p=>R(d),["prevent"])},[K(B(Fe),{class:J(B(S).m("document"))},{default:$(()=>[K(B(fr))]),_:1},8,["class"]),j("span",{class:J(B(T).be("list","item-file-name"))},ie(d.name),3)],10,Ii),d.status==="uploading"?(H(),ce(B(Yt),{key:0,type:b.listType==="picture-card"?"circle":"line","stroke-width":b.listType==="picture-card"?6:2,percentage:Number(d.percentage),style:Te(b.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):Q("v-if",!0)],2)):Q("v-if",!0),j("label",{class:J(B(T).be("list","item-status-label"))},[b.listType==="text"?(H(),ce(B(Fe),{key:0,class:J([B(S).m("upload-success"),B(S).m("circle-check")])},{default:$(()=>[K(B(Nt))]),_:1},8,["class"])):["picture-card","picture"].includes(b.listType)?(H(),ce(B(Fe),{key:1,class:J([B(S).m("upload-success"),B(S).m("check")])},{default:$(()=>[K(B(Bt))]),_:1},8,["class"])):Q("v-if",!0)],2),b.disabled?Q("v-if",!0):(H(),ce(B(Fe),{key:2,class:J(B(S).m("close")),onClick:p=>o(d)},{default:$(()=>[K(B(Ut))]),_:2},1032,["class","onClick"])),Q(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),Q(" This is a bug which needs to be fixed "),Q(" TODO: Fix the incorrect navigation interaction "),b.disabled?Q("v-if",!0):(H(),q("i",{key:3,class:J(B(S).m("close-tip"))},ie(B(_)("el.upload.deleteTip")),3)),b.listType==="picture-card"?(H(),q("span",{key:4,class:J(B(T).be("list","item-actions"))},[j("span",{class:J(B(T).be("list","item-preview")),onClick:p=>b.handlePreview(d)},[K(B(Fe),{class:J(B(S).m("zoom-in"))},{default:$(()=>[K(B(hr))]),_:1},8,["class"])],10,wi),b.disabled?Q("v-if",!0):(H(),q("span",{key:0,class:J(B(T).be("list","item-delete")),onClick:p=>o(d)},[K(B(Fe),{class:J(B(S).m("delete"))},{default:$(()=>[K(B(gr))]),_:1},8,["class"])],10,Oi))],2)):Q("v-if",!0)])],42,Ri))),128)),he(b.$slots,"append")]),_:3},8,["class","name"]))}});var Rt=it(Pi,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const xi=ze({disabled:{type:Boolean,default:!1}}),Mi={file:F=>vr(F)},Ni=["onDrop","onDragover"],Bi={name:"ElUploadDrag"},Ui=ve({...Bi,props:xi,emits:Mi,setup(F,{emit:C}){const f=F,_="ElUploadDrag",T=Gt(qt);T||bt(_,"usage: <el-upload><el-upload-dragger /></el-upload>");const S=Ye("upload"),D=se(!1),I=o=>{if(f.disabled)return;D.value=!1;const b=Array.from(o.dataTransfer.files),y=T.accept.value;if(!y){C("file",b);return}const d=b.filter(p=>{const{type:m,name:l}=p,e=l.includes(".")?`.${l.split(".").pop()}`:"",i=m.replace(/\/.*$/,"");return y.split(",").map(t=>t.trim()).filter(t=>t).some(t=>t.startsWith(".")?e===t:/\/\*$/.test(t)?i===t.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(t)?m===t:!1)});C("file",d)},R=()=>{f.disabled||(D.value=!0)};return(o,b)=>(H(),q("div",{class:J([B(S).b("dragger"),B(S).is("dragover",D.value)]),onDrop:Re(I,["prevent"]),onDragover:Re(R,["prevent"]),onDragleave:b[0]||(b[0]=Re(y=>D.value=!1,["prevent"]))},[he(o.$slots,"default")],42,Ni))}});var Gi=it(Ui,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const ji=ze({...Qt,beforeUpload:{type:ue(Function),default:Ee},onRemove:{type:ue(Function),default:Ee},onStart:{type:ue(Function),default:Ee},onSuccess:{type:ue(Function),default:Ee},onProgress:{type:ue(Function),default:Ee},onError:{type:ue(Function),default:Ee},onExceed:{type:ue(Function),default:Ee}}),Vi=["onKeydown"],Ki=["name","multiple","accept"],Hi={name:"ElUploadContent",inheritAttrs:!1},Wi=ve({...Hi,props:ji,setup(F,{expose:C}){const f=F,_=Ye("upload"),T=tt({}),S=tt(),D=p=>{if(p.length===0)return;const{autoUpload:m,limit:l,fileList:e,multiple:i,onStart:t,onExceed:n}=f;if(l&&e.length+p.length>l){n(p,e);return}i||(p=p.slice(0,1));for(const u of p){const a=u;a.uid=Xt(),t(a),m&&I(a)}},I=async p=>{if(S.value.value="",!f.beforeUpload)return R(p);let m;try{m=await f.beforeUpload(p)}catch{m=!1}if(m===!1){f.onRemove(p);return}let l=p;m instanceof Blob&&(m instanceof File?l=m:l=new File([m],p.name,{type:p.type})),R(Object.assign(l,{uid:p.uid}))},R=p=>{const{headers:m,data:l,method:e,withCredentials:i,name:t,action:n,onProgress:u,onSuccess:a,onError:c,httpRequest:E}=f,{uid:g}=p,v={headers:m||{},withCredentials:i,file:p,data:l,method:e,filename:t,action:n,onProgress:s=>{u(s,p)},onSuccess:s=>{a(s,p),delete T.value[g]},onError:s=>{c(s,p),delete T.value[g]}},r=E(v);T.value[g]=r,r instanceof Promise&&r.then(v.onSuccess,v.onError)},o=p=>{const m=p.target.files;!m||D(Array.from(m))},b=()=>{f.disabled||(S.value.value="",S.value.click())},y=()=>{b()};return C({abort:p=>{mr(T.value).filter(p?([l])=>String(p.uid)===l:()=>!0).forEach(([l,e])=>{e instanceof XMLHttpRequest&&e.abort(),delete T.value[l]})},upload:I}),(p,m)=>(H(),q("div",{class:J([B(_).b(),B(_).m(p.listType),B(_).is("drag",p.drag)]),tabindex:"0",onClick:b,onKeydown:Ue(Re(y,["self"]),["enter","space"])},[p.drag?(H(),ce(Gi,{key:0,disabled:p.disabled,onFile:D},{default:$(()=>[he(p.$slots,"default")]),_:3},8,["disabled"])):he(p.$slots,"default",{key:1}),j("input",{ref_key:"inputRef",ref:S,class:J(B(_).e("input")),name:p.name,multiple:p.multiple,accept:p.accept,type:"file",onChange:o,onClick:m[0]||(m[0]=Re(()=>{},["stop"]))},null,42,Ki)],42,Vi))}});var Ct=it(Wi,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const It="ElUpload",$i=F=>{var C;(C=F.url)!=null&&C.startsWith("blob:")&&URL.revokeObjectURL(F.url)},qi=(F,C)=>{const f=yr(F,"fileList",void 0,{passive:!0}),_=d=>f.value.find(p=>p.uid===d.uid);function T(d){var p;(p=C.value)==null||p.abort(d)}function S(d=["ready","uploading","success","fail"]){f.value=f.value.filter(p=>!d.includes(p.status))}const D=(d,p)=>{const m=_(p);!m||(console.error(d),m.status="fail",f.value.splice(f.value.indexOf(m),1),F.onError(d,m,f.value),F.onChange(m,f.value))},I=(d,p)=>{const m=_(p);!m||(F.onProgress(d,m,f.value),m.status="uploading",m.percentage=Math.round(d.percent))},R=(d,p)=>{const m=_(p);!m||(m.status="success",m.response=d,F.onSuccess(d,m,f.value),F.onChange(m,f.value))},o=d=>{const p={name:d.name,percentage:0,status:"ready",size:d.size,raw:d,uid:d.uid};if(F.listType==="picture-card"||F.listType==="picture")try{p.url=URL.createObjectURL(d)}catch(m){Er(It,m.message),F.onError(m,p,f.value)}f.value.push(p),F.onChange(p,f.value)},b=async d=>{const p=d instanceof File?_(d):d;p||bt(It,"file to be removed not found");const m=l=>{T(l);const e=f.value;e.splice(e.indexOf(l),1),F.onRemove(l,e),$i(l)};F.beforeRemove?await F.beforeRemove(p,f.value)!==!1&&m(p):m(p)};function y(){f.value.filter(({status:d})=>d==="ready").forEach(({raw:d})=>{var p;return d&&((p=C.value)==null?void 0:p.upload(d))})}return Ge(()=>F.listType,d=>{d!=="picture-card"&&d!=="picture"||(f.value=f.value.map(p=>{const{raw:m,url:l}=p;if(!l&&m)try{p.url=URL.createObjectURL(m)}catch(e){F.onError(e,p,f.value)}return p}))}),Ge(f,d=>{for(const p of d)p.uid||(p.uid=Xt()),p.status||(p.status="success")},{immediate:!0,deep:!0}),{uploadFiles:f,abort:T,clearFiles:S,handleError:D,handleProgress:I,handleStart:o,handleSuccess:R,handleRemove:b,submit:y}},Yi={name:"ElUpload"},zi=ve({...Yi,props:Ai,setup(F,{expose:C}){const f=F,_=Tr(),T=Sr(),S=tt(),{abort:D,submit:I,clearFiles:R,uploadFiles:o,handleStart:b,handleError:y,handleRemove:d,handleSuccess:p,handleProgress:m}=qi(f,S),l=le(()=>f.listType==="picture-card"),e=le(()=>({...f,onStart:b,onProgress:m,onSuccess:p,onError:y,onRemove:d}));return br(()=>{o.value.forEach(({url:i})=>{i!=null&&i.startsWith("blob:")&&URL.revokeObjectURL(i)})}),Lr(qt,{accept:kr(f,"accept")}),C({abort:D,submit:I,clearFiles:R,handleStart:b,handleRemove:d}),(i,t)=>(H(),q("div",null,[B(l)&&i.showFileList?(H(),ce(Rt,{key:0,disabled:B(T),"list-type":i.listType,files:B(o),"handle-preview":i.onPreview,onRemove:B(d)},_t({append:$(()=>[i.listType==="picture-card"?(H(),ce(Ct,ct({key:0,ref_key:"uploadRef",ref:S},B(e)),{default:$(()=>[B(_).trigger?he(i.$slots,"trigger",{key:0}):Q("v-if",!0),!B(_).trigger&&B(_).default?he(i.$slots,"default",{key:1}):Q("v-if",!0)]),_:3},16)):Q("v-if",!0)]),_:2},[i.$slots.file?{name:"default",fn:$(({file:n})=>[he(i.$slots,"file",{file:n})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):Q("v-if",!0),i.listType!=="picture-card"?(H(),ce(Ct,ct({key:1,ref_key:"uploadRef",ref:S},B(e)),{default:$(()=>[B(_).trigger?he(i.$slots,"trigger",{key:0}):Q("v-if",!0),!B(_).trigger&&B(_).default?he(i.$slots,"default",{key:1}):Q("v-if",!0)]),_:3},16)):Q("v-if",!0),i.$slots.trigger?he(i.$slots,"default",{key:2}):Q("v-if",!0),he(i.$slots,"tip"),!B(l)&&i.showFileList?(H(),ce(Rt,{key:3,disabled:B(T),"list-type":i.listType,files:B(o),"handle-preview":i.onPreview,onRemove:B(d)},_t({_:2},[i.$slots.file?{name:"default",fn:$(({file:n})=>[he(i.$slots,"file",{file:n})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):Q("v-if",!0)]))}});var Xi=it(zi,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const Qi=St(Xi);const Zi=ve({components:{},props:{showClose:{type:Boolean,default:!0}},emits:["close"],setup(F,{emit:C}){return{handleClose:()=>{C("close")}}}}),Ji={class:"del-wrap"};function en(F,C,f,_,T,S){const D=ut("close-bold"),I=Fe;return H(),q("div",Ji,[he(F.$slots,"default",{},void 0,!0),F.showClose?(H(),q("div",{key:0,class:"icon-close",onClick:C[0]||(C[0]=Re((...R)=>F.handleClose&&F.handleClose(...R),["stop"]))},[K(I,{size:12},{default:$(()=>[K(D)]),_:1})])):Q("",!0)])}var tn=lt(Zi,[["render",en],["__scopeId","data-v-77bc45f0"]]);const rn=ve({props:{uri:{type:String},fileSize:{type:String,default:"100px"},type:{type:String,default:"image"}},emits:["close"],setup(){}}),nn=["src"];function an(F,C,f,_,T,S){const D=ri;return H(),q("div",null,[j("div",{class:"file-item",style:Te({height:F.fileSize,width:F.fileSize})},[F.type=="image"?(H(),ce(D,{key:0,class:"image",fit:"contain",src:F.uri},null,8,["src"])):F.type=="video"?(H(),q("video",{key:1,class:"video",src:F.uri},null,8,nn)):Q("",!0),he(F.$slots,"default",{},void 0,!0)],4)])}var sn=lt(rn,[["render",an],["__scopeId","data-v-442b376a"]]);const on=ve({components:{},props:{type:{type:String,default:"image"},multiple:{type:Boolean,default:!0},limit:{type:Number,default:10},data:{type:Object,default:()=>({})},showProgress:{type:Boolean,default:!1}},emits:["change","error"],setup(F,{emit:C}){const f=Ar(),_=se(null),T=se(`https://likeadmin.yixiangonline.com/adminapi/upload/${F.type}`),S=le(()=>({token:f.getters.token,version:_r})),D=se(!1),I=se([]);return{uploadRefs:_,action:T,headers:S,visible:D,fileList:I,handleProgress:(p,m,l)=>{D.value=!0,I.value=l},handleSuccess:(p,m,l)=>{var i;l.every(t=>t.status=="success")&&((i=_.value)==null||i.clearFiles(),D.value=!1,C("change"))},handleError:(p,m,l)=>{var e;mt.error(`${m.name}\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25`),(e=_.value)==null||e.abort(),D.value=!1,C("change"),C("error")},handleExceed:()=>{mt.error("\u8D85\u51FA\u4E0A\u4F20\u4E0A\u9650\uFF0C\u8BF7\u91CD\u65B0\u4E0A\u4F20")},handleClose:()=>{var p,m;(p=_.value)==null||p.abort(),(m=_.value)==null||m.clearFiles(),D.value=!1}}}}),ln={class:"upload"},un={class:"file-list"},dn={class:"flex-1"};function cn(F,C,f,_,T,S){const D=Qi,I=Yt,R=$t;return H(),q("div",ln,[K(D,{ref:"uploadRefs",action:F.action,multiple:F.multiple,limit:F.limit,"show-file-list":!1,headers:F.headers,data:F.data,"on-progress":F.handleProgress,"on-success":F.handleSuccess,"on-exceed":F.handleExceed,"on-error":F.handleError},{default:$(()=>[he(F.$slots,"default")]),_:3},8,["action","multiple","limit","headers","data","on-progress","on-success","on-exceed","on-error"]),F.showProgress&&F.fileList.length?(H(),ce(R,{key:0,modelValue:F.visible,"onUpdate:modelValue":C[0]||(C[0]=o=>F.visible=o),title:"\u4E0A\u4F20\u8FDB\u5EA6","close-on-click-modal":!1,width:"500px",modal:!1,"before-close":F.handleClose},{default:$(()=>[j("div",un,[(H(!0),q(Ae,null,Pe(F.fileList,(o,b)=>(H(),q("div",{key:b,class:"m-b-20"},[j("div",null,ie(o.name),1),j("div",dn,[K(I,{percentage:parseInt(o.percentage)},null,8,["percentage"])])]))),128))])]),_:1},8,["modelValue","before-close"])):Q("",!0)])}var Zt=lt(on,[["render",cn]]);const fn=ve({props:{type:{type:String,default:"number"},width:{type:Number,default:250},value:{type:String},placeholder:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["confirm"],setup(F,{emit:C}){const f=se(!1),_=se(F.value),T=()=>{F.disabled||(f.value=!0)},S=()=>{f.value=!1};return{visible:f,inputValue:_,open:T,close:S,handleConfirm:()=>{_.value&&(C("confirm",_.value),_.value=""),S()}}}}),hn={class:"popover-input"},gn={class:"flex"},pn={class:"popover-input__input m-r-10 flex-1"},vn={class:"popover-input__btns flex-none"},mn=ee("\u53D6\u6D88"),yn=ee("\u786E\u5B9A");function En(F,C,f,_,T,S){const D=Ht,I=jt,R=ei;return H(),q("div",hn,[K(R,{visible:F.visible,"onUpdate:visible":C[2]||(C[2]=o=>F.visible=o),placement:"top",width:F.width},{reference:$(()=>[j("div",{class:"inline",type:"text",onClick:C[1]||(C[1]=(...o)=>F.open&&F.open(...o))},[he(F.$slots,"default")])]),default:$(()=>[j("div",gn,[j("div",pn,[K(D,{modelValue:F.inputValue,"onUpdate:modelValue":C[0]||(C[0]=o=>F.inputValue=o),modelModifiers:{trim:!0},type:F.type,placeholder:F.placeholder},null,8,["modelValue","type","placeholder"])]),j("div",vn,[K(I,{type:"text",onClick:F.close},{default:$(()=>[mn]),_:1},8,["onClick"]),K(I,{type:"primary",onClick:F.handleConfirm},{default:$(()=>[yn]),_:1},8,["onClick"])])])]),_:3},8,["visible","width"])])}var Jt=lt(fn,[["render",En]]);function Tn(F){const C=se([]),f=se(""),_=I=>{Dr({type:F.value,pid:0,name:I}).then(()=>{D()})},T=(I,R)=>{Rr({id:R,name:I}).then(()=>{D()})},S=I=>{Cr({id:I}).then(()=>{D()})},D=()=>new Promise((I,R)=>{Ir({type:F.value,page_type:0}).then(o=>{const b=[{name:"\u5168\u90E8",id:""},{name:"\u672A\u5206\u7EC4",id:0}];C.value=o==null?void 0:o.lists,C.value.unshift(...b),I(C)})});return{cateId:f,cateLists:C,handleAddCate:_,handleEditCate:T,handleDeleteCate:S,getCateLists:D}}function Sn(F,C,f,_){const T=tt(),S=se("normal"),D=se(0),I=se([]),R=se(!1),o=se(!1),b=rt({name:"",type:C,cid:F}),{pager:y,requestApi:d,resetPage:p}=ti({callback:Pr,params:b,firstLoading:!0,size:_}),m=le(()=>g=>I.value.find(v=>v.id==g)),l=()=>{d()},e=()=>{p()},i=g=>{let v=g||I.value.map(r=>r.id);wr({ids:v}).then(r=>{l(),u()})},t=()=>{let g=I.value.map(v=>v.id);Or({ids:g,cid:D.value}).then(v=>{D.value=0,l(),u()})},n=g=>{let v=I.value.findIndex(r=>r.id==g.id);if(v!=-1){I.value.splice(v,1);return}if(I.value.length==f.value){if(f.value==1){I.value=[],I.value.push(g);return}mt.warning("\u5DF2\u8FBE\u5230\u9009\u62E9\u4E0A\u9650");return}I.value.push(g)},u=()=>{I.value=[]};return{listShowType:S,tableRef:T,moveId:D,pager:y,fileParams:b,select:I,isCheckAll:R,isIndeterminate:o,getFileList:l,refresh:e,batchFileDelete:i,batchFileMove:t,selectFile:n,selectStatus:m,clearSelect:u,cancelSelete:g=>{I.value=I.value.filter(v=>v.id!=g)},selectAll:g=>{var v;if(o.value=!1,(v=T.value)==null||v.toggleAllSelection(),g){I.value=[...y.lists];return}u()},fileRename:(g,v)=>{Fr({id:v,name:g}).then(()=>{l()})}}}var bn=Object.defineProperty,Ln=Object.defineProperties,kn=Object.getOwnPropertyDescriptors,wt=Object.getOwnPropertySymbols,An=Object.prototype.hasOwnProperty,_n=Object.prototype.propertyIsEnumerable,Ot=(F,C,f)=>C in F?bn(F,C,{enumerable:!0,configurable:!0,writable:!0,value:f}):F[C]=f,Et=(F,C)=>{for(var f in C||(C={}))An.call(C,f)&&Ot(F,f,C[f]);if(wt)for(var f of wt(C))_n.call(C,f)&&Ot(F,f,C[f]);return F},Tt=(F,C)=>Ln(F,kn(C));function Ft(F,C,f,_){var T,S=!1,D=0;function I(){T&&clearTimeout(T)}function R(){for(var o=arguments.length,b=new Array(o),y=0;y<o;y++)b[y]=arguments[y];var d=this,p=Date.now()-D;function m(){D=Date.now(),f.apply(d,b)}function l(){T=void 0}S||(_&&!T&&m(),I(),_===void 0&&p>F?m():C!==!0&&(T=setTimeout(_?l:m,_===void 0?F-p:F)))}return typeof C!="boolean"&&(_=f,f=C,C=void 0),R.cancel=function(){I(),S=!0},R}function Pt(F,C,f){return f===void 0?Ft(F,C,!1):Ft(F,f,C!==!1)}function Dn(F){return F&&F.__esModule&&Object.prototype.hasOwnProperty.call(F,"default")?F.default:F}var er={exports:{}};typeof window!="undefined"&&(er.exports=function(F){var C={};function f(_){if(C[_])return C[_].exports;var T=C[_]={i:_,l:!1,exports:{}};return F[_].call(T.exports,T,T.exports,f),T.l=!0,T.exports}return f.m=F,f.c=C,f.d=function(_,T,S){f.o(_,T)||Object.defineProperty(_,T,{enumerable:!0,get:S})},f.r=function(_){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(_,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_,"__esModule",{value:!0})},f.t=function(_,T){if(1&T&&(_=f(_)),8&T||4&T&&typeof _=="object"&&_&&_.__esModule)return _;var S=Object.create(null);if(f.r(S),Object.defineProperty(S,"default",{enumerable:!0,value:_}),2&T&&typeof _!="string")for(var D in _)f.d(S,D,function(I){return _[I]}.bind(null,D));return S},f.n=function(_){var T=_&&_.__esModule?function(){return _.default}:function(){return _};return f.d(T,"a",T),T},f.o=function(_,T){return Object.prototype.hasOwnProperty.call(_,T)},f.p="/dist/",f(f.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(F,C,f){var _=Object.prototype.hasOwnProperty,T="~";function S(){}function D(b,y,d){this.fn=b,this.context=y,this.once=d||!1}function I(b,y,d,p,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var l=new D(d,p||b,m),e=T?T+y:y;return b._events[e]?b._events[e].fn?b._events[e]=[b._events[e],l]:b._events[e].push(l):(b._events[e]=l,b._eventsCount++),b}function R(b,y){--b._eventsCount==0?b._events=new S:delete b._events[y]}function o(){this._events=new S,this._eventsCount=0}Object.create&&(S.prototype=Object.create(null),new S().__proto__||(T=!1)),o.prototype.eventNames=function(){var b,y,d=[];if(this._eventsCount===0)return d;for(y in b=this._events)_.call(b,y)&&d.push(T?y.slice(1):y);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(b)):d},o.prototype.listeners=function(b){var y=T?T+b:b,d=this._events[y];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,m=d.length,l=new Array(m);p<m;p++)l[p]=d[p].fn;return l},o.prototype.listenerCount=function(b){var y=T?T+b:b,d=this._events[y];return d?d.fn?1:d.length:0},o.prototype.emit=function(b,y,d,p,m,l){var e=T?T+b:b;if(!this._events[e])return!1;var i,t,n=this._events[e],u=arguments.length;if(n.fn){switch(n.once&&this.removeListener(b,n.fn,void 0,!0),u){case 1:return n.fn.call(n.context),!0;case 2:return n.fn.call(n.context,y),!0;case 3:return n.fn.call(n.context,y,d),!0;case 4:return n.fn.call(n.context,y,d,p),!0;case 5:return n.fn.call(n.context,y,d,p,m),!0;case 6:return n.fn.call(n.context,y,d,p,m,l),!0}for(t=1,i=new Array(u-1);t<u;t++)i[t-1]=arguments[t];n.fn.apply(n.context,i)}else{var a,c=n.length;for(t=0;t<c;t++)switch(n[t].once&&this.removeListener(b,n[t].fn,void 0,!0),u){case 1:n[t].fn.call(n[t].context);break;case 2:n[t].fn.call(n[t].context,y);break;case 3:n[t].fn.call(n[t].context,y,d);break;case 4:n[t].fn.call(n[t].context,y,d,p);break;default:if(!i)for(a=1,i=new Array(u-1);a<u;a++)i[a-1]=arguments[a];n[t].fn.apply(n[t].context,i)}}return!0},o.prototype.on=function(b,y,d){return I(this,b,y,d,!1)},o.prototype.once=function(b,y,d){return I(this,b,y,d,!0)},o.prototype.removeListener=function(b,y,d,p){var m=T?T+b:b;if(!this._events[m])return this;if(!y)return R(this,m),this;var l=this._events[m];if(l.fn)l.fn!==y||p&&!l.once||d&&l.context!==d||R(this,m);else{for(var e=0,i=[],t=l.length;e<t;e++)(l[e].fn!==y||p&&!l[e].once||d&&l[e].context!==d)&&i.push(l[e]);i.length?this._events[m]=i.length===1?i[0]:i:R(this,m)}return this},o.prototype.removeAllListeners=function(b){var y;return b?(y=T?T+b:b,this._events[y]&&R(this,y)):(this._events=new S,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=T,o.EventEmitter=o,F.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":function(F,C,f){var _,T,S,D,I;_=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,T=/^([^\/?#]*)([^]*)$/,S=/(?:\/|^)\.(?=\/)/g,D=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,I={buildAbsoluteURL:function(R,o,b){if(b=b||{},R=R.trim(),!(o=o.trim())){if(!b.alwaysNormalize)return R;var y=I.parseURL(R);if(!y)throw new Error("Error trying to parse base URL.");return y.path=I.normalizePath(y.path),I.buildURLFromParts(y)}var d=I.parseURL(o);if(!d)throw new Error("Error trying to parse relative URL.");if(d.scheme)return b.alwaysNormalize?(d.path=I.normalizePath(d.path),I.buildURLFromParts(d)):o;var p=I.parseURL(R);if(!p)throw new Error("Error trying to parse base URL.");if(!p.netLoc&&p.path&&p.path[0]!=="/"){var m=T.exec(p.path);p.netLoc=m[1],p.path=m[2]}p.netLoc&&!p.path&&(p.path="/");var l={scheme:p.scheme,netLoc:d.netLoc,path:null,params:d.params,query:d.query,fragment:d.fragment};if(!d.netLoc&&(l.netLoc=p.netLoc,d.path[0]!=="/"))if(d.path){var e=p.path,i=e.substring(0,e.lastIndexOf("/")+1)+d.path;l.path=I.normalizePath(i)}else l.path=p.path,d.params||(l.params=p.params,d.query||(l.query=p.query));return l.path===null&&(l.path=b.alwaysNormalize?I.normalizePath(d.path):d.path),I.buildURLFromParts(l)},parseURL:function(R){var o=_.exec(R);return o?{scheme:o[1]||"",netLoc:o[2]||"",path:o[3]||"",params:o[4]||"",query:o[5]||"",fragment:o[6]||""}:null},normalizePath:function(R){for(R=R.split("").reverse().join("").replace(S,"");R.length!==(R=R.replace(D,"")).length;);return R.split("").reverse().join("")},buildURLFromParts:function(R){return R.scheme+R.netLoc+R.path+R.params+R.query+R.fragment}},F.exports=I},"./node_modules/webworkify-webpack/index.js":function(F,C,f){function _(o){var b={};function y(p){if(b[p])return b[p].exports;var m=b[p]={i:p,l:!1,exports:{}};return o[p].call(m.exports,m,m.exports,y),m.l=!0,m.exports}y.m=o,y.c=b,y.i=function(p){return p},y.d=function(p,m,l){y.o(p,m)||Object.defineProperty(p,m,{configurable:!1,enumerable:!0,get:l})},y.r=function(p){Object.defineProperty(p,"__esModule",{value:!0})},y.n=function(p){var m=p&&p.__esModule?function(){return p.default}:function(){return p};return y.d(m,"a",m),m},y.o=function(p,m){return Object.prototype.hasOwnProperty.call(p,m)},y.p="/",y.oe=function(p){throw console.error(p),p};var d=y(y.s=ENTRY_MODULE);return d.default||d}var T="[\\.|\\-|\\+|\\w|/|@]+",S="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function D(o){return(o+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function I(o,b,y){var d={};d[y]=[];var p=b.toString(),m=p.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!m)return d;for(var l,e=m[1],i=new RegExp("(\\\\n|\\W)"+D(e)+S,"g");l=i.exec(p);)l[3]!=="dll-reference"&&d[y].push(l[3]);for(i=new RegExp("\\("+D(e)+'\\("(dll-reference\\s('+T+'))"\\)\\)'+S,"g");l=i.exec(p);)o[l[2]]||(d[y].push(l[1]),o[l[2]]=f(l[1]).m),d[l[2]]=d[l[2]]||[],d[l[2]].push(l[4]);for(var t,n=Object.keys(d),u=0;u<n.length;u++)for(var a=0;a<d[n[u]].length;a++)t=d[n[u]][a],isNaN(1*t)||(d[n[u]][a]=1*d[n[u]][a]);return d}function R(o){return Object.keys(o).reduce(function(b,y){return b||o[y].length>0},!1)}F.exports=function(o,b){b=b||{};var y={main:f.m},d=b.all?{main:Object.keys(y.main)}:function(i,t){for(var n={main:[t]},u={main:[]},a={main:{}};R(n);)for(var c=Object.keys(n),E=0;E<c.length;E++){var g=c[E],v=n[g].pop();if(a[g]=a[g]||{},!a[g][v]&&i[g][v]){a[g][v]=!0,u[g]=u[g]||[],u[g].push(v);for(var r=I(i,i[g][v],g),s=Object.keys(r),h=0;h<s.length;h++)n[s[h]]=n[s[h]]||[],n[s[h]]=n[s[h]].concat(r[s[h]])}}return u}(y,o),p="";Object.keys(d).filter(function(i){return i!=="main"}).forEach(function(i){for(var t=0;d[i][t];)t++;d[i].push(t),y[i][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",p=p+"var "+i+" = ("+_.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+d[i].map(function(n){return JSON.stringify(n)+": "+y[i][n].toString()}).join(",")+`});
`}),p=p+"new (("+_.toString().replace("ENTRY_MODULE",JSON.stringify(o))+")({"+d.main.map(function(i){return JSON.stringify(i)+": "+y.main[i].toString()}).join(",")+"}))(self);";var m=new window.Blob([p],{type:"text/javascript"});if(b.bare)return m;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(m),e=new window.Worker(l);return e.objectURL=l,e}},"./src/config.ts":function(F,C,f){f.r(C),f.d(C,"hlsDefaultConfig",function(){return c}),f.d(C,"mergeConfig",function(){return E}),f.d(C,"enableStreamingMode",function(){return g});var _=f("./src/controller/abr-controller.ts"),T=f("./src/controller/audio-stream-controller.ts"),S=f("./src/controller/audio-track-controller.ts"),D=f("./src/controller/subtitle-stream-controller.ts"),I=f("./src/controller/subtitle-track-controller.ts"),R=f("./src/controller/buffer-controller.ts"),o=f("./src/controller/timeline-controller.ts"),b=f("./src/controller/cap-level-controller.ts"),y=f("./src/controller/fps-controller.ts"),d=f("./src/controller/eme-controller.ts"),p=f("./src/utils/xhr-loader.ts"),m=f("./src/utils/fetch-loader.ts"),l=f("./src/utils/cues.ts"),e=f("./src/utils/mediakeys-helper.ts"),i=f("./src/utils/logger.ts");function t(){return(t=Object.assign||function(v){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var h in s)Object.prototype.hasOwnProperty.call(s,h)&&(v[h]=s[h])}return v}).apply(this,arguments)}function n(v,r){var s=Object.keys(v);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(v);r&&(h=h.filter(function(L){return Object.getOwnPropertyDescriptor(v,L).enumerable})),s.push.apply(s,h)}return s}function u(v){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?n(Object(s),!0).forEach(function(h){a(v,h,s[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(s)):n(Object(s)).forEach(function(h){Object.defineProperty(v,h,Object.getOwnPropertyDescriptor(s,h))})}return v}function a(v,r,s){return r in v?Object.defineProperty(v,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):v[r]=s,v}var c=u(u({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:p.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:_.default,bufferController:R.default,capLevelController:b.default,fpsController:y.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:l.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:D.SubtitleStreamController,subtitleTrackController:I.default,timelineController:o.TimelineController,audioStreamController:T.default,audioTrackController:S.default,emeController:d.default});function E(v,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return t({},v,r)}function g(v){var r=v.loader;r!==m.default&&r!==p.default?(i.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),v.progressive=!1):Object(m.fetchSupported)()&&(v.loader=m.default,v.progressive=!0,v.enableSoftwareAES=!0,i.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(F,C,f){f.r(C);var _=f("./src/polyfills/number.ts"),T=f("./src/utils/ewma-bandwidth-estimator.ts"),S=f("./src/events.ts"),D=f("./src/utils/buffer-helper.ts"),I=f("./src/errors.ts"),R=f("./src/types/loader.ts"),o=f("./src/utils/logger.ts");function b(d,p){for(var m=0;m<p.length;m++){var l=p[m];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(d,l.key,l)}}var y=function(){function d(e){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var i=e.config;this.bwEstimator=new T.default(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate),this.registerListeners()}var p,m,l=d.prototype;return l.registerListeners=function(){var e=this.hls;e.on(S.Events.FRAG_LOADING,this.onFragLoading,this),e.on(S.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(S.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var e=this.hls;e.off(S.Events.FRAG_LOADING,this.onFragLoading,this),e.off(S.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(S.Events.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.Events.ERROR,this.onError,this)},l.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},l.onFragLoading=function(e,i){var t,n=i.frag;n.type===R.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=n,this.partCurrent=(t=i.part)!=null?t:null,this.timer=self.setInterval(this.onCheck,100)))},l.onLevelLoaded=function(e,i){var t=this.hls.config;i.details.live?this.bwEstimator.update(t.abrEwmaSlowLive,t.abrEwmaFastLive):this.bwEstimator.update(t.abrEwmaSlowVoD,t.abrEwmaFastVoD)},l._abandonRulesCheck=function(){var e=this.fragCurrent,i=this.partCurrent,t=this.hls,n=t.autoLevelEnabled,u=t.config,a=t.media;if(e&&a){var c=i?i.stats:e.stats,E=i?i.duration:e.duration;if(c.aborted)return o.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(n&&!a.paused&&a.playbackRate&&a.readyState){var g=performance.now()-c.loading.start,v=Math.abs(a.playbackRate);if(!(g<=500*E/v)){var r=t.levels,s=t.minAutoLevel,h=r[e.level],L=c.total||Math.max(c.loaded,Math.round(E*h.maxBitrate/8)),k=Math.max(1,c.bwEstimate?c.bwEstimate/8:1e3*c.loaded/g),A=(L-c.loaded)/k,O=a.currentTime,w=(D.BufferHelper.bufferInfo(a,O,u.maxBufferHole).end-O)/v;if(!(w>=2*E/v||A<=w)){var P,x=Number.POSITIVE_INFINITY;for(P=e.level-1;P>s&&!((x=E*r[P].maxBitrate/(6.4*k))<w);P--);if(!(x>=A)){var M=this.bwEstimator.getEstimate();o.logger.warn("Fragment "+e.sn+(i?" part "+i.index:"")+" of level "+e.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+P+`
      Current BW estimate: `+(Object(_.isFiniteNumber)(M)?(M/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+A.toFixed(3)+` s
      Estimated load time for the next fragment: `+x.toFixed(3)+` s
      Time to underbuffer: `+w.toFixed(3)+" s"),t.nextLoadLevel=P,this.bwEstimator.sample(g,c.loaded),this.clearTimer(),e.loader&&(this.fragCurrent=this.partCurrent=null,e.loader.abort()),t.trigger(S.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:i,stats:c})}}}}}},l.onFragLoaded=function(e,i){var t=i.frag,n=i.part;if(t.type===R.PlaylistLevelType.MAIN&&Object(_.isFiniteNumber)(t.sn)){var u=n?n.stats:t.stats,a=n?n.duration:t.duration;if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var c=this.hls.levels[t.level],E=(c.loaded?c.loaded.bytes:0)+u.loaded,g=(c.loaded?c.loaded.duration:0)+a;c.loaded={bytes:E,duration:g},c.realBitrate=Math.round(8*E/g)}if(t.bitrateTest){var v={stats:u,frag:t,part:n,id:t.type};this.onFragBuffered(S.Events.FRAG_BUFFERED,v),t.bitrateTest=!1}}},l.onFragBuffered=function(e,i){var t=i.frag,n=i.part,u=n?n.stats:t.stats;if(!u.aborted&&t.type===R.PlaylistLevelType.MAIN&&t.sn!=="initSegment"){var a=u.parsing.end-u.loading.start;this.bwEstimator.sample(a,u.loaded),u.bwEstimate=this.bwEstimator.getEstimate(),t.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},l.onError=function(e,i){switch(i.details){case I.ErrorDetails.FRAG_LOAD_ERROR:case I.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},l.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},l.getNextABRAutoLevel=function(){var e=this.fragCurrent,i=this.partCurrent,t=this.hls,n=t.maxAutoLevel,u=t.config,a=t.minAutoLevel,c=t.media,E=i?i.duration:e?e.duration:0,g=c?c.currentTime:0,v=c&&c.playbackRate!==0?Math.abs(c.playbackRate):1,r=this.bwEstimator?this.bwEstimator.getEstimate():u.abrEwmaDefaultEstimate,s=(D.BufferHelper.bufferInfo(c,g,u.maxBufferHole).end-g)/v,h=this.findBestLevel(r,a,n,s,u.abrBandWidthFactor,u.abrBandWidthUpFactor);if(h>=0)return h;o.logger.trace((s?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var L=E?Math.min(E,u.maxStarvationDelay):u.maxStarvationDelay,k=u.abrBandWidthFactor,A=u.abrBandWidthUpFactor;if(!s){var O=this.bitrateTestDelay;O&&(L=(E?Math.min(E,u.maxLoadingDelay):u.maxLoadingDelay)-O,o.logger.trace("bitrate test took "+Math.round(1e3*O)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*L)+" ms"),k=A=1)}return h=this.findBestLevel(r,a,n,s+L,k,A),Math.max(h,0)},l.findBestLevel=function(e,i,t,n,u,a){for(var c,E=this.fragCurrent,g=this.partCurrent,v=this.lastLoadedFragLevel,r=this.hls.levels,s=r[v],h=!(s==null||(c=s.details)===null||c===void 0||!c.live),L=s==null?void 0:s.codecSet,k=g?g.duration:E?E.duration:0,A=t;A>=i;A--){var O=r[A];if(O&&(!L||O.codecSet===L)){var w=O.details,P=(g?w==null?void 0:w.partTarget:w==null?void 0:w.averagetargetduration)||k,x=void 0;x=A<=v?u*e:a*e;var M=r[A].maxBitrate,N=M*P/x;if(o.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+A+"/"+Math.round(x)+"/"+M+"/"+P+"/"+n+"/"+N),x>M&&(!N||h&&!this.bitrateTestDelay||N<n))return A}}return-1},p=d,(m=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,i=this.bwEstimator;if(!(e===-1||i&&i.canEstimate()))return e;var t=this.getNextABRAutoLevel();return e!==-1&&(t=Math.min(e,t)),t},set:function(e){this._nextAutoLevel=e}}])&&b(p.prototype,m),d}();C.default=y},"./src/controller/audio-stream-controller.ts":function(F,C,f){f.r(C);var _=f("./src/polyfills/number.ts"),T=f("./src/controller/base-stream-controller.ts"),S=f("./src/events.ts"),D=f("./src/utils/buffer-helper.ts"),I=f("./src/controller/fragment-tracker.ts"),R=f("./src/types/level.ts"),o=f("./src/types/loader.ts"),b=f("./src/loader/fragment.ts"),y=f("./src/demux/chunk-cache.ts"),d=f("./src/demux/transmuxer-interface.ts"),p=f("./src/types/transmuxer.ts"),m=f("./src/controller/fragment-finders.ts"),l=f("./src/utils/discontinuities.ts"),e=f("./src/errors.ts"),i=f("./src/utils/logger.ts");function t(){return(t=Object.assign||function(a){for(var c=1;c<arguments.length;c++){var E=arguments[c];for(var g in E)Object.prototype.hasOwnProperty.call(E,g)&&(a[g]=E[g])}return a}).apply(this,arguments)}function n(a,c){return(n=Object.setPrototypeOf||function(E,g){return E.__proto__=g,E})(a,c)}var u=function(a){var c,E;function g(r,s){var h;return(h=a.call(this,r,s,"[audio-stream-controller]")||this).videoBuffer=null,h.videoTrackCC=-1,h.waitingVideoCC=-1,h.audioSwitch=!1,h.trackId=-1,h.waitingData=null,h.mainDetails=null,h.bufferFlushed=!1,h._registerListeners(),h}E=a,(c=g).prototype=Object.create(E.prototype),c.prototype.constructor=c,n(c,E);var v=g.prototype;return v.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},v._registerListeners=function(){var r=this.hls;r.on(S.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(S.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(S.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(S.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(S.Events.ERROR,this.onError,this),r.on(S.Events.BUFFER_RESET,this.onBufferReset,this),r.on(S.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(S.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(S.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(S.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var r=this.hls;r.off(S.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(S.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(S.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(S.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(S.Events.ERROR,this.onError,this),r.off(S.Events.BUFFER_RESET,this.onBufferReset,this),r.off(S.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(S.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(S.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(S.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onInitPtsFound=function(r,s){var h=s.frag,L=s.id,k=s.initPTS;if(L==="main"){var A=h.cc;this.initPTS[h.cc]=k,this.log("InitPTS for cc: "+A+" found from main: "+k),this.videoTrackCC=A,this.state===T.State.WAITING_INIT_PTS&&this.tick()}},v.startLoad=function(r){if(!this.levels)return this.startPosition=r,void(this.state=T.State.STOPPED);var s=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,s>0&&r===-1?(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),this.state=T.State.IDLE):(this.loadedmetadata=!1,this.state=T.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},v.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_TRACK:var r,s=this.levels,h=this.trackId,L=s==null||(r=s[h])===null||r===void 0?void 0:r.details;if(L){if(this.waitForCdnTuneIn(L))break;this.state=T.State.WAITING_INIT_PTS}break;case T.State.FRAG_LOADING_WAITING_RETRY:var k,A=performance.now(),O=this.retryDate;(!O||A>=O||(k=this.media)!==null&&k!==void 0&&k.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=T.State.IDLE);break;case T.State.WAITING_INIT_PTS:var w=this.waitingData;if(w){var P=w.frag,x=w.part,M=w.cache,N=w.complete;if(this.initPTS[P.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.FRAG_LOADING;var U={frag:P,part:x,payload:M.flush(),networkDetails:null};this._handleFragmentLoadProgress(U),N&&a.prototype._handleFragmentLoadComplete.call(this,U)}else if(this.videoTrackCC!==this.waitingVideoCC)i.logger.log("Waiting fragment cc ("+P.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var G=this.getLoadPosition(),V=D.BufferHelper.bufferInfo(this.mediaBuffer,G,this.config.maxBufferHole);Object(m.fragmentWithinToleranceTest)(V.end,this.config.maxFragLookUpTolerance,P)<0&&(i.logger.log("Waiting fragment cc ("+P.cc+") @ "+P.start+" cancelled because another fragment at "+V.end+" is needed"),this.clearWaitingFragment())}}else this.state=T.State.IDLE}this.onTickEnd()},v.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.IDLE)},v.onTickEnd=function(){var r=this.media;if(r&&r.readyState){var s=(this.mediaBuffer?this.mediaBuffer:r).buffered;!this.loadedmetadata&&s.length&&(this.loadedmetadata=!0),this.lastCurrentTime=r.currentTime}},v.doTickIdle=function(){var r,s,h=this.hls,L=this.levels,k=this.media,A=this.trackId,O=h.config;if(L&&L[A]&&(k||!this.startFragRequested&&O.startFragPrefetch)){var w=L[A].details;if(!w||w.live&&this.levelLastLoaded!==A||this.waitForCdnTuneIn(w))this.state=T.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,b.ElementaryStreamTypes.AUDIO,o.PlaylistLevelType.AUDIO));var P=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,o.PlaylistLevelType.AUDIO);if(P!==null){var x=P.len,M=this.getMaxBufferLength(),N=this.audioSwitch;if(!(x>=M)||N){if(!N&&this._streamEnded(P,w))return h.trigger(S.Events.BUFFER_EOS,{type:"audio"}),void(this.state=T.State.ENDED);var U=w.fragments[0].start,G=P.end;if(N){var V=this.getLoadPosition();G=V,w.PTSKnown&&V<U&&(P.end>U||P.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),k.currentTime=U+.05)}var W=this.getNextFragment(G,w);W?((r=W.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(s=W.decryptdata)!==null&&s!==void 0&&s.key?this.loadFragment(W,w,G):this.loadKey(W,w):this.bufferFlushed=!0}}}}},v.getMaxBufferLength=function(){var r=a.prototype.getMaxBufferLength.call(this),s=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,o.PlaylistLevelType.MAIN);return s===null?r:Math.max(r,s.len)},v.onMediaDetaching=function(){this.videoBuffer=null,a.prototype.onMediaDetaching.call(this)},v.onAudioTracksUpdated=function(r,s){var h=s.audioTracks;this.resetTransmuxer(),this.levels=h.map(function(L){return new R.Level(L)})},v.onAudioTrackSwitching=function(r,s){var h=!!s.url;this.trackId=s.id;var L=this.fragCurrent;L!=null&&L.loader&&L.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),h?this.setInterval(100):this.resetTransmuxer(),h?(this.audioSwitch=!0,this.state=T.State.IDLE):this.state=T.State.STOPPED,this.tick()},v.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},v.onLevelLoaded=function(r,s){this.mainDetails=s.details},v.onAudioTrackLoaded=function(r,s){var h,L=this.levels,k=s.details,A=s.id;if(L){this.log("Track "+A+" loaded ["+k.startSN+","+k.endSN+"],duration:"+k.totalduration);var O=L[A],w=0;if(k.live||(h=O.details)!==null&&h!==void 0&&h.live){var P=this.mainDetails;if(k.fragments[0]||(k.deltaUpdateFailed=!0),k.deltaUpdateFailed||!P)return;!O.details&&k.hasProgramDateTime&&P.hasProgramDateTime?(Object(l.alignPDT)(k,P),w=k.fragments[0].start):w=this.alignPlaylists(k,O.details)}O.details=k,this.levelLastLoaded=A,this.startFragRequested||!this.mainDetails&&k.live||this.setStartPosition(O.details,w),this.state!==T.State.WAITING_TRACK||this.waitForCdnTuneIn(k)||(this.state=T.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+A)},v._handleFragmentLoadProgress=function(r){var s,h=r.frag,L=r.part,k=r.payload,A=this.config,O=this.trackId,w=this.levels;if(w){var P=w[O];console.assert(P,"Audio track is defined on fragment load progress");var x=P.details;console.assert(x,"Audio track details are defined on fragment load progress");var M=A.defaultAudioCodec||P.audioCodec||"mp4a.40.2",N=this.transmuxer;N||(N=this.transmuxer=new d.default(this.hls,o.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var U=this.initPTS[h.cc],G=(s=h.initSegment)===null||s===void 0?void 0:s.data;if(U!==void 0){var V=L?L.index:-1,W=V!==-1,Y=new p.ChunkMetadata(h.level,h.sn,h.stats.chunkCount,k.byteLength,V,W);N.push(k,G,M,"",h,L,x.totalduration,!1,Y,U)}else i.logger.log("Unknown video PTS for cc "+h.cc+", waiting for video PTS before demuxing audio frag "+h.sn+" of ["+x.startSN+" ,"+x.endSN+"],track "+O),(this.waitingData=this.waitingData||{frag:h,part:L,cache:new y.default,complete:!1}).cache.push(new Uint8Array(k)),this.waitingVideoCC=this.videoTrackCC,this.state=T.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+h.sn+" of level "+h.level+" will not be buffered")},v._handleFragmentLoadComplete=function(r){this.waitingData?this.waitingData.complete=!0:a.prototype._handleFragmentLoadComplete.call(this,r)},v.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},v.onBufferCreated=function(r,s){var h=s.tracks.audio;h&&(this.mediaBuffer=h.buffer),s.tracks.video&&(this.videoBuffer=s.tracks.video.buffer)},v.onFragBuffered=function(r,s){var h=s.frag,L=s.part;h.type===o.PlaylistLevelType.AUDIO&&(this.fragContextChanged(h)?this.warn("Fragment "+h.sn+(L?" p: "+L.index:"")+" of level "+h.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(h.sn!=="initSegment"&&(this.fragPrevious=h,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(S.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(h,L)))},v.onError=function(r,s){switch(s.details){case e.ErrorDetails.FRAG_LOAD_ERROR:case e.ErrorDetails.FRAG_LOAD_TIMEOUT:case e.ErrorDetails.KEY_LOAD_ERROR:case e.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.AUDIO,s);break;case e.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case e.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==T.State.ERROR&&this.state!==T.State.STOPPED&&(this.state=s.fatal?T.State.ERROR:T.State.IDLE,this.warn(s.details+" while loading frag, switching to "+this.state+" state"));break;case e.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="audio"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var h=!0,L=this.getFwdBufferInfo(this.mediaBuffer,o.PlaylistLevelType.AUDIO);L&&L.len>.5&&(h=!this.reduceMaxBufferLength(L.len)),h&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},v.onBufferFlushed=function(r,s){s.type===b.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},v._handleTransmuxComplete=function(r){var s,h="audio",L=this.hls,k=r.remuxResult,A=r.chunkMeta,O=this.getCurrentContext(A);if(!O)return this.warn("The loading context changed while buffering fragment "+A.sn+" of level "+A.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(A.level);var w=O.frag,P=O.part,x=k.audio,M=k.text,N=k.id3,U=k.initSegment;if(!this.fragContextChanged(w)){if(this.state=T.State.PARSING,this.audioSwitch&&x&&this.completeAudioSwitch(),U!=null&&U.tracks&&(this._bufferInitSegment(U.tracks,w,A),L.trigger(S.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:h,tracks:U.tracks})),x){var G=x.startPTS,V=x.endPTS,W=x.startDTS,Y=x.endDTS;P&&(P.elementaryStreams[b.ElementaryStreamTypes.AUDIO]={startPTS:G,endPTS:V,startDTS:W,endDTS:Y}),w.setElementaryStreamInfo(b.ElementaryStreamTypes.AUDIO,G,V,W,Y),this.bufferFragmentData(x,w,P,A)}if(N!=null&&(s=N.samples)!==null&&s!==void 0&&s.length){var X=t({frag:w,id:h},N);L.trigger(S.Events.FRAG_PARSING_METADATA,X)}if(M){var z=t({frag:w,id:h},M);L.trigger(S.Events.FRAG_PARSING_USERDATA,z)}}},v._bufferInitSegment=function(r,s,h){if(this.state===T.State.PARSING){r.video&&delete r.video;var L=r.audio;if(L){L.levelCodec=L.codec,L.id="audio",this.log("Init audio buffer, container:"+L.container+", codecs[parsed]=["+L.codec+"]"),this.hls.trigger(S.Events.BUFFER_CODECS,r);var k=L.initSegment;if(k!=null&&k.byteLength){var A={type:"audio",frag:s,part:null,chunkMeta:h,parent:s.type,data:k};this.hls.trigger(S.Events.BUFFER_APPENDING,A)}this.tick()}}},v.loadFragment=function(r,s,h){var L=this.fragmentTracker.getState(r);this.fragCurrent=r,(this.audioSwitch||L===I.FragmentState.NOT_LOADED||L===I.FragmentState.PARTIAL)&&(r.sn==="initSegment"?this._loadInitSegment(r):s.live&&!Object(_.isFiniteNumber)(this.initPTS[r.cc])?(this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=T.State.WAITING_INIT_PTS):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,r,s,h)))},v.completeAudioSwitch=function(){var r=this.hls,s=this.media,h=this.trackId;s&&(this.log("Switching audio track : flushing all audio"),a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,r.trigger(S.Events.AUDIO_TRACK_SWITCHED,{id:h})},g}(T.default);C.default=u},"./src/controller/audio-track-controller.ts":function(F,C,f){f.r(C);var _=f("./src/events.ts"),T=f("./src/errors.ts"),S=f("./src/controller/base-playlist-controller.ts"),D=f("./src/types/loader.ts");function I(b,y){for(var d=0;d<y.length;d++){var p=y[d];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(b,p.key,p)}}function R(b,y){return(R=Object.setPrototypeOf||function(d,p){return d.__proto__=p,d})(b,y)}var o=function(b){var y,d;function p(i){var t;return(t=b.call(this,i,"[audio-track-controller]")||this).tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.trackName="",t.selectDefaultTrack=!0,t.registerListeners(),t}d=b,(y=p).prototype=Object.create(d.prototype),y.prototype.constructor=y,R(y,d);var m,l,e=p.prototype;return e.registerListeners=function(){var i=this.hls;i.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(_.Events.ERROR,this.onError,this)},e.unregisterListeners=function(){var i=this.hls;i.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(_.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(_.Events.ERROR,this.onError,this)},e.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,b.prototype.destroy.call(this)},e.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},e.onManifestParsed=function(i,t){this.tracks=t.audioTracks||[]},e.onAudioTrackLoaded=function(i,t){var n=t.id,u=t.details,a=this.tracksInGroup[n];if(a){var c=a.details;a.details=t.details,this.log("audioTrack "+n+" loaded ["+u.startSN+"-"+u.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,t,c))}else this.warn("Invalid audio track id "+n)},e.onLevelLoading=function(i,t){this.switchLevel(t.level)},e.onLevelSwitching=function(i,t){this.switchLevel(t.level)},e.switchLevel=function(i){var t=this.hls.levels[i];if(t!=null&&t.audioGroupIds){var n=t.audioGroupIds[t.urlId];if(this.groupId!==n){this.groupId=n;var u=this.tracks.filter(function(c){return!n||c.groupId===n});this.selectDefaultTrack&&!u.some(function(c){return c.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=u;var a={audioTracks:u};this.log("Updating audio tracks, "+u.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(_.Events.AUDIO_TRACKS_UPDATED,a),this.selectInitialTrack()}}},e.onError=function(i,t){b.prototype.onError.call(this,i,t),!t.fatal&&t.context&&t.context.type===D.PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},e.setAudioTrack=function(i){var t=this.tracksInGroup;if(i<0||i>=t.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var n=t[this.trackId];this.log("Now switching to audio-track index "+i);var u=t[i],a=u.id,c=u.groupId,E=c===void 0?"":c,g=u.name,v=u.type,r=u.url;if(this.trackId=i,this.trackName=g,this.selectDefaultTrack=!1,this.hls.trigger(_.Events.AUDIO_TRACK_SWITCHING,{id:a,groupId:E,name:g,type:v,url:r}),!u.details||u.details.live){var s=this.switchParams(u.url,n==null?void 0:n.details);this.loadPlaylist(s)}}},e.selectInitialTrack=function(){var i=this.tracksInGroup;console.assert(i.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,n=this.findTrackId(t)||this.findTrackId();n!==-1?this.setAudioTrack(n):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},e.findTrackId=function(i){for(var t=this.tracksInGroup,n=0;n<t.length;n++){var u=t[n];if((!this.selectDefaultTrack||u.default)&&(!i||i===u.name))return u.id}return-1},e.loadPlaylist=function(i){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var n=t.id,u=t.groupId,a=t.url;if(i)try{a=i.addDirectives(a)}catch(c){this.warn("Could not construct new URL with HLS Delivery Directives: "+c)}this.log("loading audio-track playlist for id: "+n),this.clearTimer(),this.hls.trigger(_.Events.AUDIO_TRACK_LOADING,{url:a,id:n,groupId:u,deliveryDirectives:i||null})}},m=p,(l=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1,this.setAudioTrack(i)}}])&&I(m.prototype,l),p}(S.default);C.default=o},"./src/controller/base-playlist-controller.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return R});var _=f("./src/polyfills/number.ts"),T=f("./src/types/level.ts"),S=f("./src/controller/level-helper.ts"),D=f("./src/utils/logger.ts"),I=f("./src/errors.ts"),R=function(){function o(y,d){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=D.logger.log.bind(D.logger,d+":"),this.warn=D.logger.warn.bind(D.logger,d+":"),this.hls=y}var b=o.prototype;return b.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},b.onError=function(y,d){d.fatal&&d.type===I.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},b.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},b.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},b.stopLoad=function(){this.canLoad=!1,this.clearTimer()},b.switchParams=function(y,d){var p=d==null?void 0:d.renditionReports;if(p)for(var m=0;m<p.length;m++){var l=p[m],e=""+l.URI;if(e===y.substr(-e.length)){var i=parseInt(l["LAST-MSN"]),t=parseInt(l["LAST-PART"]);if(d&&this.hls.config.lowLatencyMode){var n=Math.min(d.age-d.partTarget,d.targetduration);t!==void 0&&n>d.partTarget&&(t+=1)}if(Object(_.isFiniteNumber)(i))return new T.HlsUrlParameters(i,Object(_.isFiniteNumber)(t)?t:void 0,T.HlsSkip.No)}}},b.loadPlaylist=function(y){},b.shouldLoadTrack=function(y){return this.canLoad&&y&&!!y.url&&(!y.details||y.details.live)},b.playlistLoaded=function(y,d,p){var m=this,l=d.details,e=d.stats,i=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(l.advancedDateTime=Date.now()-i,l.live||p!=null&&p.live){if(l.reloaded(p),p&&this.log("live playlist "+y+" "+(l.advanced?"REFRESHED "+l.lastPartSn+"-"+l.lastPartIndex:"MISSED")),p&&l.fragments.length>0&&Object(S.mergeDetails)(p,l),!this.canLoad||!l.live)return;var t,n=void 0,u=void 0;if(l.canBlockReload&&l.endSN&&l.advanced){var a=this.hls.config.lowLatencyMode,c=l.lastPartSn,E=l.endSN,g=l.lastPartIndex,v=c===E;g!==-1?(n=v?E+1:c,u=v?a?0:g:g+1):n=E+1;var r=l.age,s=r+l.ageHeader,h=Math.min(s-l.partTarget,1.5*l.targetduration);if(h>0){if(p&&h>p.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+p.tuneInGoal+" to: "+h+" with playlist age: "+l.age),h=0;else{var L=Math.floor(h/l.targetduration);n+=L,u!==void 0&&(u+=Math.round(h%l.targetduration/l.partTarget)),this.log("CDN Tune-in age: "+l.ageHeader+"s last advanced "+r.toFixed(2)+"s goal: "+h+" skip sn "+L+" to part "+u)}l.tuneInGoal=h}if(t=this.getDeliveryDirectives(l,d.deliveryDirectives,n,u),a||!v)return void this.loadPlaylist(t)}else t=this.getDeliveryDirectives(l,d.deliveryDirectives,n,u);var k=Object(S.computeReloadInterval)(l,e);n!==void 0&&l.canBlockReload&&(k-=l.partTarget||1),this.log("reload live playlist "+y+" in "+Math.round(k)+" ms"),this.timer=self.setTimeout(function(){return m.loadPlaylist(t)},k)}else this.clearTimer()},b.getDeliveryDirectives=function(y,d,p,m){var l=Object(T.getSkipValue)(y,p);return d!=null&&d.skip&&y.deltaUpdateFailed&&(p=d.msn,m=d.part,l=T.HlsSkip.No),new T.HlsUrlParameters(p,m,l)},b.retryLoadingOrFail=function(y){var d,p=this,m=this.hls.config,l=this.retryCount<m.levelLoadingMaxRetry;if(l)if(this.retryCount++,y.details.indexOf("LoadTimeOut")>-1&&(d=y.context)!==null&&d!==void 0&&d.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+y.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*m.levelLoadingRetryDelay,m.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return p.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+y.details+'"')}else this.warn('cannot recover from error "'+y.details+'"'),this.clearTimer(),y.fatal=!0;return l},o}()},"./src/controller/base-stream-controller.ts":function(F,C,f){f.r(C),f.d(C,"State",function(){return a}),f.d(C,"default",function(){return c});var _=f("./src/polyfills/number.ts"),T=f("./src/task-loop.ts"),S=f("./src/controller/fragment-tracker.ts"),D=f("./src/utils/buffer-helper.ts"),I=f("./src/utils/logger.ts"),R=f("./src/events.ts"),o=f("./src/errors.ts"),b=f("./src/types/transmuxer.ts"),y=f("./src/utils/mp4-tools.ts"),d=f("./src/utils/discontinuities.ts"),p=f("./src/controller/fragment-finders.ts"),m=f("./src/controller/level-helper.ts"),l=f("./src/loader/fragment-loader.ts"),e=f("./src/crypt/decrypter.ts"),i=f("./src/utils/time-ranges.ts"),t=f("./src/types/loader.ts");function n(E,g){for(var v=0;v<g.length;v++){var r=g[v];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(E,r.key,r)}}function u(E,g){return(u=Object.setPrototypeOf||function(v,r){return v.__proto__=r,v})(E,g)}var a={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},c=function(E){var g,v;function r(k,A,O){var w;return(w=E.call(this)||this).hls=void 0,w.fragPrevious=null,w.fragCurrent=null,w.fragmentTracker=void 0,w.transmuxer=null,w._state=a.STOPPED,w.media=void 0,w.mediaBuffer=void 0,w.config=void 0,w.bitrateTest=!1,w.lastCurrentTime=0,w.nextLoadPosition=0,w.startPosition=0,w.loadedmetadata=!1,w.fragLoadError=0,w.retryDate=0,w.levels=null,w.fragmentLoader=void 0,w.levelLastLoaded=null,w.startFragRequested=!1,w.decrypter=void 0,w.initPTS=[],w.onvseeking=null,w.onvended=null,w.logPrefix="",w.log=void 0,w.warn=void 0,w.logPrefix=O,w.log=I.logger.log.bind(I.logger,O+":"),w.warn=I.logger.warn.bind(I.logger,O+":"),w.hls=k,w.fragmentLoader=new l.default(k.config),w.fragmentTracker=A,w.config=k.config,w.decrypter=new e.default(k,k.config),k.on(R.Events.KEY_LOADED,w.onKeyLoaded,function(P){if(P===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P}(w)),w}v=E,(g=r).prototype=Object.create(v.prototype),g.prototype.constructor=g,u(g,v);var s,h,L=r.prototype;return L.doTick=function(){this.onTickEnd()},L.onTickEnd=function(){},L.startLoad=function(k){},L.stopLoad=function(){this.fragmentLoader.abort();var k=this.fragCurrent;k&&this.fragmentTracker.removeFragment(k),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=a.STOPPED},L._streamEnded=function(k,A){var O=this.fragCurrent,w=this.fragmentTracker;if(!A.live&&O&&O.sn===A.endSN&&!k.nextStart){var P=w.getState(O);return P===S.FragmentState.PARTIAL||P===S.FragmentState.OK}return!1},L.onMediaAttached=function(k,A){var O=this.media=this.mediaBuffer=A.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),O.addEventListener("seeking",this.onvseeking),O.addEventListener("ended",this.onvended);var w=this.config;this.levels&&w.autoStartLoad&&this.state===a.STOPPED&&this.startLoad(w.startPosition)},L.onMediaDetaching=function(){var k=this.media;k!=null&&k.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),k&&(k.removeEventListener("seeking",this.onvseeking),k.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},L.onMediaSeeking=function(){var k=this.config,A=this.fragCurrent,O=this.media,w=this.mediaBuffer,P=this.state,x=O?O.currentTime:0,M=D.BufferHelper.bufferInfo(w||O,x,k.maxBufferHole);if(this.log("media seeking to "+(Object(_.isFiniteNumber)(x)?x.toFixed(3):x)+", state: "+P),P===a.ENDED)this.resetLoadingState();else if(A&&!M.len){var N=k.maxFragLookUpTolerance,U=A.start-N,G=x>A.start+A.duration+N;(x<U||G)&&(G&&A.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),A.loader.abort()),this.resetLoadingState())}O&&(this.lastCurrentTime=x),this.loadedmetadata||M.len||(this.nextLoadPosition=this.startPosition=x),this.tickImmediate()},L.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},L.onKeyLoaded=function(k,A){if(this.state===a.KEY_LOADING&&A.frag===this.fragCurrent&&this.levels){this.state=a.IDLE;var O=this.levels[A.frag.level].details;O&&this.loadFragment(A.frag,O,A.frag.start)}},L.onHandlerDestroying=function(){this.stopLoad(),E.prototype.onHandlerDestroying.call(this)},L.onHandlerDestroyed=function(){this.state=a.STOPPED,this.hls.off(R.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,E.prototype.onHandlerDestroyed.call(this)},L.loadKey=function(k,A){this.log("Loading key for "+k.sn+" of ["+A.startSN+"-"+A.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+k.level),this.state=a.KEY_LOADING,this.fragCurrent=k,this.hls.trigger(R.Events.KEY_LOADING,{frag:k})},L.loadFragment=function(k,A,O){this._loadFragForPlayback(k,A,O)},L._loadFragForPlayback=function(k,A,O){var w=this;this._doFragLoad(k,A,O,function(P){if(w.fragContextChanged(k))return w.warn("Fragment "+k.sn+(P.part?" p: "+P.part.index:"")+" of level "+k.level+" was dropped during download."),void w.fragmentTracker.removeFragment(k);k.stats.chunkCount++,w._handleFragmentLoadProgress(P)}).then(function(P){if(P){w.fragLoadError=0;var x=w.state;if(!w.fragContextChanged(k))return"payload"in P&&(w.log("Loaded fragment "+k.sn+" of level "+k.level),w.hls.trigger(R.Events.FRAG_LOADED,P),w.state===a.BACKTRACKING)?(w.fragmentTracker.backtrack(k,P),void w.resetFragmentLoading(k)):void w._handleFragmentLoadComplete(P);(x===a.FRAG_LOADING||x===a.BACKTRACKING||!w.fragCurrent&&x===a.PARSING)&&(w.fragmentTracker.removeFragment(k),w.state=a.IDLE)}}).catch(function(P){w.warn(P),w.resetFragmentLoading(k)})},L.flushMainBuffer=function(k,A,O){if(O===void 0&&(O=null),k-A){var w={startOffset:k,endOffset:A,type:O};this.fragLoadError=0,this.hls.trigger(R.Events.BUFFER_FLUSHING,w)}},L._loadInitSegment=function(k){var A=this;this._doFragLoad(k).then(function(O){if(!O||A.fragContextChanged(k)||!A.levels)throw new Error("init load aborted");return O}).then(function(O){var w=A.hls,P=O.payload,x=k.decryptdata;if(P&&P.byteLength>0&&x&&x.key&&x.iv&&x.method==="AES-128"){var M=self.performance.now();return A.decrypter.webCryptoDecrypt(new Uint8Array(P),x.key.buffer,x.iv.buffer).then(function(N){var U=self.performance.now();return w.trigger(R.Events.FRAG_DECRYPTED,{frag:k,payload:N,stats:{tstart:M,tdecrypt:U}}),O.payload=N,O})}return O}).then(function(O){var w=A.fragCurrent,P=A.hls,x=A.levels;if(!x)throw new Error("init load aborted, missing levels");var M=x[k.level].details;console.assert(M,"Level details are defined when init segment is loaded");var N=k.stats;A.state=a.IDLE,A.fragLoadError=0,k.data=new Uint8Array(O.payload),N.parsing.start=N.buffering.start=self.performance.now(),N.parsing.end=N.buffering.end=self.performance.now(),O.frag===w&&P.trigger(R.Events.FRAG_BUFFERED,{stats:N,frag:w,part:null,id:k.type}),A.tick()}).catch(function(O){A.warn(O),A.resetFragmentLoading(k)})},L.fragContextChanged=function(k){var A=this.fragCurrent;return!k||!A||k.level!==A.level||k.sn!==A.sn||k.urlId!==A.urlId},L.fragBufferedComplete=function(k,A){var O=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+k.type+" sn: "+k.sn+(A?" part: "+A.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+k.level+" "+i.default.toString(D.BufferHelper.getBuffered(O))),this.state=a.IDLE,this.tick()},L._handleFragmentLoadComplete=function(k){var A=this.transmuxer;if(A){var O=k.frag,w=k.part,P=k.partsLoaded,x=!P||P.length===0||P.some(function(N){return!N}),M=new b.ChunkMetadata(O.level,O.sn,O.stats.chunkCount+1,0,w?w.index:-1,!x);A.flush(M)}},L._handleFragmentLoadProgress=function(k){},L._doFragLoad=function(k,A,O,w){var P=this;if(O===void 0&&(O=null),!this.levels)throw new Error("frag load aborted, missing levels");if(O=Math.max(k.start,O||0),this.config.lowLatencyMode&&A){var x=A.partList;if(x&&w){O>k.end&&A.fragmentHint&&(k=A.fragmentHint);var M=this.getNextPart(x,k,O);if(M>-1){var N=x[M];return this.log("Loading part sn: "+k.sn+" p: "+N.index+" cc: "+k.cc+" of playlist ["+A.startSN+"-"+A.endSN+"] parts [0-"+M+"-"+(x.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+k.level+", target: "+parseFloat(O.toFixed(3))),this.nextLoadPosition=N.start+N.duration,this.state=a.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:k,part:x[M],targetBufferTime:O}),this.doFragPartsLoad(k,x,M,w).catch(function(U){return P.handleFragLoadError(U)})}if(!k.url||this.loadedEndOfParts(x,O))return Promise.resolve(null)}}return this.log("Loading fragment "+k.sn+" cc: "+k.cc+" "+(A?"of ["+A.startSN+"-"+A.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+k.level+", target: "+parseFloat(O.toFixed(3))),Object(_.isFiniteNumber)(k.sn)&&!this.bitrateTest&&(this.nextLoadPosition=k.start+k.duration),this.state=a.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:k,targetBufferTime:O}),this.fragmentLoader.load(k,w).catch(function(U){return P.handleFragLoadError(U)})},L.doFragPartsLoad=function(k,A,O,w){var P=this;return new Promise(function(x,M){var N=[];(function U(G){var V=A[G];P.fragmentLoader.loadPart(k,V,w).then(function(W){N[V.index]=W;var Y=W.part;P.hls.trigger(R.Events.FRAG_LOADED,W);var X=A[G+1];if(!X||X.fragment!==k)return x({frag:k,part:Y,partsLoaded:N});U(G+1)}).catch(M)})(O)})},L.handleFragLoadError=function(k){var A=k.data;return A&&A.details===o.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(A.frag,A.part):this.hls.trigger(R.Events.ERROR,A),null},L._handleTransmuxerFlush=function(k){var A=this.getCurrentContext(k);if(A&&this.state===a.PARSING){var O=A.frag,w=A.part,P=A.level,x=self.performance.now();O.stats.parsing.end=x,w&&(w.stats.parsing.end=x),this.updateLevelTiming(O,w,P,k.partial)}else this.fragCurrent||(this.state=a.IDLE)},L.getCurrentContext=function(k){var A=this.levels,O=k.level,w=k.sn,P=k.part;if(!A||!A[O])return this.warn("Levels object was unset while buffering fragment "+w+" of level "+O+". The current chunk will not be buffered."),null;var x=A[O],M=P>-1?Object(m.getPartWith)(x,w,P):null,N=M?M.fragment:Object(m.getFragmentWithSN)(x,w,this.fragCurrent);return N?{frag:N,part:M,level:x}:null},L.bufferFragmentData=function(k,A,O,w){if(k&&this.state===a.PARSING){var P=k.data1,x=k.data2,M=P;if(P&&x&&(M=Object(y.appendUint8Array)(P,x)),M&&M.length){var N={type:k.type,frag:A,part:O,chunkMeta:w,parent:A.type,data:M};this.hls.trigger(R.Events.BUFFER_APPENDING,N),k.dropped&&k.independent&&!O&&this.flushBufferGap(A)}}},L.flushBufferGap=function(k){var A=this.media;if(A)if(D.BufferHelper.isBuffered(A,A.currentTime)){var O=A.currentTime,w=D.BufferHelper.bufferInfo(A,O,0),P=k.duration,x=Math.min(2*this.config.maxFragLookUpTolerance,.25*P),M=Math.max(Math.min(k.start-x,w.end-x),O+x);k.start-M>x&&this.flushMainBuffer(M,k.start)}else this.flushMainBuffer(0,k.start)},L.getFwdBufferInfo=function(k,A){var O=this.config,w=this.getLoadPosition();if(!Object(_.isFiniteNumber)(w))return null;var P=D.BufferHelper.bufferInfo(k,w,O.maxBufferHole);if(P.len===0&&P.nextStart!==void 0){var x=this.fragmentTracker.getBufferedFrag(w,A);if(x&&P.nextStart<x.end)return D.BufferHelper.bufferInfo(k,w,Math.max(P.nextStart,O.maxBufferHole))}return P},L.getMaxBufferLength=function(k){var A,O=this.config;return A=k?Math.max(8*O.maxBufferSize/k,O.maxBufferLength):O.maxBufferLength,Math.min(A,O.maxMaxBufferLength)},L.reduceMaxBufferLength=function(k){var A=this.config,O=k||A.maxBufferLength;return A.maxMaxBufferLength>=O&&(A.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+A.maxMaxBufferLength+"s"),!0)},L.getNextFragment=function(k,A){var O,w,P=A.fragments,x=P.length;if(!x)return null;var M,N=this.config,U=P[0].start;if(A.live){var G=N.initialLiveManifestSize;if(x<G)return this.warn("Not enough fragments to start playback (have: "+x+", need: "+G+")"),null;A.PTSKnown||this.startFragRequested||this.startPosition!==-1||(M=this.getInitialLiveFragment(A,P),this.startPosition=M?this.hls.liveSyncPosition||M.start:k)}else k<=U&&(M=P[0]);if(!M){var V=N.lowLatencyMode?A.partEnd:A.fragmentEnd;M=this.getFragmentAtPosition(k,V,A)}return(O=M)===null||O===void 0||!O.initSegment||(w=M)!==null&&w!==void 0&&w.initSegment.data||this.bitrateTest||(M=M.initSegment),M},L.getNextPart=function(k,A,O){for(var w=-1,P=!1,x=!0,M=0,N=k.length;M<N;M++){var U=k[M];if(x=x&&!U.independent,w>-1&&O<U.start)break;var G=U.loaded;!G&&(P||U.independent||x)&&U.fragment===A&&(w=M),P=G}return w},L.loadedEndOfParts=function(k,A){var O=k[k.length-1];return O&&A>O.start&&O.loaded},L.getInitialLiveFragment=function(k,A){var O=this.fragPrevious,w=null;if(O){if(k.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+O.programDateTime),w=Object(p.findFragmentByPDT)(A,O.endProgramDateTime,this.config.maxFragLookUpTolerance)),!w){var P=O.sn+1;if(P>=k.startSN&&P<=k.endSN){var x=A[P-k.startSN];O.cc===x.cc&&(w=x,this.log("Live playlist, switching playlist, load frag with next SN: "+w.sn))}w||(w=Object(p.findFragWithCC)(A,O.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+w.sn)}}else{var M=this.hls.liveSyncPosition;M!==null&&(w=this.getFragmentAtPosition(M,this.bitrateTest?k.fragmentEnd:k.edge,k))}return w},L.getFragmentAtPosition=function(k,A,O){var w,P=this.config,x=this.fragPrevious,M=O.fragments,N=O.endSN,U=O.fragmentHint,G=P.maxFragLookUpTolerance,V=!!(P.lowLatencyMode&&O.partList&&U);if(V&&U&&!this.bitrateTest&&(M=M.concat(U),N=U.sn),k<A){var W=k>A-G?0:G;w=Object(p.findFragmentByPTS)(x,M,k,W)}else w=M[M.length-1];if(w){var Y=w.sn-O.startSN,X=x&&w.level===x.level,z=M[Y+1];if(this.fragmentTracker.getState(w)===S.FragmentState.BACKTRACKED){w=null;for(var Z=Y;M[Z]&&this.fragmentTracker.getState(M[Z])===S.FragmentState.BACKTRACKED;)w=x?M[Z--]:M[--Z];w||(w=z)}else x&&w.sn===x.sn&&!V&&X&&(w.sn<N&&this.fragmentTracker.getState(z)!==S.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+z.sn),w=z):w=null)}return w},L.synchronizeToLiveEdge=function(k){var A=this.config,O=this.media;if(O){var w=this.hls.liveSyncPosition,P=O.currentTime,x=k.fragments[0].start,M=k.edge,N=P>=x-A.maxFragLookUpTolerance&&P<=M;if(w!==null&&O.duration>w&&(P<w||!N)){var U=A.liveMaxLatencyDuration!==void 0?A.liveMaxLatencyDuration:A.liveMaxLatencyDurationCount*k.targetduration;(!N&&O.readyState<4||P<M-U)&&(this.loadedmetadata||(this.nextLoadPosition=w),O.readyState&&(this.warn("Playback: "+P.toFixed(3)+" is located too far from the end of live sliding playlist: "+M+", reset currentTime to : "+w.toFixed(3)),O.currentTime=w))}}},L.alignPlaylists=function(k,A){var O=this.levels,w=this.levelLastLoaded,P=this.fragPrevious,x=w!==null?O[w]:null,M=k.fragments.length;if(!M)return this.warn("No fragments in live playlist"),0;var N=k.fragments[0].start,U=!A,G=k.alignedSliding&&Object(_.isFiniteNumber)(N);if(U||!G&&!N){Object(d.alignStream)(P,x,k);var V=k.fragments[0].start;return this.log("Live playlist sliding: "+V.toFixed(2)+" start-sn: "+(A?A.startSN:"na")+"->"+k.startSN+" prev-sn: "+(P?P.sn:"na")+" fragments: "+M),V}return N},L.waitForCdnTuneIn=function(k){return k.live&&k.canBlockReload&&k.tuneInGoal>Math.max(k.partHoldBack,3*k.partTarget)},L.setStartPosition=function(k,A){var O=this.startPosition;if(O<A&&(O=-1),O===-1||this.lastCurrentTime===-1){var w=k.startTimeOffset;Object(_.isFiniteNumber)(w)?(O=A+w,w<0&&(O+=k.totalduration),O=Math.min(Math.max(A,O),A+k.totalduration),this.log("Start time offset "+w+" found in playlist, adjust startPosition to "+O),this.startPosition=O):k.live?O=this.hls.liveSyncPosition||A:this.startPosition=O=0,this.lastCurrentTime=O}this.nextLoadPosition=O},L.getLoadPosition=function(){var k=this.media,A=0;return this.loadedmetadata&&k?A=k.currentTime:this.nextLoadPosition&&(A=this.nextLoadPosition),A},L.handleFragLoadAborted=function(k,A){this.transmuxer&&k.sn!=="initSegment"&&k.stats.aborted&&(this.warn("Fragment "+k.sn+(A?" part"+A.index:"")+" of level "+k.level+" was aborted"),this.resetFragmentLoading(k))},L.resetFragmentLoading=function(k){this.fragCurrent&&this.fragContextChanged(k)||(this.state=a.IDLE)},L.onFragmentOrKeyLoadError=function(k,A){if(!A.fatal){var O=A.frag;if(O&&O.type===k){var w=this.fragCurrent;console.assert(w&&O.sn===w.sn&&O.level===w.level&&O.urlId===w.urlId,"Frag load error must match current frag to retry");var P=this.config;if(this.fragLoadError+1<=P.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(O.level))return;var x=Math.min(Math.pow(2,this.fragLoadError)*P.fragLoadingRetryDelay,P.fragLoadingMaxRetryTimeout);this.warn("Fragment "+O.sn+" of "+k+" "+O.level+" failed to load, retrying in "+x+"ms"),this.retryDate=self.performance.now()+x,this.fragLoadError++,this.state=a.FRAG_LOADING_WAITING_RETRY}else A.levelRetry?(k===t.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=a.IDLE):(I.logger.error(A.details+" reaches max retry, redispatch as fatal ..."),A.fatal=!0,this.hls.stopLoad(),this.state=a.ERROR)}}},L.afterBufferFlushed=function(k,A,O){if(k){var w=D.BufferHelper.getBuffered(k);this.fragmentTracker.detectEvictedFragments(A,w,O),this.state===a.ENDED&&this.resetLoadingState()}},L.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=a.IDLE},L.resetLiveStartWhenNotLoaded=function(k){if(!this.loadedmetadata){this.startFragRequested=!1;var A=this.levels?this.levels[k].details:null;if(A!=null&&A.live)return this.startPosition=-1,this.setStartPosition(A,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},L.updateLevelTiming=function(k,A,O,w){var P=this,x=O.details;console.assert(!!x,"level.details must be defined"),Object.keys(k.elementaryStreams).reduce(function(M,N){var U=k.elementaryStreams[N];if(U){var G=U.endPTS-U.startPTS;if(G<=0)return P.warn("Could not parse fragment "+k.sn+" "+N+" duration reliably ("+G+") resetting transmuxer to fallback to playlist timing"),P.resetTransmuxer(),M||!1;var V=w?0:Object(m.updateFragPTSDTS)(x,k,U.startPTS,U.endPTS,U.startDTS,U.endDTS);return P.hls.trigger(R.Events.LEVEL_PTS_UPDATED,{details:x,level:O,drift:V,type:N,frag:k,start:U.startPTS,end:U.endPTS}),!0}return M},!1)?(this.state=a.PARSED,this.hls.trigger(R.Events.FRAG_PARSED,{frag:k,part:A})):this.resetLoadingState()},L.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},s=r,(h=[{key:"state",get:function(){return this._state},set:function(k){var A=this._state;A!==k&&(this._state=k,this.log(A+"->"+k))}}])&&n(s.prototype,h),r}(T.default)},"./src/controller/buffer-controller.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return p});var _=f("./src/polyfills/number.ts"),T=f("./src/events.ts"),S=f("./src/utils/logger.ts"),D=f("./src/errors.ts"),I=f("./src/utils/buffer-helper.ts"),R=f("./src/utils/mediasource-helper.ts"),o=f("./src/loader/fragment.ts"),b=f("./src/controller/buffer-operation-queue.ts"),y=Object(R.getMediaSource)(),d=/([ha]vc.)(?:\.[^.,]+)+/,p=function(){function m(e){var i=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=i.hls,n=i.media,u=i.mediaSource;S.logger.log("[buffer-controller]: Media source opened"),n&&(i.updateMediaElementDuration(),t.trigger(T.Events.MEDIA_ATTACHED,{media:n})),u&&u.removeEventListener("sourceopen",i._onMediaSourceOpen),i.checkPendingTracks()},this._onMediaSourceClose=function(){S.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){S.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var l=m.prototype;return l.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},l.destroy=function(){this.unregisterListeners(),this.details=null},l.registerListeners=function(){var e=this.hls;e.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(T.Events.BUFFER_RESET,this.onBufferReset,this),e.on(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(T.Events.BUFFER_EOS,this.onBufferEos,this),e.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(T.Events.FRAG_PARSED,this.onFragParsed,this),e.on(T.Events.FRAG_CHANGED,this.onFragChanged,this)},l.unregisterListeners=function(){var e=this.hls;e.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(T.Events.BUFFER_RESET,this.onBufferReset,this),e.off(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(T.Events.BUFFER_EOS,this.onBufferEos,this),e.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(T.Events.FRAG_PARSED,this.onFragParsed,this),e.off(T.Events.FRAG_CHANGED,this.onFragChanged,this)},l._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new b.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},l.onManifestParsed=function(e,i){var t=2;(i.audio&&!i.video||!i.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,this.details=null,S.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},l.onMediaAttaching=function(e,i){var t=this.media=i.media;if(t&&y){var n=this.mediaSource=new y;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),t.src=self.URL.createObjectURL(n),this._objectUrl=t.src}},l.onMediaDetaching=function(){var e=this.media,i=this.mediaSource,t=this._objectUrl;if(i){if(S.logger.log("[buffer-controller]: media source detaching"),i.readyState==="open")try{i.endOfStream()}catch(n){S.logger.warn("[buffer-controller]: onMediaDetaching: "+n.message+" while calling endOfStream")}this.onBufferReset(),i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(t&&self.URL.revokeObjectURL(t),e.src===t?(e.removeAttribute("src"),e.load()):S.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(T.Events.MEDIA_DETACHED,void 0)},l.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(i){var t=e.sourceBuffer[i];try{t&&(e.removeBufferListeners(i),e.mediaSource&&e.mediaSource.removeSourceBuffer(t),e.sourceBuffer[i]=void 0)}catch(n){S.logger.warn("[buffer-controller]: Failed to reset the "+i+" buffer",n)}}),this._initSourceBuffer()},l.onBufferCodecs=function(e,i){var t=this,n=this.getSourceBufferTypes().length;Object.keys(i).forEach(function(u){if(n){var a=t.tracks[u];if(a&&typeof a.buffer.changeType=="function"){var c=i[u],E=c.codec,g=c.levelCodec,v=c.container;if((a.levelCodec||a.codec).replace(d,"$1")!==(g||E).replace(d,"$1")){var r=v+";codecs="+(g||E);t.appendChangeType(u,r)}}}else t.pendingTracks[u]=i[u]}),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},l.appendChangeType=function(e,i){var t=this,n=this.operationQueue,u={execute:function(){var a=t.sourceBuffer[e];a&&(S.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+i),a.changeType(i)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(a){S.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",a)}};n.append(u,e)},l.onBufferAppending=function(e,i){var t=this,n=this.hls,u=this.operationQueue,a=this.tracks,c=i.data,E=i.type,g=i.frag,v=i.part,r=i.chunkMeta,s=r.buffering[E],h=self.performance.now();s.start=h;var L=g.stats.buffering,k=v?v.stats.buffering:null;L.start===0&&(L.start=h),k&&k.start===0&&(k.start=h);var A=a.audio,O=E==="audio"&&r.id===1&&(A==null?void 0:A.container)==="audio/mpeg",w={execute:function(){if(s.executeStart=self.performance.now(),O){var P=t.sourceBuffer[E];if(P){var x=g.start-P.timestampOffset;Math.abs(x)>=.1&&(S.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+g.start+" (delta: "+x+") sn: "+g.sn+")"),P.timestampOffset=g.start)}}t.appendExecutor(c,E)},onStart:function(){},onComplete:function(){var P=self.performance.now();s.executeEnd=s.end=P,L.first===0&&(L.first=P),k&&k.first===0&&(k.first=P);var x=t.sourceBuffer,M={};for(var N in x)M[N]=I.BufferHelper.getBuffered(x[N]);t.appendError=0,t.hls.trigger(T.Events.BUFFER_APPENDED,{type:E,frag:g,part:v,chunkMeta:r,parent:g.type,timeRanges:M})},onError:function(P){S.logger.error("[buffer-controller]: Error encountered while trying to append to the "+E+" SourceBuffer",P);var x={type:D.ErrorTypes.MEDIA_ERROR,parent:g.type,details:D.ErrorDetails.BUFFER_APPEND_ERROR,err:P,fatal:!1};P.code===DOMException.QUOTA_EXCEEDED_ERR?x.details=D.ErrorDetails.BUFFER_FULL_ERROR:(t.appendError++,x.details=D.ErrorDetails.BUFFER_APPEND_ERROR,t.appendError>n.config.appendErrorMaxRetry&&(S.logger.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),x.fatal=!0)),n.trigger(T.Events.ERROR,x)}};u.append(w,E)},l.onBufferFlushing=function(e,i){var t=this,n=this.operationQueue,u=function(a){return{execute:t.removeExecutor.bind(t,a,i.startOffset,i.endOffset),onStart:function(){},onComplete:function(){t.hls.trigger(T.Events.BUFFER_FLUSHED,{type:a})},onError:function(c){S.logger.warn("[buffer-controller]: Failed to remove from "+a+" SourceBuffer",c)}}};i.type?n.append(u(i.type),i.type):this.getSourceBufferTypes().forEach(function(a){n.append(u(a),a)})},l.onFragParsed=function(e,i){var t=this,n=i.frag,u=i.part,a=[],c=u?u.elementaryStreams:n.elementaryStreams;c[o.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(c[o.ElementaryStreamTypes.AUDIO]&&a.push("audio"),c[o.ElementaryStreamTypes.VIDEO]&&a.push("video")),a.length===0&&S.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(function(){var E=self.performance.now();n.stats.buffering.end=E,u&&(u.stats.buffering.end=E);var g=u?u.stats:n.stats;t.hls.trigger(T.Events.FRAG_BUFFERED,{frag:n,part:u,stats:g,id:n.type})},a)},l.onFragChanged=function(e,i){this.flushBackBuffer()},l.onBufferEos=function(e,i){var t=this;this.getSourceBufferTypes().reduce(function(n,u){var a=t.sourceBuffer[u];return i.type&&i.type!==u||a&&!a.ended&&(a.ended=!0,S.logger.log("[buffer-controller]: "+u+" sourceBuffer now EOS")),n&&!(a&&!a.ended)},!0)&&this.blockBuffers(function(){var n=t.mediaSource;n&&n.readyState==="open"&&n.endOfStream()})},l.onLevelUpdated=function(e,i){var t=i.details;t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},l.flushBackBuffer=function(){var e=this.hls,i=this.details,t=this.media,n=this.sourceBuffer;if(t&&i!==null){var u=this.getSourceBufferTypes();if(u.length){var a=i.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(Object(_.isFiniteNumber)(a)&&!(a<0)){var c=t.currentTime,E=i.levelTargetDuration,g=Math.max(a,E),v=Math.floor(c/E)*E-g;u.forEach(function(r){var s=n[r];if(s){var h=I.BufferHelper.getBuffered(s);h.length>0&&v>h.start(0)&&(e.trigger(T.Events.BACK_BUFFER_REACHED,{bufferEnd:v}),i.live&&e.trigger(T.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:v}),e.trigger(T.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:v,type:r}))}})}}}},l.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,i=this.hls,t=this.media,n=this.mediaSource,u=e.fragments[0].start+e.totalduration,a=t.duration,c=Object(_.isFiniteNumber)(n.duration)?n.duration:0;e.live&&i.config.liveDurationInfinity?(S.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(u>c&&u>a||!Object(_.isFiniteNumber)(a))&&(S.logger.log("[buffer-controller]: Updating Media Source duration to "+u.toFixed(3)),n.duration=u)}},l.updateSeekableRange=function(e){var i=this.mediaSource,t=e.fragments;if(t.length&&e.live&&i!=null&&i.setLiveSeekableRange){var n=Math.max(0,t[0].start),u=Math.max(n,n+e.totalduration);i.setLiveSeekableRange(n,u)}},l.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,i=this.operationQueue,t=this.pendingTracks,n=Object.keys(t).length;if(n&&!e||n===2){this.createSourceBuffers(t),this.pendingTracks={};var u=this.getSourceBufferTypes();if(u.length===0)return void this.hls.trigger(T.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});u.forEach(function(a){i.executeNext(a)})}},l.createSourceBuffers=function(e){var i=this.sourceBuffer,t=this.mediaSource;if(!t)throw Error("createSourceBuffers called when mediaSource was null");var n=0;for(var u in e)if(!i[u]){var a=e[u];if(!a)throw Error("source buffer exists for track "+u+", however track does not");var c=a.levelCodec||a.codec,E=a.container+";codecs="+c;S.logger.log("[buffer-controller]: creating sourceBuffer("+E+")");try{var g=i[u]=t.addSourceBuffer(E),v=u;this.addBufferListener(v,"updatestart",this._onSBUpdateStart),this.addBufferListener(v,"updateend",this._onSBUpdateEnd),this.addBufferListener(v,"error",this._onSBUpdateError),this.tracks[u]={buffer:g,codec:c,container:a.container,levelCodec:a.levelCodec,id:a.id},n++}catch(r){S.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+r.message),this.hls.trigger(T.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:E})}}n&&this.hls.trigger(T.Events.BUFFER_CREATED,{tracks:this.tracks})},l._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},l._onSBUpdateEnd=function(e){var i=this.operationQueue;i.current(e).onComplete(),i.shiftAndExecuteNext(e)},l._onSBUpdateError=function(e,i){S.logger.error("[buffer-controller]: "+e+" SourceBuffer error",i),this.hls.trigger(T.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var t=this.operationQueue.current(e);t&&t.onError(i)},l.removeExecutor=function(e,i,t){var n=this.media,u=this.mediaSource,a=this.operationQueue,c=this.sourceBuffer[e];if(!n||!u||!c)return S.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void a.shiftAndExecuteNext(e);var E=Object(_.isFiniteNumber)(n.duration)?n.duration:1/0,g=Object(_.isFiniteNumber)(u.duration)?u.duration:1/0,v=Math.max(0,i),r=Math.min(t,E,g);r>v?(S.logger.log("[buffer-controller]: Removing ["+v+","+r+"] from the "+e+" SourceBuffer"),console.assert(!c.updating,e+" sourceBuffer must not be updating"),c.remove(v,r)):a.shiftAndExecuteNext(e)},l.appendExecutor=function(e,i){var t=this.operationQueue,n=this.sourceBuffer[i];if(!n)return S.logger.warn("[buffer-controller]: Attempting to append to the "+i+" SourceBuffer, but it does not exist"),void t.shiftAndExecuteNext(i);n.ended=!1,console.assert(!n.updating,i+" sourceBuffer must not be updating"),n.appendBuffer(e)},l.blockBuffers=function(e,i){var t=this;if(i===void 0&&(i=this.getSourceBufferTypes()),!i.length)return S.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(e);var n=this.operationQueue,u=i.map(function(a){return n.appendBlocker(a)});Promise.all(u).then(function(){e(),i.forEach(function(a){var c=t.sourceBuffer[a];c&&c.updating||n.shiftAndExecuteNext(a)})})},l.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},l.addBufferListener=function(e,i,t){var n=this.sourceBuffer[e];if(n){var u=t.bind(this,e);this.listeners[e].push({event:i,listener:u}),n.addEventListener(i,u)}},l.removeBufferListeners=function(e){var i=this.sourceBuffer[e];i&&this.listeners[e].forEach(function(t){i.removeEventListener(t.event,t.listener)})},m}()},"./src/controller/buffer-operation-queue.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return T});var _=f("./src/utils/logger.ts"),T=function(){function S(I){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=I}var D=S.prototype;return D.append=function(I,R){var o=this.queues[R];o.push(I),o.length===1&&this.buffers[R]&&this.executeNext(R)},D.insertAbort=function(I,R){this.queues[R].unshift(I),this.executeNext(R)},D.appendBlocker=function(I){var R,o=new Promise(function(y){R=y}),b={execute:R,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(b,I),o},D.executeNext=function(I){var R=this.buffers,o=this.queues,b=R[I],y=o[I];if(y.length){var d=y[0];try{d.execute()}catch(p){_.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),d.onError(p),b&&b.updating||(y.shift(),this.executeNext(I))}}},D.shiftAndExecuteNext=function(I){this.queues[I].shift(),this.executeNext(I)},D.current=function(I){return this.queues[I][0]},S}()},"./src/controller/cap-level-controller.ts":function(F,C,f){f.r(C);var _=f("./src/events.ts");function T(D,I){for(var R=0;R<I.length;R++){var o=I[R];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(D,o.key,o)}}var S=function(){function D(y){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=y,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var I,R,o,b=D.prototype;return b.setStreamController=function(y){this.streamController=y},b.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},b.registerListeners=function(){var y=this.hls;y.on(_.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),y.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),y.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),y.on(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),y.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},b.unregisterListener=function(){var y=this.hls;y.off(_.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),y.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),y.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),y.off(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),y.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},b.onFpsDropLevelCapping=function(y,d){D.isLevelAllowed(d.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(d.droppedLevel)},b.onMediaAttaching=function(y,d){this.media=d.media instanceof HTMLVideoElement?d.media:null},b.onManifestParsed=function(y,d){var p=this.hls;this.restrictedLevels=[],this.firstLevel=d.firstLevel,p.config.capLevelToPlayerSize&&d.video&&this.startCapping()},b.onBufferCodecs=function(y,d){this.hls.config.capLevelToPlayerSize&&d.video&&this.startCapping()},b.onMediaDetaching=function(){this.stopCapping()},b.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var y=this.hls.levels;if(y.length){var d=this.hls;d.autoLevelCapping=this.getMaxLevel(y.length-1),d.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=d.autoLevelCapping}}},b.getMaxLevel=function(y){var d=this,p=this.hls.levels;if(!p.length)return-1;var m=p.filter(function(l,e){return D.isLevelAllowed(e,d.restrictedLevels)&&e<=y});return this.clientRect=null,D.getMaxLevelByMediaSize(m,this.mediaWidth,this.mediaHeight)},b.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},b.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},b.getDimensions=function(){if(this.clientRect)return this.clientRect;var y=this.media,d={width:0,height:0};if(y){var p=y.getBoundingClientRect();d.width=p.width,d.height=p.height,d.width||d.height||(d.width=p.right-p.left||y.width||0,d.height=p.bottom-p.top||y.height||0)}return this.clientRect=d,d},D.isLevelAllowed=function(y,d){return d===void 0&&(d=[]),d.indexOf(y)===-1},D.getMaxLevelByMediaSize=function(y,d,p){if(!y||!y.length)return-1;for(var m,l,e=y.length-1,i=0;i<y.length;i+=1){var t=y[i];if((t.width>=d||t.height>=p)&&(m=t,!(l=y[i+1])||m.width!==l.width||m.height!==l.height)){e=i;break}}return e},I=D,o=[{key:"contentScaleFactor",get:function(){var y=1;try{y=self.devicePixelRatio}catch{}return y}}],(R=[{key:"mediaWidth",get:function(){return this.getDimensions().width*D.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*D.contentScaleFactor}}])&&T(I.prototype,R),o&&T(I,o),D}();C.default=S},"./src/controller/eme-controller.ts":function(F,C,f){f.r(C);var _=f("./src/events.ts"),T=f("./src/errors.ts"),S=f("./src/utils/logger.ts"),D=f("./src/utils/mediakeys-helper.ts");function I(o,b){for(var y=0;y<b.length;y++){var d=b[y];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(o,d.key,d)}}var R=function(){function o(p){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=p,this._config=p.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var b,y,d=o.prototype;return d.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},d._registerListeners=function(){this.hls.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this)},d._unregisterListeners=function(){this.hls.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(_.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this)},d.getLicenseServerUrl=function(p){switch(p){case D.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+p+'"')},d._attemptKeySystemAccess=function(p,m,l){var e=this,i=function(n,u,a,c){switch(n){case D.KeySystems.WIDEVINE:return function(E,g,v){var r={audioCapabilities:[],videoCapabilities:[]};return E.forEach(function(s){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+s+'"',robustness:v.audioRobustness||""})}),g.forEach(function(s){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+s+'"',robustness:v.videoRobustness||""})}),[r]}(u,a,c);default:throw new Error("Unknown key-system: "+n)}}(p,m,l,this._drmSystemOptions);S.logger.log("Requesting encrypted media key-system access");var t=this.requestMediaKeySystemAccess(p,i);this.mediaKeysPromise=t.then(function(n){return e._onMediaKeySystemAccessObtained(p,n)}),t.catch(function(n){S.logger.error('Failed to obtain key-system "'+p+'" access:',n)})},d._onMediaKeySystemAccessObtained=function(p,m){var l=this;S.logger.log('Access for key-system "'+p+'" obtained');var e={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:m,mediaKeySystemDomain:p};this._mediaKeysList.push(e);var i=Promise.resolve().then(function(){return m.createMediaKeys()}).then(function(t){return e.mediaKeys=t,S.logger.log('Media-keys created for key-system "'+p+'"'),l._onMediaKeysCreated(),t});return i.catch(function(t){S.logger.error("Failed to create media-keys:",t)}),i},d._onMediaKeysCreated=function(){var p=this;this._mediaKeysList.forEach(function(m){m.mediaKeysSession||(m.mediaKeysSession=m.mediaKeys.createSession(),p._onNewMediaKeySession(m.mediaKeysSession))})},d._onNewMediaKeySession=function(p){var m=this;S.logger.log("New key-system session "+p.sessionId),p.addEventListener("message",function(l){m._onKeySessionMessage(p,l.message)},!1)},d._onKeySessionMessage=function(p,m){S.logger.log("Got EME message event, creating license request"),this._requestLicense(m,function(l){S.logger.log("Received license data (length: "+(l&&l.byteLength)+"), updating key-session"),p.update(l)})},d.onMediaEncrypted=function(p){var m=this;if(S.logger.log('Media is encrypted using "'+p.initDataType+'" init data type'),!this.mediaKeysPromise)return S.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var l=function(e){m._media&&(m._attemptSetMediaKeys(e),m._generateRequestWithPreferredKeySession(p.initDataType,p.initData))};this.mediaKeysPromise.then(l).catch(l)},d._attemptSetMediaKeys=function(p){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var m=this._mediaKeysList[0];if(!m||!m.mediaKeys)return S.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});S.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(m.mediaKeys),this._hasSetMediaKeys=!0}},d._generateRequestWithPreferredKeySession=function(p,m){var l=this,e=this._mediaKeysList[0];if(!e)return S.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(e.mediaKeysSessionInitialized)S.logger.warn("Key-Session already initialized but requested again");else{var i=e.mediaKeysSession;if(!i)return S.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!m)return S.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});S.logger.log('Generating key-session request for "'+p+'" init data type'),e.mediaKeysSessionInitialized=!0,i.generateRequest(p,m).then(function(){S.logger.debug("Key-session generation succeeded")}).catch(function(t){S.logger.error("Error generating key-session request:",t),l.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},d._createLicenseXhr=function(p,m,l){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,e,p,m,l);var i=this._licenseXhrSetup;if(i)try{i.call(this.hls,e,p),i=void 0}catch(t){S.logger.error(t)}try{e.readyState||e.open("POST",p,!0),i&&i.call(this.hls,e,p)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return e},d._onLicenseRequestReadyStageChange=function(p,m,l,e){switch(p.readyState){case 4:if(p.status===200){this._requestLicenseFailureCount=0,S.logger.log("License request succeeded");var i=p.response,t=this._licenseResponseCallback;if(t)try{i=t.call(this.hls,p,m)}catch(u){S.logger.error(u)}e(i)}else{if(S.logger.error("License Request XHR failed ("+m+"). Status: "+p.status+" ("+p.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var n=3-this._requestLicenseFailureCount+1;S.logger.warn("Retrying license request, "+n+" attempts left"),this._requestLicense(l,e)}}},d._generateLicenseRequestChallenge=function(p,m){switch(p.mediaKeySystemDomain){case D.KeySystems.WIDEVINE:return m}throw new Error("unsupported key-system: "+p.mediaKeySystemDomain)},d._requestLicense=function(p,m){S.logger.log("Requesting content license for key-system");var l=this._mediaKeysList[0];if(!l)return S.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var e=this.getLicenseServerUrl(l.mediaKeySystemDomain),i=this._createLicenseXhr(e,p,m);S.logger.log("Sending license request to URL: "+e);var t=this._generateLicenseRequestChallenge(l,p);i.send(t)}catch(n){S.logger.error("Failure requesting DRM license: "+n),this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},d.onMediaAttached=function(p,m){if(this._emeEnabled){var l=m.media;this._media=l,l.addEventListener("encrypted",this._onMediaEncrypted)}},d.onMediaDetached=function(){var p=this._media,m=this._mediaKeysList;p&&(p.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(m.map(function(l){if(l.mediaKeysSession)return l.mediaKeysSession.close().catch(function(){})})).then(function(){return p.setMediaKeys(null)}).catch(function(){}))},d.onManifestParsed=function(p,m){if(this._emeEnabled){var l=m.levels.map(function(i){return i.audioCodec}).filter(function(i){return!!i}),e=m.levels.map(function(i){return i.videoCodec}).filter(function(i){return!!i});this._attemptKeySystemAccess(D.KeySystems.WIDEVINE,l,e)}},b=o,(y=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&I(b.prototype,y),o}();C.default=R},"./src/controller/fps-controller.ts":function(F,C,f){f.r(C);var _=f("./src/events.ts"),T=f("./src/utils/logger.ts"),S=function(){function D(R){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=R,this.registerListeners()}var I=D.prototype;return I.setStreamController=function(R){this.streamController=R},I.registerListeners=function(){this.hls.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},I.unregisterListeners=function(){this.hls.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching)},I.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},I.onMediaAttaching=function(R,o){var b=this.hls.config;if(b.capLevelOnFPSDrop){var y=o.media instanceof self.HTMLVideoElement?o.media:null;this.media=y,y&&typeof y.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),b.fpsDroppedMonitoringPeriod)}},I.checkFPS=function(R,o,b){var y=performance.now();if(o){if(this.lastTime){var d=y-this.lastTime,p=b-this.lastDroppedFrames,m=o-this.lastDecodedFrames,l=1e3*p/d,e=this.hls;if(e.trigger(_.Events.FPS_DROP,{currentDropped:p,currentDecoded:m,totalDroppedFrames:b}),l>0&&p>e.config.fpsDroppedMonitoringThreshold*m){var i=e.currentLevel;T.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+i),i>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=i)&&(i-=1,e.trigger(_.Events.FPS_DROP_LEVEL_CAPPING,{level:i,droppedLevel:e.currentLevel}),e.autoLevelCapping=i,this.streamController.nextLevelSwitch())}}this.lastTime=y,this.lastDroppedFrames=b,this.lastDecodedFrames=o}},I.checkFPSInterval=function(){var R=this.media;if(R)if(this.isVideoPlaybackQualityAvailable){var o=R.getVideoPlaybackQuality();this.checkFPS(R,o.totalVideoFrames,o.droppedVideoFrames)}else this.checkFPS(R,R.webkitDecodedFrameCount,R.webkitDroppedFrameCount)},D}();C.default=S},"./src/controller/fragment-finders.ts":function(F,C,f){f.r(C),f.d(C,"findFragmentByPDT",function(){return S}),f.d(C,"findFragmentByPTS",function(){return D}),f.d(C,"fragmentWithinToleranceTest",function(){return I}),f.d(C,"pdtWithinToleranceTest",function(){return R}),f.d(C,"findFragWithCC",function(){return o});var _=f("./src/polyfills/number.ts"),T=f("./src/utils/binary-search.ts");function S(b,y,d){if(y===null||!Array.isArray(b)||!b.length||!Object(_.isFiniteNumber)(y)||y<(b[0].programDateTime||0)||y>=(b[b.length-1].endProgramDateTime||0))return null;d=d||0;for(var p=0;p<b.length;++p){var m=b[p];if(R(y,d,m))return m}return null}function D(b,y,d,p){d===void 0&&(d=0),p===void 0&&(p=0);var m=null;if(b?m=y[b.sn-y[0].sn+1]||null:d===0&&y[0].start===0&&(m=y[0]),m&&I(d,p,m)===0)return m;var l=T.default.search(y,I.bind(null,d,p));return l||m}function I(b,y,d){b===void 0&&(b=0),y===void 0&&(y=0);var p=Math.min(y,d.duration+(d.deltaPTS?d.deltaPTS:0));return d.start+d.duration-p<=b?1:d.start-p>b&&d.start?-1:0}function R(b,y,d){var p=1e3*Math.min(y,d.duration+(d.deltaPTS?d.deltaPTS:0));return(d.endProgramDateTime||0)-p>b}function o(b,y){return T.default.search(b,function(d){return d.cc<y?1:d.cc>y?-1:0})}},"./src/controller/fragment-tracker.ts":function(F,C,f){f.r(C),f.d(C,"FragmentState",function(){return _}),f.d(C,"FragmentTracker",function(){return I});var _,T,S=f("./src/events.ts"),D=f("./src/types/loader.ts");(T=_||(_={})).NOT_LOADED="NOT_LOADED",T.BACKTRACKED="BACKTRACKED",T.APPENDING="APPENDING",T.PARTIAL="PARTIAL",T.OK="OK";var I=function(){function b(d){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=d,this._registerListeners()}var y=b.prototype;return y._registerListeners=function(){var d=this.hls;d.on(S.Events.BUFFER_APPENDED,this.onBufferAppended,this),d.on(S.Events.FRAG_BUFFERED,this.onFragBuffered,this),d.on(S.Events.FRAG_LOADED,this.onFragLoaded,this)},y._unregisterListeners=function(){var d=this.hls;d.off(S.Events.BUFFER_APPENDED,this.onBufferAppended,this),d.off(S.Events.FRAG_BUFFERED,this.onFragBuffered,this),d.off(S.Events.FRAG_LOADED,this.onFragLoaded,this)},y.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},y.getAppendedFrag=function(d,p){if(p===D.PlaylistLevelType.MAIN){var m=this.activeFragment,l=this.activeParts;if(!m)return null;if(l)for(var e=l.length;e--;){var i=l[e],t=i?i.end:m.appendedPTS;if(i.start<=d&&t!==void 0&&d<=t)return e>9&&(this.activeParts=l.slice(e-9)),i}else if(m.start<=d&&m.appendedPTS!==void 0&&d<=m.appendedPTS)return m}return this.getBufferedFrag(d,p)},y.getBufferedFrag=function(d,p){for(var m=this.fragments,l=Object.keys(m),e=l.length;e--;){var i=m[l[e]];if((i==null?void 0:i.body.type)===p&&i.buffered){var t=i.body;if(t.start<=d&&d<=t.end)return t}}return null},y.detectEvictedFragments=function(d,p,m){var l=this;Object.keys(this.fragments).forEach(function(e){var i=l.fragments[e];if(i)if(i.buffered){var t=i.range[d];t&&t.time.some(function(n){var u=!l.isTimeBuffered(n.startPTS,n.endPTS,p);return u&&l.removeFragment(i.body),u})}else i.body.type===m&&l.removeFragment(i.body)})},y.detectPartialFragments=function(d){var p=this,m=this.timeRanges,l=d.frag,e=d.part;if(m&&l.sn!=="initSegment"){var i=o(l),t=this.fragments[i];t&&(Object.keys(m).forEach(function(n){var u=l.elementaryStreams[n];if(u){var a=m[n],c=e!==null||u.partial===!0;t.range[n]=p.getBufferedTimes(l,e,c,a)}}),t.backtrack=t.loaded=null,Object.keys(t.range).length?t.buffered=!0:this.removeFragment(t.body))}},y.fragBuffered=function(d){var p=o(d),m=this.fragments[p];m&&(m.backtrack=m.loaded=null,m.buffered=!0)},y.getBufferedTimes=function(d,p,m,l){for(var e={time:[],partial:m},i=p?p.start:d.start,t=p?p.end:d.end,n=d.minEndPTS||t,u=d.maxStartPTS||i,a=0;a<l.length;a++){var c=l.start(a)-this.bufferPadding,E=l.end(a)+this.bufferPadding;if(u>=c&&n<=E){e.time.push({startPTS:Math.max(i,l.start(a)),endPTS:Math.min(t,l.end(a))});break}if(i<E&&t>c)e.partial=!0,e.time.push({startPTS:Math.max(i,l.start(a)),endPTS:Math.min(t,l.end(a))});else if(t<=c)break}return e},y.getPartialFragment=function(d){var p,m,l,e=null,i=0,t=this.bufferPadding,n=this.fragments;return Object.keys(n).forEach(function(u){var a=n[u];a&&R(a)&&(m=a.body.start-t,l=a.body.end+t,d>=m&&d<=l&&(p=Math.min(d-m,l-d),i<=p&&(e=a.body,i=p)))}),e},y.getState=function(d){var p=o(d),m=this.fragments[p];return m?m.buffered?R(m)?_.PARTIAL:_.OK:m.backtrack?_.BACKTRACKED:_.APPENDING:_.NOT_LOADED},y.backtrack=function(d,p){var m=o(d),l=this.fragments[m];if(!l||l.backtrack)return null;var e=l.backtrack=p||l.loaded;return l.loaded=null,e},y.getBacktrackData=function(d){var p=o(d),m=this.fragments[p];if(m){var l,e=m.backtrack;if(e!=null&&(l=e.payload)!==null&&l!==void 0&&l.byteLength)return e;this.removeFragment(d)}return null},y.isTimeBuffered=function(d,p,m){for(var l,e,i=0;i<m.length;i++){if(l=m.start(i)-this.bufferPadding,e=m.end(i)+this.bufferPadding,d>=l&&p<=e)return!0;if(p<=l)return!1}return!1},y.onFragLoaded=function(d,p){var m=p.frag,l=p.part;if(m.sn!=="initSegment"&&!m.bitrateTest&&!l){var e=o(m);this.fragments[e]={body:m,loaded:p,backtrack:null,buffered:!1,range:Object.create(null)}}},y.onBufferAppended=function(d,p){var m=this,l=p.frag,e=p.part,i=p.timeRanges;if(l.type===D.PlaylistLevelType.MAIN)if(this.activeFragment=l,e){var t=this.activeParts;t||(this.activeParts=t=[]),t.push(e)}else this.activeParts=null;this.timeRanges=i,Object.keys(i).forEach(function(n){var u=i[n];if(m.detectEvictedFragments(n,u),!e)for(var a=0;a<u.length;a++)l.appendedPTS=Math.max(u.end(a),l.appendedPTS||0)})},y.onFragBuffered=function(d,p){this.detectPartialFragments(p)},y.hasFragment=function(d){var p=o(d);return!!this.fragments[p]},y.removeFragmentsInRange=function(d,p,m){var l=this;Object.keys(this.fragments).forEach(function(e){var i=l.fragments[e];if(i&&i.buffered){var t=i.body;t.type===m&&t.start<p&&t.end>d&&l.removeFragment(t)}})},y.removeFragment=function(d){var p=o(d);d.stats.loaded=0,d.clearElementaryStreamInfo(),delete this.fragments[p]},y.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},b}();function R(b){var y,d;return b.buffered&&(((y=b.range.video)===null||y===void 0?void 0:y.partial)||((d=b.range.audio)===null||d===void 0?void 0:d.partial))}function o(b){return b.type+"_"+b.level+"_"+b.urlId+"_"+b.sn}},"./src/controller/gap-controller.ts":function(F,C,f){f.r(C),f.d(C,"STALL_MINIMUM_DURATION_MS",function(){return I}),f.d(C,"MAX_START_GAP_JUMP",function(){return R}),f.d(C,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return o}),f.d(C,"SKIP_BUFFER_RANGE_START",function(){return b}),f.d(C,"default",function(){return y});var _=f("./src/utils/buffer-helper.ts"),T=f("./src/errors.ts"),S=f("./src/events.ts"),D=f("./src/utils/logger.ts"),I=250,R=2,o=.1,b=.05,y=function(){function d(m,l,e,i){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=m,this.media=l,this.fragmentTracker=e,this.hls=i}var p=d.prototype;return p.destroy=function(){this.hls=this.fragmentTracker=this.media=null},p.poll=function(m){var l=this.config,e=this.media,i=this.stalled,t=e.currentTime,n=e.seeking,u=this.seeking&&!n,a=!this.seeking&&n;if(this.seeking=n,t===m){if((a||u)&&(this.stalled=null),!e.paused&&!e.ended&&e.playbackRate!==0&&_.BufferHelper.getBuffered(e).length){var c=_.BufferHelper.bufferInfo(e,t,0),E=c.len>0,g=c.nextStart||0;if(E||g){if(n){var v=c.len>R,r=!g||g-t>R&&!this.fragmentTracker.getPartialFragment(t);if(v||r)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var s,h=Math.max(g,c.start||0)-t,L=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,k=!(L==null||(s=L.details)===null||s===void 0)&&s.live?2*L.details.targetduration:R;if(h>0&&h<=k)return void this._trySkipBufferHole(null)}var A=self.performance.now();if(i!==null){var O=A-i;!n&&O>=I&&this._reportStall(c.len);var w=_.BufferHelper.bufferInfo(e,t,l.maxBufferHole);this._tryFixBufferStall(w,O)}else this.stalled=A}}}else if(this.moved=!0,i!==null){if(this.stallReported){var P=self.performance.now()-i;D.logger.warn("playback not stuck anymore @"+t+", after "+Math.round(P)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},p._tryFixBufferStall=function(m,l){var e=this.config,i=this.fragmentTracker,t=this.media.currentTime,n=i.getPartialFragment(t);n&&this._trySkipBufferHole(n)||m.len>e.maxBufferHole&&l>1e3*e.highBufferWatchdogPeriod&&(D.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},p._reportStall=function(m){var l=this.hls,e=this.media;this.stallReported||(this.stallReported=!0,D.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer (buffer="+m+")"),l.trigger(S.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:m}))},p._trySkipBufferHole=function(m){for(var l=this.config,e=this.hls,i=this.media,t=i.currentTime,n=0,u=_.BufferHelper.getBuffered(i),a=0;a<u.length;a++){var c=u.start(a);if(t+l.maxBufferHole>=n&&t<c){var E=Math.max(c+b,i.currentTime+o);return D.logger.warn("skipping hole, adjusting currentTime from "+t+" to "+E),this.moved=!0,this.stalled=null,i.currentTime=E,m&&e.trigger(S.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+t+" to "+E,frag:m}),E}n=u.end(a)}return 0},p._tryNudgeBuffer=function(){var m=this.config,l=this.hls,e=this.media,i=e.currentTime,t=(this.nudgeRetry||0)+1;if(this.nudgeRetry=t,t<m.nudgeMaxRetry){var n=i+t*m.nudgeOffset;D.logger.warn("Nudging 'currentTime' from "+i+" to "+n),e.currentTime=n,l.trigger(S.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else D.logger.error("Playhead still not moving while enough data buffered @"+i+" after "+m.nudgeMaxRetry+" nudges"),l.trigger(S.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},d}()},"./src/controller/id3-track-controller.ts":function(F,C,f){f.r(C);var _=f("./src/events.ts"),T=f("./src/utils/texttrack-utils.ts"),S=f("./src/demux/id3.ts"),D=function(){function I(o){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=o,this._registerListeners()}var R=I.prototype;return R.destroy=function(){this._unregisterListeners()},R._registerListeners=function(){var o=this.hls;o.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},R._unregisterListeners=function(){var o=this.hls;o.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(_.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},R.onMediaAttached=function(o,b){this.media=b.media},R.onMediaDetaching=function(){this.id3Track&&(Object(T.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},R.getID3Track=function(o){if(this.media){for(var b=0;b<o.length;b++){var y=o[b];if(y.kind==="metadata"&&y.label==="id3")return Object(T.sendAddTrackEvent)(y,this.media),y}return this.media.addTextTrack("metadata","id3")}},R.onFragParsingMetadata=function(o,b){if(this.media){var y=b.frag,d=b.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var p=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,m=0;m<d.length;m++){var l=S.getID3Frames(d[m].data);if(l){var e=d[m].pts,i=m<d.length-1?d[m+1].pts:y.end;i-e<=0&&(i=e+.25);for(var t=0;t<l.length;t++){var n=l[t];if(!S.isTimeStampFrame(n)){var u=new p(e,i,"");u.value=n,this.id3Track.addCue(u)}}}}}},R.onBufferFlushing=function(o,b){var y=b.startOffset,d=b.endOffset,p=b.type;if(!p||p==="audio"){var m=this.id3Track;m&&Object(T.removeCuesInRange)(m,y,d)}},I}();C.default=D},"./src/controller/latency-controller.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return I});var _=f("./src/errors.ts"),T=f("./src/events.ts"),S=f("./src/utils/logger.ts");function D(R,o){for(var b=0;b<o.length;b++){var y=o[b];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(R,y.key,y)}}var I=function(){function R(d){var p=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return p.timeupdate()},this.hls=d,this.config=d.config,this.registerListeners()}var o,b,y=R.prototype;return y.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},y.registerListeners=function(){this.hls.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(T.Events.ERROR,this.onError,this)},y.unregisterListeners=function(){this.hls.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(T.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(T.Events.ERROR,this.onError)},y.onMediaAttached=function(d,p){this.media=p.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},y.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},y.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},y.onLevelUpdated=function(d,p){var m=p.details;this.levelDetails=m,m.advanced&&this.timeupdate(),!m.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},y.onError=function(d,p){p.details===_.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,S.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},y.timeupdate=function(){var d=this.media,p=this.levelDetails;if(d&&p){this.currentTime=d.currentTime;var m=this.computeLatency();if(m!==null){this._latency=m;var l=this.config,e=l.lowLatencyMode,i=l.maxLiveSyncPlaybackRate;if(e&&i!==1){var t=this.targetLatency;if(t!==null){var n=m-t,u=n<Math.min(this.maxLatency,t+p.targetduration);if(p.live&&u&&n>.05&&this.forwardBufferLength>1){var a=Math.min(2,Math.max(1,i)),c=Math.round(2/(1+Math.exp(-.75*n-this.edgeStalled))*20)/20;d.playbackRate=Math.min(a,Math.max(1,c))}else d.playbackRate!==1&&d.playbackRate!==0&&(d.playbackRate=1)}}}}},y.estimateLiveEdge=function(){var d=this.levelDetails;return d===null?null:d.edge+d.age},y.computeLatency=function(){var d=this.estimateLiveEdge();return d===null?null:d-this.currentTime},o=R,(b=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var d=this.config,p=this.levelDetails;return d.liveMaxLatencyDuration!==void 0?d.liveMaxLatencyDuration:p?d.liveMaxLatencyDurationCount*p.targetduration:0}},{key:"targetLatency",get:function(){var d=this.levelDetails;if(d===null)return null;var p=d.holdBack,m=d.partHoldBack,l=d.targetduration,e=this.config,i=e.liveSyncDuration,t=e.liveSyncDurationCount,n=e.lowLatencyMode,u=this.hls.userConfig,a=n&&m||p;(u.liveSyncDuration||u.liveSyncDurationCount||a===0)&&(a=i!==void 0?i:t*l);var c=l;return a+Math.min(1*this.stallCount,c)}},{key:"liveSyncPosition",get:function(){var d=this.estimateLiveEdge(),p=this.targetLatency,m=this.levelDetails;if(d===null||p===null||m===null)return null;var l=m.edge,e=d-p-this.edgeStalled,i=l-m.totalduration,t=l-(this.config.lowLatencyMode&&m.partTarget||m.targetduration);return Math.min(Math.max(i,e),t)}},{key:"drift",get:function(){var d=this.levelDetails;return d===null?1:d.drift}},{key:"edgeStalled",get:function(){var d=this.levelDetails;if(d===null)return 0;var p=3*(this.config.lowLatencyMode&&d.partTarget||d.targetduration);return Math.max(d.age-p,0)}},{key:"forwardBufferLength",get:function(){var d=this.media,p=this.levelDetails;if(!d||!p)return 0;var m=d.buffered.length;return m?d.buffered.end(m-1):p.edge-this.currentTime}}])&&D(o.prototype,b),R}()},"./src/controller/level-controller.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return m});var _=f("./src/types/level.ts"),T=f("./src/events.ts"),S=f("./src/errors.ts"),D=f("./src/utils/codecs.ts"),I=f("./src/controller/level-helper.ts"),R=f("./src/controller/base-playlist-controller.ts"),o=f("./src/types/loader.ts");function b(){return(b=Object.assign||function(l){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(l[t]=i[t])}return l}).apply(this,arguments)}function y(l,e){for(var i=0;i<e.length;i++){var t=e[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(l,t.key,t)}}function d(l,e){return(d=Object.setPrototypeOf||function(i,t){return i.__proto__=t,i})(l,e)}var p=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),m=function(l){var e,i;function t(c){var E;return(E=l.call(this,c,"[level-controller]")||this)._levels=[],E._firstLevel=-1,E._startLevel=void 0,E.currentLevelIndex=-1,E.manualLevelIndex=-1,E.onParsedComplete=void 0,E._registerListeners(),E}i=l,(e=t).prototype=Object.create(i.prototype),e.prototype.constructor=e,d(e,i);var n,u,a=t.prototype;return a._registerListeners=function(){var c=this.hls;c.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.on(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.on(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),c.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),c.on(T.Events.ERROR,this.onError,this)},a._unregisterListeners=function(){var c=this.hls;c.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),c.off(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),c.off(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),c.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),c.off(T.Events.ERROR,this.onError,this)},a.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,l.prototype.destroy.call(this)},a.startLoad=function(){this._levels.forEach(function(c){c.loadError=0}),l.prototype.startLoad.call(this)},a.onManifestLoaded=function(c,E){var g,v,r=[],s=[],h=[],L={},k=!1,A=!1,O=!1;if(E.levels.forEach(function(M){var N=M.attrs;k=k||!(!M.width||!M.height),A=A||!!M.videoCodec,O=O||!!M.audioCodec,p&&M.audioCodec&&M.audioCodec.indexOf("mp4a.40.34")!==-1&&(M.audioCodec=void 0);var U=M.bitrate+"-"+M.attrs.RESOLUTION+"-"+M.attrs.CODECS;(v=L[U])?v.url.push(M.url):(v=new _.Level(M),L[U]=v,r.push(v)),N&&(N.AUDIO&&Object(I.addGroupId)(v,"audio",N.AUDIO),N.SUBTITLES&&Object(I.addGroupId)(v,"text",N.SUBTITLES))}),(k||A)&&O&&(r=r.filter(function(M){var N=M.videoCodec,U=M.width,G=M.height;return!!N||!(!U||!G)})),r=r.filter(function(M){var N=M.audioCodec,U=M.videoCodec;return(!N||Object(D.isCodecSupportedInMp4)(N,"audio"))&&(!U||Object(D.isCodecSupportedInMp4)(U,"video"))}),E.audioTracks&&(s=E.audioTracks.filter(function(M){return!M.audioCodec||Object(D.isCodecSupportedInMp4)(M.audioCodec,"audio")}),Object(I.assignTrackIdsByGroup)(s)),E.subtitles&&(h=E.subtitles,Object(I.assignTrackIdsByGroup)(h)),r.length>0){g=r[0].bitrate,r.sort(function(M,N){return M.bitrate-N.bitrate}),this._levels=r;for(var w=0;w<r.length;w++)if(r[w].bitrate===g){this._firstLevel=w,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+g);break}var P=O&&!A,x={levels:r,audioTracks:s,subtitleTracks:h,firstLevel:this._firstLevel,stats:E.stats,audio:O,video:A,altAudio:!P&&s.some(function(M){return!!M.url})};this.hls.trigger(T.Events.MANIFEST_PARSED,x),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(T.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:E.url,reason:"no level with compatible codecs found in manifest"})},a.onError=function(c,E){if(l.prototype.onError.call(this,c,E),!E.fatal){var g=E.context,v=this._levels[this.currentLevelIndex];if(g&&(g.type===o.PlaylistContextType.AUDIO_TRACK&&v.audioGroupIds&&g.groupId===v.audioGroupIds[v.urlId]||g.type===o.PlaylistContextType.SUBTITLE_TRACK&&v.textGroupIds&&g.groupId===v.textGroupIds[v.urlId]))this.redundantFailover(this.currentLevelIndex);else{var r,s=!1,h=!0;switch(E.details){case S.ErrorDetails.FRAG_LOAD_ERROR:case S.ErrorDetails.FRAG_LOAD_TIMEOUT:case S.ErrorDetails.KEY_LOAD_ERROR:case S.ErrorDetails.KEY_LOAD_TIMEOUT:if(E.frag){var L=this._levels[E.frag.level];L?(L.fragmentError++,L.fragmentError>this.hls.config.fragLoadingMaxRetry&&(r=E.frag.level)):r=E.frag.level}break;case S.ErrorDetails.LEVEL_LOAD_ERROR:case S.ErrorDetails.LEVEL_LOAD_TIMEOUT:g&&(g.deliveryDirectives&&(h=!1),r=g.level),s=!0;break;case S.ErrorDetails.REMUX_ALLOC_ERROR:r=E.level,s=!0}r!==void 0&&this.recoverLevel(E,r,s,h)}}},a.recoverLevel=function(c,E,g,v){var r=c.details,s=this._levels[E];if(s.loadError++,g){if(!this.retryLoadingOrFail(c))return void(this.currentLevelIndex=-1);c.levelRetry=!0}if(v){var h=s.url.length;if(h>1&&s.loadError<h)c.levelRetry=!0,this.redundantFailover(E);else if(this.manualLevelIndex===-1){var L=E===0?this._levels.length-1:E-1;this.currentLevelIndex!==L&&this._levels[L].loadError===0&&(this.warn(r+": switch to "+L),c.levelRetry=!0,this.hls.nextAutoLevel=L)}}},a.redundantFailover=function(c){var E=this._levels[c],g=E.url.length;if(g>1){var v=(E.urlId+1)%g;this.warn("Switching to redundant URL-id "+v),this._levels.forEach(function(r){r.urlId=v}),this.level=c}},a.onFragLoaded=function(c,E){var g=E.frag;if(g!==void 0&&g.type===o.PlaylistLevelType.MAIN){var v=this._levels[g.level];v!==void 0&&(v.fragmentError=0,v.loadError=0)}},a.onLevelLoaded=function(c,E){var g,v,r=E.level,s=E.details,h=this._levels[r];if(!h)return this.warn("Invalid level index "+r),void((v=E.deliveryDirectives)!==null&&v!==void 0&&v.skip&&(s.deltaUpdateFailed=!0));r===this.currentLevelIndex?(h.fragmentError===0&&(h.loadError=0,this.retryCount=0),this.playlistLoaded(r,E,h.details)):(g=E.deliveryDirectives)!==null&&g!==void 0&&g.skip&&(s.deltaUpdateFailed=!0)},a.onAudioTrackSwitched=function(c,E){var g=this.hls.levels[this.currentLevelIndex];if(g&&g.audioGroupIds){for(var v=-1,r=this.hls.audioTracks[E.id].groupId,s=0;s<g.audioGroupIds.length;s++)if(g.audioGroupIds[s]===r){v=s;break}v!==g.urlId&&(g.urlId=v,this.startLoad())}},a.loadPlaylist=function(c){var E=this.currentLevelIndex,g=this._levels[E];if(this.canLoad&&g&&g.url.length>0){var v=g.urlId,r=g.url[v];if(c)try{r=c.addDirectives(r)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("Attempt loading level index "+E+(c?" at sn "+c.msn+" part "+c.part:"")+" with URL-id "+v+" "+r),this.clearTimer(),this.hls.trigger(T.Events.LEVEL_LOADING,{url:r,level:E,id:v,deliveryDirectives:c||null})}},a.removeLevel=function(c,E){var g=function(r,s){return s!==E},v=this._levels.filter(function(r,s){return s!==c||r.url.length>1&&E!==void 0&&(r.url=r.url.filter(g),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(g)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(g)),r.urlId=0,!0)}).map(function(r,s){var h=r.details;return h!=null&&h.fragments&&h.fragments.forEach(function(L){L.level=s}),r});this._levels=v,this.hls.trigger(T.Events.LEVELS_UPDATED,{levels:v})},n=t,(u=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(c){var E,g=this._levels;if(g.length!==0&&(this.currentLevelIndex!==c||(E=g[c])===null||E===void 0||!E.details)){if(c<0||c>=g.length){var v=c<0;if(this.hls.trigger(T.Events.ERROR,{type:S.ErrorTypes.OTHER_ERROR,details:S.ErrorDetails.LEVEL_SWITCH_ERROR,level:c,fatal:v,reason:"invalid level idx"}),v)return;c=Math.min(c,g.length-1)}this.clearTimer();var r=this.currentLevelIndex,s=g[r],h=g[c];this.log("switching to level "+c+" from "+r),this.currentLevelIndex=c;var L=b({},h,{level:c,maxBitrate:h.maxBitrate,uri:h.uri,urlId:h.urlId});delete L._urlId,this.hls.trigger(T.Events.LEVEL_SWITCHING,L);var k=h.details;if(!k||k.live){var A=this.switchParams(h.uri,s==null?void 0:s.details);this.loadPlaylist(A)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(c){this.manualLevelIndex=c,this._startLevel===void 0&&(this._startLevel=c),c!==-1&&(this.level=c)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(c){this._firstLevel=c}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var c=this.hls.config.startLevel;return c!==void 0?c:this._firstLevel}return this._startLevel},set:function(c){this._startLevel=c}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(c){this.level=c,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=c)}}])&&y(n.prototype,u),t}(R.default)},"./src/controller/level-helper.ts":function(F,C,f){f.r(C),f.d(C,"addGroupId",function(){return S}),f.d(C,"assignTrackIdsByGroup",function(){return D}),f.d(C,"updatePTS",function(){return I}),f.d(C,"updateFragPTSDTS",function(){return o}),f.d(C,"mergeDetails",function(){return b}),f.d(C,"mapPartIntersection",function(){return y}),f.d(C,"mapFragmentIntersection",function(){return d}),f.d(C,"adjustSliding",function(){return p}),f.d(C,"addSliding",function(){return m}),f.d(C,"computeReloadInterval",function(){return l}),f.d(C,"getFragmentWithSN",function(){return e}),f.d(C,"getPartWith",function(){return i});var _=f("./src/polyfills/number.ts"),T=f("./src/utils/logger.ts");function S(t,n,u){switch(n){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(u);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(u)}}function D(t){var n={};t.forEach(function(u){var a=u.groupId||"";u.id=n[a]=n[a]||0,n[a]++})}function I(t,n,u){R(t[n],t[u])}function R(t,n){var u=n.startPTS;if(Object(_.isFiniteNumber)(u)){var a,c=0;n.sn>t.sn?(c=u-t.start,a=t):(c=t.start-u,a=n),a.duration!==c&&(a.duration=c)}else n.sn>t.sn?t.cc===n.cc&&t.minEndPTS?n.start=t.start+(t.minEndPTS-t.start):n.start=t.start+t.duration:n.start=Math.max(t.start-n.duration,0)}function o(t,n,u,a,c,E){a-u<=0&&(T.logger.warn("Fragment should have a positive duration",n),a=u+n.duration,E=c+n.duration);var g=u,v=a,r=n.startPTS,s=n.endPTS;if(Object(_.isFiniteNumber)(r)){var h=Math.abs(r-u);Object(_.isFiniteNumber)(n.deltaPTS)?n.deltaPTS=Math.max(h,n.deltaPTS):n.deltaPTS=h,g=Math.max(u,r),u=Math.min(u,r),c=Math.min(c,n.startDTS),v=Math.min(a,s),a=Math.max(a,s),E=Math.max(E,n.endDTS)}n.duration=a-u;var L=u-n.start;n.appendedPTS=a,n.start=n.startPTS=u,n.maxStartPTS=g,n.startDTS=c,n.endPTS=a,n.minEndPTS=v,n.endDTS=E;var k,A=n.sn;if(!t||A<t.startSN||A>t.endSN)return 0;var O=A-t.startSN,w=t.fragments;for(w[O]=n,k=O;k>0;k--)R(w[k],w[k-1]);for(k=O;k<w.length-1;k++)R(w[k],w[k+1]);return t.fragmentHint&&R(w[w.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,L}function b(t,n){for(var u=null,a=t.fragments,c=a.length-1;c>=0;c--){var E=a[c].initSegment;if(E){u=E;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var g,v=0;if(d(t,n,function(A,O){var w;A.relurl&&(v=A.cc-O.cc),Object(_.isFiniteNumber)(A.startPTS)&&Object(_.isFiniteNumber)(A.endPTS)&&(O.start=O.startPTS=A.startPTS,O.startDTS=A.startDTS,O.appendedPTS=A.appendedPTS,O.maxStartPTS=A.maxStartPTS,O.endPTS=A.endPTS,O.endDTS=A.endDTS,O.minEndPTS=A.minEndPTS,O.duration=A.endPTS-A.startPTS,O.duration&&(g=O),n.PTSKnown=n.alignedSliding=!0),O.elementaryStreams=A.elementaryStreams,O.loader=A.loader,O.stats=A.stats,O.urlId=A.urlId,A.initSegment?(O.initSegment=A.initSegment,u=A.initSegment):O.initSegment&&O.initSegment.relurl!=((w=u)===null||w===void 0?void 0:w.relurl)||(O.initSegment=u)}),n.skippedSegments&&(n.deltaUpdateFailed=n.fragments.some(function(A){return!A}),n.deltaUpdateFailed)){T.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var r=n.skippedSegments;r--;)n.fragments.shift();n.startSN=n.fragments[0].sn,n.startCC=n.fragments[0].cc}var s=n.fragments;if(v){T.logger.warn("discontinuity sliding from playlist, take drift into account");for(var h=0;h<s.length;h++)s[h].cc+=v}n.skippedSegments&&(n.startCC=n.fragments[0].cc),y(t.partList,n.partList,function(A,O){O.elementaryStreams=A.elementaryStreams,O.stats=A.stats}),g?o(n,g,g.startPTS,g.endPTS,g.startDTS,g.endDTS):p(t,n),s.length&&(n.totalduration=n.edge-s[0].start),n.driftStartTime=t.driftStartTime,n.driftStart=t.driftStart;var L=n.advancedDateTime;if(n.advanced&&L){var k=n.edge;n.driftStart||(n.driftStartTime=L,n.driftStart=k),n.driftEndTime=L,n.driftEnd=k}else n.driftEndTime=t.driftEndTime,n.driftEnd=t.driftEnd,n.advancedDateTime=t.advancedDateTime}function y(t,n,u){if(t&&n)for(var a=0,c=0,E=t.length;c<=E;c++){var g=t[c],v=n[c+a];g&&v&&g.index===v.index&&g.fragment.sn===v.fragment.sn?u(g,v):a--}}function d(t,n,u){for(var a=n.skippedSegments,c=Math.max(t.startSN,n.startSN)-n.startSN,E=(t.fragmentHint?1:0)+(a?n.endSN:Math.min(t.endSN,n.endSN))-n.startSN,g=n.startSN-t.startSN,v=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments,r=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,s=c;s<=E;s++){var h=r[g+s],L=v[s];a&&!L&&s<a&&(L=n.fragments[s]=h),h&&L&&u(h,L)}}function p(t,n){var u=n.startSN+n.skippedSegments-t.startSN,a=t.fragments;u<0||u>=a.length||m(n,a[u].start)}function m(t,n){if(n){for(var u=t.fragments,a=t.skippedSegments;a<u.length;a++)u[a].start+=n;t.fragmentHint&&(t.fragmentHint.start+=n)}}function l(t,n){var u,a=1e3*t.levelTargetDuration,c=a/2,E=t.age,g=E>0&&E<3*a,v=n.loading.end-n.loading.start,r=t.availabilityDelay;if(t.updated===!1)if(g){var s=333*t.misses;u=Math.max(Math.min(c,2*v),s),t.availabilityDelay=(t.availabilityDelay||0)+u}else u=c;else g?(r=Math.min(r||a/2,E),t.availabilityDelay=r,u=r+a-E):u=a-v;return Math.round(u)}function e(t,n,u){if(!t||!t.details)return null;var a=t.details,c=a.fragments[n-a.startSN];return c||((c=a.fragmentHint)&&c.sn===n?c:n<a.startSN&&u&&u.sn===n?u:null)}function i(t,n,u){if(!t||!t.details)return null;var a=t.details.partList;if(a)for(var c=a.length;c--;){var E=a[c];if(E.index===u&&E.fragment.sn===n)return E}return null}},"./src/controller/stream-controller.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return t});var _=f("./src/polyfills/number.ts"),T=f("./src/controller/base-stream-controller.ts"),S=f("./src/is-supported.ts"),D=f("./src/events.ts"),I=f("./src/utils/buffer-helper.ts"),R=f("./src/controller/fragment-tracker.ts"),o=f("./src/types/loader.ts"),b=f("./src/loader/fragment.ts"),y=f("./src/demux/transmuxer-interface.ts"),d=f("./src/types/transmuxer.ts"),p=f("./src/controller/gap-controller.ts"),m=f("./src/errors.ts"),l=f("./src/utils/logger.ts");function e(n,u){for(var a=0;a<u.length;a++){var c=u[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(n,c.key,c)}}function i(n,u){return(i=Object.setPrototypeOf||function(a,c){return a.__proto__=c,a})(n,u)}var t=function(n){var u,a;function c(r,s){var h;return(h=n.call(this,r,s,"[stream-controller]")||this).audioCodecSwap=!1,h.gapController=null,h.level=-1,h._forceStartLoad=!1,h.altAudio=!1,h.audioOnly=!1,h.fragPlaying=null,h.onvplaying=null,h.onvseeked=null,h.fragLastKbps=0,h.stalled=!1,h.couldBacktrack=!1,h.audioCodecSwitch=!1,h.videoBuffer=null,h._registerListeners(),h}a=n,(u=c).prototype=Object.create(a.prototype),u.prototype.constructor=u,i(u,a);var E,g,v=c.prototype;return v._registerListeners=function(){var r=this.hls;r.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(D.Events.ERROR,this.onError,this),r.on(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(D.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(D.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var r=this.hls;r.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(D.Events.ERROR,this.onError,this),r.off(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(D.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(D.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},v.startLoad=function(r){if(this.levels){var s=this.lastCurrentTime,h=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var L=h.startLevel;L===-1&&(h.config.testBandwidth?(L=0,this.bitrateTest=!0):L=h.nextAutoLevel),this.level=h.nextLoadLevel=L,this.loadedmetadata=!1}s>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),r=s),this.state=T.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=T.State.STOPPED},v.stopLoad=function(){this._forceStartLoad=!1,n.prototype.stopLoad.call(this)},v.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_LEVEL:var r,s=this.levels,h=this.level,L=s==null||(r=s[h])===null||r===void 0?void 0:r.details;if(L&&(!L.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(L))break;this.state=T.State.IDLE;break}break;case T.State.FRAG_LOADING_WAITING_RETRY:var k,A=self.performance.now(),O=this.retryDate;(!O||A>=O||(k=this.media)!==null&&k!==void 0&&k.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=T.State.IDLE)}this.onTickEnd()},v.onTickEnd=function(){n.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},v.doTickIdle=function(){var r,s,h=this.hls,L=this.levelLastLoaded,k=this.levels,A=this.media,O=h.config,w=h.nextLoadLevel;if(L!==null&&(A||!this.startFragRequested&&O.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&k&&k[w]){var P=k[w];this.level=h.nextLoadLevel=w;var x=P.details;if(!x||this.state===T.State.WAITING_LEVEL||x.live&&this.levelLastLoaded!==w)this.state=T.State.WAITING_LEVEL;else{var M=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:A,o.PlaylistLevelType.MAIN);if(M!==null&&!(M.len>=this.getMaxBufferLength(P.maxBitrate))){if(this._streamEnded(M,x)){var N={};return this.altAudio&&(N.type="video"),this.hls.trigger(D.Events.BUFFER_EOS,N),void(this.state=T.State.ENDED)}var U=M.end,G=this.getNextFragment(U,x);if(this.couldBacktrack&&!this.fragPrevious&&G&&G.sn!=="initSegment"){var V=G.sn-x.startSN;V>1&&(G=x.fragments[V-1],this.fragmentTracker.removeFragment(G))}if(G&&this.fragmentTracker.getState(G)===R.FragmentState.OK&&this.nextLoadPosition>U){var W=this.audioOnly&&!this.altAudio?b.ElementaryStreamTypes.AUDIO:b.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(A,W,o.PlaylistLevelType.MAIN),G=this.getNextFragment(this.nextLoadPosition,x)}G&&(!G.initSegment||G.initSegment.data||this.bitrateTest||(G=G.initSegment),((r=G.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(s=G.decryptdata)!==null&&s!==void 0&&s.key?this.loadFragment(G,x,U):this.loadKey(G,x))}}}},v.loadFragment=function(r,s,h){var L,k=this.fragmentTracker.getState(r);if(this.fragCurrent=r,k===R.FragmentState.BACKTRACKED){var A=this.fragmentTracker.getBacktrackData(r);if(A)return this._handleFragmentLoadProgress(A),void this._handleFragmentLoadComplete(A);k=R.FragmentState.NOT_LOADED}k===R.FragmentState.NOT_LOADED||k===R.FragmentState.PARTIAL?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(r.bitrateTest=!0,this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,r,s,h)):k===R.FragmentState.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((L=this.media)===null||L===void 0?void 0:L.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},v.getAppendedFrag=function(r){var s=this.fragmentTracker.getAppendedFrag(r,o.PlaylistLevelType.MAIN);return s&&"fragment"in s?s.fragment:s},v.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,o.PlaylistLevelType.MAIN)},v.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},v.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},v.nextLevelSwitch=function(){var r=this.levels,s=this.media;if(s!=null&&s.readyState){var h,L=this.getAppendedFrag(s.currentTime);if(L&&L.start>1&&this.flushMainBuffer(0,L.start-1),!s.paused&&r){var k=r[this.hls.nextLoadLevel],A=this.fragLastKbps;h=A&&this.fragCurrent?this.fragCurrent.duration*k.maxBitrate/(1e3*A)+1:0}else h=0;var O=this.getBufferedFrag(s.currentTime+h);if(O){var w=this.followingBufferedFrag(O);if(w){this.abortCurrentFrag();var P=w.maxStartPTS?w.maxStartPTS:w.start,x=w.duration,M=Math.max(O.end,P+Math.min(Math.max(x-this.config.maxFragLookUpTolerance,.5*x),.75*x));this.flushMainBuffer(M,Number.POSITIVE_INFINITY)}}}},v.abortCurrentFrag=function(){var r=this.fragCurrent;this.fragCurrent=null,r!=null&&r.loader&&r.loader.abort(),this.state===T.State.KEY_LOADING&&(this.state=T.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},v.flushMainBuffer=function(r,s){n.prototype.flushMainBuffer.call(this,r,s,this.altAudio?"video":null)},v.onMediaAttached=function(r,s){n.prototype.onMediaAttached.call(this,r,s);var h=s.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),h.addEventListener("playing",this.onvplaying),h.addEventListener("seeked",this.onvseeked),this.gapController=new p.default(this.config,h,this.fragmentTracker,this.hls)},v.onMediaDetaching=function(){var r=this.media;r&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),n.prototype.onMediaDetaching.call(this)},v.onMediaPlaying=function(){this.tick()},v.onMediaSeeked=function(){var r=this.media,s=r?r.currentTime:null;Object(_.isFiniteNumber)(s)&&this.log("Media seeked to "+s.toFixed(3)),this.tick()},v.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(D.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},v.onManifestParsed=function(r,s){var h,L=!1,k=!1;s.levels.forEach(function(A){(h=A.audioCodec)&&(h.indexOf("mp4a.40.2")!==-1&&(L=!0),h.indexOf("mp4a.40.5")!==-1&&(k=!0))}),this.audioCodecSwitch=L&&k&&!Object(S.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=s.levels,this.startFragRequested=!1},v.onLevelLoading=function(r,s){var h=this.levels;if(h&&this.state===T.State.IDLE){var L=h[s.level];(!L.details||L.details.live&&this.levelLastLoaded!==s.level||this.waitForCdnTuneIn(L.details))&&(this.state=T.State.WAITING_LEVEL)}},v.onLevelLoaded=function(r,s){var h,L=this.levels,k=s.level,A=s.details,O=A.totalduration;if(L){this.log("Level "+k+" loaded ["+A.startSN+","+A.endSN+"], cc ["+A.startCC+", "+A.endCC+"] duration:"+O);var w=this.fragCurrent;!w||this.state!==T.State.FRAG_LOADING&&this.state!==T.State.FRAG_LOADING_WAITING_RETRY||w.level!==s.level&&w.loader&&(this.state=T.State.IDLE,w.loader.abort());var P=L[k],x=0;if(A.live||(h=P.details)!==null&&h!==void 0&&h.live){if(A.fragments[0]||(A.deltaUpdateFailed=!0),A.deltaUpdateFailed)return;x=this.alignPlaylists(A,P.details)}if(P.details=A,this.levelLastLoaded=k,this.hls.trigger(D.Events.LEVEL_UPDATED,{details:A,level:k}),this.state===T.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(A))return;this.state=T.State.IDLE}this.startFragRequested?A.live&&this.synchronizeToLiveEdge(A):this.setStartPosition(A,x),this.tick()}else this.warn("Levels were reset while loading level "+k)},v._handleFragmentLoadProgress=function(r){var s,h=r.frag,L=r.part,k=r.payload,A=this.levels;if(A){var O=A[h.level],w=O.details;if(w){var P=O.videoCodec,x=w.PTSKnown||!w.live,M=(s=h.initSegment)===null||s===void 0?void 0:s.data,N=this._getAudioCodec(O),U=this.transmuxer=this.transmuxer||new y.default(this.hls,o.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),G=L?L.index:-1,V=G!==-1,W=new d.ChunkMetadata(h.level,h.sn,h.stats.chunkCount,k.byteLength,G,V),Y=this.initPTS[h.cc];U.push(k,M,N,P,h,L,w.totalduration,x,W,Y)}else this.warn("Dropping fragment "+h.sn+" of level "+h.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+h.sn+" of level "+h.level+" will not be buffered")},v.onAudioTrackSwitching=function(r,s){var h=this.altAudio,L=!!s.url,k=s.id;if(!L){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var A=this.fragCurrent;A!=null&&A.loader&&(this.log("Switching to main audio track, cancel main fragment load"),A.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var O=this.hls;h&&O.trigger(D.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),O.trigger(D.Events.AUDIO_TRACK_SWITCHED,{id:k})}},v.onAudioTrackSwitched=function(r,s){var h=s.id,L=!!this.hls.audioTracks[h].url;if(L){var k=this.videoBuffer;k&&this.mediaBuffer!==k&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=k)}this.altAudio=L,this.tick()},v.onBufferCreated=function(r,s){var h,L,k=s.tracks,A=!1;for(var O in k){var w=k[O];if(w.id==="main"){if(L=O,h=w,O==="video"){var P=k[O];P&&(this.videoBuffer=P.buffer)}}else A=!0}A&&h?(this.log("Alternate track found, use "+L+".buffered to schedule main fragment loading"),this.mediaBuffer=h.buffer):this.mediaBuffer=this.media},v.onFragBuffered=function(r,s){var h=s.frag,L=s.part;if(!h||h.type===o.PlaylistLevelType.MAIN){if(this.fragContextChanged(h))return this.warn("Fragment "+h.sn+(L?" p: "+L.index:"")+" of level "+h.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===T.State.PARSED&&(this.state=T.State.IDLE));var k=L?L.stats:h.stats;this.fragLastKbps=Math.round(8*k.total/(k.buffering.end-k.loading.first)),h.sn!=="initSegment"&&(this.fragPrevious=h),this.fragBufferedComplete(h,L)}},v.onError=function(r,s){switch(s.details){case m.ErrorDetails.FRAG_LOAD_ERROR:case m.ErrorDetails.FRAG_LOAD_TIMEOUT:case m.ErrorDetails.KEY_LOAD_ERROR:case m.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.MAIN,s);break;case m.ErrorDetails.LEVEL_LOAD_ERROR:case m.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==T.State.ERROR&&(s.fatal?(this.warn(""+s.details),this.state=T.State.ERROR):s.levelRetry||this.state!==T.State.WAITING_LEVEL||(this.state=T.State.IDLE));break;case m.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="main"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var h=!0,L=this.getFwdBufferInfo(this.media,o.PlaylistLevelType.MAIN);L&&L.len>.5&&(h=!this.reduceMaxBufferLength(L.len)),h&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},v.checkBuffer=function(){var r=this.media,s=this.gapController;if(r&&s&&r.readyState){var h=I.BufferHelper.getBuffered(r);!this.loadedmetadata&&h.length?(this.loadedmetadata=!0,this.seekToStartPos()):s.poll(this.lastCurrentTime),this.lastCurrentTime=r.currentTime}},v.onFragLoadEmergencyAborted=function(){this.state=T.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},v.onBufferFlushed=function(r,s){var h=s.type;if(h!==b.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var L=(h===b.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(L,h,o.PlaylistLevelType.MAIN)}},v.onLevelsUpdated=function(r,s){this.levels=s.levels},v.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},v.seekToStartPos=function(){var r=this.media,s=r.currentTime,h=this.startPosition;if(h>=0&&s<h){if(r.seeking)return void l.logger.log("could not seek to "+h+", already seeking at "+s);var L=I.BufferHelper.getBuffered(r),k=(L.length?L.start(0):0)-h;k>0&&k<this.config.maxBufferHole&&(l.logger.log("adjusting start position by "+k+" to match buffer start"),h+=k,this.startPosition=h),this.log("seek to target start position "+h+" from current time "+s),r.currentTime=h}},v._getAudioCodec=function(r){var s=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&s&&(this.log("Swapping audio codec"),s=s.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),s},v._loadBitrateTestFrag=function(r){var s=this;this._doFragLoad(r).then(function(h){var L=s.hls;if(h&&!L.nextLoadLevel&&!s.fragContextChanged(r)){s.fragLoadError=0,s.state=T.State.IDLE,s.startFragRequested=!1,s.bitrateTest=!1;var k=r.stats;k.parsing.start=k.parsing.end=k.buffering.start=k.buffering.end=self.performance.now(),L.trigger(D.Events.FRAG_LOADED,h)}})},v._handleTransmuxComplete=function(r){var s,h="main",L=this.hls,k=r.remuxResult,A=r.chunkMeta,O=this.getCurrentContext(A);if(!O)return this.warn("The loading context changed while buffering fragment "+A.sn+" of level "+A.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(A.level);var w=O.frag,P=O.part,x=O.level,M=k.video,N=k.text,U=k.id3,G=k.initSegment,V=this.altAudio?void 0:k.audio;if(!this.fragContextChanged(w)){if(this.state=T.State.PARSING,G){G.tracks&&(this._bufferInitSegment(x,G.tracks,w,A),L.trigger(D.Events.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:h,tracks:G.tracks}));var W=G.initPTS,Y=G.timescale;Object(_.isFiniteNumber)(W)&&(this.initPTS[w.cc]=W,L.trigger(D.Events.INIT_PTS_FOUND,{frag:w,id:h,initPTS:W,timescale:Y}))}if(M&&k.independent!==!1){if(x.details){var X=M.startPTS,z=M.endPTS,Z=M.startDTS,ne=M.endDTS;if(P)P.elementaryStreams[M.type]={startPTS:X,endPTS:z,startDTS:Z,endDTS:ne};else if(M.firstKeyFrame&&M.independent&&(this.couldBacktrack=!0),M.dropped&&M.independent){if(this.getLoadPosition()+this.config.maxBufferHole<X)return void this.backtrack(w);w.setElementaryStreamInfo(M.type,w.start,z,w.start,ne,!0)}w.setElementaryStreamInfo(M.type,X,z,Z,ne),this.bufferFragmentData(M,w,P,A)}}else if(k.independent===!1)return void this.backtrack(w);if(V){var oe=V.startPTS,de=V.endPTS,re=V.startDTS,pe=V.endDTS;P&&(P.elementaryStreams[b.ElementaryStreamTypes.AUDIO]={startPTS:oe,endPTS:de,startDTS:re,endDTS:pe}),w.setElementaryStreamInfo(b.ElementaryStreamTypes.AUDIO,oe,de,re,pe),this.bufferFragmentData(V,w,P,A)}if(U!=null&&(s=U.samples)!==null&&s!==void 0&&s.length){var te={frag:w,id:h,samples:U.samples};L.trigger(D.Events.FRAG_PARSING_METADATA,te)}if(N){var ae={frag:w,id:h,samples:N.samples};L.trigger(D.Events.FRAG_PARSING_USERDATA,ae)}}},v._bufferInitSegment=function(r,s,h,L){var k=this;if(this.state===T.State.PARSING){this.audioOnly=!!s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio;var A=s.audio,O=s.video,w=s.audiovideo;if(A){var P=r.audioCodec,x=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(P&&(P=P.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),A.metadata.channelCount!==1&&x.indexOf("firefox")===-1&&(P="mp4a.40.5")),x.indexOf("android")!==-1&&A.container!=="audio/mpeg"&&(P="mp4a.40.2",this.log("Android: force audio codec to "+P)),r.audioCodec&&r.audioCodec!==P&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+P+'"'),A.levelCodec=P,A.id="main",this.log("Init audio buffer, container:"+A.container+", codecs[selected/level/parsed]=["+(P||"")+"/"+(r.audioCodec||"")+"/"+A.codec+"]")}O&&(O.levelCodec=r.videoCodec,O.id="main",this.log("Init video buffer, container:"+O.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+O.codec+"]")),w&&this.log("Init audiovideo buffer, container:"+w.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+w.codec+"]"),this.hls.trigger(D.Events.BUFFER_CODECS,s),Object.keys(s).forEach(function(M){var N=s[M].initSegment;N!=null&&N.byteLength&&k.hls.trigger(D.Events.BUFFER_APPENDING,{type:M,data:N,frag:h,part:null,chunkMeta:L,parent:h.type})}),this.tick()}},v.backtrack=function(r){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(r);var s=this.fragmentTracker.backtrack(r);this.fragPrevious=null,this.nextLoadPosition=r.start,s?this.resetFragmentLoading(r):this.state=T.State.BACKTRACKING},v.checkFragmentChanged=function(){var r=this.media,s=null;if(r&&r.readyState>1&&r.seeking===!1){var h=r.currentTime;if(I.BufferHelper.isBuffered(r,h)?s=this.getAppendedFrag(h):I.BufferHelper.isBuffered(r,h+.1)&&(s=this.getAppendedFrag(h+.1)),s){var L=this.fragPlaying,k=s.level;L&&s.sn===L.sn&&L.level===k&&s.urlId===L.urlId||(this.hls.trigger(D.Events.FRAG_CHANGED,{frag:s}),L&&L.level===k||this.hls.trigger(D.Events.LEVEL_SWITCHED,{level:k}),this.fragPlaying=s)}}},E=c,(g=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentLevel",get:function(){var r=this.media;if(r){var s=this.getAppendedFrag(r.currentTime);if(s)return s.level}return-1}},{key:"nextBufferedFrag",get:function(){var r=this.media;if(r){var s=this.getAppendedFrag(r.currentTime);return this.followingBufferedFrag(s)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&e(E.prototype,g),c}(T.default)},"./src/controller/subtitle-stream-controller.ts":function(F,C,f){f.r(C),f.d(C,"SubtitleStreamController",function(){return l});var _=f("./src/events.ts"),T=f("./src/utils/logger.ts"),S=f("./src/utils/buffer-helper.ts"),D=f("./src/controller/fragment-finders.ts"),I=f("./src/utils/discontinuities.ts"),R=f("./src/controller/level-helper.ts"),o=f("./src/controller/fragment-tracker.ts"),b=f("./src/controller/base-stream-controller.ts"),y=f("./src/types/loader.ts"),d=f("./src/types/level.ts");function p(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,i){return(m=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(e,i)}var l=function(e){var i,t;function n(E,g){var v;return(v=e.call(this,E,g,"[subtitle-stream-controller]")||this).levels=[],v.currentTrackId=-1,v.tracksBuffered=[],v.mainDetails=null,v._registerListeners(),v}t=e,(i=n).prototype=Object.create(t.prototype),i.prototype.constructor=i,m(i,t);var u,a,c=n.prototype;return c.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},c._registerListeners=function(){var E=this.hls;E.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),E.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.on(_.Events.ERROR,this.onError,this),E.on(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),E.on(_.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),E.on(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),E.on(_.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),E.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},c._unregisterListeners=function(){var E=this.hls;E.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),E.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),E.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),E.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),E.off(_.Events.ERROR,this.onError,this),E.off(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),E.off(_.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),E.off(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),E.off(_.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),E.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},c.startLoad=function(){this.stopLoad(),this.state=b.State.IDLE,this.setInterval(500),this.tick()},c.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},c.onLevelLoaded=function(E,g){this.mainDetails=g.details},c.onSubtitleFragProcessed=function(E,g){var v=g.frag,r=g.success;if(this.fragPrevious=v,this.state=b.State.IDLE,r){var s=this.tracksBuffered[this.currentTrackId];if(s){for(var h,L=v.start,k=0;k<s.length;k++)if(L>=s[k].start&&L<=s[k].end){h=s[k];break}var A=v.start+v.duration;h?h.end=A:(h={start:L,end:A},s.push(h)),this.fragmentTracker.fragBuffered(v)}}},c.onBufferFlushing=function(E,g){var v=g.startOffset,r=g.endOffset;if(v===0&&r!==Number.POSITIVE_INFINITY){var s=this.currentTrackId,h=this.levels;if(!h.length||!h[s]||!h[s].details)return;var L=r-h[s].details.targetduration;if(L<=0)return;g.endOffsetSubtitles=Math.max(0,L),this.tracksBuffered.forEach(function(k){for(var A=0;A<k.length;)if(k[A].end<=L)k.shift();else{if(!(k[A].start<L))break;k[A].start=L,A++}}),this.fragmentTracker.removeFragmentsInRange(v,L,y.PlaylistLevelType.SUBTITLE)}},c.onError=function(E,g){var v,r=g.frag;r&&r.type===y.PlaylistLevelType.SUBTITLE&&((v=this.fragCurrent)!==null&&v!==void 0&&v.loader&&this.fragCurrent.loader.abort(),this.state=b.State.IDLE)},c.onSubtitleTracksUpdated=function(E,g){var v=this,r=g.subtitleTracks;this.tracksBuffered=[],this.levels=r.map(function(s){return new d.Level(s)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(s){v.tracksBuffered[s.id]=[]}),this.mediaBuffer=null},c.onSubtitleTrackSwitch=function(E,g){if(this.currentTrackId=g.id,this.levels.length&&this.currentTrackId!==-1){var v=this.levels[this.currentTrackId];v!=null&&v.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null}else this.clearInterval()},c.onSubtitleTrackLoaded=function(E,g){var v,r=g.details,s=g.id,h=this.currentTrackId,L=this.levels;if(L.length){var k=L[h];if(!(s>=L.length||s!==h)&&k){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||(v=k.details)!==null&&v!==void 0&&v.live){var A=this.mainDetails;if(r.deltaUpdateFailed||!A)return;var O=A.fragments[0];k.details?this.alignPlaylists(r,k.details)===0&&O&&Object(R.addSliding)(r,O.start):r.hasProgramDateTime&&A.hasProgramDateTime?Object(I.alignPDT)(r,A):O&&Object(R.addSliding)(r,O.start)}k.details=r,this.levelLastLoaded=s,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===b.State.IDLE&&(Object(D.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),k.details=void 0))}}},c._handleFragmentLoadComplete=function(E){var g=E.frag,v=E.payload,r=g.decryptdata,s=this.hls;if(!this.fragContextChanged(g)&&v&&v.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){var h=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(v),r.key.buffer,r.iv.buffer).then(function(L){var k=performance.now();s.trigger(_.Events.FRAG_DECRYPTED,{frag:g,payload:L,stats:{tstart:h,tdecrypt:k}})})}},c.doTick=function(){if(this.media){if(this.state===b.State.IDLE){var E,g=this.currentTrackId,v=this.levels;if(!v.length||!v[g]||!v[g].details)return;var r=v[g].details,s=r.targetduration,h=this.config,L=this.media,k=S.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,L.currentTime-s,h.maxBufferHole),A=k.end;if(k.len>this.getMaxBufferLength()+s)return;console.assert(r,"Subtitle track details are defined on idle subtitle stream controller tick");var O,w=r.fragments,P=w.length,x=r.edge,M=this.fragPrevious;if(A<x){var N=h.maxFragLookUpTolerance;M&&r.hasProgramDateTime&&(O=Object(D.findFragmentByPDT)(w,M.endProgramDateTime,N)),O||!(O=Object(D.findFragmentByPTS)(M,w,A,N))&&M&&M.start<w[0].start&&(O=w[0])}else O=w[P-1];(E=O)!==null&&E!==void 0&&E.encrypted?(T.logger.log("Loading key for "+O.sn),this.state=b.State.KEY_LOADING,this.hls.trigger(_.Events.KEY_LOADING,{frag:O})):O&&this.fragmentTracker.getState(O)===o.FragmentState.NOT_LOADED&&this.loadFragment(O,r,A)}}else this.state=b.State.IDLE},c.loadFragment=function(E,g,v){this.fragCurrent=E,e.prototype.loadFragment.call(this,E,g,v)},u=n,(a=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&p(u.prototype,a),n}(b.default)},"./src/controller/subtitle-track-controller.ts":function(F,C,f){f.r(C);var _=f("./src/events.ts"),T=f("./src/utils/texttrack-utils.ts"),S=f("./src/controller/base-playlist-controller.ts"),D=f("./src/types/loader.ts");function I(y,d){for(var p=0;p<d.length;p++){var m=d[p];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(y,m.key,m)}}function R(y,d){return(R=Object.setPrototypeOf||function(p,m){return p.__proto__=m,p})(y,d)}var o=function(y){var d,p;function m(t){var n;return(n=y.call(this,t,"[subtitle-track-controller]")||this).media=null,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.selectDefaultTrack=!0,n.queuedDefaultTrack=-1,n.trackChangeListener=function(){return n.onTextTracksChanged()},n.asyncPollTrackChange=function(){return n.pollTrackChange(0)},n.useTextTrackPolling=!1,n.subtitlePollingInterval=-1,n.subtitleDisplay=!0,n.registerListeners(),n}p=y,(d=m).prototype=Object.create(p.prototype),d.prototype.constructor=d,R(d,p);var l,e,i=m.prototype;return i.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,y.prototype.destroy.call(this)},i.registerListeners=function(){var t=this.hls;t.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(_.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){var t=this.hls;t.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(_.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(_.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(_.Events.ERROR,this.onError,this)},i.onMediaAttached=function(t,n){this.media=n.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},i.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},i.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),b(this.media.textTracks).forEach(function(t){Object(T.clearCurrentCues)(t)}),this.subtitleTrack=-1,this.media=null)},i.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},i.onManifestParsed=function(t,n){this.tracks=n.subtitleTracks},i.onSubtitleTrackLoaded=function(t,n){var u=n.id,a=n.details,c=this.trackId,E=this.tracksInGroup[c];if(E){var g=E.details;E.details=n.details,this.log("subtitle track "+u+" loaded ["+a.startSN+"-"+a.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,n,g))}else this.warn("Invalid subtitle track id "+u)},i.onLevelLoading=function(t,n){this.switchLevel(n.level)},i.onLevelSwitching=function(t,n){this.switchLevel(n.level)},i.switchLevel=function(t){var n=this.hls.levels[t];if(n!=null&&n.textGroupIds){var u=n.textGroupIds[n.urlId];if(this.groupId!==u){var a=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,c=this.tracks.filter(function(v){return!u||v.groupId===u});this.tracksInGroup=c;var E=this.findTrackId(a==null?void 0:a.name)||this.findTrackId();this.groupId=u;var g={subtitleTracks:c};this.log("Updating subtitle tracks, "+c.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(_.Events.SUBTITLE_TRACKS_UPDATED,g),E!==-1&&this.setSubtitleTrack(E,a)}}},i.findTrackId=function(t){for(var n=this.tracksInGroup,u=0;u<n.length;u++){var a=n[u];if((!this.selectDefaultTrack||a.default)&&(!t||t===a.name))return a.id}return-1},i.onError=function(t,n){y.prototype.onError.call(this,t,n),!n.fatal&&n.context&&n.context.type===D.PlaylistContextType.SUBTITLE_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},i.loadPlaylist=function(t){var n=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(n)){var u=n.id,a=n.groupId,c=n.url;if(t)try{c=t.addDirectives(c)}catch(E){this.warn("Could not construct new URL with HLS Delivery Directives: "+E)}this.log("Loading subtitle playlist for id "+u),this.hls.trigger(_.Events.SUBTITLE_TRACK_LOADING,{url:c,id:u,groupId:a,deliveryDirectives:t||null})}},i.toggleTrackModes=function(t){var n=this,u=this.media,a=this.subtitleDisplay,c=this.trackId;if(u){var E=b(u.textTracks),g=E.filter(function(s){return s.groupId===n.groupId});if(t===-1)[].slice.call(E).forEach(function(s){s.mode="disabled"});else{var v=g[c];v&&(v.mode="disabled")}var r=g[t];r&&(r.mode=a?"showing":"hidden")}},i.setSubtitleTrack=function(t,n){var u,a=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(u=a[t])!==null&&u!==void 0&&u.details)||t<-1||t>=a.length)){this.clearTimer();var c=a[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,c){var E=c.id,g=c.groupId,v=g===void 0?"":g,r=c.name,s=c.type,h=c.url;this.hls.trigger(_.Events.SUBTITLE_TRACK_SWITCH,{id:E,groupId:v,name:r,type:s,url:h});var L=this.switchParams(c.url,n==null?void 0:n.details);this.loadPlaylist(L)}else this.hls.trigger(_.Events.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},i.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,n=b(this.media.textTracks),u=0;u<n.length;u++)if(n[u].mode==="hidden")t=u;else if(n[u].mode==="showing"){t=u;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},l=m,(e=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,n)}}])&&I(l.prototype,e),m}(S.default);function b(y){for(var d=[],p=0;p<y.length;p++){var m=y[p];m.kind==="subtitles"&&m.label&&d.push(y[p])}return d}C.default=o},"./src/controller/timeline-controller.ts":function(F,C,f){f.r(C),f.d(C,"TimelineController",function(){return d});var _=f("./src/polyfills/number.ts"),T=f("./src/events.ts"),S=f("./src/utils/cea-608-parser.ts"),D=f("./src/utils/output-filter.ts"),I=f("./src/utils/webvtt-parser.ts"),R=f("./src/utils/texttrack-utils.ts"),o=f("./src/utils/imsc1-ttml-parser.ts"),b=f("./src/types/loader.ts"),y=f("./src/utils/logger.ts"),d=function(){function m(e){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var i=new D.default(this,"textTrack1"),t=new D.default(this,"textTrack2"),n=new D.default(this,"textTrack3"),u=new D.default(this,"textTrack4");this.cea608Parser1=new S.default(1,i,t),this.cea608Parser2=new S.default(3,n,u)}e.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(T.Events.FRAG_LOADING,this.onFragLoading,this),e.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),e.on(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var l=m.prototype;return l.destroy=function(){var e=this.hls;e.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(T.Events.FRAG_LOADING,this.onFragLoading,this),e.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),e.off(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},l.addCues=function(e,i,t,n,u){for(var a,c,E,g,v=!1,r=u.length;r--;){var s=u[r],h=(a=s[0],c=s[1],E=i,g=t,Math.min(c,g)-Math.max(a,E));if(h>=0&&(s[0]=Math.min(s[0],i),s[1]=Math.max(s[1],t),v=!0,h/(t-i)>.5))return}if(v||u.push([i,t]),this.config.renderTextTracksNatively){var L=this.captionsTracks[e];this.Cues.newCue(L,i,t,n)}else{var k=this.Cues.newCue(null,i,t,n);this.hls.trigger(T.Events.CUES_PARSED,{type:"captions",cues:k,track:e})}},l.onInitPtsFound=function(e,i){var t=this,n=i.frag,u=i.id,a=i.initPTS,c=i.timescale,E=this.unparsedVttFrags;u==="main"&&(this.initPTS[n.cc]=a,this.timescale[n.cc]=c),E.length&&(this.unparsedVttFrags=[],E.forEach(function(g){t.onFragLoaded(T.Events.FRAG_LOADED,g)}))},l.getExistingTrack=function(e){var i=this.media;if(i)for(var t=0;t<i.textTracks.length;t++){var n=i.textTracks[t];if(n[e])return n}return null},l.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},l.createNativeTrack=function(e){if(!this.captionsTracks[e]){var i=this.captionsProperties,t=this.captionsTracks,n=this.media,u=i[e],a=u.label,c=u.languageCode,E=this.getExistingTrack(e);if(E)t[e]=E,Object(R.clearCurrentCues)(t[e]),Object(R.sendAddTrackEvent)(t[e],n);else{var g=this.createTextTrack("captions",a,c);g&&(g[e]=!0,t[e]=g)}}},l.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var i=this.captionsProperties[e];if(i){var t={_id:e,label:i.label,kind:"captions",default:!!i.media&&!!i.media.default,closedCaptions:i.media};this.nonNativeCaptionsTracks[e]=t,this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[t]})}}},l.createTextTrack=function(e,i,t){var n=this.media;if(n)return n.addTextTrack(e,i,t)},l.onMediaAttaching=function(e,i){this.media=i.media,this._cleanTracks()},l.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach(function(i){Object(R.clearCurrentCues)(e[i]),delete e[i]}),this.nonNativeCaptionsTracks={}},l.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},l._cleanTracks=function(){var e=this.media;if(e){var i=e.textTracks;if(i)for(var t=0;t<i.length;t++)Object(R.clearCurrentCues)(i[t])}},l.onSubtitleTracksUpdated=function(e,i){var t=this;this.textTracks=[];var n=i.subtitleTracks||[],u=n.some(function(g){return g.textCodec===o.IMSC1_CODEC});if(this.config.enableWebVTT||u&&this.config.enableIMSC1){var a=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var c=this.media?this.media.textTracks:[];this.tracks.forEach(function(g,v){var r;if(v<c.length){for(var s=null,h=0;h<c.length;h++)if(p(c[h],g)){s=c[h];break}s&&(r=s)}r?Object(R.clearCurrentCues)(r):(r=t.createTextTrack("subtitles",g.name,g.lang))&&(r.mode="disabled"),r&&(r.groupId=g.groupId,t.textTracks.push(r))})}else if(!a&&this.tracks&&this.tracks.length){var E=this.tracks.map(function(g){return{label:g.name,kind:g.type.toLowerCase(),default:g.default,subtitleTrack:g}});this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:E})}}},l.onManifestLoaded=function(e,i){var t=this;this.config.enableCEA708Captions&&i.captions&&i.captions.forEach(function(n){var u=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(u){var a="textTrack"+u[1],c=t.captionsProperties[a];c&&(c.label=n.name,n.lang&&(c.languageCode=n.lang),c.media=n)}})},l.onFragLoading=function(e,i){var t=this.cea608Parser1,n=this.cea608Parser2,u=this.lastSn;if(this.enabled&&t&&n&&i.frag.type===b.PlaylistLevelType.MAIN){var a=i.frag.sn;a!==u+1&&(t.reset(),n.reset()),this.lastSn=a}},l.onFragLoaded=function(e,i){var t=i.frag,n=i.payload,u=this.initPTS,a=this.unparsedVttFrags;if(t.type===b.PlaylistLevelType.SUBTITLE)if(n.byteLength){if(!Object(_.isFiniteNumber)(u[t.cc]))return a.push(i),void(u.length&&this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Missing initial subtitle PTS")}));var c=t.decryptdata;if(c==null||c.key==null||c.method!=="AES-128"){var E=this.tracks[t.level],g=this.vttCCs;g[t.cc]||(g[t.cc]={start:t.start,prevCC:this.prevCC,new:!0},this.prevCC=t.cc),E&&E.textCodec===o.IMSC1_CODEC?this._parseIMSC1(t,n):this._parseVTTs(t,n,g)}}else this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:new Error("Empty subtitle payload")})},l._parseIMSC1=function(e,i){var t=this,n=this.hls;Object(o.parseIMSC1)(i,this.initPTS[e.cc],this.timescale[e.cc],function(u){t._appendCues(u,e.level),n.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(u){y.logger.log("Failed to parse IMSC1: "+u),n.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:u})})},l._parseVTTs=function(e,i,t){var n=this,u=this.hls;Object(I.parseWebVTT)(i,this.initPTS[e.cc],this.timescale[e.cc],t,e.cc,e.start,function(a){n._appendCues(a,e.level),u.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},function(a){n._fallbackToIMSC1(e,i),y.logger.log("Failed to parse VTT cue: "+a),u.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})},l._fallbackToIMSC1=function(e,i){var t=this,n=this.tracks[e.level];n.textCodec||Object(o.parseIMSC1)(i,this.initPTS[e.cc],this.timescale[e.cc],function(){n.textCodec=o.IMSC1_CODEC,t._parseIMSC1(e,i)},function(){n.textCodec="wvtt"})},l._appendCues=function(e,i){var t=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[i];if(n.mode==="disabled")return;e.forEach(function(a){return Object(R.addCueToTrack)(n,a)})}else{var u=this.tracks[i].default?"default":"subtitles"+i;t.trigger(T.Events.CUES_PARSED,{type:"subtitles",cues:e,track:u})}},l.onFragDecrypted=function(e,i){var t=i.frag;if(t.type===b.PlaylistLevelType.SUBTITLE){if(!Object(_.isFiniteNumber)(this.initPTS[t.cc]))return void this.unparsedVttFrags.push(i);this.onFragLoaded(T.Events.FRAG_LOADED,i)}},l.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},l.onFragParsingUserdata=function(e,i){var t=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&t&&n)for(var u=0;u<i.samples.length;u++){var a=i.samples[u].bytes;if(a){var c=this.extractCea608Data(a);t.addData(i.samples[u].pts,c[0]),n.addData(i.samples[u].pts,c[1])}}},l.onBufferFlushing=function(e,i){var t=i.startOffset,n=i.endOffset,u=i.endOffsetSubtitles,a=i.type,c=this.media;if(c&&!(c.currentTime<n)){if(!a||a==="video"){var E=this.captionsTracks;Object.keys(E).forEach(function(v){return Object(R.removeCuesInRange)(E[v],t,n)})}if(this.config.renderTextTracksNatively&&t===0&&u!==void 0){var g=this.textTracks;Object.keys(g).forEach(function(v){return Object(R.removeCuesInRange)(g[v],t,u)})}}},l.extractCea608Data=function(e){for(var i=31&e[0],t=2,n=[[],[]],u=0;u<i;u++){var a=e[t++],c=127&e[t++],E=127&e[t++],g=3&a;c===0&&E===0||(4&a)!=0&&(g!==0&&g!==1||(n[g].push(c),n[g].push(E)))}return n},m}();function p(m,l){return m&&m.label===l.name&&!(m.textTrack1||m.textTrack2)}},"./src/crypt/aes-crypto.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return _});var _=function(){function T(S,D){this.subtle=void 0,this.aesIV=void 0,this.subtle=S,this.aesIV=D}return T.prototype.decrypt=function(S,D){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},D,S)},T}()},"./src/crypt/aes-decryptor.ts":function(F,C,f){f.r(C),f.d(C,"removePadding",function(){return T}),f.d(C,"default",function(){return S});var _=f("./src/utils/typed-array.ts");function T(D){var I=D.byteLength,R=I&&new DataView(D.buffer).getUint8(I-1);return R?Object(_.sliceUint8)(D,0,I-R):D}var S=function(){function D(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var I=D.prototype;return I.uint8ArrayToUint32Array_=function(R){for(var o=new DataView(R),b=new Uint32Array(4),y=0;y<4;y++)b[y]=o.getUint32(4*y);return b},I.initTable=function(){var R=this.sBox,o=this.invSBox,b=this.subMix,y=b[0],d=b[1],p=b[2],m=b[3],l=this.invSubMix,e=l[0],i=l[1],t=l[2],n=l[3],u=new Uint32Array(256),a=0,c=0,E=0;for(E=0;E<256;E++)u[E]=E<128?E<<1:E<<1^283;for(E=0;E<256;E++){var g=c^c<<1^c<<2^c<<3^c<<4;g=g>>>8^255&g^99,R[a]=g,o[g]=a;var v=u[a],r=u[v],s=u[r],h=257*u[g]^16843008*g;y[a]=h<<24|h>>>8,d[a]=h<<16|h>>>16,p[a]=h<<8|h>>>24,m[a]=h,h=16843009*s^65537*r^257*v^16843008*a,e[g]=h<<24|h>>>8,i[g]=h<<16|h>>>16,t[g]=h<<8|h>>>24,n[g]=h,a?(a=v^u[u[u[s^v]]],c^=u[u[c]]):a=c=1}},I.expandKey=function(R){for(var o=this.uint8ArrayToUint32Array_(R),b=!0,y=0;y<o.length&&b;)b=o[y]===this.key[y],y++;if(!b){this.key=o;var d=this.keySize=o.length;if(d!==4&&d!==6&&d!==8)throw new Error("Invalid aes key size="+d);var p,m,l,e,i=this.ksRows=4*(d+6+1),t=this.keySchedule=new Uint32Array(i),n=this.invKeySchedule=new Uint32Array(i),u=this.sBox,a=this.rcon,c=this.invSubMix,E=c[0],g=c[1],v=c[2],r=c[3];for(p=0;p<i;p++)p<d?l=t[p]=o[p]:(e=l,p%d==0?(e=u[(e=e<<8|e>>>24)>>>24]<<24|u[e>>>16&255]<<16|u[e>>>8&255]<<8|u[255&e],e^=a[p/d|0]<<24):d>6&&p%d==4&&(e=u[e>>>24]<<24|u[e>>>16&255]<<16|u[e>>>8&255]<<8|u[255&e]),t[p]=l=(t[p-d]^e)>>>0);for(m=0;m<i;m++)p=i-m,e=3&m?t[p]:t[p-4],n[m]=m<4||p<=4?e:E[u[e>>>24]]^g[u[e>>>16&255]]^v[u[e>>>8&255]]^r[u[255&e]],n[m]=n[m]>>>0}},I.networkToHostOrderSwap=function(R){return R<<24|(65280&R)<<8|(16711680&R)>>8|R>>>24},I.decrypt=function(R,o,b){for(var y,d,p,m,l,e,i,t,n,u,a,c,E,g,v=this.keySize+6,r=this.invKeySchedule,s=this.invSBox,h=this.invSubMix,L=h[0],k=h[1],A=h[2],O=h[3],w=this.uint8ArrayToUint32Array_(b),P=w[0],x=w[1],M=w[2],N=w[3],U=new Int32Array(R),G=new Int32Array(U.length),V=this.networkToHostOrderSwap;o<U.length;){for(n=V(U[o]),u=V(U[o+1]),a=V(U[o+2]),c=V(U[o+3]),l=n^r[0],e=c^r[1],i=a^r[2],t=u^r[3],E=4,g=1;g<v;g++)y=L[l>>>24]^k[e>>16&255]^A[i>>8&255]^O[255&t]^r[E],d=L[e>>>24]^k[i>>16&255]^A[t>>8&255]^O[255&l]^r[E+1],p=L[i>>>24]^k[t>>16&255]^A[l>>8&255]^O[255&e]^r[E+2],m=L[t>>>24]^k[l>>16&255]^A[e>>8&255]^O[255&i]^r[E+3],l=y,e=d,i=p,t=m,E+=4;y=s[l>>>24]<<24^s[e>>16&255]<<16^s[i>>8&255]<<8^s[255&t]^r[E],d=s[e>>>24]<<24^s[i>>16&255]<<16^s[t>>8&255]<<8^s[255&l]^r[E+1],p=s[i>>>24]<<24^s[t>>16&255]<<16^s[l>>8&255]<<8^s[255&e]^r[E+2],m=s[t>>>24]<<24^s[l>>16&255]<<16^s[e>>8&255]<<8^s[255&i]^r[E+3],G[o]=V(y^P),G[o+1]=V(m^x),G[o+2]=V(p^M),G[o+3]=V(d^N),P=n,x=u,M=a,N=c,o+=4}return G.buffer},D}()},"./src/crypt/decrypter.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return o});var _=f("./src/crypt/aes-crypto.ts"),T=f("./src/crypt/fast-aes-key.ts"),S=f("./src/crypt/aes-decryptor.ts"),D=f("./src/utils/logger.ts"),I=f("./src/utils/mp4-tools.ts"),R=f("./src/utils/typed-array.ts"),o=function(){function b(d,p,m){var l=(m===void 0?{}:m).removePKCS7Padding,e=l===void 0||l;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=d,this.config=p,this.removePKCS7Padding=e,e)try{var i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var y=b.prototype;return y.destroy=function(){this.observer=null},y.isSync=function(){return this.config.enableSoftwareAES},y.flush=function(){var d=this.currentResult;if(d){var p=new Uint8Array(d);return this.reset(),this.removePKCS7Padding?Object(S.removePadding)(p):p}this.reset()},y.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},y.decrypt=function(d,p,m,l){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(d),p,m);var e=this.flush();e&&l(e.buffer)}else this.webCryptoDecrypt(new Uint8Array(d),p,m).then(l)},y.softwareDecrypt=function(d,p,m){var l=this.currentIV,e=this.currentResult,i=this.remainderData;this.logOnce("JS AES decrypt"),i&&(d=Object(I.appendUint8Array)(i,d),this.remainderData=null);var t=this.getValidChunk(d);if(!t.length)return null;l&&(m=l);var n=this.softwareDecrypter;n||(n=this.softwareDecrypter=new S.default),n.expandKey(p);var u=e;return this.currentResult=n.decrypt(t.buffer,0,m),this.currentIV=Object(R.sliceUint8)(t,-16).buffer,u||null},y.webCryptoDecrypt=function(d,p,m){var l=this,e=this.subtle;return this.key===p&&this.fastAesKey||(this.key=p,this.fastAesKey=new T.default(e,p)),this.fastAesKey.expandKey().then(function(i){return e?new _.default(e,m).decrypt(d.buffer,i):Promise.reject(new Error("web crypto not initialized"))}).catch(function(i){return l.onWebCryptoError(i,d,p,m)})},y.onWebCryptoError=function(d,p,m,l){return D.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",d),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(p,m,l)},y.getValidChunk=function(d){var p=d,m=d.length-d.length%16;return m!==d.length&&(p=Object(R.sliceUint8)(d,0,m),this.remainderData=Object(R.sliceUint8)(d,m)),p},y.logOnce=function(d){this.logEnabled&&(D.logger.log("[decrypter.ts]: "+d),this.logEnabled=!1)},b}()},"./src/crypt/fast-aes-key.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return _});var _=function(){function T(S,D){this.subtle=void 0,this.key=void 0,this.subtle=S,this.key=D}return T.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},T}()},"./src/demux/aacdemuxer.ts":function(F,C,f){f.r(C);var _=f("./src/demux/base-audio-demuxer.ts"),T=f("./src/demux/adts.ts"),S=f("./src/utils/logger.ts"),D=f("./src/demux/id3.ts");function I(o,b){return(I=Object.setPrototypeOf||function(y,d){return y.__proto__=d,y})(o,b)}var R=function(o){var b,y;function d(m,l){var e;return(e=o.call(this)||this).observer=void 0,e.config=void 0,e.observer=m,e.config=l,e}y=o,(b=d).prototype=Object.create(y.prototype),b.prototype.constructor=b,I(b,y);var p=d.prototype;return p.resetInitSegment=function(m,l,e){o.prototype.resetInitSegment.call(this,m,l,e),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:m,duration:e,inputTimeScale:9e4,dropped:0}},d.probe=function(m){if(!m)return!1;for(var l=(D.getID3Data(m,0)||[]).length,e=m.length;l<e;l++)if(T.probe(m,l))return S.logger.log("ADTS sync word found !"),!0;return!1},p.canParse=function(m,l){return T.canParse(m,l)},p.appendFrame=function(m,l,e){T.initTrackConfig(m,this.observer,l,e,m.manifestCodec);var i=T.appendFrame(m,l,e,this.initPTS,this.frameIndex);if(i&&i.missing===0)return i},d}(_.default);R.minProbeByteLength=9,C.default=R},"./src/demux/adts.ts":function(F,C,f){f.r(C),f.d(C,"getAudioConfig",function(){return D}),f.d(C,"isHeaderPattern",function(){return I}),f.d(C,"getHeaderLength",function(){return R}),f.d(C,"getFullFrameLength",function(){return o}),f.d(C,"canGetFrameLength",function(){return b}),f.d(C,"isHeader",function(){return y}),f.d(C,"canParse",function(){return d}),f.d(C,"probe",function(){return p}),f.d(C,"initTrackConfig",function(){return m}),f.d(C,"getFrameDuration",function(){return l}),f.d(C,"parseFrameHeader",function(){return e}),f.d(C,"appendFrame",function(){return i});var _=f("./src/utils/logger.ts"),T=f("./src/errors.ts"),S=f("./src/events.ts");function D(t,n,u,a){var c,E,g,v,r=navigator.userAgent.toLowerCase(),s=a,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];c=1+((192&n[u+2])>>>6);var L=(60&n[u+2])>>>2;if(!(L>h.length-1))return g=(1&n[u+2])<<2,g|=(192&n[u+3])>>>6,_.logger.log("manifest codec:"+a+", ADTS type:"+c+", samplingIndex:"+L),/firefox/i.test(r)?L>=6?(c=5,v=new Array(4),E=L-3):(c=2,v=new Array(2),E=L):r.indexOf("android")!==-1?(c=2,v=new Array(2),E=L):(c=5,v=new Array(4),a&&(a.indexOf("mp4a.40.29")!==-1||a.indexOf("mp4a.40.5")!==-1)||!a&&L>=6?E=L-3:((a&&a.indexOf("mp4a.40.2")!==-1&&(L>=6&&g===1||/vivaldi/i.test(r))||!a&&g===1)&&(c=2,v=new Array(2)),E=L)),v[0]=c<<3,v[0]|=(14&L)>>1,v[1]|=(1&L)<<7,v[1]|=g<<3,c===5&&(v[1]|=(14&E)>>1,v[2]=(1&E)<<7,v[2]|=8,v[3]=0),{config:v,samplerate:h[L],channelCount:g,codec:"mp4a.40."+c,manifestCodec:s};t.trigger(S.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+L})}function I(t,n){return t[n]===255&&(246&t[n+1])==240}function R(t,n){return 1&t[n+1]?7:9}function o(t,n){return(3&t[n+3])<<11|t[n+4]<<3|(224&t[n+5])>>>5}function b(t,n){return n+5<t.length}function y(t,n){return n+1<t.length&&I(t,n)}function d(t,n){return b(t,n)&&I(t,n)&&o(t,n)<=t.length-n}function p(t,n){if(y(t,n)){var u=R(t,n);if(n+u>=t.length)return!1;var a=o(t,n);if(a<=u)return!1;var c=n+a;return c===t.length||y(t,c)}return!1}function m(t,n,u,a,c){if(!t.samplerate){var E=D(n,u,a,c);if(!E)return;t.config=E.config,t.samplerate=E.samplerate,t.channelCount=E.channelCount,t.codec=E.codec,t.manifestCodec=E.manifestCodec,_.logger.log("parsed codec:"+t.codec+", rate:"+E.samplerate+", channels:"+E.channelCount)}}function l(t){return 9216e4/t}function e(t,n,u,a,c){var E=R(t,n),g=o(t,n);if((g-=E)>0)return{headerLength:E,frameLength:g,stamp:u+a*c}}function i(t,n,u,a,c){var E=e(n,u,a,c,l(t.samplerate));if(E){var g,v=E.frameLength,r=E.headerLength,s=E.stamp,h=r+v,L=Math.max(0,u+h-n.length);L?(g=new Uint8Array(h-r)).set(n.subarray(u+r,n.length),0):g=n.subarray(u+r,u+h);var k={unit:g,pts:s};return L||t.samples.push(k),{sample:k,length:h,missing:L}}}},"./src/demux/base-audio-demuxer.ts":function(F,C,f){f.r(C),f.d(C,"initPTSFn",function(){return o});var _=f("./src/polyfills/number.ts"),T=f("./src/demux/id3.ts"),S=f("./src/demux/dummy-demuxed-track.ts"),D=f("./src/utils/mp4-tools.ts"),I=f("./src/utils/typed-array.ts"),R=function(){function b(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var y=b.prototype;return y.resetInitSegment=function(d,p,m){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},y.resetTimeStamp=function(){},y.resetContiguity=function(){},y.canParse=function(d,p){return!1},y.appendFrame=function(d,p,m){},y.demux=function(d,p){this.cachedData&&(d=Object(D.appendUint8Array)(this.cachedData,d),this.cachedData=null);var m,l,e=T.getID3Data(d,0),i=e?e.length:0,t=this._audioTrack,n=this._id3Track,u=e?T.getTimeStamp(e):void 0,a=d.length;for(this.frameIndex!==0&&this.initPTS!==null||(this.initPTS=o(u,p)),e&&e.length>0&&n.samples.push({pts:this.initPTS,dts:this.initPTS,data:e}),l=this.initPTS;i<a;){if(this.canParse(d,i)){var c=this.appendFrame(t,d,i);c?(this.frameIndex++,l=c.sample.pts,m=i+=c.length):i=a}else T.canParse(d,i)?(e=T.getID3Data(d,i),n.samples.push({pts:l,dts:l,data:e}),m=i+=e.length):i++;if(i===a&&m!==a){var E=Object(I.sliceUint8)(d,m);this.cachedData?this.cachedData=Object(D.appendUint8Array)(this.cachedData,E):this.cachedData=E}}return{audioTrack:t,avcTrack:Object(S.dummyTrack)(),id3Track:n,textTrack:Object(S.dummyTrack)()}},y.demuxSampleAes=function(d,p,m){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},y.flush=function(d){var p=this.cachedData;return p&&(this.cachedData=null,this.demux(p,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(S.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(S.dummyTrack)()}},y.destroy=function(){},b}(),o=function(b,y){return Object(_.isFiniteNumber)(b)?90*b:9e4*y};C.default=R},"./src/demux/chunk-cache.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return _});var _=function(){function T(){this.chunks=[],this.dataLength=0}var S=T.prototype;return S.push=function(D){this.chunks.push(D),this.dataLength+=D.length},S.flush=function(){var D,I=this.chunks,R=this.dataLength;return I.length?(D=I.length===1?I[0]:function(o,b){for(var y=new Uint8Array(b),d=0,p=0;p<o.length;p++){var m=o[p];y.set(m,d),d+=m.length}return y}(I,R),this.reset(),D):new Uint8Array(0)},S.reset=function(){this.chunks.length=0,this.dataLength=0},T}()},"./src/demux/dummy-demuxed-track.ts":function(F,C,f){function _(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}f.r(C),f.d(C,"dummyTrack",function(){return _})},"./src/demux/exp-golomb.ts":function(F,C,f){f.r(C);var _=f("./src/utils/logger.ts"),T=function(){function S(I){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=I,this.bytesAvailable=I.byteLength,this.word=0,this.bitsAvailable=0}var D=S.prototype;return D.loadWord=function(){var I=this.data,R=this.bytesAvailable,o=I.byteLength-R,b=new Uint8Array(4),y=Math.min(4,R);if(y===0)throw new Error("no bytes available");b.set(I.subarray(o,o+y)),this.word=new DataView(b.buffer).getUint32(0),this.bitsAvailable=8*y,this.bytesAvailable-=y},D.skipBits=function(I){var R;this.bitsAvailable>I?(this.word<<=I,this.bitsAvailable-=I):(I-=this.bitsAvailable,I-=(R=I>>3)>>3,this.bytesAvailable-=R,this.loadWord(),this.word<<=I,this.bitsAvailable-=I)},D.readBits=function(I){var R=Math.min(this.bitsAvailable,I),o=this.word>>>32-R;return I>32&&_.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=R,this.bitsAvailable>0?this.word<<=R:this.bytesAvailable>0&&this.loadWord(),(R=I-R)>0&&this.bitsAvailable?o<<R|this.readBits(R):o},D.skipLZ=function(){var I;for(I=0;I<this.bitsAvailable;++I)if((this.word&2147483648>>>I)!=0)return this.word<<=I,this.bitsAvailable-=I,I;return this.loadWord(),I+this.skipLZ()},D.skipUEG=function(){this.skipBits(1+this.skipLZ())},D.skipEG=function(){this.skipBits(1+this.skipLZ())},D.readUEG=function(){var I=this.skipLZ();return this.readBits(I+1)-1},D.readEG=function(){var I=this.readUEG();return 1&I?1+I>>>1:-1*(I>>>1)},D.readBoolean=function(){return this.readBits(1)===1},D.readUByte=function(){return this.readBits(8)},D.readUShort=function(){return this.readBits(16)},D.readUInt=function(){return this.readBits(32)},D.skipScalingList=function(I){for(var R=8,o=8,b=0;b<I;b++)o!==0&&(o=(R+this.readEG()+256)%256),R=o===0?R:o},D.readSPS=function(){var I,R,o,b=0,y=0,d=0,p=0,m=this.readUByte.bind(this),l=this.readBits.bind(this),e=this.readUEG.bind(this),i=this.readBoolean.bind(this),t=this.skipBits.bind(this),n=this.skipEG.bind(this),u=this.skipUEG.bind(this),a=this.skipScalingList.bind(this);m();var c=m();if(l(5),t(3),m(),u(),c===100||c===110||c===122||c===244||c===44||c===83||c===86||c===118||c===128){var E=e();if(E===3&&t(1),u(),u(),t(1),i())for(R=E!==3?8:12,o=0;o<R;o++)i()&&a(o<6?16:64)}u();var g=e();if(g===0)e();else if(g===1)for(t(1),n(),n(),I=e(),o=0;o<I;o++)n();u(),t(1);var v=e(),r=e(),s=l(1);s===0&&t(1),t(1),i()&&(b=e(),y=e(),d=e(),p=e());var h=[1,1];if(i()&&i())switch(m()){case 1:h=[1,1];break;case 2:h=[12,11];break;case 3:h=[10,11];break;case 4:h=[16,11];break;case 5:h=[40,33];break;case 6:h=[24,11];break;case 7:h=[20,11];break;case 8:h=[32,11];break;case 9:h=[80,33];break;case 10:h=[18,11];break;case 11:h=[15,11];break;case 12:h=[64,33];break;case 13:h=[160,99];break;case 14:h=[4,3];break;case 15:h=[3,2];break;case 16:h=[2,1];break;case 255:h=[m()<<8|m(),m()<<8|m()]}return{width:Math.ceil(16*(v+1)-2*b-2*y),height:(2-s)*(r+1)*16-(s?2:4)*(d+p),pixelRatio:h}},D.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},S}();C.default=T},"./src/demux/id3.ts":function(F,C,f){f.r(C),f.d(C,"isHeader",function(){return T}),f.d(C,"isFooter",function(){return S}),f.d(C,"getID3Data",function(){return D}),f.d(C,"canParse",function(){return R}),f.d(C,"getTimeStamp",function(){return o}),f.d(C,"isTimeStampFrame",function(){return b}),f.d(C,"getID3Frames",function(){return d}),f.d(C,"decodeFrame",function(){return p}),f.d(C,"utf8ArrayToStr",function(){return t}),f.d(C,"testables",function(){return n});var _,T=function(u,a){return a+10<=u.length&&u[a]===73&&u[a+1]===68&&u[a+2]===51&&u[a+3]<255&&u[a+4]<255&&u[a+6]<128&&u[a+7]<128&&u[a+8]<128&&u[a+9]<128},S=function(u,a){return a+10<=u.length&&u[a]===51&&u[a+1]===68&&u[a+2]===73&&u[a+3]<255&&u[a+4]<255&&u[a+6]<128&&u[a+7]<128&&u[a+8]<128&&u[a+9]<128},D=function(u,a){for(var c=a,E=0;T(u,a);)E+=10,E+=I(u,a+6),S(u,a+10)&&(E+=10),a+=E;if(E>0)return u.subarray(c,c+E)},I=function(u,a){var c=0;return c=(127&u[a])<<21,c|=(127&u[a+1])<<14,c|=(127&u[a+2])<<7,c|=127&u[a+3]},R=function(u,a){return T(u,a)&&I(u,a+6)+10<=u.length-a},o=function(u){for(var a=d(u),c=0;c<a.length;c++){var E=a[c];if(b(E))return i(E)}},b=function(u){return u&&u.key==="PRIV"&&u.info==="com.apple.streaming.transportStreamTimestamp"},y=function(u){var a=String.fromCharCode(u[0],u[1],u[2],u[3]),c=I(u,4);return{type:a,size:c,data:u.subarray(10,10+c)}},d=function(u){for(var a=0,c=[];T(u,a);){for(var E=I(u,a+6),g=(a+=10)+E;a+8<g;){var v=y(u.subarray(a)),r=p(v);r&&c.push(r),a+=v.size+10}S(u,a)&&(a+=10)}return c},p=function(u){return u.type==="PRIV"?m(u):u.type[0]==="W"?e(u):l(u)},m=function(u){if(!(u.size<2)){var a=t(u.data,!0),c=new Uint8Array(u.data.subarray(a.length+1));return{key:u.type,info:a,data:c.buffer}}},l=function(u){if(!(u.size<2)){if(u.type==="TXXX"){var a=1,c=t(u.data.subarray(a),!0);a+=c.length+1;var E=t(u.data.subarray(a));return{key:u.type,info:c,data:E}}var g=t(u.data.subarray(1));return{key:u.type,data:g}}},e=function(u){if(u.type==="WXXX"){if(u.size<2)return;var a=1,c=t(u.data.subarray(a),!0);a+=c.length+1;var E=t(u.data.subarray(a));return{key:u.type,info:c,data:E}}var g=t(u.data);return{key:u.type,data:g}},i=function(u){if(u.data.byteLength===8){var a=new Uint8Array(u.data),c=1&a[3],E=(a[4]<<23)+(a[5]<<15)+(a[6]<<7)+a[7];return E/=45,c&&(E+=4772185884e-2),Math.round(E)}},t=function(u,a){a===void 0&&(a=!1);var c=(_||self.TextDecoder===void 0||(_=new self.TextDecoder("utf-8")),_);if(c){var E=c.decode(u);if(a){var g=E.indexOf("\0");return g!==-1?E.substring(0,g):E}return E.replace(/\0/g,"")}for(var v,r,s,h=u.length,L="",k=0;k<h;){if((v=u[k++])===0&&a)return L;if(v!==0&&v!==3)switch(v>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:L+=String.fromCharCode(v);break;case 12:case 13:r=u[k++],L+=String.fromCharCode((31&v)<<6|63&r);break;case 14:r=u[k++],s=u[k++],L+=String.fromCharCode((15&v)<<12|(63&r)<<6|(63&s)<<0)}}return L},n={decodeTextFrame:l}},"./src/demux/mp3demuxer.ts":function(F,C,f){f.r(C);var _=f("./src/demux/base-audio-demuxer.ts"),T=f("./src/demux/id3.ts"),S=f("./src/utils/logger.ts"),D=f("./src/demux/mpegaudio.ts");function I(o,b){return(I=Object.setPrototypeOf||function(y,d){return y.__proto__=d,y})(o,b)}var R=function(o){var b,y;function d(){return o.apply(this,arguments)||this}y=o,(b=d).prototype=Object.create(y.prototype),b.prototype.constructor=b,I(b,y);var p=d.prototype;return p.resetInitSegment=function(m,l,e){o.prototype.resetInitSegment.call(this,m,l,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:m,duration:e,inputTimeScale:9e4,dropped:0}},d.probe=function(m){if(!m)return!1;for(var l=(T.getID3Data(m,0)||[]).length,e=m.length;l<e;l++)if(D.probe(m,l))return S.logger.log("MPEG Audio sync word found !"),!0;return!1},p.canParse=function(m,l){return D.canParse(m,l)},p.appendFrame=function(m,l,e){if(this.initPTS!==null)return D.appendFrame(m,l,e,this.initPTS,this.frameIndex)},d}(_.default);R.minProbeByteLength=4,C.default=R},"./src/demux/mp4demuxer.ts":function(F,C,f){f.r(C);var _=f("./src/utils/mp4-tools.ts"),T=f("./src/demux/dummy-demuxed-track.ts"),S=function(){function D(R,o){this.remainderData=null,this.config=void 0,this.config=o}var I=D.prototype;return I.resetTimeStamp=function(){},I.resetInitSegment=function(){},I.resetContiguity=function(){},D.probe=function(R){return Object(_.findBox)({data:R,start:0,end:Math.min(R.length,16384)},["moof"]).length>0},I.demux=function(R){var o=R,b=Object(T.dummyTrack)();if(this.config.progressive){this.remainderData&&(o=Object(_.appendUint8Array)(this.remainderData,R));var y=Object(_.segmentValidRange)(o);this.remainderData=y.remainder,b.samples=y.valid||new Uint8Array}else b.samples=o;return{audioTrack:Object(T.dummyTrack)(),avcTrack:b,id3Track:Object(T.dummyTrack)(),textTrack:Object(T.dummyTrack)()}},I.flush=function(){var R=Object(T.dummyTrack)();return R.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(T.dummyTrack)(),avcTrack:R,id3Track:Object(T.dummyTrack)(),textTrack:Object(T.dummyTrack)()}},I.demuxSampleAes=function(R,o,b){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},I.destroy=function(){},D}();S.minProbeByteLength=1024,C.default=S},"./src/demux/mpegaudio.ts":function(F,C,f){f.r(C),f.d(C,"appendFrame",function(){return R}),f.d(C,"parseHeader",function(){return o}),f.d(C,"isHeaderPattern",function(){return b}),f.d(C,"isHeader",function(){return y}),f.d(C,"canParse",function(){return d}),f.d(C,"probe",function(){return p});var _=null,T=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],S=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],D=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],I=[0,1,1,4];function R(m,l,e,i,t){if(!(e+24>l.length)){var n=o(l,e);if(n&&e+n.frameLength<=l.length){var u=i+t*(9e4*n.samplesPerFrame/n.sampleRate),a={unit:l.subarray(e,e+n.frameLength),pts:u,dts:u};return m.config=[],m.channelCount=n.channelCount,m.samplerate=n.sampleRate,m.samples.push(a),{sample:a,length:n.frameLength,missing:0}}}}function o(m,l){var e=m[l+1]>>3&3,i=m[l+1]>>1&3,t=m[l+2]>>4&15,n=m[l+2]>>2&3;if(e!==1&&t!==0&&t!==15&&n!==3){var u=m[l+2]>>1&1,a=m[l+3]>>6,c=1e3*T[14*(e===3?3-i:i===3?3:4)+t-1],E=S[3*(e===3?0:e===2?1:2)+n],g=a===3?1:2,v=D[e][i],r=I[i],s=8*v*r,h=Math.floor(v*c/E+u)*r;if(_===null){var L=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);_=L?parseInt(L[1]):0}return!!_&&_<=87&&i===2&&c>=224e3&&a===0&&(m[l+3]=128|m[l+3]),{sampleRate:E,channelCount:g,frameLength:h,samplesPerFrame:s}}}function b(m,l){return m[l]===255&&(224&m[l+1])==224&&(6&m[l+1])!=0}function y(m,l){return l+1<m.length&&b(m,l)}function d(m,l){return b(m,l)&&4<=m.length-l}function p(m,l){if(l+1<m.length&&b(m,l)){var e=o(m,l),i=4;e!=null&&e.frameLength&&(i=e.frameLength);var t=l+i;return t===m.length||y(m,t)}return!1}},"./src/demux/sample-aes.ts":function(F,C,f){f.r(C);var _=f("./src/crypt/decrypter.ts"),T=f("./src/demux/tsdemuxer.ts"),S=function(){function D(R,o,b){this.keyData=void 0,this.decrypter=void 0,this.keyData=b,this.decrypter=new _.default(R,o,{removePKCS7Padding:!1})}var I=D.prototype;return I.decryptBuffer=function(R,o){this.decrypter.decrypt(R,this.keyData.key.buffer,this.keyData.iv.buffer,o)},I.decryptAacSample=function(R,o,b,y){var d=R[o].unit,p=d.subarray(16,d.length-d.length%16),m=p.buffer.slice(p.byteOffset,p.byteOffset+p.length),l=this;this.decryptBuffer(m,function(e){var i=new Uint8Array(e);d.set(i,16),y||l.decryptAacSamples(R,o+1,b)})},I.decryptAacSamples=function(R,o,b){for(;;o++){if(o>=R.length)return void b();if(!(R[o].unit.length<32)){var y=this.decrypter.isSync();if(this.decryptAacSample(R,o,b,y),!y)return}}},I.getAvcEncryptedData=function(R){for(var o=16*Math.floor((R.length-48)/160)+16,b=new Int8Array(o),y=0,d=32;d<=R.length-16;d+=160,y+=16)b.set(R.subarray(d,d+16),y);return b},I.getAvcDecryptedUnit=function(R,o){for(var b=new Uint8Array(o),y=0,d=32;d<=R.length-16;d+=160,y+=16)R.set(b.subarray(y,y+16),d);return R},I.decryptAvcSample=function(R,o,b,y,d,p){var m=Object(T.discardEPB)(d.data),l=this.getAvcEncryptedData(m),e=this;this.decryptBuffer(l.buffer,function(i){d.data=e.getAvcDecryptedUnit(m,i),p||e.decryptAvcSamples(R,o,b+1,y)})},I.decryptAvcSamples=function(R,o,b,y){if(R instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;o++,b=0){if(o>=R.length)return void y();for(var d=R[o].units;!(b>=d.length);b++){var p=d[b];if(!(p.data.length<=48||p.type!==1&&p.type!==5)){var m=this.decrypter.isSync();if(this.decryptAvcSample(R,o,b,y,p,m),!m)return}}}},D}();C.default=S},"./src/demux/transmuxer-interface.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return y});var _=f("./node_modules/webworkify-webpack/index.js"),T=f("./src/events.ts"),S=f("./src/demux/transmuxer.ts"),D=f("./src/utils/logger.ts"),I=f("./src/errors.ts"),R=f("./src/utils/mediasource-helper.ts"),o=f("./node_modules/eventemitter3/index.js"),b=Object(R.getMediaSource)()||{isTypeSupported:function(){return!1}},y=function(){function d(m,l,e,i){var t=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=m,this.id=l,this.onTransmuxComplete=e,this.onFlush=i;var n=m.config,u=function(g,v){(v=v||{}).frag=t.frag,v.id=t.id,m.trigger(g,v)};this.observer=new o.EventEmitter,this.observer.on(T.Events.FRAG_DECRYPTED,u),this.observer.on(T.Events.ERROR,u);var a={mp4:b.isTypeSupported("video/mp4"),mpeg:b.isTypeSupported("audio/mpeg"),mp3:b.isTypeSupported('audio/mp4; codecs="mp3"')},c=navigator.vendor;if(n.enableWorker&&typeof Worker!="undefined"){var E;D.logger.log("demuxing in webworker");try{E=this.worker=_("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),E.addEventListener("message",this.onwmsg),E.onerror=function(g){m.trigger(T.Events.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(g.message+"  ("+g.filename+":"+g.lineno+")")})},E.postMessage({cmd:"init",typeSupported:a,vendor:c,id:l,config:JSON.stringify(n)})}catch(g){D.logger.warn("Error in worker:",g),D.logger.error("Error while initializing DemuxerWorker, fallback to inline"),E&&self.URL.revokeObjectURL(E.objectURL),this.transmuxer=new S.default(this.observer,a,n,c,l),this.worker=null}}else this.transmuxer=new S.default(this.observer,a,n,c,l)}var p=d.prototype;return p.destroy=function(){var m=this.worker;if(m)m.removeEventListener("message",this.onwmsg),m.terminate(),this.worker=null;else{var l=this.transmuxer;l&&(l.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.observer=null},p.push=function(m,l,e,i,t,n,u,a,c,E){var g=this;c.transmuxing.start=self.performance.now();var v=this.transmuxer,r=this.worker,s=n?n.start:t.start,h=t.decryptdata,L=this.frag,k=!(L&&t.cc===L.cc),A=!(L&&c.level===L.level),O=L?c.sn-L.sn:-1,w=this.part?c.part-this.part.index:1,P=!A&&(O===1||O===0&&w===1),x=self.performance.now();(A||O||t.stats.parsing.start===0)&&(t.stats.parsing.start=x),!n||!w&&P||(n.stats.parsing.start=x);var M=new S.TransmuxState(k,P,a,A,s);if(!P||k){D.logger.log("[transmuxer-interface, "+t.type+"]: Starting new transmux session for sn: "+c.sn+" p: "+c.part+" level: "+c.level+" id: "+c.id+`
        discontinuity: `+k+`
        trackSwitch: `+A+`
        contiguous: `+P+`
        accurateTimeOffset: `+a+`
        timeOffset: `+s);var N=new S.TransmuxConfig(e,i,l,u,E);this.configureTransmuxer(N)}if(this.frag=t,this.part=n,r)r.postMessage({cmd:"demux",data:m,decryptdata:h,chunkMeta:c,state:M},m instanceof ArrayBuffer?[m]:[]);else if(v){var U=v.push(m,h,c,M);Object(S.isPromise)(U)?U.then(function(G){g.handleTransmuxComplete(G)}):this.handleTransmuxComplete(U)}},p.flush=function(m){var l=this;m.transmuxing.start=self.performance.now();var e=this.transmuxer,i=this.worker;if(i)i.postMessage({cmd:"flush",chunkMeta:m});else if(e){var t=e.flush(m);Object(S.isPromise)(t)?t.then(function(n){l.handleFlushResult(n,m)}):this.handleFlushResult(t,m)}},p.handleFlushResult=function(m,l){var e=this;m.forEach(function(i){e.handleTransmuxComplete(i)}),this.onFlush(l)},p.onWorkerMessage=function(m){var l=m.data,e=this.hls;switch(l.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(l.data);break;case"flush":this.onFlush(l.data);break;default:l.data=l.data||{},l.data.frag=this.frag,l.data.id=this.id,e.trigger(l.event,l.data)}},p.configureTransmuxer=function(m){var l=this.worker,e=this.transmuxer;l?l.postMessage({cmd:"configure",config:m}):e&&e.configure(m)},p.handleTransmuxComplete=function(m){m.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(m)},d}()},"./src/demux/transmuxer-worker.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return I});var _=f("./src/demux/transmuxer.ts"),T=f("./src/events.ts"),S=f("./src/utils/logger.ts"),D=f("./node_modules/eventemitter3/index.js");function I(y){var d=new D.EventEmitter,p=function(m,l){y.postMessage({event:m,data:l})};d.on(T.Events.FRAG_DECRYPTED,p),d.on(T.Events.ERROR,p),y.addEventListener("message",function(m){var l=m.data;switch(l.cmd){case"init":var e=JSON.parse(l.config);y.transmuxer=new _.default(d,l.typeSupported,e,l.vendor,l.id),Object(S.enableLogs)(e.debug),p("init",null);break;case"configure":y.transmuxer.configure(l.config);break;case"demux":var i=y.transmuxer.push(l.data,l.decryptdata,l.chunkMeta,l.state);Object(_.isPromise)(i)?i.then(function(u){R(y,u)}):R(y,i);break;case"flush":var t=l.chunkMeta,n=y.transmuxer.flush(t);Object(_.isPromise)(n)?n.then(function(u){b(y,u,t)}):b(y,n,t)}})}function R(y,d){if((p=d.remuxResult).audio||p.video||p.text||p.id3||p.initSegment){var p,m=[],l=d.remuxResult,e=l.audio,i=l.video;e&&o(m,e),i&&o(m,i),y.postMessage({event:"transmuxComplete",data:d},m)}}function o(y,d){d.data1&&y.push(d.data1.buffer),d.data2&&y.push(d.data2.buffer)}function b(y,d,p){d.forEach(function(m){R(y,m)}),y.postMessage({event:"flush",data:p})}},"./src/demux/transmuxer.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return t}),f.d(C,"isPromise",function(){return u}),f.d(C,"TransmuxConfig",function(){return a}),f.d(C,"TransmuxState",function(){return c});var _,T=f("./src/events.ts"),S=f("./src/errors.ts"),D=f("./src/crypt/decrypter.ts"),I=f("./src/demux/aacdemuxer.ts"),R=f("./src/demux/mp4demuxer.ts"),o=f("./src/demux/tsdemuxer.ts"),b=f("./src/demux/mp3demuxer.ts"),y=f("./src/remux/mp4-remuxer.ts"),d=f("./src/remux/passthrough-remuxer.ts"),p=f("./src/demux/chunk-cache.ts"),m=f("./src/utils/mp4-tools.ts"),l=f("./src/utils/logger.ts");try{_=self.performance.now.bind(self.performance)}catch{l.logger.debug("Unable to use Performance API on this environment"),_=self.Date.now}var e=[{demux:o.default,remux:y.default},{demux:R.default,remux:d.default},{demux:I.default,remux:y.default},{demux:b.default,remux:y.default}],i=1024;e.forEach(function(E){var g=E.demux;i=Math.max(i,g.minProbeByteLength)});var t=function(){function E(v,r,s,h,L){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new p.default,this.observer=v,this.typeSupported=r,this.config=s,this.vendor=h,this.id=L}var g=E.prototype;return g.configure=function(v){this.transmuxConfig=v,this.decrypter&&this.decrypter.reset()},g.push=function(v,r,s,h){var L=this,k=s.transmuxing;k.executeStart=_();var A=new Uint8Array(v),O=this.cache,w=this.config,P=this.currentTransmuxState,x=this.transmuxConfig;h&&(this.currentTransmuxState=h);var M=function(ge,fe){var Le=null;return ge.byteLength>0&&fe!=null&&fe.key!=null&&fe.iv!==null&&fe.method!=null&&(Le=fe),Le}(A,r);if(M&&M.method==="AES-128"){var N=this.getDecrypter();if(!w.enableSoftwareAES)return this.decryptionPromise=N.webCryptoDecrypt(A,M.key.buffer,M.iv.buffer).then(function(ge){var fe=L.push(ge,null,s);return L.decryptionPromise=null,fe}),this.decryptionPromise;var U=N.softwareDecrypt(A,M.key.buffer,M.iv.buffer);if(!U)return k.executeEnd=_(),n(s);A=new Uint8Array(U)}var G=h||P,V=G.contiguous,W=G.discontinuity,Y=G.trackSwitch,X=G.accurateTimeOffset,z=G.timeOffset,Z=x.audioCodec,ne=x.videoCodec,oe=x.defaultInitPts,de=x.duration,re=x.initSegmentData;if((W||Y)&&this.resetInitSegment(re,Z,ne,de),W&&this.resetInitialTimestamp(oe),V||this.resetContiguity(),this.needsProbing(A,W,Y)){if(O.dataLength){var pe=O.flush();A=Object(m.appendUint8Array)(pe,A)}this.configureTransmuxer(A,x)}var te=this.transmux(A,M,z,X,s),ae=this.currentTransmuxState;return ae.contiguous=!0,ae.discontinuity=!1,ae.trackSwitch=!1,k.executeEnd=_(),te},g.flush=function(v){var r=this,s=v.transmuxing;s.executeStart=_();var h=this.decrypter,L=this.cache,k=this.currentTransmuxState,A=this.decryptionPromise;if(A)return A.then(function(){return r.flush(v)});var O=[],w=k.timeOffset;if(h){var P=h.flush();P&&O.push(this.push(P,null,v))}var x=L.dataLength;L.reset();var M=this.demuxer,N=this.remuxer;if(!M||!N)return x>=i&&this.observer.emit(T.Events.ERROR,T.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),s.executeEnd=_(),[n(v)];var U=M.flush(w);return u(U)?U.then(function(G){return r.flushRemux(O,G,v),O}):(this.flushRemux(O,U,v),O)},g.flushRemux=function(v,r,s){var h=r.audioTrack,L=r.avcTrack,k=r.id3Track,A=r.textTrack,O=this.currentTransmuxState,w=O.accurateTimeOffset,P=O.timeOffset;l.logger.log("[transmuxer.ts]: Flushed fragment "+s.sn+(s.part>-1?" p: "+s.part:"")+" of level "+s.level);var x=this.remuxer.remux(h,L,k,A,P,w,!0,this.id);v.push({remuxResult:x,chunkMeta:s}),s.transmuxing.executeEnd=_()},g.resetInitialTimestamp=function(v){var r=this.demuxer,s=this.remuxer;r&&s&&(r.resetTimeStamp(v),s.resetTimeStamp(v))},g.resetContiguity=function(){var v=this.demuxer,r=this.remuxer;v&&r&&(v.resetContiguity(),r.resetNextTimestamp())},g.resetInitSegment=function(v,r,s,h){var L=this.demuxer,k=this.remuxer;L&&k&&(L.resetInitSegment(r,s,h),k.resetInitSegment(v,r,s))},g.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},g.transmux=function(v,r,s,h,L){return r&&r.method==="SAMPLE-AES"?this.transmuxSampleAes(v,r,s,h,L):this.transmuxUnencrypted(v,s,h,L)},g.transmuxUnencrypted=function(v,r,s,h){var L=this.demuxer.demux(v,r,!1,!this.config.progressive),k=L.audioTrack,A=L.avcTrack,O=L.id3Track,w=L.textTrack;return{remuxResult:this.remuxer.remux(k,A,O,w,r,s,!1,this.id),chunkMeta:h}},g.transmuxSampleAes=function(v,r,s,h,L){var k=this;return this.demuxer.demuxSampleAes(v,r,s).then(function(A){return{remuxResult:k.remuxer.remux(A.audioTrack,A.avcTrack,A.id3Track,A.textTrack,s,h,!1,k.id),chunkMeta:L}})},g.configureTransmuxer=function(v,r){for(var s,h=this.config,L=this.observer,k=this.typeSupported,A=this.vendor,O=r.audioCodec,w=r.defaultInitPts,P=r.duration,x=r.initSegmentData,M=r.videoCodec,N=0,U=e.length;N<U;N++)if(e[N].demux.probe(v)){s=e[N];break}s||(l.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),s={demux:R.default,remux:d.default});var G=this.demuxer,V=this.remuxer,W=s.remux,Y=s.demux;V&&V instanceof W||(this.remuxer=new W(L,h,k,A)),G&&G instanceof Y||(this.demuxer=new Y(L,h,k),this.probe=Y.probe),this.resetInitSegment(x,O,M,P),this.resetInitialTimestamp(w)},g.needsProbing=function(v,r,s){return!this.demuxer||!this.remuxer||r||s},g.getDecrypter=function(){var v=this.decrypter;return v||(v=this.decrypter=new D.default(this.observer,this.config)),v},E}(),n=function(E){return{remuxResult:{},chunkMeta:E}};function u(E){return"then"in E&&E.then instanceof Function}var a=function(E,g,v,r,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=E,this.videoCodec=g,this.initSegmentData=v,this.duration=r,this.defaultInitPts=s},c=function(E,g,v,r,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=E,this.contiguous=g,this.accurateTimeOffset=v,this.trackSwitch=r,this.timeOffset=s}},"./src/demux/tsdemuxer.ts":function(F,C,f){f.r(C),f.d(C,"discardEPB",function(){return u});var _=f("./src/demux/adts.ts"),T=f("./src/demux/mpegaudio.ts"),S=f("./src/demux/exp-golomb.ts"),D=f("./src/demux/id3.ts"),I=f("./src/demux/sample-aes.ts"),R=f("./src/events.ts"),o=f("./src/utils/mp4-tools.ts"),b=f("./src/utils/logger.ts"),y=f("./src/errors.ts"),d={video:1,audio:2,id3:3,text:4},p=function(){function a(E,g,v){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=E,this.config=g,this.typeSupported=v}a.probe=function(E){var g=a.syncOffset(E);return!(g<0||(g&&b.logger.warn("MPEG2-TS detected but first sync word found @ offset "+g+", junk ahead ?"),0))},a.syncOffset=function(E){for(var g=Math.min(1e3,E.length-564),v=0;v<g;){if(E[v]===71&&E[v+188]===71&&E[v+376]===71)return v;v++}return-1},a.createTrack=function(E,g){return{container:E==="video"||E==="audio"?"video/mp2t":void 0,type:E,id:d[E],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:E==="audio"?g:void 0}};var c=a.prototype;return c.resetInitSegment=function(E,g,v){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=a.createTrack("video",v),this._audioTrack=a.createTrack("audio",v),this._id3Track=a.createTrack("id3",v),this._txtTrack=a.createTrack("text",v),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=E,this.videoCodec=g,this._duration=v},c.resetTimeStamp=function(){},c.resetContiguity=function(){var E=this._audioTrack,g=this._avcTrack,v=this._id3Track;E&&(E.pesData=null),g&&(g.pesData=null),v&&(v.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},c.demux=function(E,g,v,r){var s;v===void 0&&(v=!1),r===void 0&&(r=!1),v||(this.sampleAes=null);var h=this._avcTrack,L=this._audioTrack,k=this._id3Track,A=h.pid,O=h.pesData,w=L.pid,P=k.pid,x=L.pesData,M=k.pesData,N=!1,U=this.pmtParsed,G=this._pmtId,V=E.length;if(this.remainderData&&(V=(E=Object(o.appendUint8Array)(this.remainderData,E)).length,this.remainderData=null),V<188&&!r)return this.remainderData=E,{audioTrack:L,avcTrack:h,id3Track:k,textTrack:this._txtTrack};var W=Math.max(0,a.syncOffset(E));(V-=(V+W)%188)<E.byteLength&&!r&&(this.remainderData=new Uint8Array(E.buffer,V,E.buffer.byteLength-V));for(var Y=W;Y<V;Y+=188)if(E[Y]===71){var X=!!(64&E[Y+1]),z=((31&E[Y+1])<<8)+E[Y+2],Z=void 0;if((48&E[Y+3])>>4>1){if((Z=Y+5+E[Y+4])===Y+188)continue}else Z=Y+4;switch(z){case A:X&&(O&&(s=i(O))&&this.parseAVCPES(s,!1),O={data:[],size:0}),O&&(O.data.push(E.subarray(Z,Y+188)),O.size+=Y+188-Z);break;case w:X&&(x&&(s=i(x))&&(L.isAAC?this.parseAACPES(s):this.parseMPEGPES(s)),x={data:[],size:0}),x&&(x.data.push(E.subarray(Z,Y+188)),x.size+=Y+188-Z);break;case P:X&&(M&&(s=i(M))&&this.parseID3PES(s),M={data:[],size:0}),M&&(M.data.push(E.subarray(Z,Y+188)),M.size+=Y+188-Z);break;case 0:X&&(Z+=E[Z]+1),G=this._pmtId=l(E,Z);break;case G:X&&(Z+=E[Z]+1);var ne=e(E,Z,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,v);(A=ne.avc)>0&&(h.pid=A),(w=ne.audio)>0&&(L.pid=w,L.isAAC=ne.isAAC),(P=ne.id3)>0&&(k.pid=P),N&&!U&&(b.logger.log("reparse from beginning"),N=!1,Y=W-188),U=this.pmtParsed=!0;break;case 17:case 8191:break;default:N=!0}}else this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});h.pesData=O,L.pesData=x,k.pesData=M;var oe={audioTrack:L,avcTrack:h,id3Track:k,textTrack:this._txtTrack};return r&&this.extractRemainingSamples(oe),oe},c.flush=function(){var E,g=this.remainderData;return this.remainderData=null,E=g?this.demux(g,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(E),this.sampleAes?this.decrypt(E,this.sampleAes):E},c.extractRemainingSamples=function(E){var g,v=E.audioTrack,r=E.avcTrack,s=E.id3Track,h=r.pesData,L=v.pesData,k=s.pesData;h&&(g=i(h))?(this.parseAVCPES(g,!0),r.pesData=null):r.pesData=h,L&&(g=i(L))?(v.isAAC?this.parseAACPES(g):this.parseMPEGPES(g),v.pesData=null):(L!=null&&L.size&&b.logger.log("last AAC PES packet truncated,might overlap between fragments"),v.pesData=L),k&&(g=i(k))?(this.parseID3PES(g),s.pesData=null):s.pesData=k},c.demuxSampleAes=function(E,g,v){var r=this.demux(E,v,!0,!this.config.progressive),s=this.sampleAes=new I.default(this.observer,this.config,g);return this.decrypt(r,s)},c.decrypt=function(E,g){return new Promise(function(v){var r=E.audioTrack,s=E.avcTrack;r.samples&&r.isAAC?g.decryptAacSamples(r.samples,0,function(){s.samples?g.decryptAvcSamples(s.samples,0,0,function(){v(E)}):v(E)}):s.samples&&g.decryptAvcSamples(s.samples,0,0,function(){v(E)})})},c.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},c.parseAVCPES=function(E,g){var v,r=this,s=this._avcTrack,h=this.parseAVCNALu(E.data),L=this.avcSample,k=!1;E.data=null,L&&h.length&&!s.audFound&&(t(L,s),L=this.avcSample=m(!1,E.pts,E.dts,"")),h.forEach(function(A){switch(A.type){case 1:v=!0,L||(L=r.avcSample=m(!0,E.pts,E.dts,"")),L.frame=!0;var O=A.data;if(k&&O.length>4){var w=new S.default(O).readSliceType();w!==2&&w!==4&&w!==7&&w!==9||(L.key=!0)}break;case 5:v=!0,L||(L=r.avcSample=m(!0,E.pts,E.dts,"")),L.key=!0,L.frame=!0;break;case 6:v=!0;var P=new S.default(u(A.data));P.readUByte();for(var x=0,M=0,N=!1,U=0;!N&&P.bytesAvailable>1;){x=0;do x+=U=P.readUByte();while(U===255);M=0;do M+=U=P.readUByte();while(U===255);if(x===4&&P.bytesAvailable!==0){if(N=!0,P.readUByte()===181&&P.readUShort()===49&&P.readUInt()===1195456820&&P.readUByte()===3){for(var G=P.readUByte(),V=31&G,W=[G,P.readUByte()],Y=0;Y<V;Y++)W.push(P.readUByte()),W.push(P.readUByte()),W.push(P.readUByte());n(r._txtTrack.samples,{type:3,pts:E.pts,bytes:W})}}else if(x===5&&P.bytesAvailable!==0){if(N=!0,M>16){for(var X=[],z=0;z<16;z++)X.push(P.readUByte().toString(16)),z!==3&&z!==5&&z!==7&&z!==9||X.push("-");for(var Z=M-16,ne=new Uint8Array(Z),oe=0;oe<Z;oe++)ne[oe]=P.readUByte();n(r._txtTrack.samples,{pts:E.pts,payloadType:x,uuid:X.join(""),userData:Object(D.utf8ArrayToStr)(ne),userDataBytes:ne})}}else if(M<P.bytesAvailable)for(var de=0;de<M;de++)P.readUByte()}break;case 7:if(v=!0,k=!0,!s.sps){var re=new S.default(A.data).readSPS();s.width=re.width,s.height=re.height,s.pixelRatio=re.pixelRatio,s.sps=[A.data],s.duration=r._duration;for(var pe=A.data.subarray(1,4),te="avc1.",ae=0;ae<3;ae++){var ge=pe[ae].toString(16);ge.length<2&&(ge="0"+ge),te+=ge}s.codec=te}break;case 8:v=!0,s.pps||(s.pps=[A.data]);break;case 9:v=!1,s.audFound=!0,L&&t(L,s),L=r.avcSample=m(!1,E.pts,E.dts,"");break;case 12:v=!1;break;default:v=!1,L&&(L.debug+="unknown NAL "+A.type+" ")}L&&v&&L.units.push(A)}),g&&L&&(t(L,s),this.avcSample=null)},c.getLastNalUnit=function(){var E,g,v=this.avcSample;if(!v||v.units.length===0){var r=this._avcTrack.samples;v=r[r.length-1]}if((E=v)!==null&&E!==void 0&&E.units){var s=v.units;g=s[s.length-1]}return g},c.parseAVCNALu=function(E){var g,v,r=E.byteLength,s=this._avcTrack,h=s.naluState||0,L=h,k=[],A=0,O=-1,w=0;for(h===-1&&(O=0,w=31&E[0],h=0,A=1);A<r;)if(g=E[A++],h)if(h!==1)if(g)if(g===1){if(O>=0){var P={data:E.subarray(O,A-h-1),type:w};k.push(P)}else{var x=this.getLastNalUnit();if(x&&(L&&A<=4-L&&x.state&&(x.data=x.data.subarray(0,x.data.byteLength-L)),(v=A-h-1)>0)){var M=new Uint8Array(x.data.byteLength+v);M.set(x.data,0),M.set(E.subarray(0,v),x.data.byteLength),x.data=M}}A<r?(O=A,w=31&E[A],h=0):h=-1}else h=0;else h=3;else h=g?0:2;else h=g?0:1;if(O>=0&&h>=0){var N={data:E.subarray(O,r),type:w,state:h};k.push(N)}if(k.length===0){var U=this.getLastNalUnit();if(U){var G=new Uint8Array(U.data.byteLength+E.byteLength);G.set(U.data,0),G.set(E,U.data.byteLength),U.data=G}}return s.naluState=h,k},c.parseAACPES=function(E){var g,v,r,s,h,L=0,k=this._audioTrack,A=this.aacOverFlow,O=E.data;if(A){this.aacOverFlow=null;var w=A.sample.unit.byteLength,P=Math.min(A.missing,w),x=w-P;A.sample.unit.set(O.subarray(0,P),x),k.samples.push(A.sample),L=A.missing}for(g=L,v=O.length;g<v-1&&!_.isHeader(O,g);g++);if(g===L||(g<v-1?(r="AAC PES did not start with ADTS header,offset:"+g,s=!1):(r="no ADTS header found in AAC PES",s=!0),b.logger.warn("parsing error:"+r),this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:s,reason:r}),!s)){if(_.initTrackConfig(k,this.observer,O,g,this.audioCodec),E.pts!==void 0)h=E.pts;else{if(!A)return void b.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var M=_.getFrameDuration(k.samplerate);h=A.sample.pts+M}for(var N=0;g<v;){if(_.isHeader(O,g)){if(g+5<v){var U=_.appendFrame(k,O,g,h,N);if(U){if(!U.missing){g+=U.length,N++;continue}this.aacOverFlow=U}}break}g++}}},c.parseMPEGPES=function(E){var g=E.data,v=g.length,r=0,s=0,h=E.pts;if(h!==void 0)for(;s<v;)if(T.isHeader(g,s)){var L=T.appendFrame(this._audioTrack,g,s,h,r);if(!L)break;s+=L.length,r++}else s++;else b.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},c.parseID3PES=function(E){E.pts!==void 0?this._id3Track.samples.push(E):b.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},a}();function m(a,c,E,g){return{key:a,frame:!1,pts:c,dts:E,units:[],debug:g,length:0}}function l(a,c){return(31&a[c+10])<<8|a[c+11]}function e(a,c,E,g){var v={audio:-1,avc:-1,id3:-1,isAAC:!0},r=c+3+((15&a[c+1])<<8|a[c+2])-4;for(c+=12+((15&a[c+10])<<8|a[c+11]);c<r;){var s=(31&a[c+1])<<8|a[c+2];switch(a[c]){case 207:if(!g){b.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:v.audio===-1&&(v.audio=s);break;case 21:v.id3===-1&&(v.id3=s);break;case 219:if(!g){b.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:v.avc===-1&&(v.avc=s);break;case 3:case 4:E?v.audio===-1&&(v.audio=s,v.isAAC=!1):b.logger.log("MPEG audio found, not supported in this browser");break;case 36:b.logger.warn("Unsupported HEVC stream type found")}c+=5+((15&a[c+3])<<8|a[c+4])}return v}function i(a){var c,E,g,v,r,s=0,h=a.data;if(!a||a.size===0)return null;for(;h[0].length<19&&h.length>1;){var L=new Uint8Array(h[0].length+h[1].length);L.set(h[0]),L.set(h[1],h[0].length),h[0]=L,h.splice(1,1)}if(((c=h[0])[0]<<16)+(c[1]<<8)+c[2]===1){if((E=(c[4]<<8)+c[5])&&E>a.size-6)return null;var k=c[7];192&k&&(v=536870912*(14&c[9])+4194304*(255&c[10])+16384*(254&c[11])+128*(255&c[12])+(254&c[13])/2,64&k?v-(r=536870912*(14&c[14])+4194304*(255&c[15])+16384*(254&c[16])+128*(255&c[17])+(254&c[18])/2)>54e5&&(b.logger.warn(Math.round((v-r)/9e4)+"s delta between PTS and DTS, align them"),v=r):r=v);var A=(g=c[8])+9;if(a.size<=A)return null;a.size-=A;for(var O=new Uint8Array(a.size),w=0,P=h.length;w<P;w++){var x=(c=h[w]).byteLength;if(A){if(A>x){A-=x;continue}c=c.subarray(A),x-=A,A=0}O.set(c,s),s+=x}return E&&(E-=g+3),{data:O,pts:v,dts:r,len:E}}return null}function t(a,c){if(a.units.length&&a.frame){if(a.pts===void 0){var E=c.samples,g=E.length;if(!g)return void c.dropped++;var v=E[g-1];a.pts=v.pts,a.dts=v.dts}c.samples.push(a)}a.debug.length&&b.logger.log(a.pts+"/"+a.dts+":"+a.debug)}function n(a,c){var E=a.length;if(E>0){if(c.pts>=a[E-1].pts)a.push(c);else for(var g=E-1;g>=0;g--)if(c.pts<a[g].pts){a.splice(g,0,c);break}}else a.push(c)}function u(a){for(var c=a.byteLength,E=[],g=1;g<c-2;)a[g]===0&&a[g+1]===0&&a[g+2]===3?(E.push(g+2),g+=2):g++;if(E.length===0)return a;var v=c-E.length,r=new Uint8Array(v),s=0;for(g=0;g<v;s++,g++)s===E[0]&&(s++,E.shift()),r[g]=a[s];return r}p.minProbeByteLength=188,C.default=p},"./src/errors.ts":function(F,C,f){var _,T,S,D;f.r(C),f.d(C,"ErrorTypes",function(){return _}),f.d(C,"ErrorDetails",function(){return S}),(T=_||(_={})).NETWORK_ERROR="networkError",T.MEDIA_ERROR="mediaError",T.KEY_SYSTEM_ERROR="keySystemError",T.MUX_ERROR="muxError",T.OTHER_ERROR="otherError",(D=S||(S={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",D.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",D.KEY_SYSTEM_NO_SESSION="keySystemNoSession",D.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",D.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",D.MANIFEST_LOAD_ERROR="manifestLoadError",D.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",D.MANIFEST_PARSING_ERROR="manifestParsingError",D.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",D.LEVEL_EMPTY_ERROR="levelEmptyError",D.LEVEL_LOAD_ERROR="levelLoadError",D.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",D.LEVEL_SWITCH_ERROR="levelSwitchError",D.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",D.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",D.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",D.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",D.FRAG_LOAD_ERROR="fragLoadError",D.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",D.FRAG_DECRYPT_ERROR="fragDecryptError",D.FRAG_PARSING_ERROR="fragParsingError",D.REMUX_ALLOC_ERROR="remuxAllocError",D.KEY_LOAD_ERROR="keyLoadError",D.KEY_LOAD_TIMEOUT="keyLoadTimeOut",D.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",D.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",D.BUFFER_APPEND_ERROR="bufferAppendError",D.BUFFER_APPENDING_ERROR="bufferAppendingError",D.BUFFER_STALLED_ERROR="bufferStalledError",D.BUFFER_FULL_ERROR="bufferFullError",D.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",D.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",D.INTERNAL_EXCEPTION="internalException",D.INTERNAL_ABORTED="aborted",D.UNKNOWN="unknown"},"./src/events.ts":function(F,C,f){var _,T;f.r(C),f.d(C,"Events",function(){return _}),(T=_||(_={})).MEDIA_ATTACHING="hlsMediaAttaching",T.MEDIA_ATTACHED="hlsMediaAttached",T.MEDIA_DETACHING="hlsMediaDetaching",T.MEDIA_DETACHED="hlsMediaDetached",T.BUFFER_RESET="hlsBufferReset",T.BUFFER_CODECS="hlsBufferCodecs",T.BUFFER_CREATED="hlsBufferCreated",T.BUFFER_APPENDING="hlsBufferAppending",T.BUFFER_APPENDED="hlsBufferAppended",T.BUFFER_EOS="hlsBufferEos",T.BUFFER_FLUSHING="hlsBufferFlushing",T.BUFFER_FLUSHED="hlsBufferFlushed",T.MANIFEST_LOADING="hlsManifestLoading",T.MANIFEST_LOADED="hlsManifestLoaded",T.MANIFEST_PARSED="hlsManifestParsed",T.LEVEL_SWITCHING="hlsLevelSwitching",T.LEVEL_SWITCHED="hlsLevelSwitched",T.LEVEL_LOADING="hlsLevelLoading",T.LEVEL_LOADED="hlsLevelLoaded",T.LEVEL_UPDATED="hlsLevelUpdated",T.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",T.LEVELS_UPDATED="hlsLevelsUpdated",T.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",T.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",T.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",T.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",T.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",T.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",T.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",T.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",T.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",T.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",T.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",T.CUES_PARSED="hlsCuesParsed",T.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",T.INIT_PTS_FOUND="hlsInitPtsFound",T.FRAG_LOADING="hlsFragLoading",T.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",T.FRAG_LOADED="hlsFragLoaded",T.FRAG_DECRYPTED="hlsFragDecrypted",T.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",T.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",T.FRAG_PARSING_METADATA="hlsFragParsingMetadata",T.FRAG_PARSED="hlsFragParsed",T.FRAG_BUFFERED="hlsFragBuffered",T.FRAG_CHANGED="hlsFragChanged",T.FPS_DROP="hlsFpsDrop",T.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",T.ERROR="hlsError",T.DESTROYING="hlsDestroying",T.KEY_LOADING="hlsKeyLoading",T.KEY_LOADED="hlsKeyLoaded",T.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",T.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return t});var _=f("./node_modules/url-toolkit/src/url-toolkit.js"),T=f("./src/loader/playlist-loader.ts"),S=f("./src/loader/key-loader.ts"),D=f("./src/controller/id3-track-controller.ts"),I=f("./src/controller/latency-controller.ts"),R=f("./src/controller/level-controller.ts"),o=f("./src/controller/fragment-tracker.ts"),b=f("./src/controller/stream-controller.ts"),y=f("./src/is-supported.ts"),d=f("./src/utils/logger.ts"),p=f("./src/config.ts"),m=f("./node_modules/eventemitter3/index.js"),l=f("./src/events.ts"),e=f("./src/errors.ts");function i(n,u){for(var a=0;a<u.length;a++){var c=u[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(n,c.key,c)}}var t=function(){function n(g){g===void 0&&(g={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new m.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var v=this.config=Object(p.mergeConfig)(n.DefaultConfig,g);this.userConfig=g,Object(d.enableLogs)(v.debug),this._autoLevelCapping=-1,v.progressive&&Object(p.enableStreamingMode)(v);var r=v.abrController,s=v.bufferController,h=v.capLevelController,L=v.fpsController,k=this.abrController=new r(this),A=this.bufferController=new s(this),O=this.capLevelController=new h(this),w=new L(this),P=new T.default(this),x=new S.default(this),M=new D.default(this),N=this.levelController=new R.default(this),U=new o.FragmentTracker(this),G=this.streamController=new b.default(this,U);O.setStreamController(G),w.setStreamController(G);var V=[N,G];this.networkControllers=V;var W=[P,x,k,A,O,w,M,U];this.audioTrackController=this.createController(v.audioTrackController,null,V),this.createController(v.audioStreamController,U,V),this.subtitleTrackController=this.createController(v.subtitleTrackController,null,V),this.createController(v.subtitleStreamController,U,V),this.createController(v.timelineController,null,W),this.emeController=this.createController(v.emeController,null,W),this.latencyController=this.createController(I.default,null,W),this.coreComponents=W}n.isSupported=function(){return Object(y.isSupported)()};var u,a,c,E=n.prototype;return E.createController=function(g,v,r){if(g){var s=v?new g(this,v):new g(this);return r&&r.push(s),s}return null},E.on=function(g,v,r){r===void 0&&(r=this),this._emitter.on(g,v,r)},E.once=function(g,v,r){r===void 0&&(r=this),this._emitter.once(g,v,r)},E.removeAllListeners=function(g){this._emitter.removeAllListeners(g)},E.off=function(g,v,r,s){r===void 0&&(r=this),this._emitter.off(g,v,r,s)},E.listeners=function(g){return this._emitter.listeners(g)},E.emit=function(g,v,r){return this._emitter.emit(g,v,r)},E.trigger=function(g,v){if(this.config.debug)return this.emit(g,g,v);try{return this.emit(g,g,v)}catch(r){d.logger.error("An internal error happened while handling event "+g+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(l.Events.ERROR,{type:e.ErrorTypes.OTHER_ERROR,details:e.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:g,error:r})}return!1},E.listenerCount=function(g){return this._emitter.listenerCount(g)},E.destroy=function(){d.logger.log("destroy"),this.trigger(l.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(g){return g.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(g){return g.destroy()}),this.coreComponents.length=0},E.attachMedia=function(g){d.logger.log("attachMedia"),this._media=g,this.trigger(l.Events.MEDIA_ATTACHING,{media:g})},E.detachMedia=function(){d.logger.log("detachMedia"),this.trigger(l.Events.MEDIA_DETACHING,void 0),this._media=null},E.loadSource=function(g){this.stopLoad();var v=this.media,r=this.url,s=this.url=_.buildAbsoluteURL(self.location.href,g,{alwaysNormalize:!0});d.logger.log("loadSource:"+s),v&&r&&r!==s&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(v)),this.trigger(l.Events.MANIFEST_LOADING,{url:g})},E.startLoad=function(g){g===void 0&&(g=-1),d.logger.log("startLoad("+g+")"),this.networkControllers.forEach(function(v){v.startLoad(g)})},E.stopLoad=function(){d.logger.log("stopLoad"),this.networkControllers.forEach(function(g){g.stopLoad()})},E.swapAudioCodec=function(){d.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},E.recoverMediaError=function(){d.logger.log("recoverMediaError");var g=this._media;this.detachMedia(),g&&this.attachMedia(g)},E.removeLevel=function(g,v){v===void 0&&(v=0),this.levelController.removeLevel(g,v)},u=n,c=[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return l.Events}},{key:"ErrorTypes",get:function(){return e.ErrorTypes}},{key:"ErrorDetails",get:function(){return e.ErrorDetails}},{key:"DefaultConfig",get:function(){return n.defaultConfig?n.defaultConfig:p.hlsDefaultConfig},set:function(g){n.defaultConfig=g}}],(a=[{key:"levels",get:function(){var g=this.levelController.levels;return g||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(g){d.logger.log("set currentLevel:"+g),this.loadLevel=g,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(g){d.logger.log("set nextLevel:"+g),this.levelController.manualLevel=g,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(g){d.logger.log("set loadLevel:"+g),this.levelController.manualLevel=g}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(g){this.levelController.nextLoadLevel=g}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(g){d.logger.log("set firstLevel:"+g),this.levelController.firstLevel=g}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(g){d.logger.log("set startLevel:"+g),g!==-1&&(g=Math.max(g,this.minAutoLevel)),this.levelController.startLevel=g}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(g){var v=!!g;v!==this.config.capLevelToPlayerSize&&(v?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=v)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(g){this._autoLevelCapping!==g&&(d.logger.log("set autoLevelCapping:"+g),this._autoLevelCapping=g)}},{key:"bandwidthEstimate",get:function(){var g=this.abrController.bwEstimator;return g?g.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var g=this.levels,v=this.config.minAutoBitrate;if(!g)return 0;for(var r=g.length,s=0;s<r;s++)if(g[s].maxBitrate>v)return s;return 0}},{key:"maxAutoLevel",get:function(){var g=this.levels,v=this.autoLevelCapping;return v===-1&&g&&g.length?g.length-1:v}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(g){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,g)}},{key:"audioTracks",get:function(){var g=this.audioTrackController;return g?g.audioTracks:[]}},{key:"audioTrack",get:function(){var g=this.audioTrackController;return g?g.audioTrack:-1},set:function(g){var v=this.audioTrackController;v&&(v.audioTrack=g)}},{key:"subtitleTracks",get:function(){var g=this.subtitleTrackController;return g?g.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var g=this.subtitleTrackController;return g?g.subtitleTrack:-1},set:function(g){var v=this.subtitleTrackController;v&&(v.subtitleTrack=g)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var g=this.subtitleTrackController;return!!g&&g.subtitleDisplay},set:function(g){var v=this.subtitleTrackController;v&&(v.subtitleDisplay=g)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(g){this.config.lowLatencyMode=g}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&i(u.prototype,a),c&&i(u,c),n}();t.defaultConfig=void 0},"./src/is-supported.ts":function(F,C,f){f.r(C),f.d(C,"isSupported",function(){return S}),f.d(C,"changeTypeSupported",function(){return D});var _=f("./src/utils/mediasource-helper.ts");function T(){return self.SourceBuffer||self.WebKitSourceBuffer}function S(){var I=Object(_.getMediaSource)();if(!I)return!1;var R=T(),o=I&&typeof I.isTypeSupported=="function"&&I.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),b=!R||R.prototype&&typeof R.prototype.appendBuffer=="function"&&typeof R.prototype.remove=="function";return!!o&&!!b}function D(){var I,R=T();return typeof(R==null||(I=R.prototype)===null||I===void 0?void 0:I.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return y}),f.d(C,"LoadError",function(){return p});var _=f("./src/polyfills/number.ts"),T=f("./src/errors.ts");function S(m){var l=typeof Map=="function"?new Map:void 0;return(S=function(e){if(e===null||(i=e,Function.toString.call(i).indexOf("[native code]")===-1))return e;var i;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(l!==void 0){if(l.has(e))return l.get(e);l.set(e,t)}function t(){return D(e,arguments,o(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),R(t,e)})(m)}function D(m,l,e){return(D=I()?Reflect.construct:function(i,t,n){var u=[null];u.push.apply(u,t);var a=new(Function.bind.apply(i,u));return n&&R(a,n.prototype),a}).apply(null,arguments)}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function R(m,l){return(R=Object.setPrototypeOf||function(e,i){return e.__proto__=i,e})(m,l)}function o(m){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(l){return l.__proto__||Object.getPrototypeOf(l)})(m)}var b=Math.pow(2,17),y=function(){function m(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var l=m.prototype;return l.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},l.abort=function(){this.loader&&this.loader.abort()},l.load=function(e,i){var t=this,n=e.url;if(!n)return Promise.reject(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var u=this.config,a=u.fLoader,c=u.loader;return new Promise(function(E,g){t.loader&&t.loader.destroy();var v=t.loader=e.loader=a?new a(u):new c(u),r=d(e),s={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:b};e.stats=v.stats,v.load(r,s,{onSuccess:function(h,L,k,A){t.resetLoader(e,v),E({frag:e,part:null,payload:h.data,networkDetails:A})},onError:function(h,L,k){t.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:h,networkDetails:k}))},onAbort:function(h,L,k){t.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:k}))},onTimeout:function(h,L,k){t.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:k}))},onProgress:function(h,L,k,A){i&&i({frag:e,part:null,payload:k,networkDetails:A})}})})},l.loadPart=function(e,i,t){var n=this;this.abort();var u=this.config,a=u.fLoader,c=u.loader;return new Promise(function(E,g){n.loader&&n.loader.destroy();var v=n.loader=e.loader=a?new a(u):new c(u),r=d(e,i),s={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:b};i.stats=v.stats,v.load(r,s,{onSuccess:function(h,L,k,A){n.resetLoader(e,v),n.updateStatsFromPart(e,i);var O={frag:e,part:i,payload:h.data,networkDetails:A};t(O),E(O)},onError:function(h,L,k){n.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:i,response:h,networkDetails:k}))},onAbort:function(h,L,k){e.stats.aborted=i.stats.aborted,n.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:i,networkDetails:k}))},onTimeout:function(h,L,k){n.resetLoader(e,v),g(new p({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:i,networkDetails:k}))}})})},l.updateStatsFromPart=function(e,i){var t=e.stats,n=i.stats,u=n.total;if(t.loaded+=n.loaded,u){var a=Math.round(e.duration/i.duration),c=Math.min(Math.round(t.loaded/u),a),E=(a-c)*Math.round(t.loaded/c);t.total=t.loaded+E}else t.total=Math.max(t.loaded,t.total);var g=t.loading,v=n.loading;g.start?g.first+=v.first-v.start:(g.start=v.start,g.first=v.first),g.end=v.end},l.resetLoader=function(e,i){e.loader=null,this.loader===i&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),i.destroy()},m}();function d(m,l){l===void 0&&(l=null);var e=l||m,i={frag:m,part:l,responseType:"arraybuffer",url:e.url,rangeStart:0,rangeEnd:0},t=e.byteRangeStartOffset,n=e.byteRangeEndOffset;return Object(_.isFiniteNumber)(t)&&Object(_.isFiniteNumber)(n)&&(i.rangeStart=t,i.rangeEnd=n),i}var p=function(m){var l,e;function i(t){for(var n,u=arguments.length,a=new Array(u>1?u-1:0),c=1;c<u;c++)a[c-1]=arguments[c];return(n=m.call.apply(m,[this].concat(a))||this).data=void 0,n.data=t,n}return e=m,(l=i).prototype=Object.create(e.prototype),l.prototype.constructor=l,R(l,e),i}(S(Error))},"./src/loader/fragment.ts":function(F,C,f){f.r(C),f.d(C,"ElementaryStreamTypes",function(){return _}),f.d(C,"BaseSegment",function(){return m}),f.d(C,"Fragment",function(){return l}),f.d(C,"Part",function(){return e});var _,T,S=f("./src/polyfills/number.ts"),D=f("./node_modules/url-toolkit/src/url-toolkit.js"),I=f("./src/utils/logger.ts"),R=f("./src/loader/level-key.ts"),o=f("./src/loader/load-stats.ts");function b(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i,y(i,t)}function y(i,t){return(y=Object.setPrototypeOf||function(n,u){return n.__proto__=u,n})(i,t)}function d(i,t){for(var n=0;n<t.length;n++){var u=t[n];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}function p(i,t,n){return t&&d(i.prototype,t),n&&d(i,n),i}(T=_||(_={})).AUDIO="audio",T.VIDEO="video",T.AUDIOVIDEO="audiovideo";var m=function(){function i(t){var n;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((n={})[_.AUDIO]=null,n[_.VIDEO]=null,n[_.AUDIOVIDEO]=null,n),this.baseurl=t}return i.prototype.setByteRange=function(t,n){var u=t.split("@",2),a=[];u.length===1?a[0]=n?n.byteRangeEndOffset:0:a[0]=parseInt(u[1]),a[1]=parseInt(u[0])+a[0],this._byteRange=a},p(i,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(D.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),i}(),l=function(i){function t(u,a){var c;return(c=i.call(this,a)||this)._decryptdata=null,c.rawProgramDateTime=null,c.programDateTime=null,c.tagList=[],c.duration=0,c.sn=0,c.levelkey=void 0,c.type=void 0,c.loader=null,c.level=-1,c.cc=0,c.startPTS=void 0,c.endPTS=void 0,c.appendedPTS=void 0,c.startDTS=void 0,c.endDTS=void 0,c.start=0,c.deltaPTS=void 0,c.maxStartPTS=void 0,c.minEndPTS=void 0,c.stats=new o.LoadStats,c.urlId=0,c.data=void 0,c.bitrateTest=!1,c.title=null,c.initSegment=null,c.type=u,c}b(t,i);var n=t.prototype;return n.createInitializationVector=function(u){for(var a=new Uint8Array(16),c=12;c<16;c++)a[c]=u>>8*(15-c)&255;return a},n.setDecryptDataFromLevelKey=function(u,a){var c=u;return(u==null?void 0:u.method)==="AES-128"&&u.uri&&!u.iv&&((c=R.LevelKey.fromURI(u.uri)).method=u.method,c.iv=this.createInitializationVector(a),c.keyFormat="identity"),c},n.setElementaryStreamInfo=function(u,a,c,E,g,v){v===void 0&&(v=!1);var r=this.elementaryStreams,s=r[u];s?(s.startPTS=Math.min(s.startPTS,a),s.endPTS=Math.max(s.endPTS,c),s.startDTS=Math.min(s.startDTS,E),s.endDTS=Math.max(s.endDTS,g)):r[u]={startPTS:a,endPTS:c,startDTS:E,endDTS:g,partial:v}},n.clearElementaryStreamInfo=function(){var u=this.elementaryStreams;u[_.AUDIO]=null,u[_.VIDEO]=null,u[_.AUDIOVIDEO]=null},p(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var u=this.sn;typeof u!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&I.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),u=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,u)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(S.isFiniteNumber)(this.programDateTime))return null;var u=Object(S.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*u}},{key:"encrypted",get:function(){var u;return!((u=this.decryptdata)===null||u===void 0||!u.keyFormat||!this.decryptdata.uri)}}]),t}(m),e=function(i){function t(n,u,a,c,E){var g;(g=i.call(this,a)||this).fragOffset=0,g.duration=0,g.gap=!1,g.independent=!1,g.relurl=void 0,g.fragment=void 0,g.index=void 0,g.stats=new o.LoadStats,g.duration=n.decimalFloatingPoint("DURATION"),g.gap=n.bool("GAP"),g.independent=n.bool("INDEPENDENT"),g.relurl=n.enumeratedString("URI"),g.fragment=u,g.index=c;var v=n.enumeratedString("BYTERANGE");return v&&g.setByteRange(v,E),E&&(g.fragOffset=E.fragOffset+E.duration),g}return b(t,i),p(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var n=this.elementaryStreams;return!!(n.audio||n.video||n.audiovideo)}}]),t}(m)},"./src/loader/key-loader.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return D});var _=f("./src/events.ts"),T=f("./src/errors.ts"),S=f("./src/utils/logger.ts"),D=function(){function I(o){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=o,this._registerListeners()}var R=I.prototype;return R._registerListeners=function(){this.hls.on(_.Events.KEY_LOADING,this.onKeyLoading,this)},R._unregisterListeners=function(){this.hls.off(_.Events.KEY_LOADING,this.onKeyLoading)},R.destroy=function(){for(var o in this._unregisterListeners(),this.loaders){var b=this.loaders[o];b&&b.destroy()}this.loaders={}},R.onKeyLoading=function(o,b){var y=b.frag,d=y.type,p=this.loaders[d];if(y.decryptdata){var m=y.decryptdata.uri;if(m!==this.decrypturl||this.decryptkey===null){var l=this.hls.config;if(p&&(S.logger.warn("abort previous key loader for type:"+d),p.abort()),!m)return void S.logger.warn("key uri is falsy");var e=l.loader,i=y.loader=this.loaders[d]=new e(l);this.decrypturl=m,this.decryptkey=null;var t={url:m,frag:y,responseType:"arraybuffer"},n={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:0},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};i.load(t,n,u)}else this.decryptkey&&(y.decryptdata.key=this.decryptkey,this.hls.trigger(_.Events.KEY_LOADED,{frag:y}))}else S.logger.warn("Missing decryption data on fragment in onKeyLoading")},R.loadsuccess=function(o,b,y){var d=y.frag;d.decryptdata?(this.decryptkey=d.decryptdata.key=new Uint8Array(o.data),d.loader=null,delete this.loaders[d.type],this.hls.trigger(_.Events.KEY_LOADED,{frag:d})):S.logger.error("after key load, decryptdata unset")},R.loaderror=function(o,b){var y=b.frag,d=y.loader;d&&d.abort(),delete this.loaders[y.type],this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:y,response:o})},R.loadtimeout=function(o,b){var y=b.frag,d=y.loader;d&&d.abort(),delete this.loaders[y.type],this.hls.trigger(_.Events.ERROR,{type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:y})},I}()},"./src/loader/level-details.ts":function(F,C,f){f.r(C),f.d(C,"LevelDetails",function(){return S});var _=f("./src/polyfills/number.ts");function T(D,I){for(var R=0;R<I.length;R++){var o=I[R];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(D,o.key,o)}}var S=function(){function D(o){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=o}var I,R;return D.prototype.reloaded=function(o){if(!o)return this.advanced=!0,void(this.updated=!0);var b=this.lastPartSn-o.lastPartSn,y=this.lastPartIndex-o.lastPartIndex;this.updated=this.endSN!==o.endSN||!!y||!!b,this.advanced=this.endSN>o.endSN||b>0||b===0&&y>0,this.updated||this.advanced?this.misses=Math.floor(.6*o.misses):this.misses=o.misses+1,this.availabilityDelay=o.availabilityDelay},I=D,(R=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(_.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var o=this.driftEndTime-this.driftStartTime;return o>0?1e3*(this.driftEnd-this.driftStart)/o:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var o;return(o=this.fragments)!==null&&o!==void 0&&o.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&T(I.prototype,R),D}()},"./src/loader/level-key.ts":function(F,C,f){f.r(C),f.d(C,"LevelKey",function(){return S});var _=f("./node_modules/url-toolkit/src/url-toolkit.js");function T(D,I){for(var R=0;R<I.length;R++){var o=I[R];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(D,o.key,o)}}var S=function(){function D(o,b){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=b?Object(_.buildAbsoluteURL)(o,b,{alwaysNormalize:!0}):o}var I,R;return D.fromURL=function(o,b){return new D(o,b)},D.fromURI=function(o){return new D(o)},I=D,(R=[{key:"uri",get:function(){return this._uri}}])&&T(I.prototype,R),D}()},"./src/loader/load-stats.ts":function(F,C,f){f.r(C),f.d(C,"LoadStats",function(){return _});var _=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return e});var _=f("./src/polyfills/number.ts"),T=f("./node_modules/url-toolkit/src/url-toolkit.js"),S=f("./src/loader/fragment.ts"),D=f("./src/loader/level-details.ts"),I=f("./src/loader/level-key.ts"),R=f("./src/utils/attr-list.ts"),o=f("./src/utils/logger.ts"),b=f("./src/utils/codecs.ts"),y=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,d=/#EXT-X-MEDIA:(.*)/g,p=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),m=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),l=/\.(mp4|m4s|m4v|m4a)$/i,e=function(){function u(){}return u.findGroup=function(a,c){for(var E=0;E<a.length;E++){var g=a[E];if(g.id===c)return g}},u.convertAVC1ToAVCOTI=function(a){var c=a.split(".");if(c.length>2){var E=c.shift()+".";return E+=parseInt(c.shift()).toString(16),E+=("000"+parseInt(c.shift()).toString(16)).substr(-4)}return a},u.resolve=function(a,c){return T.buildAbsoluteURL(c,a,{alwaysNormalize:!0})},u.parseMasterPlaylist=function(a,c){var E,g=[],v={},r=!1;for(y.lastIndex=0;(E=y.exec(a))!=null;)if(E[1]){var s=new R.AttrList(E[1]),h={attrs:s,bitrate:s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),name:s.NAME,url:u.resolve(E[2],c)},L=s.decimalResolution("RESOLUTION");L&&(h.width=L.width,h.height=L.height),i((s.CODECS||"").split(/[ ,]+/).filter(function(A){return A}),h),h.videoCodec&&h.videoCodec.indexOf("avc1")!==-1&&(h.videoCodec=u.convertAVC1ToAVCOTI(h.videoCodec)),g.push(h)}else if(E[3]){var k=new R.AttrList(E[3]);k["DATA-ID"]&&(r=!0,v[k["DATA-ID"]]=k)}return{levels:g,sessionData:r?v:null}},u.parseMasterPlaylistMedia=function(a,c,E,g){var v;g===void 0&&(g=[]);var r=[],s=0;for(d.lastIndex=0;(v=d.exec(a))!==null;){var h=new R.AttrList(v[1]);if(h.TYPE===E){var L={attrs:h,bitrate:0,id:s++,groupId:h["GROUP-ID"],instreamId:h["INSTREAM-ID"],name:h.NAME||h.LANGUAGE||"",type:E,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:h.LANGUAGE,url:h.URI?u.resolve(h.URI,c):""};if(g.length){var k=u.findGroup(g,L.groupId)||g[0];t(L,k,"audioCodec"),t(L,k,"textCodec")}r.push(L)}}return r},u.parseLevelPlaylist=function(a,c,E,g,v){var r,s,h,L=new D.LevelDetails(c),k=L.fragments,A=null,O=0,w=0,P=0,x=0,M=null,N=new S.Fragment(g,c),U=-1,G=!1;for(p.lastIndex=0,L.m3u8=a;(r=p.exec(a))!==null;){G&&(G=!1,(N=new S.Fragment(g,c)).start=P,N.sn=O,N.cc=x,N.level=E,A&&(N.initSegment=A,N.rawProgramDateTime=A.rawProgramDateTime));var V=r[1];if(V){N.duration=parseFloat(V);var W=(" "+r[2]).slice(1);N.title=W||null,N.tagList.push(W?["INF",V,W]:["INF",V])}else if(r[3])Object(_.isFiniteNumber)(N.duration)&&(N.start=P,h&&(N.levelkey=h),N.sn=O,N.level=E,N.cc=x,N.urlId=v,k.push(N),N.relurl=(" "+r[3]).slice(1),n(N,M),M=N,P+=N.duration,O++,w=0,G=!0);else if(r[4]){var Y=(" "+r[4]).slice(1);M?N.setByteRange(Y,M):N.setByteRange(Y)}else if(r[5])N.rawProgramDateTime=(" "+r[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),U===-1&&(U=k.length);else{if(!(r=r[0].match(m))){o.logger.warn("No matches on slow regex match for level playlist!");continue}for(s=1;s<r.length&&r[s]===void 0;s++);var X=(" "+r[s]).slice(1),z=(" "+r[s+1]).slice(1),Z=r[s+2]?(" "+r[s+2]).slice(1):"";switch(X){case"PLAYLIST-TYPE":L.type=z.toUpperCase();break;case"MEDIA-SEQUENCE":O=L.startSN=parseInt(z);break;case"SKIP":var ne=new R.AttrList(z),oe=ne.decimalInteger("SKIPPED-SEGMENTS");if(Object(_.isFiniteNumber)(oe)){L.skippedSegments=oe;for(var de=oe;de--;)k.unshift(null);O+=oe}var re=ne.enumeratedString("RECENTLY-REMOVED-DATERANGES");re&&(L.recentlyRemovedDateranges=re.split("	"));break;case"TARGETDURATION":L.targetduration=parseFloat(z);break;case"VERSION":L.version=parseInt(z);break;case"EXTM3U":break;case"ENDLIST":L.live=!1;break;case"#":(z||Z)&&N.tagList.push(Z?[z,Z]:[z]);break;case"DIS":x++;case"GAP":N.tagList.push([X]);break;case"BITRATE":N.tagList.push([X,z]);break;case"DISCONTINUITY-SEQ":x=parseInt(z);break;case"KEY":var pe,te=new R.AttrList(z),ae=te.enumeratedString("METHOD"),ge=te.URI,fe=te.hexadecimalInteger("IV"),Le=te.enumeratedString("KEYFORMATVERSIONS"),_e=te.enumeratedString("KEYID"),De=(pe=te.enumeratedString("KEYFORMAT"))!=null?pe:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(De)>-1){o.logger.warn("Keyformat "+De+" is not supported from the manifest");continue}if(De!=="identity")continue;ae&&(h=I.LevelKey.fromURL(c,ge),ge&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ae)>=0&&(h.method=ae,h.keyFormat=De,_e&&(h.keyID=_e),Le&&(h.keyFormatVersions=Le),h.iv=fe));break;case"START":var Ie=new R.AttrList(z).decimalFloatingPoint("TIME-OFFSET");Object(_.isFiniteNumber)(Ie)&&(L.startTimeOffset=Ie);break;case"MAP":var be=new R.AttrList(z);N.relurl=be.URI,be.BYTERANGE&&N.setByteRange(be.BYTERANGE),N.level=E,N.sn="initSegment",h&&(N.levelkey=h),N.initSegment=null,A=N,G=!0;break;case"SERVER-CONTROL":var ye=new R.AttrList(z);L.canBlockReload=ye.bool("CAN-BLOCK-RELOAD"),L.canSkipUntil=ye.optionalFloat("CAN-SKIP-UNTIL",0),L.canSkipDateRanges=L.canSkipUntil>0&&ye.bool("CAN-SKIP-DATERANGES"),L.partHoldBack=ye.optionalFloat("PART-HOLD-BACK",0),L.holdBack=ye.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Xe=new R.AttrList(z);L.partTarget=Xe.decimalFloatingPoint("PART-TARGET");break;case"PART":var we=L.partList;we||(we=L.partList=[]);var Ne=w>0?we[we.length-1]:void 0,Qe=w++,Ke=new S.Part(new R.AttrList(z),N,c,Qe,Ne);we.push(Ke),N.duration+=Ke.duration;break;case"PRELOAD-HINT":var xe=new R.AttrList(z);L.preloadHint=xe;break;case"RENDITION-REPORT":var nt=new R.AttrList(z);L.renditionReports=L.renditionReports||[],L.renditionReports.push(nt);break;default:o.logger.warn("line parsed but not handled: "+r)}}}M&&!M.relurl?(k.pop(),P-=M.duration,L.partList&&(L.fragmentHint=M)):L.partList&&(n(N,M),N.cc=x,L.fragmentHint=N);var Ze=k.length,Me=k[0],at=k[Ze-1];if((P+=L.skippedSegments*L.targetduration)>0&&Ze&&at){L.averagetargetduration=P/Ze;var Je=at.sn;L.endSN=Je!=="initSegment"?Je:0,Me&&(L.startCC=Me.cc,Me.initSegment||L.fragments.every(function(He){return He.relurl&&(Be=He.relurl,l.test((We=(Oe=T.parseURL(Be))===null||Oe===void 0?void 0:Oe.path)!=null?We:""));var Be,We,Oe})&&(o.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(N=new S.Fragment(g,c)).relurl=at.relurl,N.level=E,N.sn="initSegment",Me.initSegment=N,L.needSidxRanges=!0))}else L.endSN=0,L.startCC=0;return L.fragmentHint&&(P+=L.fragmentHint.duration),L.totalduration=P,L.endCC=x,U>0&&function(He,Be){for(var We=He[Be],Oe=Be;Oe--;){var $e=He[Oe];if(!$e)return;$e.programDateTime=We.programDateTime-1e3*$e.duration,We=$e}}(k,U),L},u}();function i(u,a){["video","audio","text"].forEach(function(c){var E=u.filter(function(v){return Object(b.isCodecType)(v,c)});if(E.length){var g=E.filter(function(v){return v.lastIndexOf("avc1",0)===0||v.lastIndexOf("mp4a",0)===0});a[c+"Codec"]=g.length>0?g[0]:E[0],u=u.filter(function(v){return E.indexOf(v)===-1})}}),a.unknownCodecs=u}function t(u,a,c){var E=a[c];E&&(u[c]=E)}function n(u,a){u.rawProgramDateTime?u.programDateTime=Date.parse(u.rawProgramDateTime):a!=null&&a.programDateTime&&(u.programDateTime=a.endProgramDateTime),Object(_.isFiniteNumber)(u.programDateTime)||(u.programDateTime=null,u.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(F,C,f){f.r(C);var _=f("./src/polyfills/number.ts"),T=f("./src/events.ts"),S=f("./src/errors.ts"),D=f("./src/utils/logger.ts"),I=f("./src/utils/mp4-tools.ts"),R=f("./src/loader/m3u8-parser.ts"),o=f("./src/types/loader.ts"),b=f("./src/utils/attr-list.ts");function y(p,m){var l=p.url;return l!==void 0&&l.indexOf("data:")!==0||(l=m.url),l}var d=function(){function p(l){this.hls=void 0,this.loaders=Object.create(null),this.hls=l,this.registerListeners()}var m=p.prototype;return m.registerListeners=function(){var l=this.hls;l.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(T.Events.LEVEL_LOADING,this.onLevelLoading,this),l.on(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),l.on(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},m.unregisterListeners=function(){var l=this.hls;l.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(T.Events.LEVEL_LOADING,this.onLevelLoading,this),l.off(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),l.off(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},m.createInternalLoader=function(l){var e=this.hls.config,i=e.pLoader,t=e.loader,n=new(i||t)(e);return l.loader=n,this.loaders[l.type]=n,n},m.getInternalLoader=function(l){return this.loaders[l.type]},m.resetInternalLoader=function(l){this.loaders[l]&&delete this.loaders[l]},m.destroyInternalLoaders=function(){for(var l in this.loaders){var e=this.loaders[l];e&&e.destroy(),this.resetInternalLoader(l)}},m.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},m.onManifestLoading=function(l,e){var i=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:o.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},m.onLevelLoading=function(l,e){var i=e.id,t=e.level,n=e.url,u=e.deliveryDirectives;this.load({id:i,groupId:null,level:t,responseType:"text",type:o.PlaylistContextType.LEVEL,url:n,deliveryDirectives:u})},m.onAudioTrackLoading=function(l,e){var i=e.id,t=e.groupId,n=e.url,u=e.deliveryDirectives;this.load({id:i,groupId:t,level:null,responseType:"text",type:o.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:u})},m.onSubtitleTrackLoading=function(l,e){var i=e.id,t=e.groupId,n=e.url,u=e.deliveryDirectives;this.load({id:i,groupId:t,level:null,responseType:"text",type:o.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:u})},m.load=function(l){var e,i,t,n,u,a,c=this.hls.config,E=this.getInternalLoader(l);if(E){var g=E.context;if(g&&g.url===l.url)return void D.logger.trace("[playlist-loader]: playlist request ongoing");D.logger.log("[playlist-loader]: aborting previous loader for type: "+l.type),E.abort()}switch(l.type){case o.PlaylistContextType.MANIFEST:i=c.manifestLoadingMaxRetry,t=c.manifestLoadingTimeOut,n=c.manifestLoadingRetryDelay,u=c.manifestLoadingMaxRetryTimeout;break;case o.PlaylistContextType.LEVEL:case o.PlaylistContextType.AUDIO_TRACK:case o.PlaylistContextType.SUBTITLE_TRACK:i=0,t=c.levelLoadingTimeOut;break;default:i=c.levelLoadingMaxRetry,t=c.levelLoadingTimeOut,n=c.levelLoadingRetryDelay,u=c.levelLoadingMaxRetryTimeout}if(E=this.createInternalLoader(l),(e=l.deliveryDirectives)!==null&&e!==void 0&&e.part&&(l.type===o.PlaylistContextType.LEVEL&&l.level!==null?a=this.hls.levels[l.level].details:l.type===o.PlaylistContextType.AUDIO_TRACK&&l.id!==null?a=this.hls.audioTracks[l.id].details:l.type===o.PlaylistContextType.SUBTITLE_TRACK&&l.id!==null&&(a=this.hls.subtitleTracks[l.id].details),a)){var v=a.partTarget,r=a.targetduration;v&&r&&(t=Math.min(1e3*Math.max(3*v,.8*r),t))}var s={timeout:t,maxRetry:i,retryDelay:n,maxRetryDelay:u,highWaterMark:0},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};E.load(l,s,h)},m.loadsuccess=function(l,e,i,t){if(t===void 0&&(t=null),i.isSidxRequest)return this.handleSidxRequest(l,i),void this.handlePlaylistLoaded(l,e,i,t);this.resetInternalLoader(i.type);var n=l.data;n.indexOf("#EXTM3U")===0?(e.parsing.start=performance.now(),n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(l,e,i,t):this.handleMasterPlaylist(l,e,i,t)):this.handleManifestParsingError(l,i,"no EXTM3U delimiter",t)},m.loaderror=function(l,e,i){i===void 0&&(i=null),this.handleNetworkError(e,i,!1,l)},m.loadtimeout=function(l,e,i){i===void 0&&(i=null),this.handleNetworkError(e,i,!0)},m.handleMasterPlaylist=function(l,e,i,t){var n=this.hls,u=l.data,a=y(l,i),c=R.default.parseMasterPlaylist(u,a),E=c.levels,g=c.sessionData;if(E.length){var v=E.map(function(k){return{id:k.attrs.AUDIO,audioCodec:k.audioCodec}}),r=E.map(function(k){return{id:k.attrs.SUBTITLES,textCodec:k.textCodec}}),s=R.default.parseMasterPlaylistMedia(u,a,"AUDIO",v),h=R.default.parseMasterPlaylistMedia(u,a,"SUBTITLES",r),L=R.default.parseMasterPlaylistMedia(u,a,"CLOSED-CAPTIONS");s.length&&(s.some(function(k){return!k.url})||!E[0].audioCodec||E[0].attrs.AUDIO||(D.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),s.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new b.AttrList({}),bitrate:0,url:""}))),n.trigger(T.Events.MANIFEST_LOADED,{levels:E,audioTracks:s,subtitles:h,captions:L,url:a,stats:e,networkDetails:t,sessionData:g})}else this.handleManifestParsingError(l,i,"no level found in manifest",t)},m.handleTrackOrLevelPlaylist=function(l,e,i,t){var n=this.hls,u=i.id,a=i.level,c=i.type,E=y(l,i),g=Object(_.isFiniteNumber)(u)?u:0,v=Object(_.isFiniteNumber)(a)?a:g,r=function(A){switch(A.type){case o.PlaylistContextType.AUDIO_TRACK:return o.PlaylistLevelType.AUDIO;case o.PlaylistContextType.SUBTITLE_TRACK:return o.PlaylistLevelType.SUBTITLE;default:return o.PlaylistLevelType.MAIN}}(i),s=R.default.parseLevelPlaylist(l.data,E,v,r,g);if(s.fragments.length){if(c===o.PlaylistContextType.MANIFEST){var h={attrs:new b.AttrList({}),bitrate:0,details:s,name:"",url:E};n.trigger(T.Events.MANIFEST_LOADED,{levels:[h],audioTracks:[],url:E,stats:e,networkDetails:t,sessionData:null})}if(e.parsing.end=performance.now(),s.needSidxRanges){var L,k=(L=s.fragments[0].initSegment)===null||L===void 0?void 0:L.url;this.load({url:k,isSidxRequest:!0,type:c,level:a,levelDetails:s,id:u,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else i.levelDetails=s,this.handlePlaylistLoaded(l,e,i,t)}else n.trigger(T.Events.ERROR,{type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:E,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0})},m.handleSidxRequest=function(l,e){var i=Object(I.parseSegmentIndex)(new Uint8Array(l.data));if(i){var t=i.references,n=e.levelDetails;t.forEach(function(u,a){var c=u.info,E=n.fragments[a];E.byteRange.length===0&&E.setByteRange(String(1+c.end-c.start)+"@"+String(c.start)),E.initSegment&&E.initSegment.setByteRange(String(i.moovEndOffset)+"@0")})}},m.handleManifestParsingError=function(l,e,i,t){this.hls.trigger(T.Events.ERROR,{type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===o.PlaylistContextType.MANIFEST,url:l.url,reason:i,response:l,context:e,networkDetails:t})},m.handleNetworkError=function(l,e,i,t){i===void 0&&(i=!1),D.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+l.type+" level: "+l.level+" id: "+l.id+' group-id: "'+l.groupId+'"');var n=S.ErrorDetails.UNKNOWN,u=!1,a=this.getInternalLoader(l);switch(l.type){case o.PlaylistContextType.MANIFEST:n=i?S.ErrorDetails.MANIFEST_LOAD_TIMEOUT:S.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case o.PlaylistContextType.LEVEL:n=i?S.ErrorDetails.LEVEL_LOAD_TIMEOUT:S.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case o.PlaylistContextType.AUDIO_TRACK:n=i?S.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:S.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case o.PlaylistContextType.SUBTITLE_TRACK:n=i?S.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:S.ErrorDetails.SUBTITLE_LOAD_ERROR,u=!1}a&&this.resetInternalLoader(l.type);var c={type:S.ErrorTypes.NETWORK_ERROR,details:n,fatal:u,url:l.url,loader:a,context:l,networkDetails:e};t&&(c.response=t),this.hls.trigger(T.Events.ERROR,c)},m.handlePlaylistLoaded=function(l,e,i,t){var n=i.type,u=i.level,a=i.id,c=i.groupId,E=i.loader,g=i.levelDetails,v=i.deliveryDirectives;if(g!=null&&g.targetduration){if(E)switch(g.live&&(E.getCacheAge&&(g.ageHeader=E.getCacheAge()||0),E.getCacheAge&&!isNaN(g.ageHeader)||(g.ageHeader=0)),n){case o.PlaylistContextType.MANIFEST:case o.PlaylistContextType.LEVEL:this.hls.trigger(T.Events.LEVEL_LOADED,{details:g,level:u||0,id:a||0,stats:e,networkDetails:t,deliveryDirectives:v});break;case o.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(T.Events.AUDIO_TRACK_LOADED,{details:g,id:a||0,groupId:c||"",stats:e,networkDetails:t,deliveryDirectives:v});break;case o.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(T.Events.SUBTITLE_TRACK_LOADED,{details:g,id:a||0,groupId:c||"",stats:e,networkDetails:t,deliveryDirectives:v})}}else this.handleManifestParsingError(l,i,"invalid target duration",t)},p}();C.default=d},"./src/polyfills/number.ts":function(F,C,f){f.r(C),f.d(C,"isFiniteNumber",function(){return _}),f.d(C,"MAX_SAFE_INTEGER",function(){return T});var _=Number.isFinite||function(S){return typeof S=="number"&&isFinite(S)},T=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(F,C,f){f.r(C);var _=function(){function T(){}return T.getSilentFrame=function(S,D){switch(S){case"mp4a.40.2":if(D===1)return new Uint8Array([0,200,0,128,35,128]);if(D===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(D===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(D===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(D===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(D===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(D===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(D===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(D===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},T}();C.default=_},"./src/remux/mp4-generator.ts":function(F,C,f){f.r(C);var _=Math.pow(2,32)-1,T=function(){function S(){}return S.init=function(){var D;for(D in S.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},S.types)S.types.hasOwnProperty(D)&&(S.types[D]=[D.charCodeAt(0),D.charCodeAt(1),D.charCodeAt(2),D.charCodeAt(3)]);var I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),R=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);S.HDLR_TYPES={video:I,audio:R};var o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),b=new Uint8Array([0,0,0,0,0,0,0,0]);S.STTS=S.STSC=S.STCO=b,S.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),S.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),S.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),S.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var y=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),p=new Uint8Array([0,0,0,1]);S.FTYP=S.box(S.types.ftyp,y,p,y,d),S.DINF=S.box(S.types.dinf,S.box(S.types.dref,o))},S.box=function(D){for(var I=8,R=arguments.length,o=new Array(R>1?R-1:0),b=1;b<R;b++)o[b-1]=arguments[b];for(var y=o.length,d=y;y--;)I+=o[y].byteLength;var p=new Uint8Array(I);for(p[0]=I>>24&255,p[1]=I>>16&255,p[2]=I>>8&255,p[3]=255&I,p.set(D,4),y=0,I=8;y<d;y++)p.set(o[y],I),I+=o[y].byteLength;return p},S.hdlr=function(D){return S.box(S.types.hdlr,S.HDLR_TYPES[D])},S.mdat=function(D){return S.box(S.types.mdat,D)},S.mdhd=function(D,I){I*=D;var R=Math.floor(I/(_+1)),o=Math.floor(I%(_+1));return S.box(S.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,D>>24&255,D>>16&255,D>>8&255,255&D,R>>24,R>>16&255,R>>8&255,255&R,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]))},S.mdia=function(D){return S.box(S.types.mdia,S.mdhd(D.timescale,D.duration),S.hdlr(D.type),S.minf(D))},S.mfhd=function(D){return S.box(S.types.mfhd,new Uint8Array([0,0,0,0,D>>24,D>>16&255,D>>8&255,255&D]))},S.minf=function(D){return D.type==="audio"?S.box(S.types.minf,S.box(S.types.smhd,S.SMHD),S.DINF,S.stbl(D)):S.box(S.types.minf,S.box(S.types.vmhd,S.VMHD),S.DINF,S.stbl(D))},S.moof=function(D,I,R){return S.box(S.types.moof,S.mfhd(D),S.traf(R,I))},S.moov=function(D){for(var I=D.length,R=[];I--;)R[I]=S.trak(D[I]);return S.box.apply(null,[S.types.moov,S.mvhd(D[0].timescale,D[0].duration)].concat(R).concat(S.mvex(D)))},S.mvex=function(D){for(var I=D.length,R=[];I--;)R[I]=S.trex(D[I]);return S.box.apply(null,[S.types.mvex].concat(R))},S.mvhd=function(D,I){I*=D;var R=Math.floor(I/(_+1)),o=Math.floor(I%(_+1)),b=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,D>>24&255,D>>16&255,D>>8&255,255&D,R>>24,R>>16&255,R>>8&255,255&R,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return S.box(S.types.mvhd,b)},S.sdtp=function(D){var I,R,o=D.samples||[],b=new Uint8Array(4+o.length);for(I=0;I<o.length;I++)R=o[I].flags,b[I+4]=R.dependsOn<<4|R.isDependedOn<<2|R.hasRedundancy;return S.box(S.types.sdtp,b)},S.stbl=function(D){return S.box(S.types.stbl,S.stsd(D),S.box(S.types.stts,S.STTS),S.box(S.types.stsc,S.STSC),S.box(S.types.stsz,S.STSZ),S.box(S.types.stco,S.STCO))},S.avc1=function(D){var I,R,o,b=[],y=[];for(I=0;I<D.sps.length;I++)o=(R=D.sps[I]).byteLength,b.push(o>>>8&255),b.push(255&o),b=b.concat(Array.prototype.slice.call(R));for(I=0;I<D.pps.length;I++)o=(R=D.pps[I]).byteLength,y.push(o>>>8&255),y.push(255&o),y=y.concat(Array.prototype.slice.call(R));var d=S.box(S.types.avcC,new Uint8Array([1,b[3],b[4],b[5],255,224|D.sps.length].concat(b).concat([D.pps.length]).concat(y))),p=D.width,m=D.height,l=D.pixelRatio[0],e=D.pixelRatio[1];return S.box(S.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,p>>8&255,255&p,m>>8&255,255&m,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,S.box(S.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),S.box(S.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,e>>24,e>>16&255,e>>8&255,255&e])))},S.esds=function(D){var I=D.config.length;return new Uint8Array([0,0,0,0,3,23+I,0,1,0,4,15+I,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([I]).concat(D.config).concat([6,1,2]))},S.mp4a=function(D){var I=D.samplerate;return S.box(S.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,D.channelCount,0,16,0,0,0,0,I>>8&255,255&I,0,0]),S.box(S.types.esds,S.esds(D)))},S.mp3=function(D){var I=D.samplerate;return S.box(S.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,D.channelCount,0,16,0,0,0,0,I>>8&255,255&I,0,0]))},S.stsd=function(D){return D.type==="audio"?D.isAAC||D.codec!=="mp3"?S.box(S.types.stsd,S.STSD,S.mp4a(D)):S.box(S.types.stsd,S.STSD,S.mp3(D)):S.box(S.types.stsd,S.STSD,S.avc1(D))},S.tkhd=function(D){var I=D.id,R=D.duration*D.timescale,o=D.width,b=D.height,y=Math.floor(R/(_+1)),d=Math.floor(R%(_+1));return S.box(S.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,255&I,0,0,0,0,y>>24,y>>16&255,y>>8&255,255&y,d>>24,d>>16&255,d>>8&255,255&d,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,b>>8&255,255&b,0,0]))},S.traf=function(D,I){var R=S.sdtp(D),o=D.id,b=Math.floor(I/(_+1)),y=Math.floor(I%(_+1));return S.box(S.types.traf,S.box(S.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),S.box(S.types.tfdt,new Uint8Array([1,0,0,0,b>>24,b>>16&255,b>>8&255,255&b,y>>24,y>>16&255,y>>8&255,255&y])),S.trun(D,R.length+16+20+8+16+8+8),R)},S.trak=function(D){return D.duration=D.duration||4294967295,S.box(S.types.trak,S.tkhd(D),S.mdia(D))},S.trex=function(D){var I=D.id;return S.box(S.types.trex,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,255&I,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},S.trun=function(D,I){var R,o,b,y,d,p,m=D.samples||[],l=m.length,e=12+16*l,i=new Uint8Array(e);for(I+=8+e,i.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,I>>>24&255,I>>>16&255,I>>>8&255,255&I],0),R=0;R<l;R++)b=(o=m[R]).duration,y=o.size,d=o.flags,p=o.cts,i.set([b>>>24&255,b>>>16&255,b>>>8&255,255&b,y>>>24&255,y>>>16&255,y>>>8&255,255&y,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,61440&d.degradPrio,15&d.degradPrio,p>>>24&255,p>>>16&255,p>>>8&255,255&p],12+16*R);return S.box(S.types.trun,i)},S.initSegment=function(D){S.types||S.init();var I=S.moov(D),R=new Uint8Array(S.FTYP.byteLength+I.byteLength);return R.set(S.FTYP),R.set(I,S.FTYP.byteLength),R},S}();T.types=void 0,T.HDLR_TYPES=void 0,T.STTS=void 0,T.STSC=void 0,T.STCO=void 0,T.STSZ=void 0,T.VMHD=void 0,T.SMHD=void 0,T.STSD=void 0,T.FTYP=void 0,T.DINF=void 0,C.default=T},"./src/remux/mp4-remuxer.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return l}),f.d(C,"normalizePts",function(){return e});var _=f("./src/polyfills/number.ts"),T=f("./src/remux/aac-helper.ts"),S=f("./src/remux/mp4-generator.ts"),D=f("./src/events.ts"),I=f("./src/errors.ts"),R=f("./src/utils/logger.ts"),o=f("./src/types/loader.ts"),b=f("./src/utils/timescale-conversion.ts");function y(){return(y=Object.assign||function(n){for(var u=1;u<arguments.length;u++){var a=arguments[u];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(n[c]=a[c])}return n}).apply(this,arguments)}var d=null,p=null,m=!1,l=function(){function n(a,c,E,g){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=a,this.config=c,this.typeSupported=E,this.ISGenerated=!1,d===null){var v=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);d=v?parseInt(v[1]):0}if(p===null){var r=navigator.userAgent.match(/Safari\/(\d+)/i);p=r?parseInt(r[1]):0}m=!!d&&d<75||!!p&&p<600}var u=n.prototype;return u.destroy=function(){},u.resetTimeStamp=function(a){R.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=a},u.resetNextTimestamp=function(){R.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},u.resetInitSegment=function(){R.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},u.getVideoStartPts=function(a){var c=!1,E=a.reduce(function(g,v){var r=v.pts-g;return r<-4294967296?(c=!0,e(g,v.pts)):r>0?g:v.pts},a[0].pts);return c&&R.logger.debug("PTS rollover detected"),E},u.remux=function(a,c,E,g,v,r,s,h){var L,k,A,O,w,P,x=v,M=v,N=a.pid>-1,U=c.pid>-1,G=c.samples.length,V=a.samples.length>0,W=G>1;if((!N||V)&&(!U||W)||this.ISGenerated||s){this.ISGenerated||(A=this.generateIS(a,c,v));var Y=this.isVideoContiguous,X=-1;if(W&&(X=function(de){for(var re=0;re<de.length;re++)if(de[re].key)return re;return-1}(c.samples),!Y&&this.config.forceKeyFrameOnDiscontinuity))if(P=!0,X>0){R.logger.warn("[mp4-remuxer]: Dropped "+X+" out of "+G+" video samples due to a missing keyframe");var z=this.getVideoStartPts(c.samples);c.samples=c.samples.slice(X),c.dropped+=X,M+=(c.samples[0].pts-z)/(c.timescale||9e4)}else X===-1&&(R.logger.warn("[mp4-remuxer]: No keyframe found out of "+G+" video samples"),P=!1);if(this.ISGenerated){if(V&&W){var Z=this.getVideoStartPts(c.samples),ne=(e(a.samples[0].pts,Z)-Z)/c.inputTimeScale;x+=Math.max(0,ne),M+=Math.max(0,-ne)}if(V){if(a.samplerate||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),A=this.generateIS(a,c,v)),k=this.remuxAudio(a,x,this.isAudioContiguous,r,U||W||h===o.PlaylistLevelType.AUDIO?M:void 0),W){var oe=k?k.endPTS-k.startPTS:0;c.inputTimeScale||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),A=this.generateIS(a,c,v)),L=this.remuxVideo(c,M,Y,oe)}}else W&&(L=this.remuxVideo(c,M,Y,0));L&&(L.firstKeyFrame=X,L.independent=X!==-1)}}return this.ISGenerated&&(E.samples.length&&(w=this.remuxID3(E,v)),g.samples.length&&(O=this.remuxText(g,v))),{audio:k,video:L,initSegment:A,independent:P,text:O,id3:w}},u.generateIS=function(a,c,E){var g,v,r,s=a.samples,h=c.samples,L=this.typeSupported,k={},A=!Object(_.isFiniteNumber)(this._initPTS),O="audio/mp4";if(A&&(g=v=1/0),a.config&&s.length&&(a.timescale=a.samplerate,a.isAAC||(L.mpeg?(O="audio/mpeg",a.codec=""):L.mp3&&(a.codec="mp3")),k.audio={id:"audio",container:O,codec:a.codec,initSegment:!a.isAAC&&L.mpeg?new Uint8Array(0):S.default.initSegment([a]),metadata:{channelCount:a.channelCount}},A&&(r=a.inputTimeScale,g=v=s[0].pts-Math.round(r*E))),c.sps&&c.pps&&h.length&&(c.timescale=c.inputTimeScale,k.video={id:"main",container:"video/mp4",codec:c.codec,initSegment:S.default.initSegment([c]),metadata:{width:c.width,height:c.height}},A)){r=c.inputTimeScale;var w=this.getVideoStartPts(h),P=Math.round(r*E);v=Math.min(v,e(h[0].dts,w)-P),g=Math.min(g,w-P)}if(Object.keys(k).length)return this.ISGenerated=!0,A&&(this._initPTS=g,this._initDTS=v),{tracks:k,initPTS:g,timescale:r}},u.remuxVideo=function(a,c,E,g){var v,r,s,h=a.inputTimeScale,L=a.samples,k=[],A=L.length,O=this._initPTS,w=this.nextAvcDts,P=8,x=Number.POSITIVE_INFINITY,M=Number.NEGATIVE_INFINITY,N=0,U=!1;E&&w!==null||(w=c*h-(L[0].pts-e(L[0].dts,L[0].pts)));for(var G=0;G<A;G++){var V=L[G];V.pts=e(V.pts-O,w),V.dts=e(V.dts-O,w),V.dts>V.pts&&(N=Math.max(Math.min(N,V.pts-V.dts),-18e3)),V.dts<L[G>0?G-1:G].dts&&(U=!0)}U&&L.sort(function(Oe,$e){var nr=Oe.dts-$e.dts,ar=Oe.pts-$e.pts;return nr||ar}),r=L[0].dts,s=L[L.length-1].dts;var W=Math.round((s-r)/(A-1));if(N<0){if(N<-2*W){R.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(b.toMsFromMpegTsClock)(-W,!0)+" ms");for(var Y=N,X=0;X<A;X++)L[X].dts=Y=Math.max(Y,L[X].pts-W),L[X].pts=Math.max(Y,L[X].pts)}else{R.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(b.toMsFromMpegTsClock)(N,!0)+" ms to overcome this issue");for(var z=0;z<A;z++)L[z].dts=L[z].dts+N}r=L[0].dts}if(E){var Z=r-w,ne=Z>W;if(ne||Z<-1){ne?R.logger.warn("AVC: "+Object(b.toMsFromMpegTsClock)(Z,!0)+" ms ("+Z+"dts) hole between fragments detected, filling it"):R.logger.warn("AVC: "+Object(b.toMsFromMpegTsClock)(-Z,!0)+" ms ("+Z+"dts) overlapping between fragments detected"),r=w;var oe=L[0].pts-Z;L[0].dts=r,L[0].pts=oe,R.logger.log("Video: First PTS/DTS adjusted: "+Object(b.toMsFromMpegTsClock)(oe,!0)+"/"+Object(b.toMsFromMpegTsClock)(r,!0)+", delta: "+Object(b.toMsFromMpegTsClock)(Z,!0)+" ms")}}m&&(r=Math.max(0,r));for(var de=0,re=0,pe=0;pe<A;pe++){for(var te=L[pe],ae=te.units,ge=ae.length,fe=0,Le=0;Le<ge;Le++)fe+=ae[Le].data.length;re+=fe,de+=ge,te.length=fe,te.dts=Math.max(te.dts,r),te.pts=Math.max(te.pts,te.dts,0),x=Math.min(te.pts,x),M=Math.max(te.pts,M)}s=L[A-1].dts;var _e,De=re+4*de+8;try{_e=new Uint8Array(De)}catch{return void this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:De,reason:"fail allocating video mdat "+De})}var Ie=new DataView(_e.buffer);Ie.setUint32(0,De),_e.set(S.default.types.mdat,4);for(var be=0;be<A;be++){for(var ye=L[be],Xe=ye.units,we=0,Ne=0,Qe=Xe.length;Ne<Qe;Ne++){var Ke=Xe[Ne],xe=Ke.data,nt=Ke.data.byteLength;Ie.setUint32(P,nt),P+=4,_e.set(xe,P),P+=nt,we+=4+nt}if(be<A-1)v=L[be+1].dts-ye.dts;else{var Ze=this.config,Me=ye.dts-L[be>0?be-1:be].dts;if(Ze.stretchShortVideoTrack&&this.nextAudioPts!==null){var at=Math.floor(Ze.maxBufferHole*h),Je=(g?x+g*h:this.nextAudioPts)-ye.pts;Je>at?((v=Je-Me)<0&&(v=Me),R.logger.log("[mp4-remuxer]: It is approximately "+Je/90+" ms to the next segment; using duration "+v/90+" ms for the last video frame.")):v=Me}else v=Me}var He=Math.round(ye.pts-ye.dts);k.push(new i(ye.key,v,we,He))}if(k.length&&d&&d<70){var Be=k[0].flags;Be.dependsOn=2,Be.isNonSync=0}console.assert(v!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=w=s+v,this.isVideoContiguous=!0;var We={data1:S.default.moof(a.sequenceNumber++,r,y({},a,{samples:k})),data2:_e,startPTS:x/h,endPTS:(M+v)/h,startDTS:r/h,endDTS:w/h,type:"video",hasAudio:!1,hasVideo:!0,nb:k.length,dropped:a.dropped};return a.samples=[],a.dropped=0,console.assert(_e.length,"MDAT length must not be zero"),We},u.remuxAudio=function(a,c,E,g,v){var r=a.inputTimeScale,s=r/(a.samplerate?a.samplerate:r),h=a.isAAC?1024:1152,L=h*s,k=this._initPTS,A=!a.isAAC&&this.typeSupported.mpeg,O=[],w=a.samples,P=A?0:8,x=this.nextAudioPts||-1,M=c*r;if(this.isAudioContiguous=E=E||w.length&&x>0&&(g&&Math.abs(M-x)<9e3||Math.abs(e(w[0].pts-k,M)-x)<20*L),w.forEach(function(xe){xe.pts=e(xe.pts-k,M)}),!E||x<0){if(!(w=w.filter(function(xe){return xe.pts>=0})).length)return;x=v===0?0:g?Math.max(0,M):w[0].pts}if(a.isAAC)for(var N=v!==void 0,U=this.config.maxAudioFramesDrift,G=0,V=x;G<w.length;G++){var W=w[G],Y=W.pts,X=Y-V,z=Math.abs(1e3*X/r);if(X<=-U*L&&N)G===0&&(R.logger.warn("Audio frame @ "+(Y/r).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*X/r)+" ms."),this.nextAudioPts=x=V=Y);else if(X>=U*L&&z<1e4&&N){var Z=Math.round(X/L);(V=Y-Z*L)<0&&(Z--,V+=L),G===0&&(this.nextAudioPts=x=V),R.logger.warn("[mp4-remuxer]: Injecting "+Z+" audio frame @ "+(V/r).toFixed(3)+"s due to "+Math.round(1e3*X/r)+" ms gap.");for(var ne=0;ne<Z;ne++){var oe=Math.max(V,0),de=T.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);de||(R.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),de=W.unit.subarray()),w.splice(G,0,{unit:de,pts:oe}),V+=L,G++}}W.pts=V,V+=L}for(var re,pe=null,te=null,ae=0,ge=w.length;ge--;)ae+=w[ge].unit.byteLength;for(var fe=0,Le=w.length;fe<Le;fe++){var _e=w[fe],De=_e.unit,Ie=_e.pts;if(te!==null)O[fe-1].duration=Math.round((Ie-te)/s);else{if(E&&a.isAAC&&(Ie=x),pe=Ie,!(ae>0))return;ae+=P;try{re=new Uint8Array(ae)}catch{return void this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:I.ErrorTypes.MUX_ERROR,details:I.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ae,reason:"fail allocating audio mdat "+ae})}A||(new DataView(re.buffer).setUint32(0,ae),re.set(S.default.types.mdat,4))}re.set(De,P);var be=De.byteLength;P+=be,O.push(new i(!0,h,be,0)),te=Ie}var ye=O.length;if(ye){var Xe=O[O.length-1];this.nextAudioPts=x=te+s*Xe.duration;var we=A?new Uint8Array(0):S.default.moof(a.sequenceNumber++,pe/s,y({},a,{samples:O}));a.samples=[];var Ne=pe/r,Qe=x/r,Ke={data1:we,data2:re,startPTS:Ne,endPTS:Qe,startDTS:Ne,endDTS:Qe,type:"audio",hasAudio:!0,hasVideo:!1,nb:ye};return this.isAudioContiguous=!0,console.assert(re.length,"MDAT length must not be zero"),Ke}},u.remuxEmptyAudio=function(a,c,E,g){var v=a.inputTimeScale,r=v/(a.samplerate?a.samplerate:v),s=this.nextAudioPts,h=(s!==null?s:g.startDTS*v)+this._initDTS,L=g.endDTS*v+this._initDTS,k=1024*r,A=Math.ceil((L-h)/k),O=T.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(R.logger.warn("[mp4-remuxer]: remux empty Audio"),O){for(var w=[],P=0;P<A;P++){var x=h+P*k;w.push({unit:O,pts:x,dts:x})}return a.samples=w,this.remuxAudio(a,c,E,!1)}R.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},u.remuxID3=function(a,c){var E=a.samples.length;if(E){for(var g=a.inputTimeScale,v=this._initPTS,r=this._initDTS,s=0;s<E;s++){var h=a.samples[s];h.pts=e(h.pts-v,c*g)/g,h.dts=e(h.dts-r,c*g)/g}var L=a.samples;return a.samples=[],{samples:L}}},u.remuxText=function(a,c){var E=a.samples.length;if(E){for(var g=a.inputTimeScale,v=this._initPTS,r=0;r<E;r++){var s=a.samples[r];s.pts=e(s.pts-v,c*g)/g}a.samples.sort(function(L,k){return L.pts-k.pts});var h=a.samples;return a.samples=[],{samples:h}}},n}();function e(n,u){var a;if(u===null)return n;for(a=u<n?-8589934592:8589934592;Math.abs(n-u)>4294967296;)n+=a;return n}var i=function(n,u,a,c){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=u,this.size=a,this.cts=c,this.flags=new t(n)},t=function(n){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=n?2:1,this.isNonSync=n?0:1}},"./src/remux/passthrough-remuxer.ts":function(F,C,f){f.r(C);var _=f("./src/polyfills/number.ts"),T=f("./src/utils/mp4-tools.ts"),S=f("./src/loader/fragment.ts"),D=f("./src/utils/logger.ts"),I=function(){function b(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var y=b.prototype;return y.destroy=function(){},y.resetTimeStamp=function(d){this.initPTS=d,this.lastEndDTS=null},y.resetNextTimestamp=function(){this.lastEndDTS=null},y.resetInitSegment=function(d,p,m){this.audioCodec=p,this.videoCodec=m,this.generateInitSegment(d),this.emitInitSegment=!0},y.generateInitSegment=function(d){var p=this.audioCodec,m=this.videoCodec;if(!d||!d.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var l=this.initData=Object(T.parseInitSegment)(d);p||(p=o(l.audio,S.ElementaryStreamTypes.AUDIO)),m||(m=o(l.video,S.ElementaryStreamTypes.VIDEO));var e={};l.audio&&l.video?e.audiovideo={container:"video/mp4",codec:p+","+m,initSegment:d,id:"main"}:l.audio?e.audio={container:"audio/mp4",codec:p,initSegment:d,id:"audio"}:l.video?e.video={container:"video/mp4",codec:m,initSegment:d,id:"main"}:D.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},y.remux=function(d,p,m,l,e){var i=this.initPTS,t=this.lastEndDTS,n={audio:void 0,video:void 0,text:l,id3:m,initSegment:void 0};Object(_.isFiniteNumber)(t)||(t=this.lastEndDTS=e||0);var u=p.samples;if(!u||!u.length)return n;var a={initPTS:void 0,timescale:1},c=this.initData;if(c&&c.length||(this.generateInitSegment(u),c=this.initData),!c||!c.length)return D.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),n;this.emitInitSegment&&(a.tracks=this.initTracks,this.emitInitSegment=!1),Object(_.isFiniteNumber)(i)||(this.initPTS=a.initPTS=i=R(c,u,t));var E=Object(T.getDuration)(u,c),g=t,v=E+g;Object(T.offsetStartDTS)(c,u,i),E>0?this.lastEndDTS=v:(D.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var r=!!c.audio,s=!!c.video,h="";r&&(h+="audio"),s&&(h+="video");var L={data1:u,startPTS:g,startDTS:g,endPTS:v,endDTS:v,type:h,hasAudio:r,hasVideo:s,nb:1,dropped:0};return n.audio=L.type==="audio"?L:void 0,n.video=L.type!=="audio"?L:void 0,n.text=l,n.id3=m,n.initSegment=a,n},b}(),R=function(b,y,d){return Object(T.getStartDTS)(b,y)-d};function o(b,y){var d=b==null?void 0:b.codec;return d&&d.length>4?d:d==="hvc1"?"hvc1.1.c.L120.90":d==="av01"?"av01.0.04M.08":d==="avc1"||y===S.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}C.default=I},"./src/task-loop.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return _});var _=function(){function T(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var S=T.prototype;return S.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},S.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},S.onHandlerDestroyed=function(){},S.hasInterval=function(){return!!this._tickInterval},S.hasNextTick=function(){return!!this._tickTimer},S.setInterval=function(D){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,D),!0)},S.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},S.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},S.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},S.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},S.doTick=function(){},T}()},"./src/types/level.ts":function(F,C,f){function _(o,b){for(var y=0;y<b.length;y++){var d=b[y];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(o,d.key,d)}}var T,S;function D(o,b){var y=o.canSkipUntil,d=o.canSkipDateRanges,p=o.endSN;return y&&(b!==void 0?b-p:0)<y?d?T.v2:T.Yes:T.No}f.r(C),f.d(C,"HlsSkip",function(){return T}),f.d(C,"getSkipValue",function(){return D}),f.d(C,"HlsUrlParameters",function(){return I}),f.d(C,"Level",function(){return R}),(S=T||(T={})).No="",S.Yes="YES",S.v2="v2";var I=function(){function o(b,y,d){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=b,this.part=y,this.skip=d}return o.prototype.addDirectives=function(b){var y=new self.URL(b);return this.msn!==void 0&&y.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&y.searchParams.set("_HLS_part",this.part.toString()),this.skip&&y.searchParams.set("_HLS_skip",this.skip),y.toString()},o}(),R=function(){function o(d){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[d.url],this.attrs=d.attrs,this.bitrate=d.bitrate,d.details&&(this.details=d.details),this.id=d.id||0,this.name=d.name,this.width=d.width||0,this.height=d.height||0,this.audioCodec=d.audioCodec,this.videoCodec=d.videoCodec,this.unknownCodecs=d.unknownCodecs,this.codecSet=[d.videoCodec,d.audioCodec].filter(function(p){return p}).join(",").replace(/\.[^.,]+/g,"")}var b,y;return b=o,(y=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(d){var p=d%this.url.length;this._urlId!==p&&(this.details=void 0,this._urlId=p)}}])&&_(b.prototype,y),o}()},"./src/types/loader.ts":function(F,C,f){var _,T,S,D;f.r(C),f.d(C,"PlaylistContextType",function(){return _}),f.d(C,"PlaylistLevelType",function(){return S}),(T=_||(_={})).MANIFEST="manifest",T.LEVEL="level",T.AUDIO_TRACK="audioTrack",T.SUBTITLE_TRACK="subtitleTrack",(D=S||(S={})).MAIN="main",D.AUDIO="audio",D.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(F,C,f){f.r(C),f.d(C,"ChunkMetadata",function(){return _});var _=function(T,S,D,I,R,o){I===void 0&&(I=0),R===void 0&&(R=-1),o===void 0&&(o=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=T,this.sn=S,this.id=D,this.size=I,this.part=R,this.partial=o}},"./src/utils/attr-list.ts":function(F,C,f){f.r(C),f.d(C,"AttrList",function(){return S});var _=/^(\d+)x(\d+)$/,T=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,S=function(){function D(R){for(var o in typeof R=="string"&&(R=D.parseAttrList(R)),R)R.hasOwnProperty(o)&&(this[o]=R[o])}var I=D.prototype;return I.decimalInteger=function(R){var o=parseInt(this[R],10);return o>Number.MAX_SAFE_INTEGER?1/0:o},I.hexadecimalInteger=function(R){if(this[R]){var o=(this[R]||"0x").slice(2);o=(1&o.length?"0":"")+o;for(var b=new Uint8Array(o.length/2),y=0;y<o.length/2;y++)b[y]=parseInt(o.slice(2*y,2*y+2),16);return b}return null},I.hexadecimalIntegerAsNumber=function(R){var o=parseInt(this[R],16);return o>Number.MAX_SAFE_INTEGER?1/0:o},I.decimalFloatingPoint=function(R){return parseFloat(this[R])},I.optionalFloat=function(R,o){var b=this[R];return b?parseFloat(b):o},I.enumeratedString=function(R){return this[R]},I.bool=function(R){return this[R]==="YES"},I.decimalResolution=function(R){var o=_.exec(this[R]);if(o!==null)return{width:parseInt(o[1],10),height:parseInt(o[2],10)}},D.parseAttrList=function(R){var o,b={};for(T.lastIndex=0;(o=T.exec(R))!==null;){var y=o[2];y.indexOf('"')===0&&y.lastIndexOf('"')===y.length-1&&(y=y.slice(1,-1)),b[o[1]]=y}return b},D}()},"./src/utils/binary-search.ts":function(F,C,f){f.r(C),C.default={search:function(_,T){for(var S=0,D=_.length-1,I=null,R=null;S<=D;){var o=T(R=_[I=(S+D)/2|0]);if(o>0)S=I+1;else{if(!(o<0))return R;D=I-1}}return null}}},"./src/utils/buffer-helper.ts":function(F,C,f){f.r(C),f.d(C,"BufferHelper",function(){return S});var _=f("./src/utils/logger.ts"),T={length:0,start:function(){return 0},end:function(){return 0}},S=function(){function D(){}return D.isBuffered=function(I,R){try{if(I){for(var o=D.getBuffered(I),b=0;b<o.length;b++)if(R>=o.start(b)&&R<=o.end(b))return!0}}catch{}return!1},D.bufferInfo=function(I,R,o){try{if(I){var b,y=D.getBuffered(I),d=[];for(b=0;b<y.length;b++)d.push({start:y.start(b),end:y.end(b)});return this.bufferedInfo(d,R,o)}}catch{}return{len:0,start:R,end:R,nextStart:void 0}},D.bufferedInfo=function(I,R,o){R=Math.max(0,R),I.sort(function(a,c){var E=a.start-c.start;return E||c.end-a.end});var b=[];if(o)for(var y=0;y<I.length;y++){var d=b.length;if(d){var p=b[d-1].end;I[y].start-p<o?I[y].end>p&&(b[d-1].end=I[y].end):b.push(I[y])}else b.push(I[y])}else b=I;for(var m,l=0,e=R,i=R,t=0;t<b.length;t++){var n=b[t].start,u=b[t].end;if(R+o>=n&&R<u)e=n,l=(i=u)-R;else if(R+o<n){m=n;break}}return{len:l,start:e||0,end:i||0,nextStart:m}},D.getBuffered=function(I){try{return I.buffered}catch(R){return _.logger.log("failed to get media.buffered",R),T}},D}()},"./src/utils/cea-608-parser.ts":function(F,C,f){f.r(C),f.d(C,"Row",function(){return n}),f.d(C,"CaptionScreen",function(){return u});var _,T,S=f("./src/utils/logger.ts"),D={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},I=function(v){var r=v;return D.hasOwnProperty(v)&&(r=D[v]),String.fromCharCode(r)},R=15,o=100,b={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},y={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},p={25:2,26:4,29:6,30:8,31:10,27:13,28:15},m=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(T=_||(_={}))[T.ERROR=0]="ERROR",T[T.TEXT=1]="TEXT",T[T.WARNING=2]="WARNING",T[T.INFO=2]="INFO",T[T.DEBUG=3]="DEBUG",T[T.DATA=3]="DATA";var l=function(){function v(){this.time=null,this.verboseLevel=_.ERROR}return v.prototype.log=function(r,s){this.verboseLevel>=r&&S.logger.log(this.time+" ["+r+"] "+s)},v}(),e=function(v){for(var r=[],s=0;s<v.length;s++)r.push(v[s].toString(16));return r},i=function(){function v(s,h,L,k,A){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=s||"white",this.underline=h||!1,this.italics=L||!1,this.background=k||"black",this.flash=A||!1}var r=v.prototype;return r.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},r.setStyles=function(s){for(var h=["foreground","underline","italics","background","flash"],L=0;L<h.length;L++){var k=h[L];s.hasOwnProperty(k)&&(this[k]=s[k])}},r.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},r.equals=function(s){return this.foreground===s.foreground&&this.underline===s.underline&&this.italics===s.italics&&this.background===s.background&&this.flash===s.flash},r.copy=function(s){this.foreground=s.foreground,this.underline=s.underline,this.italics=s.italics,this.background=s.background,this.flash=s.flash},r.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},v}(),t=function(){function v(s,h,L,k,A,O){this.uchar=void 0,this.penState=void 0,this.uchar=s||" ",this.penState=new i(h,L,k,A,O)}var r=v.prototype;return r.reset=function(){this.uchar=" ",this.penState.reset()},r.setChar=function(s,h){this.uchar=s,this.penState.copy(h)},r.setPenState=function(s){this.penState.copy(s)},r.equals=function(s){return this.uchar===s.uchar&&this.penState.equals(s.penState)},r.copy=function(s){this.uchar=s.uchar,this.penState.copy(s.penState)},r.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},v}(),n=function(){function v(s){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var h=0;h<o;h++)this.chars.push(new t);this.logger=s,this.pos=0,this.currPenState=new i}var r=v.prototype;return r.equals=function(s){for(var h=!0,L=0;L<o;L++)if(!this.chars[L].equals(s.chars[L])){h=!1;break}return h},r.copy=function(s){for(var h=0;h<o;h++)this.chars[h].copy(s.chars[h])},r.isEmpty=function(){for(var s=!0,h=0;h<o;h++)if(!this.chars[h].isEmpty()){s=!1;break}return s},r.setCursor=function(s){this.pos!==s&&(this.pos=s),this.pos<0?(this.logger.log(_.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>o&&(this.logger.log(_.DEBUG,"Too large cursor position "+this.pos),this.pos=o)},r.moveCursor=function(s){var h=this.pos+s;if(s>1)for(var L=this.pos+1;L<h+1;L++)this.chars[L].setPenState(this.currPenState);this.setCursor(h)},r.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},r.insertChar=function(s){s>=144&&this.backSpace();var h=I(s);this.pos>=o?this.logger.log(_.ERROR,"Cannot insert "+s.toString(16)+" ("+h+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(h,this.currPenState),this.moveCursor(1))},r.clearFromPos=function(s){var h;for(h=s;h<o;h++)this.chars[h].reset()},r.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},r.clearToEndOfRow=function(){this.clearFromPos(this.pos)},r.getTextString=function(){for(var s=[],h=!0,L=0;L<o;L++){var k=this.chars[L].uchar;k!==" "&&(h=!1),s.push(k)}return h?"":s.join("")},r.setPenStyles=function(s){this.currPenState.setStyles(s),this.chars[this.pos].setPenState(this.currPenState)},v}(),u=function(){function v(s){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var h=0;h<R;h++)this.rows.push(new n(s));this.logger=s,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var r=v.prototype;return r.reset=function(){for(var s=0;s<R;s++)this.rows[s].clear();this.currRow=14},r.equals=function(s){for(var h=!0,L=0;L<R;L++)if(!this.rows[L].equals(s.rows[L])){h=!1;break}return h},r.copy=function(s){for(var h=0;h<R;h++)this.rows[h].copy(s.rows[h])},r.isEmpty=function(){for(var s=!0,h=0;h<R;h++)if(!this.rows[h].isEmpty()){s=!1;break}return s},r.backSpace=function(){this.rows[this.currRow].backSpace()},r.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},r.insertChar=function(s){this.rows[this.currRow].insertChar(s)},r.setPen=function(s){this.rows[this.currRow].setPenStyles(s)},r.moveCursor=function(s){this.rows[this.currRow].moveCursor(s)},r.setCursor=function(s){this.logger.log(_.INFO,"setCursor: "+s),this.rows[this.currRow].setCursor(s)},r.setPAC=function(s){this.logger.log(_.INFO,"pacData = "+JSON.stringify(s));var h=s.row-1;if(this.nrRollUpRows&&h<this.nrRollUpRows-1&&(h=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==h){for(var L=0;L<R;L++)this.rows[L].clear();var k=this.currRow+1-this.nrRollUpRows,A=this.lastOutputScreen;if(A){var O=A.rows[k].cueStartTime,w=this.logger.time;if(O&&w!==null&&O<w)for(var P=0;P<this.nrRollUpRows;P++)this.rows[h-this.nrRollUpRows+P+1].copy(A.rows[k+P])}}this.currRow=h;var x=this.rows[this.currRow];if(s.indent!==null){var M=s.indent,N=Math.max(M-1,0);x.setCursor(s.indent),s.color=x.chars[N].penState.foreground}var U={foreground:s.color,underline:s.underline,italics:s.italics,background:"black",flash:!1};this.setPen(U)},r.setBkgData=function(s){this.logger.log(_.INFO,"bkgData = "+JSON.stringify(s)),this.backSpace(),this.setPen(s),this.insertChar(32)},r.setRollUpRows=function(s){this.nrRollUpRows=s},r.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(_.TEXT,this.getDisplayText());var s=this.currRow+1-this.nrRollUpRows,h=this.rows.splice(s,1)[0];h.clear(),this.rows.splice(this.currRow,0,h),this.logger.log(_.INFO,"Rolling up")}else this.logger.log(_.DEBUG,"roll_up but nrRollUpRows not set yet")},r.getDisplayText=function(s){s=s||!1;for(var h=[],L="",k=-1,A=0;A<R;A++){var O=this.rows[A].getTextString();O&&(k=A+1,s?h.push("Row "+k+": '"+O+"'"):h.push(O.trim()))}return h.length>0&&(L=s?"["+h.join(" | ")+"]":h.join(`
`)),L},r.getTextAndFormat=function(){return this.rows},v}(),a=function(){function v(s,h,L){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=s,this.outputFilter=h,this.mode=null,this.verbose=0,this.displayedMemory=new u(L),this.nonDisplayedMemory=new u(L),this.lastOutputScreen=new u(L),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=L}var r=v.prototype;return r.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},r.getHandler=function(){return this.outputFilter},r.setHandler=function(s){this.outputFilter=s},r.setPAC=function(s){this.writeScreen.setPAC(s)},r.setBkgData=function(s){this.writeScreen.setBkgData(s)},r.setMode=function(s){s!==this.mode&&(this.mode=s,this.logger.log(_.INFO,"MODE="+s),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=s)},r.insertChars=function(s){for(var h=0;h<s.length;h++)this.writeScreen.insertChar(s[h]);var L=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(_.INFO,L+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(_.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},r.ccRCL=function(){this.logger.log(_.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},r.ccBS=function(){this.logger.log(_.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},r.ccAOF=function(){},r.ccAON=function(){},r.ccDER=function(){this.logger.log(_.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},r.ccRU=function(s){this.logger.log(_.INFO,"RU("+s+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(s)},r.ccFON=function(){this.logger.log(_.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},r.ccRDC=function(){this.logger.log(_.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},r.ccTR=function(){this.logger.log(_.INFO,"TR"),this.setMode("MODE_TEXT")},r.ccRTD=function(){this.logger.log(_.INFO,"RTD"),this.setMode("MODE_TEXT")},r.ccEDM=function(){this.logger.log(_.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},r.ccCR=function(){this.logger.log(_.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},r.ccENM=function(){this.logger.log(_.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},r.ccEOC=function(){if(this.logger.log(_.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var s=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=s,this.writeScreen=this.nonDisplayedMemory,this.logger.log(_.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},r.ccTO=function(s){this.logger.log(_.INFO,"TO("+s+") - Tab Offset"),this.writeScreen.moveCursor(s)},r.ccMIDROW=function(s){var h={flash:!1};if(h.underline=s%2==1,h.italics=s>=46,h.italics)h.foreground="white";else{var L=Math.floor(s/2)-16;h.foreground=["white","green","blue","cyan","red","yellow","magenta"][L]}this.logger.log(_.INFO,"MIDROW: "+JSON.stringify(h)),this.writeScreen.setPen(h)},r.outputDataUpdate=function(s){s===void 0&&(s=!1);var h=this.logger.time;h!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,h,this.lastOutputScreen),s&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:h):this.cueStartTime=h,this.lastOutputScreen.copy(this.displayedMemory))},r.cueSplitAtTime=function(s){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,s,this.displayedMemory),this.cueStartTime=s))},v}(),c=function(){function v(s,h,L){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var k=new l;this.channels=[null,new a(s,h,k),new a(s+1,L,k)],this.cmdHistory={a:null,b:null},this.logger=k}var r=v.prototype;return r.getHandler=function(s){return this.channels[s].getHandler()},r.setHandler=function(s,h){this.channels[s].setHandler(h)},r.addData=function(s,h){var L,k,A,O=!1;this.logger.time=s;for(var w=0;w<h.length;w+=2)if(k=127&h[w],A=127&h[w+1],k!==0||A!==0){if(this.logger.log(_.DATA,"["+e([h[w],h[w+1]])+"] -> ("+e([k,A])+")"),(L=this.parseCmd(k,A))||(L=this.parseMidrow(k,A)),L||(L=this.parsePAC(k,A)),L||(L=this.parseBackgroundAttributes(k,A)),!L&&(O=this.parseChars(k,A))){var P=this.currentChannel;P&&P>0?this.channels[P].insertChars(O):this.logger.log(_.WARNING,"No channel found yet. TEXT-MODE?")}L||O||this.logger.log(_.WARNING,"Couldn't parse cleaned data "+e([k,A])+" orig: "+e([h[w],h[w+1]]))}},r.parseCmd=function(s,h){var L=this.cmdHistory;if(!((s===20||s===28||s===21||s===29)&&h>=32&&h<=47||(s===23||s===31)&&h>=33&&h<=35))return!1;if(g(s,h,L))return E(null,null,L),this.logger.log(_.DEBUG,"Repeated command ("+e([s,h])+") is dropped"),!0;var k=s===20||s===21||s===23?1:2,A=this.channels[k];return s===20||s===21||s===28||s===29?h===32?A.ccRCL():h===33?A.ccBS():h===34?A.ccAOF():h===35?A.ccAON():h===36?A.ccDER():h===37?A.ccRU(2):h===38?A.ccRU(3):h===39?A.ccRU(4):h===40?A.ccFON():h===41?A.ccRDC():h===42?A.ccTR():h===43?A.ccRTD():h===44?A.ccEDM():h===45?A.ccCR():h===46?A.ccENM():h===47&&A.ccEOC():A.ccTO(h-32),E(s,h,L),this.currentChannel=k,!0},r.parseMidrow=function(s,h){var L=0;if((s===17||s===25)&&h>=32&&h<=47){if((L=s===17?1:2)!==this.currentChannel)return this.logger.log(_.ERROR,"Mismatch channel in midrow parsing"),!1;var k=this.channels[L];return!!k&&(k.ccMIDROW(h),this.logger.log(_.DEBUG,"MIDROW ("+e([s,h])+")"),!0)}return!1},r.parsePAC=function(s,h){var L,k=this.cmdHistory;if(!((s>=17&&s<=23||s>=25&&s<=31)&&h>=64&&h<=127||(s===16||s===24)&&h>=64&&h<=95))return!1;if(g(s,h,k))return E(null,null,k),!0;var A=s<=23?1:2;L=h>=64&&h<=95?A===1?b[s]:d[s]:A===1?y[s]:p[s];var O=this.channels[A];return!!O&&(O.setPAC(this.interpretPAC(L,h)),E(s,h,k),this.currentChannel=A,!0)},r.interpretPAC=function(s,h){var L,k={color:null,italics:!1,indent:null,underline:!1,row:s};return L=h>95?h-96:h-64,k.underline=(1&L)==1,L<=13?k.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(L/2)]:L<=15?(k.italics=!0,k.color="white"):k.indent=4*Math.floor((L-16)/2),k},r.parseChars=function(s,h){var L,k,A=null,O=null;if(s>=25?(L=2,O=s-8):(L=1,O=s),O>=17&&O<=19?(k=O===17?h+80:O===18?h+112:h+144,this.logger.log(_.INFO,"Special char '"+I(k)+"' in channel "+L),A=[k]):s>=32&&s<=127&&(A=h===0?[s]:[s,h]),A){var w=e(A);this.logger.log(_.DEBUG,"Char codes =  "+w.join(",")),E(s,h,this.cmdHistory)}return A},r.parseBackgroundAttributes=function(s,h){var L;if(!((s===16||s===24)&&h>=32&&h<=47||(s===23||s===31)&&h>=45&&h<=47))return!1;var k={};s===16||s===24?(L=Math.floor((h-32)/2),k.background=m[L],h%2==1&&(k.background=k.background+"_semi")):h===45?k.background="transparent":(k.foreground="black",h===47&&(k.underline=!0));var A=s<=23?1:2;return this.channels[A].setBkgData(k),E(s,h,this.cmdHistory),!0},r.reset=function(){for(var s=0;s<Object.keys(this.channels).length;s++){var h=this.channels[s];h&&h.reset()}this.cmdHistory={a:null,b:null}},r.cueSplitAtTime=function(s){for(var h=0;h<this.channels.length;h++){var L=this.channels[h];L&&L.cueSplitAtTime(s)}},v}();function E(v,r,s){s.a=v,s.b=r}function g(v,r,s){return s.a===v&&s.b===r}C.default=c},"./src/utils/codecs.ts":function(F,C,f){f.r(C),f.d(C,"isCodecType",function(){return T}),f.d(C,"isCodecSupportedInMp4",function(){return S});var _={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function T(D,I){var R=_[I];return!!R&&R[D.slice(0,4)]===!0}function S(D,I){return MediaSource.isTypeSupported((I||"video")+'/mp4;codecs="'+D+'"')}},"./src/utils/cues.ts":function(F,C,f){f.r(C);var _=f("./src/utils/vttparser.ts"),T=f("./src/utils/webvtt-parser.ts"),S=f("./src/utils/texttrack-utils.ts"),D=/\s/,I={newCue:function(R,o,b,y){for(var d,p,m,l,e,i=[],t=self.VTTCue||self.TextTrackCue,n=0;n<y.rows.length;n++)if(m=!0,l=0,e="",!(d=y.rows[n]).isEmpty()){for(var u=0;u<d.chars.length;u++)D.test(d.chars[u].uchar)&&m?l++:(e+=d.chars[u].uchar,m=!1);d.cueStartTime=o,o===b&&(b+=1e-4),l>=16?l--:l++;var a=Object(_.fixLineBreaks)(e.trim()),c=Object(T.generateCueId)(o,b,a);R&&R.cues&&R.cues.getCueById(c)||((p=new t(o,b,a)).id=c,p.line=n+1,p.align="left",p.position=10+Math.min(80,10*Math.floor(8*l/32)),i.push(p))}return R&&i.length&&(i.sort(function(E,g){return E.line==="auto"||g.line==="auto"?0:E.line>8&&g.line>8?g.line-E.line:E.line-g.line}),i.forEach(function(E){return Object(S.addCueToTrack)(R,E)})),i}};C.default=I},"./src/utils/discontinuities.ts":function(F,C,f){f.r(C),f.d(C,"findFirstFragWithCC",function(){return D}),f.d(C,"shouldAlignOnDiscontinuities",function(){return I}),f.d(C,"findDiscontinuousReferenceFrag",function(){return R}),f.d(C,"adjustSlidingStart",function(){return b}),f.d(C,"alignStream",function(){return y}),f.d(C,"alignPDT",function(){return d});var _=f("./src/polyfills/number.ts"),T=f("./src/utils/logger.ts"),S=f("./src/controller/level-helper.ts");function D(p,m){for(var l=null,e=0,i=p.length;e<i;e++){var t=p[e];if(t&&t.cc===m){l=t;break}}return l}function I(p,m,l){return!(!m.details||!(l.endCC>l.startCC||p&&p.cc<l.startCC))}function R(p,m){var l=p.fragments,e=m.fragments;if(e.length&&l.length){var i=D(l,e[0].cc);if(i&&(!i||i.startPTS))return i;T.logger.log("No frag in previous level to align on")}else T.logger.log("No fragments to align")}function o(p,m){if(p){var l=p.start+m;p.start=p.startPTS=l,p.endPTS=l+p.duration}}function b(p,m){for(var l=m.fragments,e=0,i=l.length;e<i;e++)o(l[e],p);m.fragmentHint&&o(m.fragmentHint,p),m.alignedSliding=!0}function y(p,m,l){m&&(function(e,i,t){if(I(e,t,i)){var n=R(t.details,i);n&&Object(_.isFiniteNumber)(n.start)&&(T.logger.log("Adjusting PTS using last level due to CC increase within current level "+i.url),b(n.start,i))}}(p,l,m),!l.alignedSliding&&m.details&&d(l,m.details),l.alignedSliding||!m.details||l.skippedSegments||Object(S.adjustSliding)(m.details,l))}function d(p,m){if(m.fragments.length&&p.hasProgramDateTime&&m.hasProgramDateTime){var l=m.fragments[0].programDateTime,e=p.fragments[0].programDateTime,i=(e-l)/1e3+m.fragments[0].start;i&&Object(_.isFiniteNumber)(i)&&(T.logger.log("Adjusting PTS using programDateTime delta "+(e-l)+"ms, sliding:"+i.toFixed(3)+" "+p.url+" "),b(i,p))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(F,C,f){f.r(C);var _=f("./src/utils/ewma.ts"),T=function(){function S(I,R,o){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=o,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new _.default(I),this.fast_=new _.default(R)}var D=S.prototype;return D.update=function(I,R){var o=this.slow_,b=this.fast_;this.slow_.halfLife!==I&&(this.slow_=new _.default(I,o.getEstimate(),o.getTotalWeight())),this.fast_.halfLife!==R&&(this.fast_=new _.default(R,b.getEstimate(),b.getTotalWeight()))},D.sample=function(I,R){var o=(I=Math.max(I,this.minDelayMs_))/1e3,b=8*R/o;this.fast_.sample(o,b),this.slow_.sample(o,b)},D.canEstimate=function(){var I=this.fast_;return I&&I.getTotalWeight()>=this.minWeight_},D.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},D.destroy=function(){},S}();C.default=T},"./src/utils/ewma.ts":function(F,C,f){f.r(C);var _=function(){function T(D,I,R){I===void 0&&(I=0),R===void 0&&(R=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=D,this.alpha_=D?Math.exp(Math.log(.5)/D):0,this.estimate_=I,this.totalWeight_=R}var S=T.prototype;return S.sample=function(D,I){var R=Math.pow(this.alpha_,D);this.estimate_=I*(1-R)+R*this.estimate_,this.totalWeight_+=D},S.getTotalWeight=function(){return this.totalWeight_},S.getEstimate=function(){if(this.alpha_){var D=1-Math.pow(this.alpha_,this.totalWeight_);if(D)return this.estimate_/D}return this.estimate_},T}();C.default=_},"./src/utils/fetch-loader.ts":function(F,C,f){f.r(C),f.d(C,"fetchSupported",function(){return y});var _=f("./src/polyfills/number.ts"),T=f("./src/loader/load-stats.ts"),S=f("./src/demux/chunk-cache.ts");function D(l){var e=typeof Map=="function"?new Map:void 0;return(D=function(i){if(i===null||(t=i,Function.toString.call(t).indexOf("[native code]")===-1))return i;var t;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(i))return e.get(i);e.set(i,n)}function n(){return I(i,arguments,b(this).constructor)}return n.prototype=Object.create(i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,i)})(l)}function I(l,e,i){return(I=R()?Reflect.construct:function(t,n,u){var a=[null];a.push.apply(a,n);var c=new(Function.bind.apply(t,a));return u&&o(c,u.prototype),c}).apply(null,arguments)}function R(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function o(l,e){return(o=Object.setPrototypeOf||function(i,t){return i.__proto__=t,i})(l,e)}function b(l){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(l)}function y(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var d=function(){function l(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||p,this.controller=new self.AbortController,this.stats=new T.LoadStats}var e=l.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var i=this.response;i&&i.ok||(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var i;this.abortInternal(),(i=this.callbacks)!==null&&i!==void 0&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(i,t,n){var u=this,a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();var c=function(r,s){var h={method:"GET",mode:"cors",credentials:"same-origin",signal:s};return r.rangeEnd&&(h.headers=new self.Headers({Range:"bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)})),h}(i,this.controller.signal),E=n.onProgress,g=i.responseType==="arraybuffer",v=g?"byteLength":"length";this.context=i,this.config=t,this.callbacks=n,this.request=this.fetchSetup(i,c),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){u.abortInternal(),n.onTimeout(a,i,u.response)},t.timeout),self.fetch(this.request).then(function(r){if(u.response=u.loader=r,!r.ok){var s=r.status,h=r.statusText;throw new m(h||"fetch, bad network response",s,r)}return a.loading.first=Math.max(self.performance.now(),a.loading.start),a.total=parseInt(r.headers.get("Content-Length")||"0"),E&&Object(_.isFiniteNumber)(t.highWaterMark)?u.loadProgressively(r,a,i,t.highWaterMark,E):g?r.arrayBuffer():r.text()}).then(function(r){var s=u.response;self.clearTimeout(u.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first),a.loaded=a.total=r[v];var h={url:s.url,data:r};E&&!Object(_.isFiniteNumber)(t.highWaterMark)&&E(a,i,r,s),n.onSuccess(h,a,i,s)}).catch(function(r){if(self.clearTimeout(u.requestTimeout),!a.aborted){var s=r.code||0;n.onError({code:s,text:r.message},i,r.details)}})},e.getCacheAge=function(){var i=null;if(this.response){var t=this.response.headers.get("age");i=t?parseFloat(t):null}return i},e.loadProgressively=function(i,t,n,u,a){u===void 0&&(u=0);var c=new S.default,E=i.body.getReader();return function g(){return E.read().then(function(v){if(v.done)return c.dataLength&&a(t,n,c.flush(),i),Promise.resolve(new ArrayBuffer(0));var r=v.value,s=r.length;return t.loaded+=s,s<u||c.dataLength?(c.push(r),c.dataLength>=u&&a(t,n,c.flush(),i)):a(t,n,r,i),g()}).catch(function(){return Promise.reject()})}()},l}();function p(l,e){return new self.Request(l.url,e)}var m=function(l){var e,i;function t(n,u,a){var c;return(c=l.call(this,n)||this).code=void 0,c.details=void 0,c.code=u,c.details=a,c}return i=l,(e=t).prototype=Object.create(i.prototype),e.prototype.constructor=e,o(e,i),t}(D(Error));C.default=d},"./src/utils/imsc1-ttml-parser.ts":function(F,C,f){f.r(C),f.d(C,"IMSC1_CODEC",function(){return b}),f.d(C,"parseIMSC1",function(){return m});var _=f("./src/utils/mp4-tools.ts"),T=f("./src/utils/vttparser.ts"),S=f("./src/utils/vttcue.ts"),D=f("./src/demux/id3.ts"),I=f("./src/utils/timescale-conversion.ts"),R=f("./src/utils/webvtt-parser.ts");function o(){return(o=Object.assign||function(a){for(var c=1;c<arguments.length;c++){var E=arguments[c];for(var g in E)Object.prototype.hasOwnProperty.call(E,g)&&(a[g]=E[g])}return a}).apply(this,arguments)}var b="stpp.ttml.im1t",y=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,d=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,p={left:"start",center:"center",right:"end",start:"start",end:"end"};function m(a,c,E,g,v){var r=Object(_.findBox)(new Uint8Array(a),["mdat"]);if(r.length!==0){var s=r[0],h=Object(D.utf8ArrayToStr)(new Uint8Array(a,s.start,s.end-s.start)),L=Object(I.toTimescaleFromScale)(c,1,E);try{g(function(k,A){var O=new DOMParser().parseFromString(k,"text/xml").getElementsByTagName("tt")[0];if(!O)throw new Error("Invalid ttml");var w={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},P=Object.keys(w).reduce(function(G,V){return G[V]=O.getAttribute("ttp:"+V)||w[V],G},{}),x=O.getAttribute("xml:space")!=="preserve",M=e(l(O,"styling","style")),N=e(l(O,"layout","region")),U=l(O,"body","[begin]");return[].map.call(U,function(G){var V=i(G,x);if(!V||!G.hasAttribute("begin"))return null;var W=u(G.getAttribute("begin"),P),Y=u(G.getAttribute("dur"),P),X=u(G.getAttribute("end"),P);if(W===null)throw n(G);if(X===null){if(Y===null)throw n(G);X=W+Y}var z=new S.default(W-A,X-A,V);z.id=Object(R.generateCueId)(z.startTime,z.endTime,z.text);var Z=N[G.getAttribute("region")],ne=M[G.getAttribute("style")];z.position=10,z.size=80;var oe=function(pe,te){var ae="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(ge,fe){var Le=t(te,ae,fe)||t(pe,ae,fe);return Le&&(ge[fe]=Le),ge},{})}(Z,ne),de=oe.textAlign;if(de){var re=p[de];re&&(z.lineAlign=re),z.align=de}return o(z,oe),z}).filter(function(G){return G!==null})}(h,L))}catch(k){v(k)}}else v(new Error("Could not parse IMSC1 mdat"))}function l(a,c,E){var g=a.getElementsByTagName(c)[0];return g?[].slice.call(g.querySelectorAll(E)):[]}function e(a){return a.reduce(function(c,E){var g=E.getAttribute("xml:id");return g&&(c[g]=E),c},{})}function i(a,c){return[].slice.call(a.childNodes).reduce(function(E,g,v){var r;return g.nodeName==="br"&&v?E+`
`:(r=g.childNodes)!==null&&r!==void 0&&r.length?i(g,c):c?E+g.textContent.trim().replace(/\s+/g," "):E+g.textContent},"")}function t(a,c,E){return a.hasAttributeNS(c,E)?a.getAttributeNS(c,E):null}function n(a){return new Error("Could not parse ttml timestamp "+a)}function u(a,c){if(!a)return null;var E=Object(T.parseTimeStamp)(a);return E===null&&(y.test(a)?E=function(g,v){var r=y.exec(g),s=(0|r[4])+(0|r[5])/v.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+s/v.frameRate}(a,c):d.test(a)&&(E=function(g,v){var r=d.exec(g),s=Number(r[1]);switch(r[2]){case"h":return 3600*s;case"m":return 60*s;case"ms":return 1e3*s;case"f":return s/v.frameRate;case"t":return s/v.tickRate}return s}(a,c))),E}},"./src/utils/logger.ts":function(F,C,f){f.r(C),f.d(C,"enableLogs",function(){return I}),f.d(C,"logger",function(){return R});var _=function(){},T={trace:_,debug:_,log:_,warn:_,info:_,error:_},S=T;function D(o){var b=self.console[o];return b?b.bind(self.console,"["+o+"] >"):_}function I(o){if(self.console&&o===!0||typeof o=="object"){(function(b){for(var y=arguments.length,d=new Array(y>1?y-1:0),p=1;p<y;p++)d[p-1]=arguments[p];d.forEach(function(m){S[m]=b[m]?b[m].bind(b):D(m)})})(o,"debug","log","info","warn","error");try{S.log()}catch{S=T}}else S=T}var R=T},"./src/utils/mediakeys-helper.ts":function(F,C,f){var _,T;f.r(C),f.d(C,"KeySystems",function(){return _}),f.d(C,"requestMediaKeySystemAccess",function(){return S}),(T=_||(_={})).WIDEVINE="com.widevine.alpha",T.PLAYREADY="com.microsoft.playready";var S=typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(F,C,f){function _(){return self.MediaSource||self.WebKitMediaSource}f.r(C),f.d(C,"getMediaSource",function(){return _})},"./src/utils/mp4-tools.ts":function(F,C,f){f.r(C),f.d(C,"bin2str",function(){return I}),f.d(C,"readUint16",function(){return R}),f.d(C,"readUint32",function(){return o}),f.d(C,"writeUint32",function(){return b}),f.d(C,"findBox",function(){return y}),f.d(C,"parseSegmentIndex",function(){return d}),f.d(C,"parseInitSegment",function(){return p}),f.d(C,"getStartDTS",function(){return m}),f.d(C,"getDuration",function(){return l}),f.d(C,"computeRawDurationFromSamples",function(){return e}),f.d(C,"offsetStartDTS",function(){return i}),f.d(C,"segmentValidRange",function(){return t}),f.d(C,"appendUint8Array",function(){return n});var _=f("./src/utils/typed-array.ts"),T=f("./src/loader/fragment.ts"),S=Math.pow(2,32)-1,D=[].push;function I(u){return String.fromCharCode.apply(null,u)}function R(u,a){"data"in u&&(a+=u.start,u=u.data);var c=u[a]<<8|u[a+1];return c<0?65536+c:c}function o(u,a){"data"in u&&(a+=u.start,u=u.data);var c=u[a]<<24|u[a+1]<<16|u[a+2]<<8|u[a+3];return c<0?4294967296+c:c}function b(u,a,c){"data"in u&&(a+=u.start,u=u.data),u[a]=c>>24,u[a+1]=c>>16&255,u[a+2]=c>>8&255,u[a+3]=255&c}function y(u,a){var c,E,g,v=[];if(!a.length)return v;"data"in u?(c=u.data,E=u.start,g=u.end):(E=0,g=(c=u).byteLength);for(var r=E;r<g;){var s=o(c,r),h=s>1?r+s:g;if(I(c.subarray(r+4,r+8))===a[0])if(a.length===1)v.push({data:c,start:r+8,end:h});else{var L=y({data:c,start:r+8,end:h},a.slice(1));L.length&&D.apply(v,L)}r=h}return v}function d(u){var a=y(u,["moov"])[0],c=a?a.end:null,E=y(u,["sidx"]);if(!E||!E[0])return null;var g=[],v=E[0],r=v.data[0],s=r===0?8:16,h=o(v,s);s+=4,s+=r===0?8:16,s+=2;var L=v.end+0,k=R(v,s);s+=2;for(var A=0;A<k;A++){var O=s,w=o(v,O);O+=4;var P=2147483647&w;if((2147483648&w)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var x=o(v,O);O+=4,g.push({referenceSize:P,subsegmentDuration:x,info:{duration:x/h,start:L,end:L+P-1}}),L+=P,s=O+=4}return{earliestPresentationTime:0,timescale:h,version:r,referencesCount:k,references:g,moovEndOffset:c}}function p(u){for(var a=[],c=y(u,["moov","trak"]),E=0;E<c.length;E++){var g=c[E],v=y(g,["tkhd"])[0];if(v){var r=v.data[v.start],s=r===0?12:20,h=o(v,s),L=y(g,["mdia","mdhd"])[0];if(L){var k=o(L,s=(r=L.data[L.start])===0?12:20),A=y(g,["mdia","hdlr"])[0];if(A){var O=I(A.data.subarray(A.start+8,A.start+12)),w={soun:T.ElementaryStreamTypes.AUDIO,vide:T.ElementaryStreamTypes.VIDEO}[O];if(w){var P=y(g,["mdia","minf","stbl","stsd"])[0],x=void 0;P&&(x=I(P.data.subarray(P.start+12,P.start+16))),a[h]={timescale:k,type:w},a[w]={timescale:k,id:h,codec:x}}}}}}return y(u,["moov","mvex","trex"]).forEach(function(M){var N=o(M,4),U=a[N];U&&(U.default={duration:o(M,12),flags:o(M,20)})}),a}function m(u,a){return y(a,["moof","traf"]).reduce(function(c,E){var g=y(E,["tfdt"])[0],v=g.data[g.start],r=y(E,["tfhd"]).reduce(function(s,h){var L=o(h,4),k=u[L];if(k){var A=o(g,4);v===1&&(A*=Math.pow(2,32),A+=o(g,8));var O=A/(k.timescale||9e4);if(isFinite(O)&&(s===null||O<s))return O}return s},null);return r!==null&&isFinite(r)&&(c===null||r<c)?r:c},null)||0}function l(u,a){for(var c=0,E=0,g=0,v=y(u,["moof","traf"]),r=0;r<v.length;r++){var s=v[r],h=y(s,["tfhd"])[0],L=a[o(h,4)];if(L){var k=L.default,A=o(h,0)|(k==null?void 0:k.flags),O=k==null?void 0:k.duration;8&A&&(O=o(h,2&A?12:8));for(var w=L.timescale||9e4,P=y(s,["trun"]),x=0;x<P.length;x++)c=O?O*o(P[x],4):e(P[x]),L.type===T.ElementaryStreamTypes.VIDEO?E+=c/w:L.type===T.ElementaryStreamTypes.AUDIO&&(g+=c/w)}}if(E===0&&g===0){var M=d(u);if(M!=null&&M.references)return M.references.reduce(function(N,U){return N+U.info.duration||0},0)}return E||g}function e(u){var a=o(u,0),c=8;1&a&&(c+=4),4&a&&(c+=4);for(var E=0,g=o(u,4),v=0;v<g;v++)256&a&&(E+=o(u,c),c+=4),512&a&&(c+=4),1024&a&&(c+=4),2048&a&&(c+=4);return E}function i(u,a,c){y(a,["moof","traf"]).forEach(function(E){y(E,["tfhd"]).forEach(function(g){var v=o(g,4),r=u[v];if(r){var s=r.timescale||9e4;y(E,["tfdt"]).forEach(function(h){var L=h.data[h.start],k=o(h,4);if(L===0)b(h,4,k-c*s);else{k*=Math.pow(2,32),k+=o(h,8),k-=c*s,k=Math.max(k,0);var A=Math.floor(k/(S+1)),O=Math.floor(k%(S+1));b(h,4,A),b(h,8,O)}})}})})}function t(u){var a={valid:null,remainder:null},c=y(u,["moof"]);if(!c)return a;if(c.length<2)return a.remainder=u,a;var E=c[c.length-1];return a.valid=Object(_.sliceUint8)(u,0,E.start-8),a.remainder=Object(_.sliceUint8)(u,E.start-8),a}function n(u,a){var c=new Uint8Array(u.length+a.length);return c.set(u),c.set(a,u.length),c}},"./src/utils/output-filter.ts":function(F,C,f){f.r(C),f.d(C,"default",function(){return _});var _=function(){function T(D,I){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=D,this.trackName=I}var S=T.prototype;return S.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},S.newCue=function(D,I,R){(this.startTime===null||this.startTime>D)&&(this.startTime=D),this.endTime=I,this.screen=R,this.timelineController.createCaptionsTrack(this.trackName)},S.reset=function(){this.cueRanges=[]},T}()},"./src/utils/texttrack-utils.ts":function(F,C,f){f.r(C),f.d(C,"sendAddTrackEvent",function(){return T}),f.d(C,"addCueToTrack",function(){return S}),f.d(C,"clearCurrentCues",function(){return D}),f.d(C,"removeCuesInRange",function(){return I}),f.d(C,"getCuesInRange",function(){return R});var _=f("./src/utils/logger.ts");function T(o,b){var y;try{y=new Event("addtrack")}catch{(y=document.createEvent("Event")).initEvent("addtrack",!1,!1)}y.track=o,b.dispatchEvent(y)}function S(o,b){var y=o.mode;if(y==="disabled"&&(o.mode="hidden"),o.cues&&!o.cues.getCueById(b.id))try{if(o.addCue(b),!o.cues.getCueById(b.id))throw new Error("addCue is failed for: "+b)}catch(p){_.logger.debug("[texttrack-utils]: "+p);var d=new self.TextTrackCue(b.startTime,b.endTime,b.text);d.id=b.id,o.addCue(d)}y==="disabled"&&(o.mode=y)}function D(o){var b=o.mode;if(b==="disabled"&&(o.mode="hidden"),o.cues)for(var y=o.cues.length;y--;)o.removeCue(o.cues[y]);b==="disabled"&&(o.mode=b)}function I(o,b,y){var d=o.mode;if(d==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0)for(var p=R(o.cues,b,y),m=0;m<p.length;m++)o.removeCue(p[m]);d==="disabled"&&(o.mode=d)}function R(o,b,y){var d=[],p=function(i,t){if(t<i[0].startTime)return 0;var n=i.length-1;if(t>i[n].endTime)return-1;for(var u=0,a=n;u<=a;){var c=Math.floor((a+u)/2);if(t<i[c].startTime)a=c-1;else{if(!(t>i[c].startTime&&u<n))return c;u=c+1}}return i[u].startTime-t<t-i[a].startTime?u:a}(o,b);if(p>-1)for(var m=p,l=o.length;m<l;m++){var e=o[m];if(e.startTime>=b&&e.endTime<=y)d.push(e);else if(e.startTime>y)return d}return d}},"./src/utils/time-ranges.ts":function(F,C,f){f.r(C),C.default={toString:function(_){for(var T="",S=_.length,D=0;D<S;D++)T+="["+_.start(D).toFixed(3)+","+_.end(D).toFixed(3)+"]";return T}}},"./src/utils/timescale-conversion.ts":function(F,C,f){function _(I,R,o,b){o===void 0&&(o=1),b===void 0&&(b=!1);var y=I*R*o;return b?Math.round(y):y}function T(I,R,o,b){return o===void 0&&(o=1),b===void 0&&(b=!1),_(I,R,1/o,b)}function S(I,R){return R===void 0&&(R=!1),_(I,1e3,1/9e4,R)}function D(I,R){return R===void 0&&(R=1),_(I,9e4,1/R)}f.r(C),f.d(C,"toTimescaleFromBase",function(){return _}),f.d(C,"toTimescaleFromScale",function(){return T}),f.d(C,"toMsFromMpegTsClock",function(){return S}),f.d(C,"toMpegTsClockFromTimescale",function(){return D})},"./src/utils/typed-array.ts":function(F,C,f){function _(T,S,D){return Uint8Array.prototype.slice?T.slice(S,D):new Uint8Array(Array.prototype.slice.call(T,S,D))}f.r(C),f.d(C,"sliceUint8",function(){return _})},"./src/utils/vttcue.ts":function(F,C,f){f.r(C),C.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var _=["","lr","rl"],T=["start","middle","end","left","right"];function S(o,b){if(typeof b!="string"||!Array.isArray(o))return!1;var y=b.toLowerCase();return!!~o.indexOf(y)&&y}function D(o){return S(T,o)}function I(o){for(var b=arguments.length,y=new Array(b>1?b-1:0),d=1;d<b;d++)y[d-1]=arguments[d];for(var p=1;p<arguments.length;p++){var m=arguments[p];for(var l in m)o[l]=m[l]}return o}function R(o,b,y){var d=this,p={enumerable:!0};d.hasBeenReset=!1;var m="",l=!1,e=o,i=b,t=y,n=null,u="",a=!0,c="auto",E="start",g=50,v="middle",r=50,s="middle";Object.defineProperty(d,"id",I({},p,{get:function(){return m},set:function(h){m=""+h}})),Object.defineProperty(d,"pauseOnExit",I({},p,{get:function(){return l},set:function(h){l=!!h}})),Object.defineProperty(d,"startTime",I({},p,{get:function(){return e},set:function(h){if(typeof h!="number")throw new TypeError("Start time must be set to a number.");e=h,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",I({},p,{get:function(){return i},set:function(h){if(typeof h!="number")throw new TypeError("End time must be set to a number.");i=h,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",I({},p,{get:function(){return t},set:function(h){t=""+h,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",I({},p,{get:function(){return n},set:function(h){n=h,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",I({},p,{get:function(){return u},set:function(h){var L=function(k){return S(_,k)}(h);if(L===!1)throw new SyntaxError("An invalid or illegal string was specified.");u=L,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",I({},p,{get:function(){return a},set:function(h){a=!!h,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",I({},p,{get:function(){return c},set:function(h){if(typeof h!="number"&&h!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");c=h,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",I({},p,{get:function(){return E},set:function(h){var L=D(h);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");E=L,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",I({},p,{get:function(){return g},set:function(h){if(h<0||h>100)throw new Error("Position must be between 0 and 100.");g=h,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",I({},p,{get:function(){return v},set:function(h){var L=D(h);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");v=L,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",I({},p,{get:function(){return r},set:function(h){if(h<0||h>100)throw new Error("Size must be between 0 and 100.");r=h,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",I({},p,{get:function(){return s},set:function(h){var L=D(h);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");s=L,this.hasBeenReset=!0}})),d.displayState=void 0}return R.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},R}()},"./src/utils/vttparser.ts":function(F,C,f){f.r(C),f.d(C,"parseTimeStamp",function(){return S}),f.d(C,"fixLineBreaks",function(){return y}),f.d(C,"VTTParser",function(){return d});var _=f("./src/utils/vttcue.ts"),T=function(){function p(){}return p.prototype.decode=function(m,l){if(!m)return"";if(typeof m!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(m))},p}();function S(p){function m(e,i,t,n){return 3600*(0|e)+60*(0|i)+(0|t)+parseFloat(n||0)}var l=p.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return l?parseFloat(l[2])>59?m(l[2],l[3],0,l[4]):m(l[1],l[2],l[3],l[4]):null}var D=function(){function p(){this.values=Object.create(null)}var m=p.prototype;return m.set=function(l,e){this.get(l)||e===""||(this.values[l]=e)},m.get=function(l,e,i){return i?this.has(l)?this.values[l]:e[i]:this.has(l)?this.values[l]:e},m.has=function(l){return l in this.values},m.alt=function(l,e,i){for(var t=0;t<i.length;++t)if(e===i[t]){this.set(l,e);break}},m.integer=function(l,e){/^-?\d+$/.test(e)&&this.set(l,parseInt(e,10))},m.percent=function(l,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var i=parseFloat(e);if(i>=0&&i<=100)return this.set(l,i),!0}return!1},p}();function I(p,m,l,e){var i=e?p.split(e):[p];for(var t in i)if(typeof i[t]=="string"){var n=i[t].split(l);n.length===2&&m(n[0],n[1])}}var R=new _.default(0,0,""),o=R.align==="middle"?"middle":"center";function b(p,m,l){var e=p;function i(){var n=S(p);if(n===null)throw new Error("Malformed timestamp: "+e);return p=p.replace(/^[^\sa-zA-Z-]+/,""),n}function t(){p=p.replace(/^\s+/,"")}if(t(),m.startTime=i(),t(),p.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+e);p=p.substr(3),t(),m.endTime=i(),t(),function(n,u){var a=new D;I(n,function(g,v){var r;switch(g){case"region":for(var s=l.length-1;s>=0;s--)if(l[s].id===v){a.set(g,l[s].region);break}break;case"vertical":a.alt(g,v,["rl","lr"]);break;case"line":r=v.split(","),a.integer(g,r[0]),a.percent(g,r[0])&&a.set("snapToLines",!1),a.alt(g,r[0],["auto"]),r.length===2&&a.alt("lineAlign",r[1],["start",o,"end"]);break;case"position":r=v.split(","),a.percent(g,r[0]),r.length===2&&a.alt("positionAlign",r[1],["start",o,"end","line-left","line-right","auto"]);break;case"size":a.percent(g,v);break;case"align":a.alt(g,v,["start",o,"end","left","right"])}},/:/,/\s/),u.region=a.get("region",null),u.vertical=a.get("vertical","");var c=a.get("line","auto");c==="auto"&&R.line===-1&&(c=-1),u.line=c,u.lineAlign=a.get("lineAlign","start"),u.snapToLines=a.get("snapToLines",!0),u.size=a.get("size",100),u.align=a.get("align",o);var E=a.get("position","auto");E==="auto"&&R.position===50&&(E=u.align==="start"||u.align==="left"?0:u.align==="end"||u.align==="right"?100:50),u.position=E}(p,m)}function y(p){return p.replace(/<br(?: \/)?>/gi,`
`)}var d=function(){function p(){this.state="INITIAL",this.buffer="",this.decoder=new T,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var m=p.prototype;return m.parse=function(l){var e=this;function i(){var c=e.buffer,E=0;for(c=y(c);E<c.length&&c[E]!=="\r"&&c[E]!==`
`;)++E;var g=c.substr(0,E);return c[E]==="\r"&&++E,c[E]===`
`&&++E,e.buffer=c.substr(E),g}l&&(e.buffer+=e.decoder.decode(l,{stream:!0}));try{var t="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;var n=(t=i()).match(/^()?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var u=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(u?u=!1:t=i(),e.state){case"HEADER":/:/.test(t)?I(t,function(c,E){},/:/):t||(e.state="ID");continue;case"NOTE":t||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(t)){e.state="NOTE";break}if(!t)continue;if(e.cue=new _.default(0,0,""),e.state="CUE",t.indexOf("-->")===-1){e.cue.id=t;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{b(t,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var a=t.indexOf("-->")!==-1;if(!t||a&&(u=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=t;continue;case"BADCUE":t||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},m.flush=function(){var l=this;try{if((l.cue||l.state==="HEADER")&&(l.buffer+=`

`,l.parse()),l.state==="INITIAL"||l.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){l.onparsingerror&&l.onparsingerror(e)}return l.onflush&&l.onflush(),this},p}()},"./src/utils/webvtt-parser.ts":function(F,C,f){f.r(C),f.d(C,"generateCueId",function(){return y}),f.d(C,"parseWebVTT",function(){return d});var _=f("./src/polyfills/number.ts"),T=f("./src/utils/vttparser.ts"),S=f("./src/demux/id3.ts"),D=f("./src/utils/timescale-conversion.ts"),I=f("./src/remux/mp4-remuxer.ts"),R=/\r\n|\n\r|\n|\r/g,o=function(p,m,l){return l===void 0&&(l=0),p.substr(l,m.length)===m},b=function(p){for(var m=5381,l=p.length;l;)m=33*m^p.charCodeAt(--l);return(m>>>0).toString()};function y(p,m,l){return b(p.toString())+b(m.toString())+b(l)}function d(p,m,l,e,i,t,n,u){var a,c=new T.VTTParser,E=Object(S.utf8ArrayToStr)(new Uint8Array(p)).trim().replace(R,`
`).split(`
`),g=[],v=Object(D.toMpegTsClockFromTimescale)(m,l),r="00:00.000",s=0,h=0,L=!0,k=!1;c.oncue=function(A){var O=e[i],w=e.ccOffset,P=(s-v)/9e4;if(O!=null&&O.new&&(h!==void 0?w=e.ccOffset=O.start:function(U,G,V){var W=U[G],Y=U[W.prevCC];if(!Y||!Y.new&&W.new)return U.ccOffset=U.presentationOffset=W.start,void(W.new=!1);for(;(X=Y)!==null&&X!==void 0&&X.new;){var X;U.ccOffset+=W.start-Y.start,W.new=!1,Y=U[(W=Y).prevCC]}U.presentationOffset=V}(e,i,P)),P&&(w=P-e.presentationOffset),k){var x=A.endTime-A.startTime,M=Object(I.normalizePts)(9e4*(A.startTime+w-h),9e4*t)/9e4;A.startTime=M,A.endTime=M+x}var N=A.text.trim();A.text=decodeURIComponent(encodeURIComponent(N)),A.id||(A.id=y(A.startTime,A.endTime,N)),A.endTime>0&&g.push(A)},c.onparsingerror=function(A){a=A},c.onflush=function(){a?u(a):n(g)},E.forEach(function(A){if(L){if(o(A,"X-TIMESTAMP-MAP=")){L=!1,k=!0,A.substr(16).split(",").forEach(function(O){o(O,"LOCAL:")?r=O.substr(6):o(O,"MPEGTS:")&&(s=parseInt(O.substr(7)))});try{h=function(O){var w=parseInt(O.substr(-3)),P=parseInt(O.substr(-6,2)),x=parseInt(O.substr(-9,2)),M=O.length>9?parseInt(O.substr(0,O.indexOf(":"))):0;if(!(Object(_.isFiniteNumber)(w)&&Object(_.isFiniteNumber)(P)&&Object(_.isFiniteNumber)(x)&&Object(_.isFiniteNumber)(M)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+O);return w+=1e3*P,(w+=6e4*x)+36e5*M}(r)/1e3}catch(O){k=!1,a=O}return}A===""&&(L=!1)}c.parse(A+`
`)}),c.flush()}},"./src/utils/xhr-loader.ts":function(F,C,f){f.r(C);var _=f("./src/utils/logger.ts"),T=f("./src/loader/load-stats.ts"),S=/^age:\s*[\d.]+\s*$/m,D=function(){function I(o){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=o?o.xhrSetup:null,this.stats=new T.LoadStats,this.retryDelay=0}var R=I.prototype;return R.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},R.abortInternal=function(){var o=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),o&&(o.onreadystatechange=null,o.onprogress=null,o.readyState!==4&&(this.stats.aborted=!0,o.abort()))},R.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},R.load=function(o,b,y){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=o,this.config=b,this.callbacks=y,this.retryDelay=b.retryDelay,this.loadInternal()},R.loadInternal=function(){var o=this.config,b=this.context;if(o){var y=this.loader=new self.XMLHttpRequest,d=this.stats;d.loading.first=0,d.loaded=0;var p=this.xhrSetup;try{if(p)try{p(y,b.url)}catch{y.open("GET",b.url,!0),p(y,b.url)}y.readyState||y.open("GET",b.url,!0)}catch(m){return void this.callbacks.onError({code:y.status,text:m.message},b,y)}b.rangeEnd&&y.setRequestHeader("Range","bytes="+b.rangeStart+"-"+(b.rangeEnd-1)),y.onreadystatechange=this.readystatechange.bind(this),y.onprogress=this.loadprogress.bind(this),y.responseType=b.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout),y.send()}},R.readystatechange=function(){var o=this.context,b=this.loader,y=this.stats;if(o&&b){var d=b.readyState,p=this.config;if(!y.aborted&&d>=2)if(self.clearTimeout(this.requestTimeout),y.loading.first===0&&(y.loading.first=Math.max(self.performance.now(),y.loading.start)),d===4){b.onreadystatechange=null,b.onprogress=null;var m=b.status;if(m>=200&&m<300){var l,e;if(y.loading.end=Math.max(self.performance.now(),y.loading.first),e=o.responseType==="arraybuffer"?(l=b.response).byteLength:(l=b.responseText).length,y.loaded=y.total=e,!this.callbacks)return;var i=this.callbacks.onProgress;if(i&&i(y,o,l,b),!this.callbacks)return;var t={url:b.responseURL,data:l};this.callbacks.onSuccess(t,y,o,b)}else y.retry>=p.maxRetry||m>=400&&m<499?(_.logger.error(m+" while loading "+o.url),this.callbacks.onError({code:m,text:b.statusText},o,b)):(_.logger.warn(m+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,p.maxRetryDelay),y.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),p.timeout)}},R.loadtimeout=function(){_.logger.warn("timeout while loading "+this.context.url);var o=this.callbacks;o&&(this.abortInternal(),o.onTimeout(this.stats,this.context,this.loader))},R.loadprogress=function(o){var b=this.stats;b.loaded=o.loaded,o.lengthComputable&&(b.total=o.total)},R.getCacheAge=function(){var o=null;if(this.loader&&S.test(this.loader.getAllResponseHeaders())){var b=this.loader.getResponseHeader("age");o=b?parseFloat(b):null}return o},I}();C.default=D}}).default);var gt=Dn(er.exports);const Rn={name:"d-icon"},Ce=Object.assign(Rn,{props:{icon:String,size:[Number,String]},setup:function(F){const C=F,f=le(()=>({fontSize:/^\d+$/.test(C.size)?C.size+"px":C.size}));return(_,T)=>(H(),q("i",{class:J(["d-icon iconfont",F.icon]),style:Te(B(f))},null,6))}});Ce.__scopeId="data-v-0c690e66";je("data-v-4cb76d59");const Cn={class:"d-player-top"},In={class:"top-title"},wn={class:"top-title"};Ve();const On={props:{title:{default:""}},setup(F){Date.prototype.format=function(_){let T={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var S in T)new RegExp("("+S+")").test(_)&&(_=_.replace(RegExp.$1,RegExp.$1.length==1?T[S]:("00"+T[S]).substr((""+T[S]).length)));return _};let C=se("00:00:00");C.value=new Date().format("hh:mm:ss");let f=null;return f=setInterval(()=>{C.value=new Date().format("hh:mm:ss")},1e3),Vt(()=>{clearInterval(f)}),(_,T)=>(H(),q("div",Cn,[j("p",In,ie(F.title||""),1),j("p",wn,ie(B(C)),1)]))},__scopeId:"data-v-4cb76d59"};je("data-v-ac2469ec");const Fn={class:"d-status"},Pn={class:"d-flex-center"},xn={class:"d-flex-center"},Mn=ee("5X\u901F\u64AD\u653E\u4E2D ");Ve();var tr=ve({props:["state"],setup:F=>(C,f)=>me((H(),q("div",Fn,[me(j("li",Pn,[K(Ce,{size:"18",class:"d-status-icon",icon:"icon-volume-"+(F.state.volume==0?"mute":F.state.volume>.5?"up":"down")},null,8,["icon"]),ee(" "+ie(~~(100*F.state.volume))+"% ",1)],512),[[Se,F.state.handleType=="volume"]]),me(j("li",xn,[K(Ce,{size:"12",icon:"icon-play"}),K(Ce,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),Mn],512),[[Se,F.state.handleType=="playbackRate"||F.state.isMultiplesPlay]])],512)),[[Se,F.state.handleType||F.state.isMultiplesPlay]])});tr.__scopeId="data-v-ac2469ec",je("data-v-385f7870");const Nn=["checked","true-value","false-value"],Bn=j("span",{class:"d-switch_action"},null,-1);Ve();var dt=ve({props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(F,{emit:C}){const f=F;kt(D=>({"014e5dc0":F.width,e4e32852:F.activeColor}));const _=se(null),T=le(()=>f.modelValue===f.trueValue),S=()=>{ft(()=>{const D=_.value.checked;C("update:modelValue",D),C("change",D)})};return(D,I)=>(H(),q("div",{class:J(["d-switch",{"is-checked":B(T)}])},[j("input",{class:"d-switch__input",ref:_,type:"checkbox",checked:B(T),onChange:S,"true-value":F.trueValue,"false-value":F.falseValue},null,40,Nn),Bn],2))}});dt.__scopeId="data-v-385f7870",je("data-v-b2384226");const Un={key:0},Gn=j("i",{class:"rotating iconfont icon-loading f50"},null,-1),jn=[j("i",{class:"rotating iconfont icon-loading f50"},null,-1),j("p",null,"\u6B63\u5728\u7F13\u51B2...",-1)],Vn=[j("i",{class:"iconfont icon-replay f24 mr5"},null,-1),ee("\u91CD\u65B0\u64AD\u653E ")],Kn=[j("i",{class:"iconfont icon-replay f24 mr5"},null,-1),ee("\u8BF7\u6C42\u9519\u8BEF ")];Ve();var rr=ve({props:{loadType:String,text:{type:String,default:""}},setup(F){const C=F,{proxy:f}=Mr(),_=["loadstart","waiting","ended","error","stalled"],T=()=>{f.$parent.play()},S=le(()=>{let D="background: rgba(0, 0, 0, .1);z-index:1";return C.loadType=="loadstart"&&(D="background: rgba(0, 0, 0, 1);;z-index:3"),D});return(D,I)=>me((H(),q("div",{class:"d-loading",style:Te(B(S))},[j("div",null,[F.loadType=="loadstart"?(H(),q("span",Un,[Gn,j("p",null,ie(F.text),1)])):Q("",!0),me(j("span",null,jn,512),[[Se,F.loadType=="waiting"]]),me(j("span",null,[j("p",{onClick:T,class:"d-flex-x d-pointer"},Vn)],512),[[Se,F.loadType=="ended"]]),me(j("span",null,[j("p",{onClick:T,class:"d-flex-x d-pointer"},Kn)],512),[[Se,F.loadType=="error"||F.loadType=="stalled"]])])],4)),[[Se,_.includes(F.loadType)]])}});rr.__scopeId="data-v-b2384226";const qe=function(F,C,f,_=!1){F&&C&&f&&F.addEventListener(C,f,_)},ke=function(F,C,f,_=!1){F&&C&&f&&F.removeEventListener(C,f,_)};je("data-v-5a794390");const Hn=["onMousedown"];Ve();var et=ve(Tt(Et({},{name:"DSlider"}),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup:function(F,{emit:C}){const f=F;kt(e=>({"5242b67b":F.size}));const _=se(null),T=se(null),S=rt({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),D=le(()=>{let e=f.modelValue<0?0:f.modelValue>1?1:f.modelValue;return f.vertical?`height:${100*e}%`:`width:${100*e}%`}),I=le(()=>{let e=f.preload<0?0:f.preload>1?1:f.preload;return f.vertical?`height:${100*e}%`:`width:${100*e}%`}),R=le(()=>{let e=S.hoverPosition<0?0:S.hoverPosition>1?1:S.hoverPosition;return f.vertical?`bottom:${100*e}%`:`left:${100*e}%`}),o=e=>{e.preventDefault()},b=e=>{f.disabled||(e.preventDefault(),S.dragging=!0,d(e),qe(window,"mousemove",m),qe(window,"touchmove",m),qe(window,"mouseup",l),qe(window,"touchend",l))},y=e=>{if(!f.hover)return;let i=p(e);if(C("onMousemove",e,i),S.hoverPosition=i,f.vertical)return;let t=_.value,n=T.value.clientWidth/2,u=e.clientX-t.getBoundingClientRect().left;u<n?S.hoverTipsLeft=n-u+"px":t.clientWidth-u<n?S.hoverTipsLeft=t.clientWidth-u-n+"px":S.hoverTipsLeft="50%"},d=e=>{let i=p(e);C("update:modelValue",i),C("change",e,i)},p=e=>{let i=_.value,t=0;if(f.vertical){let n=i.clientHeight;t=(i.getBoundingClientRect().bottom-e.clientY)/n}else t=(e.clientX-i.getBoundingClientRect().left)/i.clientWidth;return t<0?0:t>1?1:t},m=e=>{d(e)},l=e=>{S.dragging&&(ke(window,"mousemove",m),ke(window,"touchmove",m),ke(window,"mouseup",l),ke(window,"touchend",l),ke(window,"contextmenu",l),setTimeout(()=>{S.dragging=!1},0))};return(e,i)=>(H(),q("div",{ref:_,class:J(["d-slider",{"is-vertical":f.vertical}]),onMousedown:Re(b,["stop"]),onContextmenu:o},[j("div",{class:"d-slider__runway",onMousemove:y},[me(j("div",{class:"d-slider__cursor",style:Te(B(R))},[me(j("div",{class:"d-slider__tips",ref:T,style:Te({left:B(S).hoverTipsLeft})},ie(f.hoverText),5),[[Se,f.hoverText]])],4),[[Se,f.hover]]),j("div",{class:"d-slider__preload",style:Te(B(I))},null,4),j("div",{class:"d-slider__bar",style:Te(B(D))},null,4)],32)],42,Hn))}}));et.__scopeId="data-v-5a794390";je("data-v-570fa0d1");const Wn={key:0,class:"d-player-dialog"},$n={class:"d-player-dialog-body"},qn={class:"d-player-dialog-title"},Yn={class:"d-player-hotkey-panel"},zn={class:"d-player-filter-panel"},Xn={class:"d-player-filter-panel-item"},Qn=j("span",null,"\u9971\u548C\u5EA6",-1),Zn={class:"d-player-filter-panel-item"},Jn=j("span",null,"\u4EAE\u5EA6",-1),ea={class:"d-player-filter-panel-item"},ta=j("span",null,"\u5BF9\u6BD4\u5EA6",-1),ra={key:0,class:"d-player-contextmenu"},ia=["dplayerKeyCode"],na=j("input",{class:"d-player-copyText"},null,-1);Ve();var ir=ve({setup(F){const C=rt({show:!1,dialogType:"",dialogTitle:"",version:"1.3.1-beta.6",mouseX:0,mouseY:0}),f=[{label:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",key:"filter"},{label:"\u5FEB\u6377\u952E\u8BF4\u660E",key:"hotkey"},{label:"\u590D\u5236\u89C6\u9891\u7F51\u5740",key:"copy"},{label:"\u7248\u672C\uFF1A1.3.1-beta.6",key:"version"}],_=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u90005s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"},{key:"Esc",label:"\u9000\u51FA\u5168\u5C4F/\u9000\u51FA\u7F51\u9875\u5168\u5C4F"},{key:"F",label:"\u5168\u5C4F/\u9000\u51FA\u5168\u5C4F"}],T=rt({saturate:.392,brightness:.392,contrast:.392}),S=le(()=>({left:C.mouseX+"px",top:C.mouseY+"px"}));Ge(T,b=>{let y=document.querySelector("#dPlayerVideo"),d=(2.55*b.saturate).toFixed(2),p=(2.55*b.brightness).toFixed(2),m=(2.55*b.contrast).toFixed(2);y.style.filter=`saturate(${d}) brightness(${p}) contrast(${m})`});const D=()=>{T.saturate=.392,T.brightness=.392,T.contrast=.392},I=b=>{b.key=="Escape"&&o(0)},R=b=>{b.preventDefault(),qe(window,"keydown",I),qe(window,"click",o);let y=document.querySelector("#refPlayerWrap"),d=y.clientWidth;y.clientHeight,C.mouseX=b.clientX-y.getBoundingClientRect().left,d-C.mouseX<130&&(C.mouseX=C.mouseX+(d-C.mouseX-130)),C.mouseY=b.clientY-y.getBoundingClientRect().top,C.show=!0},o=b=>{let y=b.path[0].tagName=="LI",d=b.path[0].attributes.dplayerKeyCode&&b.path[0].attributes.dplayerKeyCode.value,p=f.map(m=>m.key);if(y&&p.includes(d))if(C.dialogTitle=b.path[0].innerText,C.dialogType=d,d=="copy"){let m=document.querySelector(".d-player-copyText");m.value=window.location.href,m.select(),document.execCommand("copy"),C.dialogType=""}else d=="version"&&(C.dialogType="");C.show=!1,ke(window,"keydown",I),ke(window,"click",o)};return Lt(()=>{let b=document.querySelector("#refPlayerWrap");ke(window,"keydown",I),ke(window,"click",o),ke(b,"contextmenu",R),qe(b,"contextmenu",R)}),Vt(()=>{let b=document.querySelector("#refPlayerWrap");ke(window,"keydown",I),ke(window,"click",o),ke(b,"contextmenu",R)}),(b,y)=>(H(),q("div",null,[K(yt,{name:"d-fade-in"},{default:$(()=>[B(C).dialogType?(H(),q("div",Wn,[j("div",$n,[j("h5",qn,[ee(ie(B(C).dialogTitle)+" ",1),j("i",{onClick:y[0]||(y[0]=d=>B(C).dialogType=!1),class:"icon icon-close"},"X")]),me(j("ul",Yn,[(H(),q(Ae,null,Pe(_,d=>j("li",{class:"d-player-hotkey-panel-item",key:d.key},[j("span",null,ie(d.key),1),j("span",null,ie(d.label),1)])),64))],512),[[Se,B(C).dialogType=="hotkey"]]),me(j("ul",zn,[j("li",Xn,[Qn,K(et,{class:"filter-panel-slider",size:"5px",modelValue:B(T).saturate,"onUpdate:modelValue":y[1]||(y[1]=d=>B(T).saturate=d)},null,8,["modelValue"]),j("span",null,ie(Math.round(255*B(T).saturate)),1)]),j("li",Zn,[Jn,K(et,{class:"filter-panel-slider",size:"5px",modelValue:B(T).brightness,"onUpdate:modelValue":y[2]||(y[2]=d=>B(T).brightness=d)},null,8,["modelValue"]),j("span",null,ie(Math.round(255*B(T).brightness)),1)]),j("li",ea,[ta,K(et,{class:"filter-panel-slider",size:"5px",modelValue:B(T).contrast,"onUpdate:modelValue":y[3]||(y[3]=d=>B(T).contrast=d)},null,8,["modelValue"]),j("span",null,ie(Math.round(255*B(T).contrast)),1)]),j("span",{onClick:D,title:"\u91CD\u7F6E","aria-label":"\u91CD\u7F6E",class:"d-player-filter-reset"},"\u91CD\u7F6E")],512),[[Se,B(C).dialogType=="filter"]])])])):Q("",!0)]),_:1}),B(C).show?(H(),q("div",ra,[j("ul",{class:"d-player-contextmenu-body",style:Te(B(S))},[(H(),q(Ae,null,Pe(f,d=>j("li",{dplayerKeyCode:d.key,key:d.key},ie(d.label),9,ia)),64))],4),na])):Q("",!0)]))}});ir.__scopeId="data-v-570fa0d1";const pt=F=>{let C=~~(F/3600),f=~~(F%3600/60),_=~~(F%60);return C=C<10?"0"+C:C,f=f<10?"0"+f:f,_=_<10?"0"+_:_,`${C}:${f}:${_}`},st="ontouchstart"in window,xt=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],aa={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};je("data-v-01791e9e");const sa={class:"d-player-video",id:"dPlayerVideo"},oa=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],la={class:"d-player-lightoff"},ua={key:1,class:"d-player-state"},da={class:"d-play-btn"},ca=["onKeyup","onKeydown"],fa={class:"d-control-progress"},ha={class:"d-tool-bar"},ga={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},pa=j("span",{style:{margin:"0 3px"}},"/",-1),va={class:"total-time"},ma={class:"d-tool-bar"},ya={key:0,class:"d-tool-item quality-btn"},Ea={class:"d-tool-item-main"},Ta={class:"speed-main",style:{"text-align":"center"}},Sa=["onClick"],ba={key:1,class:"d-tool-item speedRate-btn"},La={class:"d-tool-item-main"},ka={class:"speed-main"},Aa=["onClick"],_a={key:2,class:"d-tool-item volume-btn"},Da={class:"d-tool-item-main volume-box",style:{width:"52px"}},Ra={class:"volume-text-size"},Ca={key:3,class:"d-tool-item setting-btn"},Ia={class:"d-tool-item-main"},wa={class:"speed-main"},Oa=ee(" \u955C\u50CF\u753B\u9762 "),Fa=ee(" \u5FAA\u73AF\u64AD\u653E "),Pa=ee(" \u5173\u706F\u6A21\u5F0F "),xa=j("div",{class:"d-tool-item-main"},"\u753B\u4E2D\u753B",-1),Ma=j("div",{class:"d-tool-item-main"},"\u7F51\u9875\u5168\u5C4F",-1),Na=j("div",{class:"d-tool-item-main"},"\u5168\u5C4F",-1);Ve();var ot=ve(Tt(Et({},{name:"vue3VideoPlay",inheritAttrs:!1}),{props:aa,emits:[...xt,"mirrorChange","loopChange","lightOffChange"],setup:function(F,{expose:C,emit:f}){const _=F;kt(w=>({"51d4439c":B(p),"77e758a6":w.width,b8a1afc0:w.height}));const T=new gt({fragLoadingTimeOut:2e3}),S=se(null),D=se(null),I=se(null),R=se(null),o=rt(Tt(Et({dVideo:null},_),{muted:_.muted,playBtnState:_.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),b=(...w)=>P=>w.reverse().reduce((x,M)=>M(x),P),y=xt.reduce((w,P)=>{var x;return w[`on${x=P,x.charAt(0).toUpperCase()+x.slice(1)}`]=M=>{o.loadStateType=P,f(P,M)},w},{});y.onCanplay=b(y.onCanplay,()=>{o.playBtnState!="play"&&o.dVideo.play(),o.autoPlay&&(o.dVideo.play(),o.playBtnState="pause")}),y.onEnded=b(y.onEnded,()=>{o.playBtnState="replay"}),y.onDurationchange=w=>{f("durationchange",w),_.currentTime!=0&&(o.dVideo.currentTime=_.currentTime),y.onTimeupdate(w)},y.onProgress=w=>{console.log("\u7F13\u51B2\u4E2D..."),f("progress",w);let P=w.target.duration,x=w.target.buffered,M=w.target.buffered.length&&w.target.buffered.end(x-1);o.preloadBar=M/P},y.onTimeupdate=w=>{f("timeupdate",w);let P=w.duration||w.target.duration||0,x=w.currentTime||w.target.currentTime;o.playProgress=x/P,o.currentTime=pt(x),o.totalTime=pt(P)},y.onError=b(y.onError,()=>{o.playBtnState="replay"});let d=xr();for(let w in d)y[w]=d[w];const p=(m=o.color,`${parseInt("0x"+m.slice(1,3))},${parseInt("0x"+m.slice(3,5))},${parseInt("0x"+m.slice(5,7))}`);var m;const l=Pt(500,()=>{o.handleType=""}),e=w=>{w.preventDefault(),w.code=="ArrowUp"?o.volume=o.volume+.1>1?1:o.volume+.1:o.volume=o.volume-.1<0?0:o.volume-.1,o.muted=!1,o.handleType="volume",l()},i=w=>{_.speed&&(o.dVideo.currentTime=o.dVideo.currentTime<10?.1:o.dVideo.currentTime-10,y.onTimeupdate(o.dVideo),u())},t=w=>{w.preventDefault();let P=w.type;if(w.key=="ArrowRight"){if(u(),P=="keyup"){if(clearTimeout(o.longPressTimeout),!_.speed&&!o.longPressTimeout)return;o.isMultiplesPlay?(o.dVideo.playbackRate=o.speedActive,o.isMultiplesPlay=!1):(o.dVideo.currentTime=o.dVideo.currentTime+10,y.onTimeupdate(o.dVideo))}else if(P=="keydown"){if(!_.speed)return;o.isMultiplesPlay&&clearTimeout(o.longPressTimeout),o.longPressTimeout=setTimeout(()=>{o.isMultiplesPlay=!0,o.dVideo.playbackRate=5,o.handleType="playbackRate",l()},500)}}},n=()=>{st||R.value.focus()},u=()=>{o.loadStateType="play",o.dVideo.play().catch(()=>{setTimeout(()=>{o.playBtnState="replay",o.loadStateType="error"},500)}),o.playBtnState="pause"},a=()=>{o.dVideo.pause(),o.playBtnState="play"},c=w=>{w&&w.preventDefault(),o.playBtnState=="play"||o.playBtnState=="replay"?u():o.playBtnState=="pause"&&a()},E=()=>{o.muted=!o.muted,o.volume==0&&(o.volume=.05)},g=(w,P)=>{let x=o.dVideo.duration||o.dVideo.target.duration;o.dVideo.currentTime=x*P,o.playBtnState=="play"&&(o.dVideo.play(),o.playBtnState="pause")},v=(w,P)=>{o.progressCursorTime=pt(o.dVideo.duration*P)},r=Pt(2500,()=>{o.isVideoHovering=!1}),s=w=>{o.isVideoHovering=!0,r()},h=w=>{f("mirrorChange",w,o.dVideo)},L=w=>{f("loopChange",w,o.dVideo)},k=w=>{f("lightOffChange",w,o.dVideo)},A=()=>{var w;w=o.dVideo,document.pictureInPictureElement?document.exitPictureInPicture().catch(P=>{console.log(P,"Video failed to leave Picture-in-Picture mode.")}):w.requestPictureInPicture().catch(P=>{console.log(P,"Video failed to enter Picture-in-Picture mode.")})},O=()=>{o.fullScreen=(w=>{let P=document,x=P.webkitIsFullScreen||P.fullscreen;return x?(document.exitFullscreen||P.webkitExitFullScreen).call(P):(w.requestFullscreen||w.webkitRequestFullScreen).call(w),!x})(S.value)};return Ge(()=>_.src,()=>{ft(()=>{o.dVideo.canPlayType(_.type)||o.dVideo.canPlayType("application/vnd.apple.mpegurl")?o.muted=_.autoPlay:gt.isSupported()&&(T.detachMedia(),T.attachMedia(o.dVideo),T.on(gt.Events.MEDIA_ATTACHED,()=>{T.loadSource(_.src),T.on("hlsManifestParsed",(w,P)=>{console.log(P),o.currentLevel=P.level,o.qualityLevels=P.levels||[]})}),T.on("hlsLevelSwitching",(w,P)=>{console.log(P),console.log("LEVEL_SWITCHING")}),T.on("hlsLevelSwitched",(w,P)=>{o.currentLevel=P.level,console.log("LEVEL_SWITCHED")}))})},{immediate:!0}),Lt(()=>{o.dVideo=D,n()}),C({play:u,pause:a,togglePlay:c}),(w,P)=>(H(),q("div",{ref:S,id:"refPlayerWrap",class:J(["d-player-wrap",{"web-full-screen":B(o).webFullScreen,"is-lightoff":B(o).lightOff,"d-player-wrap-hover":B(o).playBtnState=="play"||B(o).isVideoHovering}]),onMousemove:s},[j("div",sa,[j("video",ct({ref:D,class:["d-player-video-main",{"video-mirror":B(o).mirror}],id:"dPlayerVideoMain",controls:!(!B(st)||!B(o).speed),"webkit-playsinline":_.playsinline,playsinline:_.playsinline},B(y),{volume:B(o).volume,muted:B(o).muted,loop:B(o).loop,preload:w.preload,width:"100%",height:"100%",src:_.src,poster:_.poster}),"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002",16,oa)]),K(yt,{name:"d-fade-in"},{default:$(()=>[me(j("div",la,null,512),[[Se,B(o).lightOff]])]),_:1}),B(o).fullScreen?(H(),ce(On,{key:0,title:_.title},null,8,["title"])):Q("",!0),B(st)?Q("",!0):(H(),q("div",ua,[K(yt,{name:"d-scale-out"},{default:$(()=>[me(j("div",da,[K(Ce,{icon:"icon-play",size:40})],512),[[Se,B(o).playBtnState=="play"]])]),_:1}),K(tr,{state:B(o)},null,8,["state"])])),B(st)?Q("",!0):(H(),q("input",{key:2,type:"input",readonly:"readonly",ref:R,onDblclick:O,onKeyup:[Ue(O,["f"]),P[0]||(P[0]=Ue(x=>B(o).webFullScreen=!1,["esc"])),t],onClick:c,onKeydown:[Ue(c,["space"]),Ue(i,["arrow-left"]),Ue(e,["arrow-up","arrow-down"]),t],class:"d-player-input",maxlength:"0"},null,40,ca)),K(rr,{loadType:B(o).loadStateType},null,8,["loadType"]),K(ir),!B(st)&&B(o).control?(H(),q("div",{key:3,class:"d-player-control",ref:I},[j("div",fa,[K(et,{class:"d-progress-bar",onOnMousemove:v,onChange:g,disabled:!B(o).speed,hoverText:B(o).progressCursorTime,modelValue:B(o).playProgress,"onUpdate:modelValue":P[1]||(P[1]=x=>B(o).playProgress=x),preload:B(o).preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),j("div",{class:"d-control-tool",onClick:n},[j("div",ha,[j("div",{class:"d-tool-item",onClick:c},[K(Ce,{size:"24",icon:`icon-${B(o).playBtnState}`},null,8,["icon"])]),_.controlBtns.includes("audioTrack")?(H(),q("div",ga,[j("span",null,ie(B(o).currentTime),1),pa,j("span",va,ie(B(o).totalTime),1)])):Q("",!0)]),j("div",ma,[B(o).qualityLevels.length&&_.controlBtns.includes("quality")?(H(),q("div",ya,[ee(ie(B(o).qualityLevels.length&&(B(o).qualityLevels[B(o).currentLevel]||{}).height)+"P ",1),j("div",Ea,[j("ul",Ta,[(H(!0),q(Ae,null,Pe(B(o).qualityLevels,(x,M)=>(H(),q("li",{class:J({"speed-active":B(o).currentLevel==M}),onClick:N=>((U,G)=>{T.currentLevel=G,o.currentLevel=G})(0,M),key:x},ie(x.height)+"P",11,Sa))),128))])])])):Q("",!0),_.controlBtns.includes("speedRate")?(H(),q("div",ba,[ee(ie(B(o).speedActive=="1.0"?"\u500D\u901F":B(o).speedActive+"x")+" ",1),j("div",La,[j("ul",ka,[(H(!0),q(Ae,null,Pe(B(o).speedRate,x=>(H(),q("li",{class:J({"speed-active":B(o).speedActive==x}),onClick:M=>(N=>{o.speedActive=N,o.dVideo.playbackRate=N})(x),key:x},ie(x)+"x",11,Aa))),128))])])])):Q("",!0),_.controlBtns.includes("volume")?(H(),q("div",_a,[j("div",Da,[j("div",{class:J(["volume-main",{"is-muted":B(o).muted}])},[j("span",Ra,ie(B(o).muted?0:~~(100*B(o).volume))+"%",1),K(et,{onChange:P[2]||(P[2]=x=>B(o).muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:B(o).volume,"onUpdate:modelValue":P[3]||(P[3]=x=>B(o).volume=x)},null,8,["modelValue"])],2)]),j("span",{onClick:E,style:{display:"flex"}},[K(Ce,{size:"20",icon:"icon-volume-"+(B(o).volume==0||B(o).muted?"mute":B(o).volume>.5?"up":"down")},null,8,["icon"])])])):Q("",!0),_.controlBtns.includes("setting")?(H(),q("div",Ca,[K(Ce,{size:"20",class:"rotateHover",icon:"icon-settings"}),j("div",Ia,[j("ul",wa,[j("li",null,[Oa,K(dt,{onChange:h,modelValue:B(o).mirror,"onUpdate:modelValue":P[4]||(P[4]=x=>B(o).mirror=x)},null,8,["modelValue"])]),j("li",null,[Fa,K(dt,{onChange:L,modelValue:B(o).loop,"onUpdate:modelValue":P[5]||(P[5]=x=>B(o).loop=x)},null,8,["modelValue"])]),j("li",null,[Pa,K(dt,{onChange:k,modelValue:B(o).lightOff,"onUpdate:modelValue":P[6]||(P[6]=x=>B(o).lightOff=x)},null,8,["modelValue"])])])])])):Q("",!0),_.controlBtns.includes("pip")?(H(),q("div",{key:4,class:"d-tool-item pip-btn",onClick:A},[K(Ce,{size:"20",icon:"icon-pip"}),xa])):Q("",!0),_.controlBtns.includes("pageFullScreen")?(H(),q("div",{key:5,class:"d-tool-item pip-btn",onClick:P[7]||(P[7]=x=>B(o).webFullScreen=!B(o).webFullScreen)},[K(Ce,{size:"20",icon:"icon-web-screen"}),Ma])):Q("",!0),_.controlBtns.includes("fullScreen")?(H(),q("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:O},[Na,K(Ce,{size:"20",icon:"icon-screen"})])):Q("",!0)])])],512)):Q("",!0)],34))}}));function Ba(F){F.component(ot.name,ot)}ot.__scopeId="data-v-01791e9e",ot.install=Ba;const Ua=ve({__name:"index",props:{src:{type:String,required:!0},width:String,height:String,poster:String},setup(F,{expose:C}){const f=F,_=tt(),T=rt({color:Nr.color_primary,muted:!1,webFullScreen:!1,speedRate:["0.75","1.0","1.25","1.5","2.0"],autoPlay:!0,loop:!1,mirror:!1,ligthOff:!1,volume:.3,control:!0,title:"",poster:"",...f}),S=()=>{_.value.play()},D=()=>{_.value.pause()},I=y=>{console.log("\u64AD\u653E")},R=y=>{console.log(y,"\u6682\u505C")},o=y=>{console.log(y,"\u65F6\u95F4\u66F4\u65B0")},b=y=>{console.log(y,"\u53EF\u4EE5\u64AD\u653E")};return C({play:S,pause:D}),(y,d)=>(H(),q("div",null,[K(B(ot),ct({ref_key:"playerRef",ref:_},T,{src:F.src,onPlay:I,onPause:R,onTimeupdate:o,onCanplay:b}),null,16,["src"])]))}}),Ga={key:0},ja={key:1},Va=ve({__name:"preview",props:{modelValue:{type:Boolean,default:""},url:{type:String,default:""},type:{type:String,default:"image"}},emits:["update:modelValue"],setup(F,{emit:C}){const f=F,_=tt(),T=()=>{C("update:modelValue",!1)},S=se([]);return Ge(()=>f.modelValue,D=>{D?ft(()=>{var I;S.value=[f.url],(I=_.value)==null||I.play()}):ft(()=>{var I;S.value=[],(I=_.value)==null||I.pause()})}),(D,I)=>{const R=ii,o=Ua,b=$t;return me((H(),q("div",null,[F.type=="image"?(H(),q("div",Ga,[S.value.length?(H(),ce(R,{key:0,"url-list":S.value,"hide-on-click-modal":"",onClose:T},null,8,["url-list"])):Q("",!0)])):Q("",!0),F.type=="video"?(H(),q("div",ja,[K(b,{modelValue:F.modelValue,"onUpdate:modelValue":I[0]||(I[0]=y=>Br(modelValue)?modelValue.value=y:null),width:"740px",title:"\u89C6\u9891\u9884\u89C8","before-close":T},{default:$(()=>[K(o,{ref_key:"playerRef",ref:_,src:F.url,width:"700px",height:"450px"},null,8,["src"])]),_:1},8,["modelValue"])])):Q("",!0)],512)),[[Se,F.modelValue]])}}});var Ka="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAACJElEQVRYR+2YMWsUURSFz3m7s+nskjUIQSutbMRi7WzUVjSadMHCbVLkByjmLygaCVYWRqMEUhkFS9Gg0cJfYCPZjYUQFbPs+I7c2R1Q2ZjZfRNYYS4MAzPv3vnmvDvL3kMA2Hl5/CjLI9ckf4ZwY3Zt15C+gfwIao3So0rt3XsJtPUk9M/cAW6y9ap2DIyfAjgCwANwGeoYiEFtk/5e5CvXeer1D2neATcGgiTZM4+t9RNLEKcBtAFEGeBsiRWzl7EoSXo+8rV9gWc/fDc1B1VSEoEnDpj0KTB33tS26DGaEezvZQZpRxmODyoT5+vwBwS3zeTcT4yjTdZNJEiPSykk1bjZX6HeD/WQJ1zUApgq2w+etcsniBuAVlH9vELOx6Yo1VywgkmTB4X1kEGGhyAtg/Ecq3NNqnknDwVTrNBaactEts88OHs5b8Bw/Tof4M+kr4WrwwhoL9n5uRPWhxWwsxPEl+EGNMacP5I8evCPGgVgqKSFgoWCoQqE5hc9WCgYqkBoftGDeSiYz1/+UJLe+foftvh2A2B1fwQIrapkaFoDcK4PVyH0qVnyU4fjGdW4NQ2WlgDE5hLkMoJmQdh9zW9Dk59K5lhtLjyE01TX/jDILP5MGEbvbFPOJroIXvc5PjvTBbx7GM4vAjjd9WdSc2g/IPaqaTv5Aq58haP1TSb2Au20GGErvgTxIqiTAA7tVSnn+2Z9vAXdCsa4bD6Nsf0C/gYA5PMzcW0AAAAASUVORK5CYII=";const Ha=ve({components:{PopoverInput:Jt,Pagination:Kt,Popup:Wt,Upload:Zt,FileItem:sn,Preview:Va},props:{fileSize:{type:String,default:"100px"},limit:{type:Number,default:1},type:{type:String,default:"image"},mode:{type:String,default:"select"},pageSize:{type:Number,default:10}},emits:["change"],setup(F,{emit:C}){const f=se(null),{limit:_}=Ur(F),T=le(()=>{switch(F.type){case"image":return 10;case"video":return 20;case"file":return 30}}),S=Gt("visible"),D=se(""),I=se(!1),{cateId:R,cateLists:o,handleAddCate:b,handleEditCate:y,handleDeleteCate:d,getCateLists:p}=Tn(T),{tableRef:m,listShowType:l,moveId:e,pager:i,fileParams:t,select:n,isCheckAll:u,isIndeterminate:a,getFileList:c,refresh:E,batchFileDelete:g,batchFileMove:v,selectFile:r,selectStatus:s,clearSelect:h,cancelSelete:L,selectAll:k,fileRename:A}=Sn(R,T,_,F.pageSize),O=M=>{R.value=M.id},w=async()=>{var M;await p(),(M=f.value)==null||M.setCurrentKey(R.value),c()},P=M=>n.value.findIndex(N=>N.id==M)!=-1,x=M=>{D.value=M,I.value=!0};return Ge(S,async M=>{M&&w()},{immediate:!0}),Ge(R,M=>{t.name="",E()}),Ge(n,M=>{if(C("change",M),M.length==i.lists.length&&M.length!==0){a.value=!1,u.value=!0;return}M.length>0?a.value=!0:(u.value=!1,a.value=!1)},{deep:!0}),Lt(()=>{F.mode=="page"&&w()}),{showPreview:I,handlePreview:x,isSelected:P,tableRef:m,listShowType:l,previewUrl:D,treeRefs:f,Search:Gr,limit:_,cateId:R,cateLists:o,handleAddCate:b,handleEditCate:y,handleDeleteCate:d,currentChange:O,moveId:e,pager:i,fileParams:t,select:n,isCheckAll:u,isIndeterminate:a,getFileList:c,refresh:E,batchFileDelete:g,batchFileMove:v,selectFile:r,selectStatus:s,clearSelect:h,cancelSelete:L,selectAll:k,fileRename:A}}}),ht=F=>(je("data-v-e2b14d94"),F=F(),Ve(),F),Wa={class:"material flex col-stretch"},$a={class:"material__left"},qa={class:"material-left__content p-t-16 p-b-16"},Ya={class:"flex flex-1 flex-center",style:{"min-width":"0"}},za=ht(()=>j("img",{style:{width:"20px",height:"16px"},src:Ka,class:"m-r-10"},null,-1)),Xa={class:"flex-1 line-1 m-r-10"},Qa=ht(()=>j("span",{class:"muted m-r-10"},"\xB7\xB7\xB7",-1)),Za=ee("\u547D\u540D\u5206\u7EC4"),Ja=["onClick"],es=ee("\u5220\u9664\u5206\u7EC4"),ts={class:"flex flex-center"},rs=ee("\u6DFB\u52A0\u5206\u7EC4"),is={class:"material__center flex flex-col"},ns={class:"operate-btn flex"},as={class:"flex-1 flex"},ss=ee("\u672C\u5730\u4E0A\u4F20"),os=ee("\u5220\u9664"),ls=ee("\u79FB\u52A8"),us=ht(()=>j("span",{class:"m-r-20"},"\u79FB\u52A8\u6587\u4EF6\u81F3",-1)),ds={class:"flex col-center m-l-10"},cs={key:0,class:"m-t-10"},fs=ee("\u5F53\u9875\u5168\u9009"),hs={class:"material-center__content flex flex-col flex-1 m-b-4"},gs={class:"file-list flex flex-wrap m-t-14"},ps={key:0,class:"item-selected"},vs={class:"item-name line-1 p-t-10"},ms={class:"operation-btns flex col-center"},ys=ee("\u91CD\u547D\u540D"),Es=ee("\u67E5\u770B"),Ts=ee("\u5220\u9664"),Ss=ee("\u91CD\u547D\u540D"),bs=ee("\u67E5\u770B"),Ls=ee("\u5220\u9664"),ks={key:0,class:"flex flex-1 row-center col-center"},As={class:"material-center__footer flex row-between col-center"},_s={class:"flex"},Ds={class:"m-r-10"},Rs=ee("\u5F53\u9875\u5168\u9009"),Cs=ee("\u5220\u9664"),Is=ee("\u79FB\u52A8"),ws=ht(()=>j("span",{class:"m-r-20"},"\u79FB\u52A8\u6587\u4EF6\u81F3",-1)),Os={key:0,class:"material__right"},Fs={class:"flex row-between p-l-10 p-r-10"},Ps={class:"sm flex flex-center"},xs={key:0},Ms=ee("\u6E05\u7A7A"),Ns={class:"select-lists flex-col p-t-10"},Bs={class:"select-item"};function Us(F,C,f,_,T,S){const D=Vr,I=Jt,R=Kr,o=Hr,b=Jr,y=Wr,d=jt,p=Zt,m=Wt,l=Qr,e=Zr,i=Ht,t=$r,n=jr,u=Xr,a=ut("check"),c=Fe,E=ut("file-item"),g=Yr,v=di,r=zr,s=Kt,h=tn,L=ut("preview"),k=qr;return me((H(),q("div",Wa,[j("div",$a,[K(y,{class:"ls-scrollbar",style:{height:"calc(100% - 40px)"}},{default:$(()=>[j("div",qa,[K(b,{ref:"treeRefs","node-key":"id",data:F.cateLists,"empty-text":"","highlight-current":!0,"expand-on-click-node":!1,"icon-class":"el-icon-arrow-right","current-node-key":F.cateId,onNodeClick:F.currentChange},{default:$(({data:A})=>[j("div",Ya,[za,j("span",Xa,ie(A.name),1),A.id>0?(H(),ce(o,{key:0,"hide-on-click":!1},{dropdown:$(()=>[K(R,null,{default:$(()=>[j("div",null,[K(I,{type:"text",tips:"\u5206\u7C7B\u540D\u79F0",onConfirm:O=>F.handleEditCate(O,A.id)},{default:$(()=>[K(D,null,{default:$(()=>[Za]),_:1})]),_:2},1032,["onConfirm"])]),j("div",{onClick:O=>F.handleDeleteCate(A.id)},[K(D,null,{default:$(()=>[es]),_:1})],8,Ja)]),_:2},1024)]),default:$(()=>[Qa]),_:2},1024)):Q("",!0)])]),_:1},8,["data","current-node-key","onNodeClick"])])]),_:1}),j("div",ts,[K(I,{tips:"\u5206\u7C7B\u540D\u79F0",type:"text",onConfirm:F.handleAddCate},{default:$(()=>[K(d,null,{default:$(()=>[rs]),_:1})]),_:1},8,["onConfirm"])])]),j("div",is,[j("div",ns,[j("div",as,[K(p,{class:"m-r-10",data:{cid:F.cateId},type:F.type,"show-progress":!0,onChange:F.refresh},{default:$(()=>[K(d,{type:"primary"},{default:$(()=>[ss]),_:1})]),_:1},8,["data","type","onChange"]),F.mode=="page"?(H(),ce(m,{key:0,class:"m-r-10 inline",content:"\u786E\u8BA4\u5220\u9664\u540E\uFF0C\u672C\u5730\u6216\u4E91\u5B58\u50A8\u56FE\u7247\u4E5F\u5C06\u540C\u6B65\u5220\u9664\uFF0C\u5982\u56FE\u7247\u5DF2\u88AB\u4F7F\u7528\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01",disabled:!F.select.length,onConfirm:C[0]||(C[0]=A=>F.batchFileDelete())},{trigger:$(()=>[K(d,{disabled:!F.select.length},{default:$(()=>[os]),_:1},8,["disabled"])]),_:1},8,["disabled"])):Q("",!0),F.mode=="page"?(H(),ce(m,{key:1,class:"m-r-10 inline",onConfirm:F.batchFileMove,disabled:!F.select.length,title:"\u79FB\u52A8\u6587\u4EF6"},{trigger:$(()=>[K(d,{disabled:!F.select.length},{default:$(()=>[ls]),_:1},8,["disabled"])]),default:$(()=>[j("div",null,[us,K(e,{modelValue:F.moveId,"onUpdate:modelValue":C[1]||(C[1]=A=>F.moveId=A),placeholder:"\u8BF7\u9009\u62E9"},{default:$(()=>[(H(!0),q(Ae,null,Pe(F.cateLists,A=>(H(),q(Ae,{key:A.id},[A.id!==""?(H(),ce(l,{key:0,label:A.name,value:A.id},null,8,["label","value"])):Q("",!0)],64))),128))]),_:1},8,["modelValue"])])]),_:1},8,["onConfirm","disabled"])):Q("",!0)]),K(i,{placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",style:{width:"280px"},modelValue:F.fileParams.name,"onUpdate:modelValue":C[2]||(C[2]=A=>F.fileParams.name=A),onKeyup:Ue(F.refresh,["enter"])},{append:$(()=>[K(d,{icon:F.Search,onClick:F.refresh},null,8,["icon","onClick"])]),_:1},8,["modelValue","onKeyup"]),j("div",ds,[K(n,{content:"\u5217\u8868\u89C6\u56FE",placement:"top"},{default:$(()=>[j("div",{class:J(["list-icon",{select:F.listShowType=="table"}]),onClick:C[3]||(C[3]=A=>F.listShowType="table")},[K(t,{name:"el-icon-Fold",size:18})],2)]),_:1}),K(n,{content:"\u5E73\u94FA\u89C6\u56FE",placement:"top"},{default:$(()=>[j("div",{class:J(["list-icon",{select:F.listShowType=="normal"}]),onClick:C[4]||(C[4]=A=>F.listShowType="normal")},[K(t,{name:"el-icon-Menu",size:18})],2)]),_:1})])]),F.mode=="page"?(H(),q("div",cs,[K(u,{disabled:!F.pager.lists.length,modelValue:F.isCheckAll,"onUpdate:modelValue":C[5]||(C[5]=A=>F.isCheckAll=A),onChange:F.selectAll,indeterminate:F.isIndeterminate},{default:$(()=>[fs]),_:1},8,["disabled","modelValue","onChange","indeterminate"])])):Q("",!0),j("div",hs,[me(j("ul",gs,[(H(!0),q(Ae,null,Pe(F.pager.lists,A=>(H(),q("li",{class:"file-item-wrap",key:A.id,style:Te({width:F.fileSize})},[K(E,{uri:A.uri,"file-size":F.fileSize,type:F.type,onClick:O=>F.selectFile(A)},{default:$(()=>[F.selectStatus(A.id)?(H(),q("div",ps,[K(c,{color:"#fff",size:24},{default:$(()=>[K(a)]),_:1})])):Q("",!0)]),_:2},1032,["uri","file-size","type","onClick"]),j("div",vs,ie(A.name),1),j("div",ms,[K(I,{type:"text",value:A.name,onConfirm:O=>F.fileRename(O,A.id)},{default:$(()=>[K(d,{type:"primary",link:""},{default:$(()=>[ys]),_:1})]),_:2},1032,["value","onConfirm"]),K(d,{type:"primary",link:"",onClick:O=>F.handlePreview(A.uri)},{default:$(()=>[Es]),_:2},1032,["onClick"]),K(m,{class:"m-r-10 inline",content:"\u786E\u8BA4\u5220\u9664\u540E\uFF0C\u672C\u5730\u6216\u4E91\u5B58\u50A8\u56FE\u7247\u4E5F\u5C06\u540C\u6B65\u5220\u9664\uFF0C\u5982\u56FE\u7247\u5DF2\u88AB\u4F7F\u7528\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01",onConfirm:O=>F.batchFileDelete([A.id])},{trigger:$(()=>[K(d,{type:"primary",link:""},{default:$(()=>[Ts]),_:1})]),_:2},1032,["onConfirm"])])],4))),128))],512),[[Se,F.listShowType=="normal"]]),me(K(r,{ref:"tableRef",class:"m-t-16",data:F.pager.lists,width:"100%",height:"100%",onRowClick:F.selectFile},{default:$(()=>[K(g,{width:"55"},{default:$(({row:A})=>[K(u,{modelValue:F.isSelected(A.id),onChange:O=>F.selectFile(A)},null,8,["modelValue","onChange"])]),_:1}),K(g,{label:"\u56FE\u7247",width:"60"},{default:$(({row:A})=>[K(E,{uri:A.uri,"file-size":"40px"},null,8,["uri"])]),_:1}),K(g,{label:"\u540D\u79F0","min-width":"100","show-overflow-tooltip":""},{default:$(({row:A})=>[K(v,{onClick:Re(O=>F.handlePreview(A.uri),["stop"])},{default:$(()=>[ee(ie(A.name),1)]),_:2},1032,["onClick"])]),_:1}),K(g,{prop:"create_time",label:"\u4E0A\u4F20\u65F6\u95F4","min-width":"100"}),K(g,{label:"\u64CD\u4F5C",width:"150",fixed:"right"},{default:$(({row:A})=>[K(I,{class:"inline",type:"text",value:A.name,onConfirm:O=>F.fileRename(O,A.id),onClick:C[6]||(C[6]=Re(()=>{},["stop"]))},{default:$(()=>[K(d,{type:"primary",link:""},{default:$(()=>[Ss]),_:1})]),_:2},1032,["value","onConfirm"]),K(d,{type:"primary",link:"",onClick:Re(O=>F.handlePreview(A.uri),["stop"])},{default:$(()=>[bs]),_:2},1032,["onClick"]),K(m,{class:"m-r-10 inline",content:"\u786E\u8BA4\u5220\u9664\u540E\uFF0C\u672C\u5730\u6216\u4E91\u5B58\u50A8\u56FE\u7247\u4E5F\u5C06\u540C\u6B65\u5220\u9664\uFF0C\u5982\u56FE\u7247\u5DF2\u88AB\u4F7F\u7528\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01",onConfirm:O=>F.batchFileDelete([A.id]),onClick:C[7]||(C[7]=Re(()=>{},["stop"]))},{trigger:$(()=>[K(d,{type:"primary",link:""},{default:$(()=>[Ls]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data","onRowClick"]),[[Se,F.listShowType=="table"]]),!F.pager.loading&&!F.pager.lists.length?(H(),q("div",ks,"\u6682\u65E0\u6570\u636E~")):Q("",!0)]),j("div",As,[j("div",_s,[F.mode=="page"?(H(),q(Ae,{key:0},[j("span",Ds,[K(u,{disabled:!F.pager.lists.length,modelValue:F.isCheckAll,"onUpdate:modelValue":C[8]||(C[8]=A=>F.isCheckAll=A),onChange:F.selectAll,indeterminate:F.isIndeterminate},{default:$(()=>[Rs]),_:1},8,["disabled","modelValue","onChange","indeterminate"])]),K(m,{class:"m-r-10 inline",content:"\u786E\u8BA4\u5220\u9664\u540E\uFF0C\u672C\u5730\u6216\u4E91\u5B58\u50A8\u56FE\u7247\u4E5F\u5C06\u540C\u6B65\u5220\u9664\uFF0C\u5982\u56FE\u7247\u5DF2\u88AB\u4F7F\u7528\uFF0C\u8BF7\u8C28\u614E\u64CD\u4F5C\uFF01",disabled:!F.select.length,onConfirm:C[9]||(C[9]=A=>F.batchFileDelete())},{trigger:$(()=>[K(d,{disabled:!F.select.length},{default:$(()=>[Cs]),_:1},8,["disabled"])]),_:1},8,["disabled"]),K(m,{class:"m-r-10 inline",onConfirm:F.batchFileMove,disabled:!F.select.length,title:"\u79FB\u52A8\u6587\u4EF6"},{trigger:$(()=>[K(d,{disabled:!F.select.length},{default:$(()=>[Is]),_:1},8,["disabled"])]),default:$(()=>[j("div",null,[ws,K(e,{modelValue:F.moveId,"onUpdate:modelValue":C[10]||(C[10]=A=>F.moveId=A),placeholder:"\u8BF7\u9009\u62E9"},{default:$(()=>[(H(!0),q(Ae,null,Pe(F.cateLists,A=>(H(),q(Ae,{key:A.id},[A.id!==""?(H(),ce(l,{key:0,label:A.name,value:A.id},null,8,["label","value"])):Q("",!0)],64))),128))]),_:1},8,["modelValue"])])]),_:1},8,["onConfirm","disabled"])],64)):Q("",!0)]),K(s,{modelValue:F.pager,"onUpdate:modelValue":C[11]||(C[11]=A=>F.pager=A),onChange:F.getFileList,layout:"total, prev, pager, next, jumper"},null,8,["modelValue","onChange"])])]),F.mode=="select"?(H(),q("div",Os,[j("div",Fs,[j("div",Ps,[ee(" \u5DF2\u9009\u62E9 "+ie(F.select.length)+" ",1),F.limit?(H(),q("span",xs,"/"+ie(F.limit),1)):Q("",!0)]),K(d,{type:"text",onClick:F.clearSelect},{default:$(()=>[Ms]),_:1},8,["onClick"])]),K(y,{class:"ls-scrollbar",style:{height:"calc(100% - 32px)"}},{default:$(()=>[j("ul",Ns,[(H(!0),q(Ae,null,Pe(F.select,A=>(H(),q("li",{class:"m-b-16",key:A.id},[j("div",Bs,[K(h,{onClose:O=>F.cancelSelete(A.id)},{default:$(()=>[K(E,{uri:A.uri,"file-size":"100px",type:F.type},null,8,["uri","type"])]),_:2},1032,["onClose"])])]))),128))])]),_:1})])):Q("",!0),K(L,{modelValue:F.showPreview,"onUpdate:modelValue":C[12]||(C[12]=A=>F.showPreview=A),url:F.previewUrl,type:F.type},null,8,["modelValue","url","type"])])),[[k,F.pager.loading]])}var eo=lt(Ha,[["render",Us],["__scopeId","data-v-e2b14d94"]]);export{sn as F,eo as M,Va as _,tn as a};
